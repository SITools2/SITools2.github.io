<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.namespace(&quot;sitools.env&quot;);var i18n={map:[],load:function(a,c){var b=this;Ext.Ajax.request({method:&quot;GET&quot;,url:a,success:function(d,e){ann(d.responseText,&quot;no response is sent&quot;);b.map=b.transformsPropertiesToMap(d.responseText);c()},failure:function(d,e){Ext.Msg.alert(&quot;Error! Can't read i18n file with url :&quot;+a)}})},transformsPropertiesToMap:function(g){var k=g.split(&quot;\n&quot;);var f=[];for(var d=0;d&lt;k.length;d++){var a=k[d];var c=a.indexOf(&quot;=&quot;);if(c&gt;=1){var b=a.substring(0,c).replace(&quot;\r&quot;,&quot;&quot;);var e=a.substring(c+1).replace(&quot;\r&quot;,&quot;&quot;);f[b]=e}}return f},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var sql2ext={map:[],load:function(a){var b=this;Ext.Ajax.request({method:&quot;GET&quot;,url:a,success:function(c,d){ann(c.responseText,&quot;no response is sent&quot;);b.map=b.transformsPropertiesToMap(c.responseText)},failure:function(c,d){alert(&quot;Error! Can't read i18n file with url :&quot;+a)}})},transformsPropertiesToMap:function(g){var k=g.split(&quot;\n&quot;);var f=[];var d;for(d=0;d&lt;k.length;d++){var a=k[d];var c=a.indexOf(&quot;=&quot;);if(c&gt;=1){var b=a.substring(0,c).replace(&quot;\r&quot;,&quot;&quot;);var e=a.substring(c+1).replace(&quot;\r&quot;,&quot;&quot;);f[b]=e}}return f},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:&quot;auto&quot;}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:&quot;GET&quot;,url:b,success:function(c,d){a(Ext.decode(c.responseText))},failure:function(c,d){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+b)}});return this.ret}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this)}});Ext.namespace(&quot;sitools.siteMap&quot;);var loadUrl={map:[],load:function(a,d,b){var c=this;c.transformsPropertiesToMap(a,d,b)},transformsPropertiesToMap:function(b,e,c){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:b,restful:true}),reader:new Ext.data.XmlReader({record:&quot;url&quot;},[{name:&quot;name&quot;,mapping:&quot;name&quot;},{name:&quot;loc&quot;,mapping:&quot;loc&quot;}])});var d=this.map;a.load({scope:c,callback:function(m,k,p){var l=0;while(l!=undefined){var n=m[l];if(n!=undefined){var g=n.data.loc;var f=n.data.name;d[f]=g;l++}else{l=undefined}}e.call(this)}})},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:&quot;GET&quot;,url:b,success:function(c,d){a(Ext.decode(c.responseText))},failure:function(c,d){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+b)}});return this.ret}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this)}});var Base64={_keyStr:&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;,encode:function(c){var a=&quot;&quot;;var m,k,f,l,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b&lt;c.length){m=c.charCodeAt(b++);k=c.charCodeAt(b++);f=c.charCodeAt(b++);l=m&gt;&gt;2;g=((m&amp;3)&lt;&lt;4)|(k&gt;&gt;4);e=((k&amp;15)&lt;&lt;2)|(f&gt;&gt;6);d=f&amp;63;if(isNaN(k)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(l)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a=&quot;&quot;;var m,k,f;var l,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,&quot;&quot;);while(b&lt;c.length){l=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));m=(l&lt;&lt;2)|(g&gt;&gt;4);k=((g&amp;15)&lt;&lt;4)|(e&gt;&gt;2);f=((e&amp;3)&lt;&lt;6)|d;a=a+String.fromCharCode(m);if(e!=64){a=a+String.fromCharCode(k)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,&quot;\n&quot;);var a=&quot;&quot;;for(var e=0;e&lt;b.length;e++){var d=b.charCodeAt(e);if(d&lt;128){a+=String.fromCharCode(d)}else{if((d&gt;127)&amp;&amp;(d&lt;2048)){a+=String.fromCharCode((d&gt;&gt;6)|192);a+=String.fromCharCode((d&amp;63)|128)}else{a+=String.fromCharCode((d&gt;&gt;12)|224);a+=String.fromCharCode(((d&gt;&gt;6)&amp;63)|128);a+=String.fromCharCode((d&amp;63)|128)}}}return a},_utf8_decode:function(a){var b=&quot;&quot;;var d=0;var e=c1=c2=0;while(d&lt;a.length){e=a.charCodeAt(d);if(e&lt;128){b+=String.fromCharCode(e);d++}else{if((e&gt;191)&amp;&amp;(e&lt;224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&amp;31)&lt;&lt;6)|(c2&amp;63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&amp;15)&lt;&lt;12)|((c2&amp;63)&lt;&lt;6)|(c3&amp;63));d+=3}}}return b}};function array(a){for(i=0;i&lt;a;i++){this[i]=0}this.length=a}function integer(a){return a%(4294967295+1)}function shr(d,c){d=integer(d);c=integer(c);if(d-2147483648&gt;=0){d=d%2147483648;d&gt;&gt;=c;d+=1073741824&gt;&gt;(c-1)}else{d&gt;&gt;=c}return d}function shl1(b){b=b%2147483648;if(b&amp;1073741824==1073741824){b-=1073741824;b*=2;b+=2147483648}else{b*=2}return b}function shl(d,c){d=integer(d);c=integer(c);for(var e=0;e&lt;c;e++){d=shl1(d)}return d}function and(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f&gt;=0){if(e&gt;=0){return((f&amp;e)+2147483648)}else{return(f&amp;c)}}else{if(e&gt;=0){return(d&amp;e)}else{return(d&amp;c)}}}function or(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f&gt;=0){if(e&gt;=0){return((f|e)+2147483648)}else{return((f|c)+2147483648)}}else{if(e&gt;=0){return((d|e)+2147483648)}else{return(d|c)}}}function xor(d,c){d=integer(d);c=integer(c);var f=(d-2147483648);var e=(c-2147483648);if(f&gt;=0){if(e&gt;=0){return(f^e)}else{return((f^c)+2147483648)}}else{if(e&gt;=0){return((d^e)+2147483648)}else{return(d^c)}}}function not(b){b=integer(b);return(4294967295-b)}var state=new array(4);var count=new array(2);count[0]=0;count[1]=0;var buffer=new array(64);var transformBuffer=new array(16);var digestBits=new array(16);var S11=7;var S12=12;var S13=17;var S14=22;var S21=5;var S22=9;var S23=14;var S24=20;var S31=4;var S32=11;var S33=16;var S34=23;var S41=6;var S42=10;var S43=15;var S44=21;function F(a,c,b){return or(and(a,c),and(not(a),b))}function G(a,c,b){return or(and(a,b),and(c,not(b)))}function H(a,c,b){return xor(xor(a,c),b)}function I(a,c,b){return xor(c,or(a,not(b)))}function rotateLeft(b,c){return or(shl(b,c),(shr(b,(32-c))))}function FF(g,f,n,m,e,k,l){g=g+F(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function GG(g,f,n,m,e,k,l){g=g+G(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function HH(g,f,n,m,e,k,l){g=g+H(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function II(g,f,n,m,e,k,l){g=g+I(f,n,m)+e+l;g=rotateLeft(g,k);g=g+f;return g}function transform(k,m){var g=0,f=0,n=0,l=0;var e=transformBuffer;g=state[0];f=state[1];n=state[2];l=state[3];for(i=0;i&lt;16;i++){e[i]=and(k[i*4+m],255);for(j=1;j&lt;4;j++){e[i]+=shl(and(k[i*4+j+m],255),j*8)}}g=FF(g,f,n,l,e[0],S11,3614090360);l=FF(l,g,f,n,e[1],S12,3905402710);n=FF(n,l,g,f,e[2],S13,606105819);f=FF(f,n,l,g,e[3],S14,3250441966);g=FF(g,f,n,l,e[4],S11,4118548399);l=FF(l,g,f,n,e[5],S12,1200080426);n=FF(n,l,g,f,e[6],S13,2821735955);f=FF(f,n,l,g,e[7],S14,4249261313);g=FF(g,f,n,l,e[8],S11,1770035416);l=FF(l,g,f,n,e[9],S12,2336552879);n=FF(n,l,g,f,e[10],S13,4294925233);f=FF(f,n,l,g,e[11],S14,2304563134);g=FF(g,f,n,l,e[12],S11,1804603682);l=FF(l,g,f,n,e[13],S12,4254626195);n=FF(n,l,g,f,e[14],S13,2792965006);f=FF(f,n,l,g,e[15],S14,1236535329);g=GG(g,f,n,l,e[1],S21,4129170786);l=GG(l,g,f,n,e[6],S22,3225465664);n=GG(n,l,g,f,e[11],S23,643717713);f=GG(f,n,l,g,e[0],S24,3921069994);g=GG(g,f,n,l,e[5],S21,3593408605);l=GG(l,g,f,n,e[10],S22,38016083);n=GG(n,l,g,f,e[15],S23,3634488961);f=GG(f,n,l,g,e[4],S24,3889429448);g=GG(g,f,n,l,e[9],S21,568446438);l=GG(l,g,f,n,e[14],S22,3275163606);n=GG(n,l,g,f,e[3],S23,4107603335);f=GG(f,n,l,g,e[8],S24,1163531501);g=GG(g,f,n,l,e[13],S21,2850285829);l=GG(l,g,f,n,e[2],S22,4243563512);n=GG(n,l,g,f,e[7],S23,1735328473);f=GG(f,n,l,g,e[12],S24,2368359562);g=HH(g,f,n,l,e[5],S31,4294588738);l=HH(l,g,f,n,e[8],S32,2272392833);n=HH(n,l,g,f,e[11],S33,1839030562);f=HH(f,n,l,g,e[14],S34,4259657740);g=HH(g,f,n,l,e[1],S31,2763975236);l=HH(l,g,f,n,e[4],S32,1272893353);n=HH(n,l,g,f,e[7],S33,4139469664);f=HH(f,n,l,g,e[10],S34,3200236656);g=HH(g,f,n,l,e[13],S31,681279174);l=HH(l,g,f,n,e[0],S32,3936430074);n=HH(n,l,g,f,e[3],S33,3572445317);f=HH(f,n,l,g,e[6],S34,76029189);g=HH(g,f,n,l,e[9],S31,3654602809);l=HH(l,g,f,n,e[12],S32,3873151461);n=HH(n,l,g,f,e[15],S33,530742520);f=HH(f,n,l,g,e[2],S34,3299628645);g=II(g,f,n,l,e[0],S41,4096336452);l=II(l,g,f,n,e[7],S42,1126891415);n=II(n,l,g,f,e[14],S43,2878612391);f=II(f,n,l,g,e[5],S44,4237533241);g=II(g,f,n,l,e[12],S41,1700485571);l=II(l,g,f,n,e[3],S42,2399980690);n=II(n,l,g,f,e[10],S43,4293915773);f=II(f,n,l,g,e[1],S44,2240044497);g=II(g,f,n,l,e[8],S41,1873313359);l=II(l,g,f,n,e[15],S42,4264355552);n=II(n,l,g,f,e[6],S43,2734768916);f=II(f,n,l,g,e[13],S44,1309151649);g=II(g,f,n,l,e[4],S41,4149444226);l=II(l,g,f,n,e[11],S42,3174756917);n=II(n,l,g,f,e[2],S43,718787259);f=II(f,n,l,g,e[9],S44,3951481745);state[0]+=g;state[1]+=f;state[2]+=n;state[3]+=l}function init(){count[0]=count[1]=0;state[0]=1732584193;state[1]=4023233417;state[2]=2562383102;state[3]=271733878;for(i=0;i&lt;digestBits.length;i++){digestBits[i]=0}}function update(a){var c,d;c=and(shr(count[0],3),63);if(count[0]&lt;4294967295-7){count[0]+=8}else{count[1]++;count[0]-=4294967295+1;count[0]+=8}buffer[c]=and(a,255);if(c&gt;=63){transform(buffer,0)}}function finish(){var d=new array(8);var e;var c=0,b=0,a=0;for(c=0;c&lt;4;c++){d[c]=and(shr(count[0],(c*8)),255)}for(c=0;c&lt;4;c++){d[c+4]=and(shr(count[1],(c*8)),255)}b=and(shr(count[0],3),63);a=(b&lt;56)?(56-b):(120-b);e=new array(64);e[0]=128;for(c=0;c&lt;a;c++){update(e[c])}for(c=0;c&lt;8;c++){update(d[c])}for(c=0;c&lt;4;c++){for(j=0;j&lt;4;j++){digestBits[c*4+j]=and(shr(state[c],(j*8)),255)}}}function hexa(d){var c=&quot;0123456789abcdef&quot;;var a=&quot;&quot;;var b=d;for(hexa_i=0;hexa_i&lt;8;hexa_i++){a=c.charAt(Math.abs(b)%16)+a;b=Math.floor(b/16)}return a}var ascii=&quot;01234567890123456789012345678901 !\&quot;#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~&quot;;function MD5(m){var a,f,b,g,e,d,c;init();for(b=0;b&lt;m.length;b++){a=m.charAt(b);update(ascii.lastIndexOf(a))}finish();g=e=d=c=0;for(i=0;i&lt;4;i++){g+=shl(digestBits[15-i],(i*8))}for(i=4;i&lt;8;i++){e+=shl(digestBits[15-i],((i-4)*8))}for(i=8;i&lt;12;i++){d+=shl(digestBits[15-i],((i-8)*8))}for(i=12;i&lt;16;i++){c+=shl(digestBits[15-i],((i-12)*8))}f=hexa(c)+hexa(d)+hexa(e)+hexa(g);return f}function Digest(a){this.url=a.url;this.usr=a.usr;this.pwd=a.pwd;this.realm=a.realm;this.algorithm=a.algorithm;this.nonce=a.nonce;this.method=a.method;this.mode=a.mode;this.A1=a.A1;this.getDigestAuth=function(){this.resetHeaders();return this.buildAuthenticationRequest()};this.getA1=function(){this.resetHeaders();return this.digest(this.usr+&quot;:&quot;+this.realm+&quot;:&quot;+this.pwd)};this.resetHeaders=function(){if(typeof(this.headers)!=&quot;undefined&quot;){delete this.headers}this.headers={uri:this.url,username:this.usr,algorithm:this.algorithm,realm:this.realm,nonce:this.nonce}};this.digest=function(b){if(typeof(window[this.headers.algorithm])!=&quot;function&quot;){if(typeof(window.MD5)!=&quot;function&quot;){alert(&quot;Votre navigateur ne supporte pas l'authentification HTTP Digest !&quot;);return false}else{return MD5(b)}}return window[this.headers.algorithm](b)};this.buildResponseHash=function(){if(this.headers.salt){auth.secret=auth.secret+&quot;:&quot;+auth.headers.salt;delete auth.headers.salt}if(this.headers.migrate){auth.secret=this.digest(auth.secret)}var c;if(Ext.isEmpty(this.A1)){c=this.getA1()}else{c=this.A1}var b=this.digest(this.method+&quot;:&quot;+this.headers.uri);if(this.mode==&quot;digest&quot;){return this.digest(c+&quot;:&quot;+this.headers.nonce+&quot;:&quot;+b)}return null};this.buildAuthenticationRequest=function(){var d=&quot;Digest&quot;;var b=&quot; &quot;;for(name in this.headers){d+=b+name+'=&quot;'+this.headers[name]+'&quot;';b=&quot;,&quot;}if(typeof(this.headers.algorithm)==&quot;undefined&quot;){return d}var c=this.buildResponseHash();if(c){d+=', response=&quot;'+c+'&quot;';return d}return false}}function ann(b,a){if(b===true||b===false){return}if(b===undefined){cerr(&quot;Object is undefined - &quot;+a);ctrace();return}if(b===null){cerr(&quot;Object is null - &quot;+a);ctrace();return}if(b===&quot;&quot;){cerr(&quot;String seems empty - &quot;+a);ctrace();return}if(b==NaN){cerr(&quot;Object equals NaN - &quot;+a);ctrace();return}}function assert(b,a){if(!b){cerr(&quot;Condition is not valid : &quot;+a);ctrace();return}}function clog(a){if(isFirebugConsoleIsActive()){console.log(a)}}function cerr(a){if(isFirebugConsoleIsActive()){console.trace()}}function ctrace(){if(isFirebugConsoleIsActive()){console.trace()}}function cdir(a){if(isFirebugConsoleIsActive()){console.dir(a)}}function isFirebugConsoleIsActive(){try{if(console!==null&amp;&amp;console!==undefined){return true}else{return false}}catch(a){return false}}Ext.ns(&quot;sitools.common.utils&quot;);sitools.common.utils.Utils={arrayProperties2Object:function(b){var a={};Ext.each(b,function(c){if(!Ext.isEmpty(c.name)&amp;&amp;!Ext.isEmpty(c.value)){a[c.name]=c.value}});return a}};sitoolsUtils=sitools.common.utils.Utils;Ext.ns(&quot;sitools.common.utils&quot;);sitools.common.utils.Date={regToday:new RegExp(&quot;^{\\$TODAY} *(\\+ *[0-9]*|\\- *[0-9]*)?$&quot;),timeInterval:Date.DAY,stringWithTodayToDate:function(d){if(Ext.isDate(d)){return d}if(!this.regToday.test(d)){return null}var c=new RegExp(&quot;[0-9]+&quot;,&quot;g&quot;);var b=new RegExp(&quot;[+]|[-]&quot;);var f=parseFloat(c.exec(d));var e=b.exec(d);var a=new Date();if(Ext.isEmpty(f)&amp;&amp;!Ext.isEmpty(e)){return null}if(!Ext.isEmpty(f)&amp;&amp;!Ext.isEmpty(e)){if(e==&quot;-&quot;){f=f*-1}a=a.add(this.timeInterval,f)}return a},isValidDate:function(a){if(Object.prototype.toString.call(a)!==&quot;[object Date]&quot;){return false}return !isNaN(a.getTime())}};Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:&quot;x-statusbar&quot;,busyIconCls:&quot;x-status-busy&quot;,busyText:&quot;Loading...&quot;,autoClear:5000,emptyText:&quot;&amp;nbsp;&quot;,activeThreadId:0,initComponent:function(){if(this.statusAlign==&quot;right&quot;){this.cls+=&quot; x-status-right&quot;}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var a=this.statusAlign==&quot;right&quot;;this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:&quot;x-status-text &quot;+(this.currIconCls||&quot;&quot;),text:this.text||this.defaultText||&quot;&quot;});if(a){this.add(&quot;-&gt;&quot;);this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,&quot;-&gt;&quot;)}this.doLayout()},setStatus:function(d){d=d||{};if(typeof d==&quot;string&quot;){d={text:d}}if(d.text!==undefined){this.setText(d.text)}if(d.iconCls!==undefined){this.setIcon(d.iconCls)}if(d.clear){var e=d.clear,b=this.autoClear,a={useDefaults:true,anim:true};if(typeof e==&quot;object&quot;){e=Ext.applyIf(e,a);if(e.wait){b=e.wait}}else{if(typeof e==&quot;number&quot;){b=e;e=a}else{if(typeof e==&quot;boolean&quot;){e=a}}}e.threadId=this.activeThreadId;this.clearStatus.defer(b,this,[e])}return this},clearStatus:function(c){c=c||{};if(c.threadId&amp;&amp;c.threadId!==this.activeThreadId){return this}var b=c.useDefaults?this.defaultText:this.emptyText,a=c.useDefaults?(this.defaultIconCls?this.defaultIconCls:&quot;&quot;):&quot;&quot;;if(c.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:b,iconCls:a});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:b,iconCls:a});this.statusEl.show()}return this},setText:function(a){this.activeThreadId++;this.text=a||&quot;&quot;;if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(a){this.activeThreadId++;a=a||&quot;&quot;;if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(a.length&gt;0){this.statusEl.addClass(a);this.currIconCls=a}}else{this.currIconCls=a}return this},showBusy:function(a){if(typeof a==&quot;string&quot;){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.reg(&quot;statusbar&quot;,Ext.ux.StatusBar);Ext.namespace(&quot;Ext.ux.plugins&quot;);Ext.ux.plugins.SliderRange=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.plugins.SliderRange,Ext.util.Observable,{init:function(a){Ext.apply(a,{onResize:a.onResize.createSequence(function(f,b){this.el.addClass(&quot;ux-sliderrange-slider&quot;);if(a.range){a.range.remove()}a.range=a.el.createChild({cls:&quot;ux-sliderrange&quot;});var d=a.translateValue(a.minValue);var g=a.translateValue((a.minValue+a.increment));var k=g-d;var c;c=0;for(var e=a.minValue;e&lt;=a.maxValue;e=e+a.increment){a.range.createChild({html:&quot;&quot;+e,cls:&quot;ux-sliderrange-val&quot;,style:&quot;left: &quot;+(d+(k*c))+&quot;px;&quot;});c++}})})}});Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.Login=Ext.extend(Ext.Window,{id:&quot;winLogin&quot;,layout:&quot;hbox&quot;,width:392,height:200,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get(&quot;label.login&quot;);this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbWinLogin&quot;,iconCls:&quot;x-status-valid&quot;,items:[{text:i18n.get(&quot;label.passwordLost&quot;),hidden:!this.reset,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/wadl.gif&quot;,iconAlign:&quot;right&quot;,handler:function(){Ext.getCmp(&quot;winLogin&quot;).close();var a=new sitools.widget.resetPassword({closable:this.closable,url:this.reset,handler:this.handler});a.show()}}]});this.combo=new Ext.form.ComboBox({typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,allowBlank:false,lazyRender:true,mode:&quot;local&quot;,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[1,i18n.get(&quot;label.userPortal&quot;)],[2,i18n.get(&quot;label.administration&quot;)]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;,anchor:&quot;80%&quot;,value:1,fieldLabel:i18n.get(&quot;label.target&quot;),hideLabel:true});if(this.chooseLocation){this.combo.setVisible(true);this.combo.hideLabel=false}else{this.combo.setVisible(false);this.setSize(392,160)}this.items=[{xtype:&quot;form&quot;,frame:false,border:false,buttonAlign:&quot;center&quot;,id:&quot;frmLogin&quot;,bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get(&quot;APP_URL&quot;)+'/common/res/images/ux/login-big.gif&quot;) no-repeat #dfe8f6;',width:392,labelWidth:100,items:[{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),name:&quot;login&quot;,id:&quot;logId&quot;,allowBlank:false,anchor:&quot;80%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),name:&quot;password&quot;,id:&quot;pwdId&quot;,allowBlank:false,inputType:&quot;password&quot;,anchor:&quot;80%&quot;,listeners:{scope:this,specialkey:function(b,a){if(a.getKey()==a.ENTER){this.getAuth()}}}},this.combo],buttons:[{text:i18n.get(&quot;label.login&quot;),handler:this.getAuth,scope:this},{text:i18n.get(&quot;label.reset&quot;),handler:function(){Ext.getCmp(&quot;frmLogin&quot;).getForm().reset();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:i18n.get(&quot;label.ready&quot;),iconCls:&quot;x-status-valid&quot;})}},{text:i18n.get(&quot;label.cancel&quot;),hidden:!this.defurl,scope:this,handler:function(){window.location.href=this.defurl}},{text:i18n.get(&quot;label.register&quot;),hidden:!this.register,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh.png&quot;,handler:function(){Ext.getCmp(&quot;winLogin&quot;).close();var a=new sitools.widget.Register({closable:this.closable,url:this.register,login:this.url,handler:this.handler});a.show()}}]}];sitools.widget.Login.superclass.initComponent.call(this)},getAuth:function(){Ext.util.Cookies.set(&quot;A1&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;algorithm&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;realm&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;nonce&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;);Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:&quot;&quot;});Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(f,a){var e=Ext.decode(f.responseText);var c=new Date();if(!Ext.isEmpty(e.data)){if(e.data.scheme==&quot;HTTP_Digest&quot;){var b=new Digest({usr:Ext.getCmp(&quot;logId&quot;).getValue(),pwd:Ext.getCmp(&quot;pwdId&quot;).getValue(),realm:e.data.realm});var d=b.getA1();Ext.util.Cookies.set(&quot;A1&quot;,d);Ext.util.Cookies.set(&quot;userLogin&quot;,b.usr,c.add(Date.MINUTE,1));Ext.util.Cookies.set(&quot;scheme&quot;,e.data.scheme);Ext.util.Cookies.set(&quot;algorithm&quot;,e.data.algorithm);Ext.util.Cookies.set(&quot;realm&quot;,b.realm);Ext.util.Cookies.set(&quot;nonce&quot;,e.data.nonce)}else{if(e.data.scheme==&quot;HTTP_Basic&quot;){var k=Ext.getCmp(&quot;logId&quot;).getValue();var l=Ext.getCmp(&quot;pwdId&quot;).getValue();var m=k+&quot;:&quot;+l;var g=Base64.encode(m);var b=&quot;Basic &quot;+g;Ext.util.Cookies.set(&quot;userLogin&quot;,k,c.add(Date.MINUTE,1));Ext.util.Cookies.set(&quot;scheme&quot;,e.data.scheme);Ext.util.Cookies.set(&quot;hashCode&quot;,b,c.add(Date.MINUTE,1))}}}this.login()},failure:alertFailure})},login:function(){if(!Ext.getCmp(&quot;frmLogin&quot;).getForm().isValid()){Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});return}Ext.getCmp(&quot;winLogin&quot;).body.mask();Ext.getCmp(&quot;sbWinLogin&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(c,e){try{var b=Ext.decode(c.responseText);if(b.success){Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get(&quot;hashCode&quot;)});Ext.getCmp(&quot;winLogin&quot;).close();if(this.chooseLocation){if(this.combo.getValue()==1){window.location.href=loadUrl.get(&quot;APP_URL&quot;)+&quot;/login-redirect?kwd=/client-user/index.html&quot;}else{Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/login-redirect?kwd=/client-admin&quot;,method:&quot;GET&quot;,success:function(f){Ext.Msg.alert(&quot;error login.js redirect with authorization&quot;)}})}}else{window.location.reload()}}else{Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+b.message;Ext.getCmp(&quot;winLogin&quot;).body.unmask();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:a,iconCls:&quot;x-status-error&quot;})}}catch(d){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),d)}},failure:function(b,d){Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a;if(b.status==200){var c=Ext.decode(b.responseText).error;a=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+c}else{a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+b.statusText}Ext.getCmp(&quot;winLogin&quot;).body.unmask();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:a,iconCls:&quot;x-status-error&quot;})}})}});Ext.reg(&quot;s-login&quot;,sitools.widget.Login);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.ActionLink=Ext.extend(Ext.BoxComponent,{text:undefined,initComponent:function(){Ext.apply(this,{autoEl:{tag:&quot;div&quot;,html:'&lt;a class=&quot;small-link&quot;&gt;'+this.text+&quot;&lt;/a&gt;&quot;}});sitools.widget.ActionLink.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.ActionLink.superclass.onRender.apply(this,arguments);Ext.get(this.id).child(&quot;a&quot;).on(&quot;click&quot;,this._bubbleClick);Ext.get(this.id).child(&quot;a&quot;).on(&quot;mouseover&quot;,this._bubbleOver);Ext.get(this.id).child(&quot;a&quot;).on(&quot;mouseout&quot;,this._bubbleOut)},_bubbleClick:function(){var a=Ext.getCmp(this.parent().id);a.onClick()},_bubbleOver:function(){var a=Ext.getCmp(this.parent().id);a.onMouseOver()},_bubbleOut:function(){var a=Ext.getCmp(this.parent().id);a.onMouseOut()},onClick:function(){clog(&quot;actionLink &quot;+this+&quot; onClick() function is not yet implemented !&quot;)},onMouseOver:function(){},onMouseOut:function(){},toString:function(){return&quot;ActionLink &quot;+this.text}});Ext.reg(&quot;s-actionlink&quot;,sitools.widget.ActionLink);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.HighlightText=Ext.extend(Ext.BoxComponent,{text:undefined,initComponent:function(){Ext.apply(this,{autoEl:{html:this.text}});sitools.widget.HighlightText.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.HighlightText.superclass.onRender.apply(this,arguments)},highlight:function(a){clog(&quot;try highlight&quot;);if(a==null){a=&quot;yellow&quot;}this.getEl().applyStyles(&quot;background-color:&quot;+a)},stopHighlight:function(){this.getEl().applyStyles(&quot;background-color:&quot;)},updateHtml:function(a){this.getEl().update(a)}});Ext.reg(&quot;s-lighttext&quot;,sitools.widget.HighlightText);Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.ux.grid.CheckColumn=Ext.extend(Ext.Component,{enabled:true,init:function(a){this.grid=a;this.grid.on(&quot;render&quot;,function(){var b=this.grid.getView();b.mainBody.on(&quot;mousedown&quot;,this.onMouseDown,this)},this)},onMouseDown:function(d,c){if(Ext.fly(c).hasClass(this.createId())&amp;&amp;Ext.fly(c).hasClass(&quot;x-grid3-check-col-enabled&quot;)){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,d,a){d.css+=&quot; x-grid3-check-col-td&quot;;var c=Ext.getCmp(this.id);if(c.enabled){return String.format('&lt;div id=&quot;{2}&quot; class=&quot;x-grid3-check-col{0} x-grid3-check-col-enabled {1}&quot;&gt;&amp;#160;&lt;/div&gt;',b?&quot;-on&quot;:&quot;&quot;,c.createId(),this.id)}else{return String.format('&lt;div id=&quot;{2}&quot; class=&quot;x-grid3-check-disabled-col{0} {1}&quot;&gt;&amp;#160;&lt;/div&gt;',b?&quot;-on&quot;:&quot;&quot;,c.createId(),this.id)}},createId:function(){return&quot;x-grid3-cc-&quot;+this.id},getEnabled:function(){return this.enabled},setEnabled:function(a){this.enabled=a}});Ext.preg(&quot;checkcolumn&quot;,Ext.ux.grid.CheckColumn);Ext.grid.CheckColumn=Ext.ux.grid.CheckColumn;Ext.namespace(&quot;Ext.ux.plugin&quot;);Ext.onReady(function(){var a=Ext.util.CSS;if(a){a.getRule(&quot;.x-hide-nosize&quot;)||a.createStyleSheet(&quot;.x-hide-nosize{height:0px!important;width:0px!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;border:none!important;zoom:1;}&quot;);a.refreshCache()}});(function(){var g=Ext.Element,b=Ext.lib.Anim,a=g.prototype;var f=&quot;visibility&quot;,d=&quot;display&quot;,c=&quot;hidden&quot;,k=&quot;none&quot;;var e={};e.El={setDisplayed:function(m){var l=this;l.visibilityCls?(l[m!==false?&quot;removeClass&quot;:&quot;addClass&quot;](l.visibilityCls)):a.setDisplayed.call(l,m);return l},isDisplayed:function(){return !(this.hasClass(this.visibilityCls)||this.isStyle(d,k))},fixDisplay:function(){var l=this;a.fixDisplay.call(l);l.visibilityCls&amp;&amp;l.removeClass(l.visibilityCls)},isVisible:function(m){var n=this.visible||(!this.isStyle(f,c)&amp;&amp;(this.visibilityCls?!this.hasClass(this.visibilityCls):!this.isStyle(d,k)));if(m!==true||!n){return n}var q=this.dom.parentNode,l=/^body/i;while(q&amp;&amp;!l.test(q.tagName)){if(!Ext.fly(q,&quot;_isVisible&quot;).isVisible()){return false}q=q.parentNode}return true},isStyle:a.isStyle||function(l,m){return this.getStyle(l)==m}};Ext.override(g.Flyweight,e.El);Ext.ux.plugin.VisibilityMode=function(m){Ext.apply(this,m||{});var l=Ext.util.CSS;if(l&amp;&amp;!Ext.isIE&amp;&amp;this.fixMaximizedWindow!==false&amp;&amp;!Ext.ux.plugin.VisibilityMode.MaxWinFixed){l.updateRule(&quot;.x-window-maximized-ct&quot;,&quot;overflow&quot;,&quot;&quot;);Ext.ux.plugin.VisibilityMode.MaxWinFixed=true}};Ext.extend(Ext.ux.plugin.VisibilityMode,Object,{bubble:true,fixMaximizedWindow:true,elements:null,visibilityCls:&quot;x-hide-nosize&quot;,hideMode:&quot;nosize&quot;,ptype:&quot;uxvismode&quot;,init:function(q){var m=this.hideMode||q.hideMode,p=this,l=Ext.Container.prototype.bubble,n=function(){var t=[this.collapseEl,this.actionMode].concat(p.elements||[]);Ext.each(t,function(u){p.extend(this[u]||u)},this);var s={visFixed:true,animCollapse:false,animFloat:false,hideMode:m,defaults:this.defaults||{}};s.defaults.hideMode=m;Ext.apply(this,s);Ext.apply(this.initialConfig||{},s)};q.on(&quot;render&quot;,function(){if(p.bubble!==false&amp;&amp;this.ownerCt){l.call(this.ownerCt,function(){this.visFixed||this.on(&quot;afterlayout&quot;,n,this,{single:true})})}n.call(this)},q,{single:true})},extend:function(l,m){l&amp;&amp;Ext.each([].concat(l),function(n){if(n&amp;&amp;n.dom){if(&quot;visibilityCls&quot; in n){return}Ext.apply(n,e.El);n.visibilityCls=m||this.visibilityCls}},this);return this}});Ext.preg&amp;&amp;Ext.preg(&quot;uxvismode&quot;,Ext.ux.plugin.VisibilityMode);Ext.provide&amp;&amp;Ext.provide(&quot;uxvismode&quot;)})();(function(){var Q=Ext.Element,s,C=Ext.lib.Dom,av=Ext.lib.Anim,q=Ext.EventManager,at=Ext.lib.Event,ax=document,B=function(){},az=Object.prototype,aJ=az.toString,u=&quot;[object HTMLDocument]&quot;;if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,&quot;&quot;),10)&lt;311){alert(&quot;Ext Release &quot;+Ext.version+&quot; is not supported&quot;)}Ext._documents={};Ext._documents[Ext.id(document,&quot;_doc&quot;)]=Ext.elCache;var aa=C.resolveDocumentCache=function(E,aO){var aN=e(E),aP=Ext.isDocument(aN)?Ext.id(aN):aO,A=Ext._documents[aP]||null;return A||(aP?Ext._documents[aP]={}:null)},aM=C.clearDocumentCache=function(A){delete Ext._documents[A]};Q.addMethods||(Q.addMethods=function(A){Ext.apply(Q.prototype,A||{})});Ext.removeNode=function(aQ){var aP=aQ?aQ.dom||aQ:null,aN,aO,A=aa(aP),E;if(aP&amp;&amp;(aO=A[aP.id])&amp;&amp;(aN=aO.el)){if(aN.dom){Ext.enableNestedListenerRemoval?q.purgeElement(aN.dom,true):q.removeAll(aN.dom)}delete A[aP.id];delete aN.dom;delete aN._context;aN=null}if(aP&amp;&amp;!aP.navigator&amp;&amp;!Ext.isDocument(aP)&amp;&amp;aP.tagName!=&quot;BODY&quot;){(E=aP.parentElement||aP.parentNode)&amp;&amp;E.removeChild(aP)}aP=E=null};var f=function(aR,aP){var aQ=typeof aR===&quot;function&quot;?aR:function aO(){};var aN=aQ._ovl;if(!aN){aN={base:aQ};aN[aQ.length||0]=aQ;aQ=function aO(){var aU=arguments.callee._ovl;var aT=aU[arguments.length]||aU.base;return aT&amp;&amp;aT!=arguments.callee?aT.apply(this,arguments):undefined}}var aS=[].concat(aP);for(var E=0,A=aS.length;E&lt;A;++E){aN[aS[E].length]=aS[E]}aQ._ovl=aN;var aO=null;return aQ};Ext.applyIf(Ext,{overload:f(f,[function(A){return f(null,A)},function(aN,E,A){return aN[E]=f(aN[E],A)}]),isArray:function(A){return !!A&amp;&amp;aJ.apply(A)==&quot;[object Array]&quot;},isObject:function(A){return !!A&amp;&amp;typeof A==&quot;object&quot;},isDocument:function(E,A){var aP=E?E.dom||E:null;var aO=aP&amp;&amp;((aJ.apply(aP)==u)||(aP&amp;&amp;aP.nodeType==9));if(aO&amp;&amp;A){try{aO=!!aP.location}catch(aN){return false}}return aO},isWindow:function(A){var E=A?A.dom||A:null;return E?!!E.navigator||aJ.apply(E)==&quot;[object Window]&quot;:false},isIterable:function(A){if(Ext.isArray(A)||A.callee){return true}if(/NodeList|HTMLCollection/.test(aJ.call(A))){return true}return((typeof A.nextNode!=&quot;undefined&quot;||A.item)&amp;&amp;Ext.isNumber(A.length))},isElement:function(A){return A&amp;&amp;Ext.type(A)==&quot;element&quot;},isEvent:function(A){return aJ.apply(A)==&quot;[object Event]&quot;||(Ext.isObject(A)&amp;&amp;!Ext.type(o.constructor)&amp;&amp;(window.event&amp;&amp;A.clientX&amp;&amp;A.clientX==window.event.clientX))},isFunction:function(A){return !!A&amp;&amp;typeof A==&quot;function&quot;},isEventSupported:function(aO,aP){var aN={select:&quot;input&quot;,change:&quot;input&quot;,submit:&quot;form&quot;,reset:&quot;form&quot;,load:&quot;img&quot;,error:&quot;img&quot;,abort:&quot;img&quot;},A={},aQ=/^on/i,E=function(aT,aS){var aR=Ext.getDom(aS);return(aR?(Ext.isElement(aR)||Ext.isDocument(aR)?aR.nodeName.toLowerCase():aS.self?&quot;#window&quot;:aS||&quot;#object&quot;):aS||&quot;div&quot;)+&quot;:&quot;+aT};return function(aV,aX){aV=(aV||&quot;&quot;).replace(aQ,&quot;&quot;);var aW,aU=false;var aS=&quot;on&quot;+aV;var aR=(aX?aX:aN[aV])||&quot;div&quot;;var aT=E(aV,aR);if(aT in A){return A[aT]}aW=Ext.isString(aR)?ax.createElement(aR):aX;aU=(!!aW&amp;&amp;(aS in aW));aU||(aU=window.Event&amp;&amp;!!(String(aV).toUpperCase() in window.Event));if(!aU&amp;&amp;aW){aW.setAttribute&amp;&amp;aW.setAttribute(aS,&quot;return;&quot;);aU=Ext.isFunction(aW[aS])}A[aT]=aU;aW=null;return aU}}()});var ay=function(A){return Q;return Q[(A.tagName||&quot;-&quot;).toUpperCase()]||Q};var O;function ar(A,E){if(!O){O=new Ext.Element.Flyweight()}O.dom=Ext.getDom(A,null,E);return O}Ext.apply(Ext,{get:Q.get=function(aO,aT){if(!aO){return null}var aS=Ext.isDocument(aO);Ext.isDocument(aT)||(aT=ax);var aR,aQ,E,A=aa(aT);if(typeof aO==&quot;string&quot;){aQ=Ext.getDom(aO,null,aT);if(!aQ){return null}if(A[aO]&amp;&amp;A[aO].el){aR=A[aO].el;aR.dom=aQ}else{aR=Q.addToCache(new (ay(aQ))(aQ,null,aT))}return aR}else{if(aS){if(!Ext.isDocument(aO,true)){return false}A=aa(aO);if(A[Ext.id(aO)]&amp;&amp;A[aO.id].el){return A[aO.id].el}var aP=function(){};aP.prototype=Q.prototype;var aN=new aP();aN.dom=aO;aN.id=Ext.id(aO,&quot;_doc&quot;);aN._isDoc=true;Q.addToCache(aN,null,A);return aN}else{if(aO instanceof Q){if(aO.dom){aO.id=Ext.id(aO.dom)}else{aO.dom=aO.id?Ext.getDom(aO.id,true):null}if(aO.dom){A=aa(aO);(A[aO.id]||(A[aO.id]={data:{},events:{}})).el=aO}return aO}else{if(aO.tagName||Ext.isWindow(aO)){A=aa(aO);E=Ext.id(aO);if(A[E]&amp;&amp;(aR=A[E].el)){aR.dom=aO}else{aR=Q.addToCache(new (ay(aO))(aO,null,aT),null,A)}return aR}else{if(aO.isComposite){return aO}else{if(Ext.isArray(aO)){return Ext.get(aT,aT).select(aO)}}}}}}return null},getDom:function(E,A,aP){var aO=aP||ax;if(!E||!aO){return null}if(E.dom){return E.dom}else{if(Ext.isString(E)){var aN=aO.getElementById(E);if(aN&amp;&amp;Ext.isIE&amp;&amp;A){if(E==aN.getAttribute(&quot;id&quot;)){return aN}else{return null}}return aN}else{return E}}},getBody:function(E){var A=C.getDocument(E)||ax;return Ext.get(A.body||A.documentElement)},getDoc:Ext.overload([Ext.getDoc,function(A){return Ext.get(A,A)}])});Q.data=function(E,A,aN){E=Q.get(E);if(!E){return null}var aO=aa(E)[E.id].data;if(arguments.length==2){return aO[A]}else{return(aO[A]=aN)}};Q.addToCache=function(E,aP,A){aP=aP||Ext.id(E);var aO=A||aa(E);aO[aP]={el:E.dom?E:Ext.get(E),data:{},events:{}};var aN=aO[aP].el.dom;(aN.getElementById||aN.navigator)&amp;&amp;(aO[aP].skipGC=true);return aO[aP].el};Q.removeFromCache=function(E,A){if(E&amp;&amp;E.id){var aN=A||aa(E);delete aN[E.id]}};Q.ASCLASS=3;Q.visibilityCls=&quot;x-hide-nosize&quot;;var aB={},S=/(-[a-z])/gi,N=function(A,E){return E.charAt(1).toUpperCase()},l=/alpha\(opacity=(.*)\)/i,p=/^\s+|\s+$/g,aH=/marginRight/,K=Ext.isIE?&quot;styleFloat&quot;:&quot;cssFloat&quot;,aC=ax.defaultView,aj=&quot;visibilityMode&quot;,D=Q.DISPLAY,k=Q.VISIBILITY,ap=Q.ASCLASS,T=&quot;originalDisplay&quot;,ak=&quot;padding&quot;,X=&quot;margin&quot;,aF=&quot;border&quot;,c=&quot;-left&quot;,m=&quot;-right&quot;,t=&quot;-top&quot;,aD=&quot;-bottom&quot;,W=&quot;-width&quot;,aI=Math,af=&quot;opacity&quot;,ae=&quot;visibility&quot;,R=&quot;display&quot;,ao=&quot;offsets&quot;,aE=&quot;asclass&quot;,al=&quot;hidden&quot;,ag=&quot;none&quot;,ad=&quot;isVisible&quot;,J=&quot;isClipped&quot;,d=&quot;overflow&quot;,Z=&quot;overflow-x&quot;,Y=&quot;overflow-y&quot;,L=&quot;originalClip&quot;,V=&quot;x-masked&quot;,M=&quot;x-masked-relative&quot;,aq={l:aF+c+W,r:aF+m+W,t:aF+t+W,b:aF+aD+W},aw={l:ak+c,r:ak+m,t:ak+t,b:ak+aD},v={l:X+c,r:X+m,t:X+t,b:X+aD},P=Q.data,aK=Ext.getDom,z=Ext.get,an=Ext.DomHelper,ah=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,aL=Ext.util.CSS,au=function(E){var A=P(E,T);if(A===undefined){P(E,T,A=&quot;&quot;)}return A},n=function(E){var A=P(E,aj);if(A===undefined){P(E,aj,A=Q.prototype.visibilityMode)}return A};function aA(A){return aB[A]||(aB[A]=A==&quot;float&quot;?K:A.replace(S,N))}Q.addMethods({getDocument:function(){return this._context||(this._context=e(this))},remove:function(E,A){var aN=this.dom;this.isMasked()&amp;&amp;this.unmask();if(aN){Ext.removeNode(aN);delete this._context;delete this.dom}},appendChild:function(A,E){return z(A,E||this.getDocument()).appendTo(this)},appendTo:function(A,E){aK(A,false,E||this.getDocument()).appendChild(this.dom);return this},insertBefore:function(A,E){(A=aK(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A);return this},insertAfter:function(A,E){(A=aK(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A.nextSibling);return this},insertFirst:function(E,A){E=E||{};if(E.nodeType||E.dom||typeof E==&quot;string&quot;){E=aK(E);this.dom.insertBefore(E,this.dom.firstChild);return !A?z(E):E}else{return this.createChild(E,this.dom.firstChild,A)}},replace:function(A,E){A=z(A,E||this.getDocument());this.insertBefore(A);A.remove();return this},replaceWith:function(A,aN){var E=this;if(A.nodeType||A.dom||typeof A==&quot;string&quot;){A=aK(A,false,aN||E.getDocument());E.dom.parentNode.insertBefore(A,E.dom)}else{A=an.insertBefore(E.dom,A)}var aO=aa(E);Ext.removeNode(E.dom);E.id=Ext.id(E.dom=A);Q.addToCache(E.isFlyweight?new (ay(E.dom))(E.dom,null,aO):E);return E},insertHtml:function(E,aN,A){var aO=an.insertHtml(E,this.dom,aN);return A?Ext.get(aO,e(aO)):aO},setVisibilityMode:function(A){P(this.dom,aj,A);return this},isVisible:function(){return this.visible||Ext.value(P(this.dom,ad),!this.isStyle(ae,al)&amp;&amp;!this.isStyle(R,ag))},setVisible:function(aP,A){var aR=this,aQ=aR.dom,E,aT,aS,aO;if(typeof A==&quot;string&quot;){E=A==R;aT=A==ae;aS=A==ao;aO=A==aE;A=false}else{var aN=n(aQ);E=aN==D;aT=aN==k;aO=aN==ap}if(!A||!aR.anim){if(aO){aR[aP?&quot;removeClass&quot;:&quot;addClass&quot;](aR.visibilityCls||Q.visibilityCls)}else{if(E){return aR.setDisplayed(aP)}else{if(aS){if(!aP){aR.hideModeStyles={position:aR.getStyle(&quot;position&quot;),top:aR.getStyle(&quot;top&quot;),left:aR.getStyle(&quot;left&quot;)};aR.applyStyles({position:&quot;absolute&quot;,top:&quot;-10000px&quot;,left:&quot;-10000px&quot;})}else{aR.applyStyles(aR.hideModeStyles||{position:&quot;&quot;,top:&quot;&quot;,left:&quot;&quot;});delete aR.hideModeStyles}}else{aR.fixDisplay();if(aQ){aQ.style.visibility=aP?&quot;visible&quot;:al}}}}}else{if(aP){aR.setOpacity(0.01);aR.setVisible(true)}aR.anim({opacity:{to:(aP?1:0)}},aR.preanim(arguments,1),null,0.35,&quot;easeIn&quot;,function(){if(!aP){aO?aR.addClass(aR.visibilityCls||Q.visibilityCls):aQ.style[E?R:ae]=(E)?ag:al;aR.setOpacity(1)}})}P(aQ,ad,aP);return aR},setDisplayed:function(E){var aN=this.dom,A=n(aN);if(typeof E==&quot;boolean&quot;){if(A==Q.ASCLASS){return this.setVisible(E,aE)}P(this.dom,ad,E);E=E?au(aN):ag}this.setStyle(R,E);return this},fixDisplay:function(){var A=this;if(A.isStyle(R,ag)){A.setStyle(ae,al);A.setStyle(R,au(A.dom));if(A.isStyle(R,ag)){A.setStyle(R,&quot;block&quot;)}}P(A.dom,ad)||A.removeClass(A.visibilityCls||Q.visibilityCls)},enableDisplayMode:function(A){this.setVisibilityMode(Q.DISPLAY);if(!Ext.isEmpty(A)){P(this.dom,T,A)}return this},scrollIntoView:function(aN,aQ){var aV=this.getDocument(),aW=Ext.getDom(aN,null,aV)||Ext.getBody(aV).dom,aP=this.dom,aO=this.getOffsetsTo(aW),aS=aO[0]+aW.scrollLeft,aZ=aO[1]+aW.scrollTop,aX=aZ+aP.offsetHeight,E=aS+aP.offsetWidth,A=aW.clientHeight,aT=parseInt(aW.scrollTop,10),aY=parseInt(aW.scrollLeft,10),aR=aT+A,aU=aY+aW.clientWidth;if(aP.offsetHeight&gt;A||aZ&lt;aT){aW.scrollTop=aZ}else{if(aX&gt;aR){aW.scrollTop=aX-A}}aW.scrollTop=aW.scrollTop;if(aQ!==false){if(aP.offsetWidth&gt;aW.clientWidth||aS&lt;aY){aW.scrollLeft=aS}else{if(E&gt;aU){aW.scrollLeft=E-aW.clientWidth}}aW.scrollLeft=aW.scrollLeft}return this},contains:function(A){try{return !A?false:C.isAncestor(this.dom,A.dom?A.dom:A)}catch(E){return false}},getScroll:function(){var aR=this.dom,aQ=this.getDocument(),A=aQ.body,aN=aQ.documentElement,E,aP,aO;if(Ext.isDocument(aR)||aR==A){if(Ext.isIE&amp;&amp;C.docIsStrict(aQ)){E=aN.scrollLeft;aP=aN.scrollTop}else{E=window.pageXOffset;aP=window.pageYOffset}aO={left:E||(A?A.scrollLeft:0),top:aP||(A?A.scrollTop:0)}}else{aO={left:aR.scrollLeft,top:aR.scrollTop}}return aO},getStyle:function(){var A=aC&amp;&amp;aC.getComputedStyle?function E(aT){var aQ=!this._isDoc?this.dom:null,aN,aP,aO,aR,aS=Ext.isWebKit,aR;if(!aQ||!aQ.style){return null}aT=aA(aT);aO=(aN=aQ.style[aT])?aN:(aP=aC.getComputedStyle(aQ,&quot;&quot;))?aP[aT]:null;if(aS){if((aH.test(aT))&amp;&amp;aO!=&quot;0px&quot;){aR=this.getStyle(&quot;display&quot;);aQ.style.display=&quot;inline-block&quot;;aO=aC.getComputedStyle(aQ,&quot;&quot;);aQ.style.display=aR}if(aO==&quot;rgba(0, 0, 0, 0)&quot;){aO=&quot;transparent&quot;}}return aO}:function E(aR){var aP=!this._isDoc?this.dom:null,aN,aO;if(!aP||!aP.style){return null}if(aR==af){if(aP.style.filter.match){if(aN=aP.style.filter.match(l)){var aQ=parseFloat(aN[1]);if(!isNaN(aQ)){return aQ?aQ/100:0}}}return 1}aR=aA(aR);return aP.style[aR]||((aO=aP.currentStyle)?aO[aR]:null)};var E=null;return A}(),setStyle:function(aP,aO){if(this._isDoc||Ext.isDocument(this.dom)){return this}var A,E;if(typeof aP!=&quot;object&quot;){A={};A[aP]=aO;aP=A}for(E in aP){aO=aP[E];if(E==af){this.setOpacity(aO)}else{try{this.dom.style[aA(E)]=aO}catch(aN){null}}}return this},center:function(A){return this.alignTo(A||this.getDocument(),&quot;c-c&quot;)},mask:function(E,aQ){var aS=this,aO=aS.dom,aR=Ext.DomHelper,aP=&quot;ext-el-mask-msg&quot;,A,aT;if(aS.getStyle(&quot;position&quot;)==&quot;static&quot;){aS.addClass(M)}if((A=P(aO,&quot;maskMsg&quot;))){A.remove()}if((A=P(aO,&quot;mask&quot;))){A.remove()}aT=aR.append(aO,{cls:&quot;ext-el-mask&quot;},true);P(aO,&quot;mask&quot;,aT);aS.addClass(V);aT.setDisplayed(true);if(typeof E==&quot;string&quot;){var aN=aR.append(aO,{cls:aP,cn:{tag:&quot;div&quot;}},true);P(aO,&quot;maskMsg&quot;,aN);aN.dom.className=aQ?aP+&quot; &quot;+aQ:aP;aN.dom.firstChild.innerHTML=E;aN.setDisplayed(true);aN.center(aS)}if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;aS.getStyle(&quot;height&quot;)==&quot;auto&quot;){aT.setSize(undefined,aS.getHeight())}return aT},unmask:function(){var aN=this,aO=aN.dom,A=P(aO,&quot;mask&quot;),E=P(aO,&quot;maskMsg&quot;);if(A){if(E){E.remove();P(aO,&quot;maskMsg&quot;,undefined)}A.remove();P(aO,&quot;mask&quot;,undefined)}aN.removeClass([V,M])},isMasked:function(){var A=P(this.dom,&quot;mask&quot;);return A&amp;&amp;A.isVisible()},getCenterXY:function(){return this.getAlignToXY(this.getDocument(),&quot;c-c&quot;)},getAnchorXY:function(aP,aU,aZ){aP=(aP||&quot;tl&quot;).toLowerCase();aZ=aZ||{};var aT=this,aW=this.getDocument(),E=aT.dom==aW.body||aT.dom==aW,aX=aZ.width||E?C.getViewWidth(false,aW):aT.getWidth(),aR=aZ.height||E?C.getViewHeight(false,aW):aT.getHeight(),aY,A=Math.round,aN=aT.getXY(),aV=aT.getScroll(),aS=E?aV.left:!aU?aN[0]:0,aQ=E?aV.top:!aU?aN[1]:0,aO={c:[A(aX*0.5),A(aR*0.5)],t:[A(aX*0.5),0],l:[0,A(aR*0.5)],r:[aX,A(aR*0.5)],b:[A(aX*0.5),aR],tl:[0,0],bl:[0,aR],br:[aX,aR],tr:[aX,0]};aY=aO[aP];return[aY[0]+aS,aY[1]+aQ]},anchorTo:function(E,aQ,aN,A,aS,aT){var aR=this,aP=aR.dom;function aO(){ar(aP).alignTo(E,aQ,aN,A);Ext.callback(aT,ar(aP))}Ext.EventManager.onWindowResize(aO,aR);if(!Ext.isEmpty(aS)){Ext.EventManager.on(window,&quot;scroll&quot;,aO,aR,{buffer:!isNaN(aS)?aS:50})}aO.call(aR);return aR},getScroll:function(){var aR=this.dom,aQ=this.getDocument(),A=aQ.body,aN=aQ.documentElement,E,aP,aO;if(aR==aQ||aR==A){if(Ext.isIE&amp;&amp;C.docIsStrict(aQ)){E=aN.scrollLeft;aP=aN.scrollTop}else{E=window.pageXOffset;aP=window.pageYOffset}aO={left:E||(A?A.scrollLeft:0),top:aP||(A?A.scrollTop:0)}}else{aO={left:aR.scrollLeft,top:aR.scrollTop}}return aO},getAlignToXY:function(aO,a0,a3){var bf;aO=Ext.get(aO,bf=this.getDocument());if(!aO||!aO.dom){throw&quot;Element.getAlignToXY with an element that doesn't exist&quot;}a3=a3||[0,0];a0=(a0==&quot;?&quot;?&quot;tl-bl?&quot;:(!/-/.test(a0)&amp;&amp;a0!=&quot;&quot;?&quot;tl-&quot;+a0:a0||&quot;tl-bl&quot;)).toLowerCase();var bc=this,a9=bc.dom,be,bd,aT,aS,aV,a7,aY,aW=C.getViewWidth(false,bf)-10,a8=C.getViewHeight(false,bf)-10,E,aP,aQ,aR,aX,aZ,bb=bf.documentElement,aU=bf.body,a6=(bb.scrollLeft||aU.scrollLeft||0)+5,a5=(bb.scrollTop||aU.scrollTop||0)+5,ba=false,aN=&quot;&quot;,A=&quot;&quot;,a4=a0.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!a4){throw&quot;Element.getAlignToXY with an invalid alignment &quot;+a0}aN=a4[1];A=a4[2];ba=!!a4[3];be=bc.getAnchorXY(aN,true);bd=aO.getAnchorXY(A,false);aT=bd[0]-be[0]+a3[0];aS=bd[1]-be[1]+a3[1];if(ba){aV=bc.getWidth();a7=bc.getHeight();aY=aO.getRegion();E=aN.charAt(0);aP=aN.charAt(aN.length-1);aQ=A.charAt(0);aR=A.charAt(A.length-1);aX=((E==&quot;t&quot;&amp;&amp;aQ==&quot;b&quot;)||(E==&quot;b&quot;&amp;&amp;aQ==&quot;t&quot;));aZ=((aP==&quot;r&quot;&amp;&amp;aR==&quot;l&quot;)||(aP==&quot;l&quot;&amp;&amp;aR==&quot;r&quot;));if(aT+aV&gt;aW+a6){aT=aZ?aY.left-aV:aW+a6-aV}if(aT&lt;a6){aT=aZ?aY.right:a6}if(aS+a7&gt;a8+a5){aS=aX?aY.top-a7:a8+a5-a7}if(aS&lt;a5){aS=aX?aY.bottom:a5}}return[aT,aS]},adjustForConstraints:function(aN,A,E){return this.getConstrainToXY(A||this.getDocument(),false,E,aN)||aN},getConstrainToXY:function(E,A,aN,aP){var aO={top:0,left:0,bottom:0,right:0};return function(aR,aZ,aS,aQ){var a1=this.getDocument();aR=Ext.get(aR,a1);aS=aS?Ext.applyIf(aS,aO):aO;var a0,aT,aY=0,aW=0;if(aR.dom==a1.body||aR.dom==a1){a0=C.getViewWidth(false,a1);aT=C.getViewHeight(false,a1)}else{a0=aR.dom.clientWidth;aT=aR.dom.clientHeight;if(!aZ){var aU=aR.getXY();aY=aU[0];aW=aU[1]}}var a4=aR.getScroll();aY+=aS.left+a4.left;aW+=aS.top+a4.top;a0-=aS.right;aT-=aS.bottom;var a3=aY+a0,aV=aW+aT,a2=aQ||(!aZ?this.getXY():[this.getLeft(true),this.getTop(true)]);x=a2[0],y=a2[1],offset=this.getConstrainOffset(),w=this.dom.offsetWidth+offset,h=this.dom.offsetHeight+offset;var aX=false;if((x+w)&gt;a3){x=a3-w;aX=true}if((y+h)&gt;aV){y=aV-h;aX=true}if(x&lt;aY){x=aY;aX=true}if(y&lt;aW){y=aW;aX=true}return aX?[x,y]:false}}(),getConstrainOffset:function(){return 0},getCenterXY:function(){return this.getAlignToXY(Ext.getBody(this.getDocument()),&quot;c-c&quot;)},center:function(A){return this.alignTo(A||Ext.getBody(this.getDocument()),&quot;c-c&quot;)},findParent:function(aS,aR,E){var aP=this.dom,aO=this.getDocument(),A=aO.body,aQ=0,aN;if(Ext.isGecko&amp;&amp;aJ.call(aP)==&quot;[object XULElement]&quot;){return null}aR=aR||50;if(isNaN(aR)){aN=Ext.getDom(aR,null,aO);aR=Number.MAX_VALUE}while(aP&amp;&amp;aP.nodeType==1&amp;&amp;aQ&lt;aR&amp;&amp;aP!=A&amp;&amp;aP!=aN){if(Ext.DomQuery.is(aP,aS)){return E?Ext.get(aP,aO):aP}aQ++;aP=aP.parentNode}return null},clip:function(){var A=this,E=A.dom;if(!P(E,J)){P(E,J,true);P(E,L,{o:A.getStyle(d),x:A.getStyle(Z),y:A.getStyle(Y)});A.setStyle(d,al);A.setStyle(Z,al);A.setStyle(Y,al)}return A},unclip:function(){var A=this,aN=A.dom;if(P(aN,J)){P(aN,J,false);var E=P(aN,L);if(E.o){A.setStyle(d,E.o)}if(E.x){A.setStyle(Z,E.x)}if(E.y){A.setStyle(Y,E.y)}}return A},getViewSize:function(){var aN=this.getDocument(),aO=this.dom,A=(aO==aN||aO==aN.body);if(A){var E=Ext.lib.Dom;return{width:E.getViewWidth(),height:E.getViewHeight()}}else{return{width:aO.clientWidth,height:aO.clientHeight}}},getStyleSize:function(){var aP=this,A,aO,aR=this.getDocument(),aS=this.dom,E=(aS==aR||aS==aR.body),aN=aS.style;if(E){var aQ=Ext.lib.Dom;return{width:aQ.getViewWidth(),height:aQ.getViewHeight()}}if(aN.width&amp;&amp;aN.width!=&quot;auto&quot;){A=parseFloat(aN.width);if(aP.isBorderBox()){A-=aP.getFrameWidth(&quot;lr&quot;)}}if(aN.height&amp;&amp;aN.height!=&quot;auto&quot;){aO=parseFloat(aN.height);if(aP.isBorderBox()){aO-=aP.getFrameWidth(&quot;tb&quot;)}}return{width:A||aP.getWidth(true),height:aO||aP.getHeight(true)}}});Ext.isDefined(Q.collectorThreadId)&amp;&amp;clearInterval(Q.collectorThreadId);function am(){if(!Ext.enableGarbageCollector){clearInterval(Q.collectorThreadId)}else{var A,aO,aQ,aP,aN=Ext.elCache;for(A in aN){aP=aN[A];if(aP.skipGC){continue}aO=aP.el;aQ=aO.dom;if(!aQ||!aQ.parentNode||(!aQ.offsetParent&amp;&amp;!ax.getElementById(A))){if(Ext.enableListenerCollection){Ext.EventManager.removeAll(aQ)}delete aN[A]}}if(Ext.isIE){var E={};for(A in aN){E[A]=aN[A]}Ext.elCache=Ext._documents[Ext.id(document)]=E;E=null}}}if(Ext.enableGarbageCollector){Q.collectorThreadId=setInterval(am,30000)}Ext.apply(C,{getDocument:function(aN,aO){var aP=null;try{aP=Ext.getDom(aN,null,null)}catch(E){}var A=Ext.isDocument(aP);if(A){if(aO){return Ext.isDocument(aP,aO)?aP:null}return aP}return aP?aP.ownerDocument||aP.document:null},docIsStrict:function(A){return(Ext.isDocument(A)?A:this.getDocument(A)).compatMode==&quot;CSS1Compat&quot;},getViewWidth:Ext.overload([C.getViewWidth||function(A){},function(){return this.getViewWidth(false)},function(A,E){return A?this.getDocumentWidth(E):this.getViewportWidth(E)}]),getViewHeight:Ext.overload([C.getViewHeight||function(A){},function(){return this.getViewHeight(false)},function(A,E){return A?this.getDocumentHeight(E):this.getViewportHeight(E)}]),getDocumentHeight:Ext.overload([C.getDocumentHeight||B,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollHeight:A.documentElement.scrollHeight,this.getViewportHeight(A))}return undefined}]),getDocumentWidth:Ext.overload([C.getDocumentWidth||B,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollWidth:A.documentElement.scrollWidth,this.getViewportWidth(A))}return undefined}]),getViewportHeight:Ext.overload([C.getViewportHeight||B,function(A){if(A=this.getDocument(A)){if(Ext.isIE){return this.docIsStrict(A)?A.documentElement.clientHeight:A.body.clientHeight}else{return A.defaultView.innerHeight}}return undefined}]),getViewportWidth:Ext.overload([C.getViewportWidth||B,function(A){if(A=this.getDocument(A)){return !this.docIsStrict(A)&amp;&amp;!Ext.isOpera?A.body.clientWidth:Ext.isIE?A.documentElement.clientWidth:A.defaultView.innerWidth}return undefined}]),getXY:Ext.overload([C.getXY||B,function(A,aO){A=Ext.getDom(A,null,aO);var aN=this.getDocument(A),E=aN?(aN.body||aN.documentElement):null;if(!A||!E||A==E){return[0,0]}return this.getXY(A)}])});var e=C.getDocument,U=Q._flyweights;Ext.fly=Q.fly=function(aN,A,aO){var E=null;A=A||&quot;_global&quot;;if(aN=Ext.getDom(aN,null,aO)){(E=U[A]=(U[A]||new Q.Flyweight())).dom=aN;Ext.isDocument(aN)&amp;&amp;(E._isDoc=true)}return E};var aG=function(){};aG.prototype=Q.prototype;Q.Flyweight=function(A){this.dom=A};Q.Flyweight.prototype=new aG();Q.Flyweight.prototype.isFlyweight=true;function b(aO,aQ,aT,aP,aN,aV){aO=Ext.getDom(aO);if(!aO){return}var E=Ext.id(aO),A=aa(aO);A[E]||Q.addToCache(aO,E,A);var aU=A[E].events||{},aR;aR=at.on(aO,aQ,aN);aU[aQ]=aU[aQ]||[];aU[aQ].push([aT,aN,aV,aR,aP]);if(aO.addEventListener&amp;&amp;aQ==&quot;mousewheel&quot;){var aS=[&quot;DOMMouseScroll&quot;,aN,false];aO.addEventListener.apply(aO,aS);Ext.EventManager.addListener(window,&quot;beforeunload&quot;,function(){aO.removeEventListener.apply(aO,aS)})}if(aQ==&quot;mousedown&quot;&amp;&amp;ax==aO){Ext.EventManager.stoppedMouseDownEvent.addListener(aN)}}function g(A,E){return function(){var aN=Ext.toArray(arguments);if(E.target==Ext.EventObject.setEvent(aN[0]).target){A.apply(this,aN)}}}function ai(E,aN,A){return function(aO){A.delay(aN.buffer,E,null,[new Ext.EventObjectImpl(aO)])}}function ac(aP,aO,A,aN,E){return function(aQ){Ext.EventManager.removeListener(aO,A,aN,E);aP(aQ)}}function a(E,aN,A){return function(aP){var aO=new Ext.util.DelayedTask(E);(A.tasks||(A.tasks=[])).push(aO);aO.delay(aN.delay||10,E,null,[new Ext.EventObjectImpl(aP)])}}function ab(aQ,aP,A,aS,aT){var E=!Ext.isObject(A)?{}:A,aN=Ext.getDom(aQ),aO;aS=aS||E.fn;aT=aT||E.scope;if(!aN){throw'Error listening for &quot;'+aP+'&quot;. Element &quot;'+aQ+&quot;\&quot; doesn't exist.&quot;}function aR(aV){if(!window.Ext){return}aV=Ext.EventObject.setEvent(aV);var aU;if(E.delegate){if(!(aU=aV.getTarget(E.delegate,aN))){return}}else{aU=aV.target}if(E.stopEvent){aV.stopEvent()}if(E.preventDefault){aV.preventDefault()}if(E.stopPropagation){aV.stopPropagation()}if(E.normalized){aV=aV.browserEvent}aS.call(aT||aN,aV,aU,E)}if(E.target){aR=g(aR,E)}if(E.delay){aR=a(aR,E,aS)}if(E.single){aR=ac(aR,aN,aP,aS,aT)}if(E.buffer){aO=new Ext.util.DelayedTask(aR);aR=ai(aR,E,aO)}b(aN,aP,aS,aO,aR,aT);return aR}Ext.apply(q,{addListener:q.on=function(aN,A,aP,aO,E){if(typeof A==&quot;object&quot;){var aS=A,aQ,aR;for(aQ in aS){aR=aS[aQ];if(!ah.test(aQ)){if(Ext.isFunction(aR)){ab(aN,aQ,aS,aR,aS.scope)}else{ab(aN,aQ,aR)}}}}else{ab(aN,A,E,aP,aO)}},removeListener:q.un=function(aQ,aR,aV,aX){var E=Ext.getDom(aQ);E&amp;&amp;Ext.get(E);var aW=E?aa(E):{},aT=E&amp;&amp;((aW[E.id]||{events:{}}).events)[aR]||[],A,aP,aN,aO,aS,aU;for(aP=0,aS=aT.length;aP&lt;aS;aP++){if(Ext.isArray(aU=aT[aP])&amp;&amp;aU[0]==aV&amp;&amp;(!aX||aU[2]==aX)){aU[4]&amp;&amp;aU[4].cancel();aO=aV.tasks&amp;&amp;aV.tasks.length;if(aO){while(aO--){aV.tasks[aO].cancel()}delete aV.tasks}A=aU[1];at.un(E,aR,at.extAdapter?aU[3]:A);if(A&amp;&amp;aR==&quot;mousewheel&quot;&amp;&amp;E.addEventListener){E.removeEventListener(&quot;DOMMouseScroll&quot;,A,false)}if(A&amp;&amp;aR==&quot;mousedown&quot;&amp;&amp;ax==E){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}aT.splice(aP,1);if(aT.length===0){delete aW[E.id].events[aR]}for(aO in aW[E.id].events){return false}aW[E.id].events={};return false}}},removeAll:function(aN){if(!(aN=Ext.getDom(aN))){return}var E=aN.id,aV=aa(aN)||{},aW=aV[E]||{},aU=aW.events||{},aR,aQ,aS,aO,aT,aP,A;for(aO in aU){if(aU.hasOwnProperty(aO)){aR=aU[aO];for(aQ=0,aS=aR.length;aQ&lt;aS;aQ++){aT=aR[aQ];aT[4]&amp;&amp;aT[4].cancel();if(aT[0].tasks&amp;&amp;(aP=aT[0].tasks.length)){while(aP--){aT[0].tasks[aP].cancel()}delete aT.tasks}A=aT[1];at.un(aN,aO,at.extAdapter?aT[3]:A);if(A&amp;&amp;aN.addEventListener&amp;&amp;aO==&quot;mousewheel&quot;){aN.removeEventListener(&quot;DOMMouseScroll&quot;,A,false)}if(A&amp;&amp;ax==aN&amp;&amp;aO==&quot;mousedown&quot;){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}}}}aV[E]&amp;&amp;(aV[E].events={})},getListeners:function(aN,E){aN=Ext.getDom(aN);if(!aN){return}var aP=(Ext.get(aN)||{}).id,A=aa(aN),aO=(A[aP]||{}).events||{};return aO[E]||null},purgeElement:function(aN,A,aP){aN=Ext.getDom(aN);var E=Ext.id(aN),aS=aa(aN),aT=(aS[E]||{}).events||{},aO,aR,aQ;if(aP){if(aT.hasOwnProperty(aP)){aR=aT[aP];for(aO=0,aQ=aR.length;aO&lt;aQ;aO++){q.removeListener(aN,aP,aR[aO][0])}}}else{q.removeAll(aN)}if(A&amp;&amp;aN&amp;&amp;aN.childNodes){for(aO=0,aQ=aN.childNodes.length;aO&lt;aQ;aO++){q.purgeElement(aN.childNodes[aO],A,aP)}}}});at.getListeners=function(E,A){return Ext.EventManager.getListeners(E,A)};Ext.provide&amp;&amp;Ext.provide(&quot;multidom&quot;)})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,EMPTYFN=function(){},OP=Object.prototype,addListener=function(){var handler;if(window.addEventListener){handler=function F(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){handler=function F(el,eventName,fn,capture){el.attachEvent(&quot;on&quot;+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}(),removeListener=function(){var handler;if(window.removeEventListener){handler=function F(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){handler=function F(el,eventName,fn){el.detachEvent(&quot;on&quot;+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}();if(typeof ELD.getDocument!=&quot;function&quot;){alert(&quot;MIF 2.1 requires multidom support&quot;)}if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,&quot;&quot;),10)&lt;311){alert(&quot;Ext Release &quot;+Ext.version+&quot; is not supported&quot;)}Ext.ns(&quot;Ext.ux.ManagedIFrame&quot;,&quot;Ext.ux.plugin&quot;);var MIM,MIF=Ext.ux.ManagedIFrame,MIFC;var frameEvents=[&quot;documentloaded&quot;,&quot;domready&quot;,&quot;focus&quot;,&quot;blur&quot;,&quot;resize&quot;,&quot;scroll&quot;,&quot;unload&quot;,&quot;scroll&quot;,&quot;exception&quot;,&quot;message&quot;,&quot;reset&quot;];var reSynthEvents=new RegExp(&quot;^(&quot;+frameEvents.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;);Ext.ux.ManagedIFrame.Element=Ext.extend(Ext.Element,{constructor:function(element,forceNew,doc){var d=doc||document,elCache=ELD.resolveDocumentCache(d),dom=Ext.getDom(element,false,d);if(!dom||!(/^(iframe|frame)/i).test(dom.tagName)){return null}var id=Ext.id(dom);this.dom=dom;this.id=id;(elCache[id]||(elCache[id]={el:this,events:{},data:{}})).el=this;this.dom.name||(this.dom.name=this.id);if(Ext.isIE){document.frames&amp;&amp;(document.frames[this.dom.name]||(document.frames[this.dom.name]=this.dom))}this.dom.ownerCt=this;MIM.register(this);if(!this._observable){(this._observable=new Ext.util.Observable()).addEvents(&quot;documentloaded&quot;,&quot;domready&quot;,&quot;exception&quot;,&quot;resize&quot;,&quot;message&quot;,&quot;blur&quot;,&quot;focus&quot;,&quot;unload&quot;,&quot;scroll&quot;,&quot;reset&quot;);this._observable.addEvents(&quot;_docready&quot;,&quot;_docload&quot;)}var H=Ext.isIE?&quot;onreadystatechange&quot;:&quot;onload&quot;;this.dom[H]=this.loadHandler.createDelegate(this);this.dom.onerror=this.loadHandler.createDelegate(this)},destructor:function(){this.dom[Ext.isIE?&quot;onreadystatechange&quot;:&quot;onload&quot;]=this.dom.onerror=EMPTYFN;MIM.deRegister(this);this.removeAllListeners();Ext.destroy(this.frameShim,this.DDM);this.hideMask(true);delete this.loadMask;this.reset();this.manager=null;this.dom.ownerCt=null},cleanse:function(forceReclean,deep){if(this.isCleansed&amp;&amp;forceReclean!==true){return this}var d=this.dom,n=d.firstChild,nx;while(d&amp;&amp;n){nx=n.nextSibling;deep&amp;&amp;Ext.fly(n).cleanse(forceReclean,deep);Ext.removeNode(n);n=nx}this.isCleansed=true;return this},src:null,CSS:null,manager:null,disableMessaging:true,domReadyRetries:7500,focusOnLoad:Ext.isIE,eventsFollowFrameLinks:true,remove:function(){this.destructor.apply(this,arguments);ElFrame.superclass.remove.apply(this,arguments)},getDocument:function(){return this.dom?this.dom.ownerDocument:document},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=this.getDocument(),form=Ext.getDom(opt.form?opt.form.form||opt.form:null,false,D)||Ext.DomHelper.append(D.body,{tag:&quot;form&quot;,cls:&quot;x-hidden x-mif-form&quot;,encoding:&quot;multipart/form-data&quot;}),formFly=Ext.fly(form,&quot;_dynaForm&quot;),formState={target:form.target||&quot;&quot;,method:form.method||&quot;&quot;,encoding:form.encoding||&quot;&quot;,enctype:form.enctype||&quot;&quot;,action:form.action||&quot;&quot;},encoding=opt.encoding||form.encoding,method=opt.method||form.method||&quot;POST&quot;;formFly.set({target:this.dom.name,method:method,encoding:encoding,action:opt.url||opt.action||form.action});if(method==&quot;POST&quot;||!!opt.enctype){formFly.set({enctype:opt.enctype||form.enctype||encoding})}var hiddens,hd,ps;if(opt.params&amp;&amp;(ps=Ext.isFunction(opt.params)?opt.params():opt.params)){hiddens=[];Ext.iterate(ps=typeof ps==&quot;string&quot;?Ext.urlDecode(ps,false):ps,function(n,v){Ext.fly(hd=D.createElement(&quot;input&quot;)).set({type:&quot;hidden&quot;,name:n,value:v});form.appendChild(hd);hiddens.push(hd)})}opt.callback&amp;&amp;this._observable.addListener(&quot;_docready&quot;,opt.callback,opt.scope,{single:true});this._frameAction=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&amp;&amp;Ext.each(hiddens,Ext.removeNode,Ext);if(formFly.hasClass(&quot;x-mif-form&quot;)){formFly.remove()}else{formFly.set(formState)}delete El._flyweights._dynaForm;formFly=null;this.hideMask(true)}).defer(100,this);return this},resetUrl:(function(){return Ext.isIE&amp;&amp;Ext.isSecure?Ext.SSL_SECURE_URL:&quot;about:blank&quot;})(),setSrc:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this.showMask();(discardUrl!==true)&amp;&amp;(this.src=src);var s=this._targetURI=(Ext.isFunction(src)?src()||&quot;&quot;:src);try{this._frameAction=true;this.dom.src=s;this.checkDOM()}catch(ex){O.fireEvent.call(O,&quot;exception&quot;,this,ex)}return this},setLocation:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this.showMask();var s=this._targetURI=(Ext.isFunction(src)?src()||&quot;&quot;:src);if(discardUrl!==true){this.src=src}try{this._frameAction=true;this.getWindow().location.replace(s);this.checkDOM()}catch(ex){O.fireEvent.call(O,&quot;exception&quot;,this,ex)}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false,s=src,win=this.getWindow(),O=this._observable;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false}this.hideMask(true);if(win){this.isReset=true;var cb=callback;O.addListener(&quot;_docload&quot;,function(frame){if(this.loadMask){this.loadMask.disabled=loadMaskOff}Ext.isFunction(cb)&amp;&amp;(cb=cb.apply(scope||this,arguments));O.fireEvent(&quot;reset&quot;,this)},this,{single:true});Ext.isFunction(s)&amp;&amp;(s=src());s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;win.location?(win.location.href=s):O.fireEvent(&quot;_docload&quot;,this)}return this},scriptRE:/(?:&lt;script.*?&gt;)((\n|\r|.)*?)(?:&lt;\/script&gt;)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdater().loadScripts||false;content=Ext.DomHelper.markup(content||&quot;&quot;);content=loadScripts===true?content:content.replace(this.scriptRE,&quot;&quot;);var doc;if((doc=this.getFrameDocument())&amp;&amp;!!content.length){this._unHook();this.src=null;this.showMask();Ext.isFunction(callback)&amp;&amp;this._observable.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this._targetURI=location.href;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(true);Ext.isFunction(callback)&amp;&amp;callback.call(scope,this)}return this},execCommand:function(command,userInterface,value,validate){var doc,assert;if((doc=this.getFrameDocument())&amp;&amp;!!command){try{Ext.isIE&amp;&amp;this.getWindow().focus();assert=validate&amp;&amp;Ext.isFunction(doc.queryCommandEnabled)?doc.queryCommandEnabled(command):true;return assert&amp;&amp;doc.execCommand(command,!!userInterface,value)}catch(eex){return false}}return false},setDesignMode:function(active){var doc;(doc=this.getFrameDocument())&amp;&amp;(doc.designMode=(/on|true/i).test(String(active))?&quot;on&quot;:&quot;off&quot;)},getUpdater:function(){return this.updateManager||(this.updateManager=new MIF.Updater(this))},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){var doc=this.getFrameDocument();return doc?Ext.get(el,doc):doc=null},fly:function(el,named){var doc=this.getFrameDocument();return doc?Ext.fly(el,named,doc):null},getDom:function(el){var d;if(!el||!(d=this.getFrameDocument())){return(d=null)}return Ext.getDom(el,d)},select:function(selector,unique){var d;return(d=this.getFrameDocument())?Ext.Element.select(selector,unique,d):d=null},query:function(selector){var d;return(d=this.getFrameDocument())?Ext.DomQuery.select(selector,d):null},removeNode:Ext.removeNode,_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.document.getElementById(&quot;'+this.id+'&quot;).ownerCt)._windowContext='+(Ext.isIE?&quot;window&quot;:'{eval:function(s){return new Function(&quot;return (&quot;+s+&quot;)&quot;)();}}')+&quot;;})()&quot;)){var w,p=this._frameProxy,D=this.getFrameDocument();if(w=this.getWindow()){p||(p=this._frameProxy=this._eventProxy.createDelegate(this));addListener(w,&quot;focus&quot;,p);addListener(w,&quot;blur&quot;,p);addListener(w,&quot;resize&quot;,p);addListener(w,&quot;unload&quot;,p);D&amp;&amp;addListener(Ext.isIE?w:D,&quot;scroll&quot;,p)}D&amp;&amp;(this.CSS=new Ext.ux.ManagedIFrame.CSS(D))}}catch(ex){}return this.domWritable()},_unHook:function(){if(this._hooked){this._windowContext&amp;&amp;(this._windowContext.hostMIF=null);this._windowContext=null;var w,p=this._frameProxy;if(p&amp;&amp;this.domWritable()&amp;&amp;(w=this.getWindow())){removeListener(w,&quot;focus&quot;,p);removeListener(w,&quot;blur&quot;,p);removeListener(w,&quot;resize&quot;,p);removeListener(w,&quot;unload&quot;,p);removeListener(Ext.isIE?w:this.getFrameDocument(),&quot;scroll&quot;,p)}}ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);this.CSS=this.CSS?this.CSS.destroy():null;this.domFired=this._frameAction=this.domReady=this._hooked=false},_windowContext:null,getFrameDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&amp;&amp;win?win.document:null)||this.dom.contentDocument||window.frames[this.dom.name].document||null}catch(gdEx){ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);return false}doc=(doc&amp;&amp;Ext.isFunction(ELD.getDocument))?ELD.getDocument(doc,true):doc;return doc},getDoc:function(){var D=this.getFrameDocument();return Ext.get(D,D)},getBody:function(){var d;return(d=this.getFrameDocument())?this.get(d.body||d.documentElement):null},getDocumentURI:function(){var URI,d;try{URI=this.src&amp;&amp;(d=this.getFrameDocument())?d.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},scrollChildIntoView:function(child,container,hscroll){this.fly(child,&quot;_scrollChildIntoView&quot;).scrollIntoView(this.getDom(container)||this.getBody().dom,hscroll);return this},print:function(){try{var win;if(win=this.getWindow()){Ext.isIE&amp;&amp;win.focus();win.print()}}catch(ex){throw new MIF.Error(&quot;printexception&quot;,ex.description||ex.message||ex)}return this},domWritable:function(){return !!Ext.isDocument(this.getFrameDocument(),true)&amp;&amp;!!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw new MIF.Error(&quot;execscript-secure-context&quot;)}}catch(ex){this._observable.fireEvent.call(this._observable,&quot;exception&quot;,this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:&quot;text/javascript&quot;,text:block});try{var head,script,doc=this.getFrameDocument();if(doc&amp;&amp;typeof doc.getElementsByTagName!=&quot;undefined&quot;){if(!(head=doc.getElementsByTagName(&quot;head&quot;)[0])){head=doc.createElement(&quot;head&quot;);doc.getElementsByTagName(&quot;html&quot;)[0].appendChild(head)}if(head&amp;&amp;(script=doc.createElement(&quot;script&quot;))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&amp;&amp;attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this._observable.fireEvent.call(this._observable,&quot;exception&quot;,this,ex)}finally{script=head=null}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fnSrc=fn.fn||window[fn];name&amp;&amp;fnSrc&amp;&amp;this.execScript(name+&quot;=&quot;+fnSrc,useDOM);invokeIt&amp;&amp;this.execScript(name+&quot;()&quot;)},loadHandler:function(e,target){var rstatus=(this.dom||{}).readyState||(e||{}).type;if(this.eventsFollowFrameLinks||this._frameAction||this.isReset){switch(rstatus){case&quot;domready&quot;:case&quot;DOMFrameContentLoaded&quot;:case&quot;domfail&quot;:this._onDocReady(rstatus);break;case&quot;load&quot;:case&quot;complete&quot;:this._onDocLoaded(rstatus);break;case&quot;error&quot;:this._observable.fireEvent.apply(this._observable,[&quot;exception&quot;,this].concat(arguments));break;default:}this.frameState=rstatus}},_onDocReady:function(eventName){var w,obv=this._observable,D;if(!this.isReset&amp;&amp;this.focusOnLoad&amp;&amp;(w=this.getWindow())){w.focus()}obv.fireEvent(&quot;_docready&quot;,this);(D=this.getDoc())&amp;&amp;(D.isReady=true);if(!this.domFired&amp;&amp;(this._hooked=this._renderHook())){this.domFired=true;this.isReset||obv.fireEvent.call(obv,&quot;domready&quot;,this)}this.domReady=true;this.hideMask()},_onDocLoaded:function(eventName){var obv=this._observable,w;this.domReady||this._onDocReady(&quot;domready&quot;);obv.fireEvent(&quot;_docload&quot;,this);this.isReset||obv.fireEvent(&quot;documentloaded&quot;,this);this.hideMask(true);this._frameAction=this.isReset=false},checkDOM:function(win){if(Ext.isGecko){return}var n=0,frame=this,domReady=false,b,l,d,max=this.domReadyRetries||2500,polling=false,startLocation=(this.getFrameDocument()||{location:{}}).location.href;(function(){d=frame.getFrameDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===frame._targetURI);if(frame.domReady){return}domReady=polling&amp;&amp;((b=frame.getBody())&amp;&amp;!!(b.dom.innerHTML||&quot;&quot;).length)||false;if(d.location.href&amp;&amp;!domReady&amp;&amp;(++n&lt;max)){setTimeout(arguments.callee,2);return}frame.loadHandler({type:domReady?&quot;domready&quot;:&quot;domfail&quot;})})()},filterEventOptionsRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,addListener:function(eventName,fn,scope,options){if(typeof eventName==&quot;object&quot;){var o=eventName;for(var e in o){if(this.filterEventOptionsRe.test(e)){continue}if(typeof o[e]==&quot;function&quot;){this.addListener(e,o[e],o.scope,o)}else{this.addListener(e,o[e].fn,o[e].scope,o[e])}}return}if(reSynthEvents.test(eventName)){var O=this._observable;if(O){O.events[eventName]||(O.addEvents(eventName));O.addListener.call(O,eventName,fn,scope||this,options)}}else{ElFrame.superclass.addListener.call(this,eventName,fn,scope||this,options)}return this},removeListener:function(eventName,fn,scope){var O=this._observable;if(reSynthEvents.test(eventName)){O&amp;&amp;O.removeListener.call(O,eventName,fn,scope||this,options)}else{ElFrame.superclass.removeListener.call(this,eventName,fn,scope||this)}return this},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);var O=this._observable;O&amp;&amp;O.purgeListeners.call(this._observable);return this},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&amp;&amp;!lmask.disabled){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls,lmask.maskEl)}},hideMask:function(forced){var tlm=this.loadMask||{};if(forced||(tlm.hideOnReady&amp;&amp;this.domReady)){this.unmask()}},mask:function(msg,msgCls,maskCls,maskEl){this._mask&amp;&amp;this.unmask();var p=Ext.get(maskEl)||this.parent(&quot;.ux-mif-mask-target&quot;)||this.parent();if(p.getStyle(&quot;position&quot;)==&quot;static&quot;&amp;&amp;!p.select(&quot;iframe,frame,object,embed&quot;).elements.length){p.addClass(&quot;x-masked-relative&quot;)}p.addClass(&quot;x-masked&quot;);this._mask=Ext.DomHelper.append(p,{cls:maskCls||&quot;ux-mif-el-mask&quot;},true);this._mask.setDisplayed(true);this._mask._agent=p;if(typeof msg==&quot;string&quot;){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||&quot;ux-mif-el-mask-msg&quot;,style:{visibility:&quot;hidden&quot;},cn:{tag:&quot;div&quot;,html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY).center(p).setVisible(true)}if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;this.getStyle(&quot;height&quot;)==&quot;auto&quot;){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&amp;&amp;a.removeClass([&quot;x-masked-relative&quot;,&quot;x-masked&quot;]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},createFrameShim:function(imgUrl,shimCls){this.shimCls=shimCls||this.shimCls||&quot;ux-mif-shim&quot;;this.frameShim||(this.frameShim=this.next(&quot;.&quot;+this.shimCls)||Ext.DomHelper.append(this.dom.parentNode,{tag:&quot;img&quot;,src:imgUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:&quot;no&quot;},true));this.frameShim&amp;&amp;(this.frameShim.autoBoxAdjust=false);return this.frameShim},toggleShim:function(show){var shim=this.frameShim||this.createFrameShim();var cls=this.shimCls+&quot;-on&quot;;!show&amp;&amp;shim.removeClass(cls);show&amp;&amp;!shim.hasClass(cls)&amp;&amp;shim.addClass(cls)},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&amp;&amp;loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},_eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e,er,args=[e.type,this];if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){if(e.type==&quot;resize&quot;){var doc=this.getFrameDocument();doc&amp;&amp;(args.push({height:ELD.getDocumentHeight(doc),width:ELD.getDocumentWidth(doc)},{height:ELD.getViewportHeight(doc),width:ELD.getViewportWidth(doc)},{height:ELD.getViewHeight(false,doc),width:ELD.getViewWidth(false,doc)}))}er=this._observable?this._observable.fireEvent.apply(this._observable,args.concat(Array.prototype.slice.call(arguments,0))):null;(e.type==&quot;unload&quot;)&amp;&amp;this._unHook()}return er},sendMessage:function(message,tag,origin){},postMessage:function(message,origin){}});ElFrame=Ext.Element.IFRAME=Ext.Element.FRAME=Ext.ux.ManagedIFrame.Element;var fp=ElFrame.prototype;Ext.override(ElFrame,{on:fp.addListener,un:fp.removeListener,getUpdateManager:fp.getUpdater});Ext.ux.ManagedIFrame.ComponentAdapter=function(){};Ext.ux.ManagedIFrame.ComponentAdapter.prototype={version:2.12,defaultSrc:null,unsupportedText:&quot;Inline frames are NOT enabled/supported by your browser.&quot;,hideMode:!Ext.isIE&amp;&amp;!!Ext.ux.plugin.VisibilityMode?&quot;nosize&quot;:&quot;display&quot;,animCollapse:Ext.isIE,animFloat:Ext.isIE,disableMessaging:true,eventsFollowFrameLinks:true,frameConfig:null,focusOnLoad:Ext.isIE,frameEl:null,useShim:false,autoScroll:true,autoLoad:null,getId:function(){return this.id||(this.id=&quot;mif-comp-&quot;+(++Ext.Component.AUTO_ID))},stateEvents:[&quot;documentloaded&quot;],stateful:false,setAutoScroll:function(auto){var scroll=Ext.value(auto,this.autoScroll===true);this.rendered&amp;&amp;this.getFrame()&amp;&amp;this.frameEl.setOverflow((this.autoScroll=scroll)?&quot;auto&quot;:&quot;hidden&quot;);return this},getContentTarget:function(){return this.getFrame()},getFrame:function(){if(this.rendered){if(this.frameEl){return this.frameEl}var f=this.items&amp;&amp;this.items.first?this.items.first():null;f&amp;&amp;(this.frameEl=f.frameEl);return this.frameEl}return null},getFrameWindow:function(){return this.getFrame()?this.frameEl.getWindow():null},getFrameDocument:function(){return this.getFrame()?this.frameEl.getFrameDocument():null},getFrameDoc:function(){return this.getFrame()?this.frameEl.getDoc():null},getFrameBody:function(){return this.getFrame()?this.frameEl.getBody():null},resetFrame:function(){this.getFrame()&amp;&amp;this.frameEl.reset.apply(this.frameEl,arguments);return this},submitAsTarget:function(submitCfg){this.getFrame()&amp;&amp;this.frameEl.submitAsTarget.apply(this.frameEl,arguments);return this},load:function(loadCfg){if(loadCfg&amp;&amp;this.getFrame()){var args=arguments;this.resetFrame(null,function(){loadCfg.submitAsTarget?this.submitAsTarget.apply(this,args):this.frameEl.load.apply(this.frameEl,args)},this)}this.autoLoad=loadCfg;return this},doAutoLoad:function(){this.autoLoad&amp;&amp;this.load(typeof this.autoLoad==&quot;object&quot;?this.autoLoad:{url:this.autoLoad})},getUpdater:function(){return this.getFrame()?this.frameEl.getUpdater():null},setSrc:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setSrc.apply(this.frameEl,arguments);return this},setLocation:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setLocation.apply(this.frameEl,arguments);return this},getState:function(){var URI=this.getFrame()?this.frameEl.getDocumentURI()||null:null;var state=this.supr().getState.call(this);state=Ext.apply(state||{},{defaultSrc:Ext.isFunction(URI)?URI():URI,autoLoad:this.autoLoad});return state},setMIFEvents:function(){this.addEvents(&quot;documentloaded&quot;,&quot;domready&quot;,&quot;exception&quot;,&quot;message&quot;,&quot;blur&quot;,&quot;focus&quot;,&quot;scroll&quot;,&quot;resize&quot;,&quot;unload&quot;,&quot;reset&quot;)},sendMessage:function(message,tag,origin){},onAdd:function(C){C.relayTarget&amp;&amp;this.suspendEvents(true)},initRef:function(){if(this.ref){var t=this,levels=this.ref.split(&quot;/&quot;),l=levels.length,i;for(i=0;i&lt;l;i++){if(t.ownerCt){t=t.ownerCt}}this.refName=levels[--i];t[this.refName]||(t[this.refName]=this);this.refOwner=t}}};Ext.ux.ManagedIFrame.Component=Ext.extend(Ext.BoxComponent,{ctype:&quot;Ext.ux.ManagedIFrame.Component&quot;,initComponent:function(){var C={monitorResize:this.monitorResize||(this.monitorResize=!!this.fitToParent),plugins:(this.plugins||[]).concat(this.hideMode===&quot;nosize&quot;&amp;&amp;Ext.ux.plugin.VisibilityMode?[new Ext.ux.plugin.VisibilityMode({hideMode:&quot;nosize&quot;,elements:[&quot;bwrap&quot;]})]:[])};MIF.Component.superclass.initComponent.call(Ext.apply(this,Ext.apply(this.initialConfig,C)));this.setMIFEvents()},onRender:function(ct,position){var frCfg=this.frameCfg||this.frameConfig||(this.relayTarget?{name:this.relayTarget.id}:{})||{};var frDOM=frCfg.autoCreate||frCfg;frDOM=Ext.apply({tag:&quot;iframe&quot;,id:Ext.id()},frDOM);var el=Ext.getDom(this.el);(el&amp;&amp;el.tagName==&quot;iframe&quot;)||(this.autoEl=Ext.apply({name:frDOM.id,frameborder:0},frDOM));MIF.Component.superclass.onRender.apply(this,arguments);if(this.unsupportedText){ct.child(&quot;noframes&quot;)||ct.createChild({tag:&quot;noframes&quot;,html:this.unsupportedText||null})}var frame=this.el;var F;if(F=this.frameEl=(this.el?new MIF.Element(this.el.dom,true):null)){Ext.apply(F,{ownerCt:this.relayTarget||this,disableMessaging:Ext.value(this.disableMessaging,true),focusOnLoad:Ext.value(this.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(this.eventsFollowFrameLinks,true)});F.ownerCt.frameEl=F;F.addClass(&quot;ux-mif&quot;);if(this.loadMask){var mEl=this.loadMask.maskEl;F.loadMask=Ext.apply({disabled:false,hideOnReady:false,msgCls:&quot;ext-el-mask-msg x-mask-loading&quot;,maskCls:&quot;ext-el-mask&quot;},{maskEl:F.ownerCt[String(mEl)]||F.parent(&quot;.&quot;+String(mEl))||F.parent(&quot;.ux-mif-mask-target&quot;)||mEl},Ext.isString(this.loadMask)?{msg:this.loadMask}:this.loadMask);Ext.get(F.loadMask.maskEl)&amp;&amp;Ext.get(F.loadMask.maskEl).addClass(&quot;ux-mif-mask-target&quot;)}F._observable&amp;&amp;(this.relayTarget||this).relayEvents(F._observable,frameEvents.concat(this._msgTagHandlers||[]));delete this.contentEl}},afterRender:function(container){MIF.Component.superclass.afterRender.apply(this,arguments);if(this.fitToParent&amp;&amp;!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}this.getEl().setOverflow(&quot;hidden&quot;);this.setAutoScroll();var F;if(F=this.frameEl){var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on(&quot;afterlayout&quot;,function(container,layout){Ext.each([&quot;north&quot;,&quot;south&quot;,&quot;east&quot;,&quot;west&quot;],function(region){var reg;if((reg=layout[region])&amp;&amp;reg.split&amp;&amp;reg.split.dd&amp;&amp;!reg._splitTrapped){reg.split.dd.endDrag=reg.split.dd.endDrag.createSequence(MIM.hideShims,MIM);reg.split.on(&quot;beforeresize&quot;,MIM.showShims,MIM);reg._splitTrapped=MIM._splitTrapped=true}},this)},this,{single:true});ownerCt=ownerCt.ownerCt}if(!!this.ownerCt||this.useShim){this.frameShim=F.createFrameShim()}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var resumeEvents=this.relayTarget&amp;&amp;this.ownerCt?this.ownerCt.resumeEvents.createDelegate(this.ownerCt):null;if(this.autoload){this.doAutoLoad()}else{if(this.frameMarkup||this.html){F.update(this.frameMarkup||this.html,true,resumeEvents);delete this.html;delete this.frameMarkup;return}else{if(this.defaultSrc){F.setSrc(this.defaultSrc,false)}else{F.reset(null,resumeEvents);return}}}resumeEvents&amp;&amp;resumeEvents()}},beforeDestroy:function(){var F;if(F=this.getFrame()){F.remove();this.frameEl=this.frameShim=null}this.relayTarget&amp;&amp;(this.relayTarget.frameEl=null);MIF.Component.superclass.beforeDestroy.call(this)}});Ext.override(MIF.Component,MIF.ComponentAdapter.prototype);Ext.reg(&quot;mif&quot;,MIF.Component);function embed_MIF(config){config||(config={});config.layout=&quot;fit&quot;;config.items={xtype:&quot;mif&quot;,ref:&quot;mifChild&quot;,useShim:true,autoScroll:Ext.value(config.autoScroll,this.autoScroll),defaultSrc:Ext.value(config.defaultSrc,this.defaultSrc),frameMarkup:Ext.value(config.html,this.html),loadMask:Ext.value(config.loadMask,this.loadMask),disableMessaging:Ext.value(config.disableMessaging,this.disableMessaging),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,this.eventsFollowFrameLinks),focusOnLoad:Ext.value(config.focusOnLoad,this.focusOnLoad),frameConfig:Ext.value(config.frameConfig||config.frameCfg,this.frameConfig),relayTarget:this};delete config.html;this.setMIFEvents();return config}Ext.ux.ManagedIFrame.Panel=Ext.extend(Ext.Panel,{ctype:&quot;Ext.ux.ManagedIFrame.Panel&quot;,bodyCssClass:&quot;ux-mif-mask-target&quot;,constructor:function(config){MIF.Panel.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Panel,MIF.ComponentAdapter.prototype);Ext.reg(&quot;iframepanel&quot;,MIF.Panel);Ext.ux.ManagedIFrame.Portlet=Ext.extend(Ext.ux.ManagedIFrame.Panel,{ctype:&quot;Ext.ux.ManagedIFrame.Portlet&quot;,anchor:&quot;100%&quot;,frame:true,collapseEl:&quot;bwrap&quot;,collapsible:true,draggable:true,cls:&quot;x-portlet&quot;});Ext.reg(&quot;iframeportlet&quot;,MIF.Portlet);Ext.ux.ManagedIFrame.Window=Ext.extend(Ext.Window,{ctype:&quot;Ext.ux.ManagedIFrame.Window&quot;,bodyCssClass:&quot;ux-mif-mask-target&quot;,constructor:function(config){MIF.Window.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Window,MIF.ComponentAdapter.prototype);Ext.reg(&quot;iframewindow&quot;,MIF.Window);Ext.ux.ManagedIFrame.Updater=Ext.extend(Ext.Updater,{showLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.mask(this.indicatorText)},hideLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.unmask()},updateComplete:function(response){MIF.Updater.superclass.updateComplete.apply(this,arguments);this.hideLoading()},processFailure:function(response){MIF.Updater.superclass.processFailure.apply(this,arguments);this.hideLoading()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};Ext.ux.ManagedIFrame.CSS=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName(&quot;head&quot;)[0];var rules=doc.createElement(&quot;style&quot;);rules.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;rules.setAttribute(&quot;id&quot;,id);if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc||!id){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){if(!doc){return}this.removeStyleSheet(id);var ss=doc.createElement(&quot;link&quot;);ss.setAttribute(&quot;rel&quot;,&quot;stylesheet&quot;);ss.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;ss.setAttribute(&quot;id&quot;,id);ss.setAttribute(&quot;href&quot;,url);doc.getElementsByTagName(&quot;head&quot;)[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss,media){this.rules||(this.rules={});try{Ext.each(ss.cssRules||ss.rules||[],function(rule){this.hashRule(rule,ss,media)},this);Ext.each(ss.imports||[],function(sheet){sheet&amp;&amp;this.cacheStyleSheet(sheet,this.resolveMedia([sheet,sheet.parentStyleSheet]))},this)}catch(e){}},hashRule:function(rule,sheet,mediaOverride){var mediaSelector=mediaOverride||this.resolveMedia(rule);if(rule.cssRules||rule.rules){this.cacheStyleSheet(rule,this.resolveMedia([rule,rule.parentRule]))}if(rule.styleSheet){this.cacheStyleSheet(rule.styleSheet,this.resolveMedia([rule,rule.ownerRule,rule.parentStyleSheet]))}rule.selectorText&amp;&amp;Ext.each((mediaSelector||&quot;&quot;).split(&quot;,&quot;),function(media){this.rules[((media?media.trim()+&quot;:&quot;:&quot;&quot;)+rule.selectorText).toLowerCase()]=rule},this)},resolveMedia:function(rule){var media;Ext.each([].concat(rule),function(r){if(r&amp;&amp;r.media&amp;&amp;r.media.length){media=r.media;return false}});return media?(Ext.isIE?String(media):media.mediaText):&quot;&quot;},getRules:function(refreshCache){if(!this.rules||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i&lt;len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache,mediaSelector){var rs=this.getRules(refreshCache);if(Ext.type(mediaSelector)==&quot;string&quot;){mediaSelector=mediaSelector.trim()+&quot;:&quot;}else{mediaSelector=&quot;&quot;}if(!Ext.isArray(selector)){return rs[(mediaSelector+selector).toLowerCase()]}var select;for(var i=0;i&lt;selector.length;i++){select=(mediaSelector+selector[i]).toLowerCase();if(rs[select]){return rs[select]}}return null},updateRule:function(selector,property,value,mediaSelector){Ext.each((mediaSelector||&quot;&quot;).split(&quot;,&quot;),function(mediaSelect){if(!Ext.isArray(selector)){var rule=this.getRule(selector,false,mediaSelect);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true}}else{for(var i=0;i&lt;selector.length;i++){if(this.updateRule(selector[i],property,value,mediaSelect)){return true}}}return false},this)}}}};Ext.ux.ManagedIFrame.Manager=function(){var frames={};var implementation={_DOMFrameReadyHandler:function(e){try{var $frame;if($frame=e.target.ownerCt){$frame.loadHandler.call($frame,e)}}catch(rhEx){}},shimCls:&quot;ux-mif-shim&quot;,register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.name]={ref:frame};return frame},deRegister:function(frame){delete frames[frame.id];delete frames[frame.name]},hideShims:function(){var mm=MIF.Manager;mm.shimsApplied&amp;&amp;Ext.select(&quot;.&quot;+mm.shimCls,true).removeClass(mm.shimCls+&quot;-on&quot;);mm.shimsApplied=false},showShims:function(){var mm=MIF.Manager;!mm.shimsApplied&amp;&amp;Ext.select(&quot;.&quot;+mm.shimCls,true).addClass(mm.shimCls+&quot;-on&quot;);mm.shimsApplied=true},getFrameById:function(id){return typeof id==&quot;string&quot;?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frames[frame.id]||frames[frame.id]||null},destroy:function(){if(document.addEventListener&amp;&amp;!Ext.isOpera){window.removeEventListener(&quot;DOMFrameContentLoaded&quot;,this._DOMFrameReadyHandler,false)}}};document.addEventListener&amp;&amp;!Ext.isOpera&amp;&amp;window.addEventListener(&quot;DOMFrameContentLoaded&quot;,implementation._DOMFrameReadyHandler,false);Ext.EventManager.on(window,&quot;beforeunload&quot;,implementation.destroy,implementation);return implementation}();MIM=MIF.Manager;MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;var winDD=Ext.Window.DD;Ext.override(winDD,{startDrag:winDD.prototype.startDrag.createInterceptor(MIM.showShims),endDrag:winDD.prototype.endDrag.createInterceptor(MIM.hideShims)});Ext.ux.ManagedIFramePanel=MIF.Panel;Ext.ux.ManagedIFramePortlet=MIF.Portlet;Ext.ux.ManagedIframe=function(el,opt){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&amp;&amp;el.dom&amp;&amp;el.dom.tagName==&quot;IFRAME&quot;){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:&quot;iframe&quot;,frameborder:0,cls:&quot;x-mif&quot;,src:(Ext.isIE&amp;&amp;Ext.isSecure)?Ext.SSL_SECURE_URL:&quot;about:blank&quot;},config.autoCreate))):null;if(el&amp;&amp;config.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:&quot;noframes&quot;,html:config.unsupportedText})}}var mif=new MIF.Element(el,true);if(mif){Ext.apply(mif,{disableMessaging:Ext.value(config.disableMessaging,true),focusOnLoad:Ext.value(config.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,true),loadMask:!!config.loadMask?Ext.apply({msg:&quot;Loading..&quot;,msgCls:&quot;x-mask-loading&quot;,maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null});config.listeners&amp;&amp;mif.on(config.listeners);if(!!config.html){mif.update(config.html)}else{!!config.src&amp;&amp;mif.setSrc(config.src)}}return mif};Ext.ux.ManagedIFrame.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:&quot;Ext.ux.ManagedIFrame&quot;});Ext.apply(Ext.ux.ManagedIFrame.Error.prototype,{lang:{&quot;documentcontext-remove&quot;:&quot;An attempt was made to remove an Element from the wrong document context.&quot;,&quot;execscript-secure-context&quot;:&quot;An attempt was made at script execution within a document context with limited access permissions.&quot;,printexception:&quot;An Error was encountered attempting the print the frame contents (document access is likely restricted).&quot;}});Ext.onReady(function(){var CSS=new Ext.ux.ManagedIFrame.CSS(document),rules=[];CSS.getRule(&quot;.ux-mif-fill&quot;)||(rules.push(&quot;.ux-mif-fill{height:100%;width:100%;}&quot;));CSS.getRule(&quot;.ux-mif-mask-target&quot;)||(rules.push(&quot;.ux-mif-mask-target{position:relative;zoom:1;}&quot;));CSS.getRule(&quot;.ux-mif-el-mask&quot;)||(rules.push(&quot;.ux-mif-el-mask {z-index: 100;position: absolute;top:0;left:0;-moz-opacity: 0.5;opacity: .50;*filter: alpha(opacity=50);width: 100%;height: 100%;zoom: 1;} &quot;,&quot;.ux-mif-el-mask-msg {z-index: 1;position: absolute;top: 0;left: 0;border:1px solid;background:repeat-x 0 -16px;padding:2px;} &quot;,&quot;.ux-mif-el-mask-msg div {padding:5px 10px 5px 10px;border:1px solid;cursor:wait;} &quot;));if(!CSS.getRule(&quot;.ux-mif-shim&quot;)){rules.push(&quot;.ux-mif-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}&quot;);rules.push(&quot;.ux-mif-shim-on{width:100%;height:100%;display:block;zoom:1;}&quot;);rules.push(&quot;.ext-ie6 .ux-mif-shim{margin-left:5px;margin-top:3px;}&quot;)}if(!CSS.getRule(&quot;.x-hide-nosize&quot;)){rules.push(&quot;.x-hide-nosize{height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}&quot;)}!!rules.length&amp;&amp;CSS.createStyleSheet(rules.join(&quot; &quot;),&quot;mifCSS&quot;)});Ext.provide&amp;&amp;Ext.provide(&quot;mif&quot;)})();Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.TextFilter=Ext.extend(Ext.form.TriggerField,{ctCls:&quot;s-textfilter&quot;,cls:&quot;s-textfilter-text&quot;,triggerConfig:{tag:&quot;div&quot;,cls:&quot;x-form-trigger s-textfilter-trigger&quot;},enableKeyEvents:true,listeners:{keyup:{fn:function(c,b){c.trigger.setVisible((c.getValue()!==&quot;&quot;))}},render:{fn:function(a){a.trigger.hide()}}},queryDelay:500,queryAction:&quot;find&quot;,enumAction:&quot;enum&quot;,queryParam:&quot;query&quot;,localFilter:false,localFilterField:&quot;&quot;,pageSize:&quot;&quot;,constructor:function(a){sitools.widget.TextFilter.superclass.constructor.call(this,a);if(this.store&amp;&amp;!this.localFilter){this.mon(this.store,&quot;beforeload&quot;,this.onBeforeLoad,this)}if(this.localFilter===true){this.mon(this.store,&quot;load&quot;,this.reset,this)}},initEvents:function(){sitools.widget.TextFilter.superclass.initEvents.call(this);this.mon(this.el,&quot;keyup&quot;,this.filter,this,{buffer:this.queryDelay})},setPageSize:function(a){this.pageSize=a},onBeforeLoad:function(e,d){var f=this.getValue();if(f){d.params[this.queryParam]=f;d.params.action=this.queryAction}else{d.params.action=this.enumAction}return true},filter:function(){var c=this.getValue();var d={};if(!this.store){return}if(this.localFilter===true){if(c){this.store.filter(this.localFilterField,c,true)}else{this.store.clearFilter(false)}return}if(!Ext.isEmpty(this.pageSize)){d={start:0,limit:this.pageSize}}if(c){d.action=this.queryAction;d[this.queryParam]=c;this.store.load({params:d})}else{d.action=this.enumAction;this.store.load({params:d})}},reset:function(){sitools.widget.TextFilter.superclass.reset.call(this);if(this.localFilterField===false&amp;&amp;this.store){this.store.clearFilter(false)}},onTriggerClick:function(){if(this.getValue()){this.setValue(&quot;&quot;);this.trigger.hide();this.filter()}}});Ext.reg(&quot;s-filter&quot;,sitools.widget.TextFilter);Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:&quot;x-form-spinner-trigger&quot;,splitterClass:&quot;x-form-spinner-splitter&quot;,alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(a){Ext.ux.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=false},init:function(a){this.field=a;a.afterMethod(&quot;onRender&quot;,this.doRender,this);a.afterMethod(&quot;onEnable&quot;,this.doEnable,this);a.afterMethod(&quot;onDisable&quot;,this.doDisable,this);a.afterMethod(&quot;afterRender&quot;,this.doAfterRender,this);a.afterMethod(&quot;onResize&quot;,this.doResize,this);a.afterMethod(&quot;onFocus&quot;,this.doFocus,this);a.beforeMethod(&quot;onDestroy&quot;,this.doDestroy,this)},doRender:function(b,a){var c=this.el=this.field.getEl();var d=this.field;if(!d.wrap){d.wrap=this.wrap=c.wrap({cls:&quot;x-form-field-wrap&quot;})}else{this.wrap=d.wrap.addClass(&quot;x-form-field-wrap&quot;)}this.trigger=this.wrap.createChild({tag:&quot;img&quot;,src:Ext.BLANK_IMAGE_URL,cls:&quot;x-form-trigger &quot;+this.triggerClass});if(!d.width){this.wrap.setWidth(c.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:&quot;div&quot;,cls:this.splitterClass,style:&quot;width:13px; height:2px;&quot;});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy(&quot;&quot;,this.splitter,true);this.proxy.addClass(&quot;x-form-spinner-proxy&quot;);this.proxy.setStyle(&quot;left&quot;,&quot;0px&quot;);this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,&quot;SpinnerDrag&quot;,{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var a;if(Ext.isIE&amp;&amp;this.el.getY()!=(a=this.trigger.getY())){this.el.position();this.el.setY(a)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(a,b){if(typeof a==&quot;number&quot;){this.el.setWidth(a-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass(&quot;x-trigger-wrap-focus&quot;);this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on(&quot;mousedown&quot;,this.mimicBlur,this,{delay:10});this.el.on(&quot;keydown&quot;,this.checkTab,this)}},checkTab:function(a){if(a.getKey()==a.TAB){this.triggerBlur()}},mimicBlur:function(a){if(!this.wrap.contains(a.target)&amp;&amp;this.field.validateBlur(a)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un(&quot;mousedown&quot;,this.mimicBlur,this);this.el.un(&quot;keydown&quot;,this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass(&quot;x-trigger-wrap-focus&quot;);this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver(&quot;x-form-trigger-over&quot;);this.trigger.addClassOnClick(&quot;x-form-trigger-click&quot;)},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp()},down:function(a){a.preventDefault();this.onSpinDown()},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate()},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,&quot;click&quot;,this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,&quot;mousewheel&quot;,this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()&lt;a)?&quot;x-form-spinner-overup&quot;:&quot;x-form-spinner-overdown&quot;;this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var a=this.getMiddle();if(((Ext.EventObject.getPageY()&gt;a)&amp;&amp;this.tmpHoverClass==&quot;x-form-spinner-overup&quot;)||((Ext.EventObject.getPageY()&lt;a)&amp;&amp;this.tmpHoverClass==&quot;x-form-spinner-overdown&quot;)){}},onMouseDown:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()&lt;a)?&quot;x-form-spinner-clickup&quot;:&quot;x-form-spinner-clickdown&quot;;this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var b=this.getMiddle();var a=(Ext.EventObject.getPageY()&lt;b)?&quot;Up&quot;:&quot;Down&quot;;this[&quot;onSpin&quot;+a]()},getMiddle:function(){var b=this.trigger.getTop();var c=this.trigger.getHeight();var a=b+(c/2);return a},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(a){if(this.wrap.hasClass(&quot;x-trigger-wrap-focus&quot;)==false){return}var b=a.getWheelDelta();if(b&gt;0){this.onSpinUp();a.stopEvent()}else{if(b&lt;0){this.onSpinDown();a.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var b=Ext.fly(this.dd.getDragEl()).getTop();var a=&quot;&quot;;if(this._previousY&gt;b){a=&quot;Up&quot;}if(this._previousY&lt;b){a=&quot;Down&quot;}if(a!=&quot;&quot;){this[&quot;onSpin&quot;+a]()}this._previousY=b},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spinup&quot;,this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spindown&quot;,this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spinup&quot;,this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spindown&quot;,this)},spin:function(d,b){var a=parseFloat(this.field.getValue());var c=(b==true)?this.alternateIncrementValue:this.incrementValue;(d==true)?a-=c:a+=c;a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setRawValue(a)},fixBoundries:function(b){var a=b;if(this.field.minValue!=undefined&amp;&amp;a&lt;this.field.minValue){a=this.field.minValue}if(this.field.maxValue!=undefined&amp;&amp;a&gt;this.field.maxValue){a=this.field.maxValue}return this.fixPrecision(a)},fixPrecision:function(b){var a=isNaN(b);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||a||!b){return a?&quot;&quot;:b}return parseFloat(parseFloat(b).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:&quot;wrap&quot;,deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(c){var b=Ext.copyTo({},c,&quot;incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass&quot;);var d=this.spinner=new Ext.ux.Spinner(b);var a=c.plugins?(Ext.isArray(c.plugins)?c.plugins.push(d):[c.plugins,d]):d;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(c,{plugins:a}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,&quot;tl-tr&quot;,[2,0])}},validateBlur:function(){return true}});Ext.reg(&quot;spinnerfield&quot;,Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.ux.PanelRecherche=function(a,l,c,g){var f=[];var m=new Ext.data.JsonStore({fields:[{name:&quot;parentheseOuvrante&quot;,type:&quot;text&quot;},{name:&quot;leftAttribute&quot;},{name:&quot;operateur&quot;,type:&quot;text&quot;},{name:&quot;rightAttribute&quot;},{name:&quot;parentheseFermante&quot;},{name:&quot;opLogique&quot;}]});Ext.util.Format.comboRenderer=function(n){return function(q){var p=n.findRecord(n.valueField,q);return p?p.get(n.displayField):n.valueNotFoundText}};var k=new Ext.form.ComboBox({id:&quot;comboOlEditor&quot;,typeAhead:false,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[&quot;&quot;,&quot;&quot;],[&quot;and&quot;,&quot;and&quot;],[&quot;or&quot;,&quot;or&quot;]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;});var d=new Ext.form.ComboBox({id:&quot;comboOpEditor&quot;,typeAhead:false,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[&quot; &gt; &quot;,&quot;&gt;&quot;],[&quot; &gt;= &quot;,&quot;&gt;=&quot;],[&quot; &lt; &quot;,&quot;&lt;&quot;],[&quot; &lt;= &quot;,&quot;&lt;=&quot;],[&quot; like &quot;,&quot;like&quot;],[&quot; = &quot;,&quot;=&quot;],[&quot; != &quot;,&quot;!=&quot;]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;});Ext.util.Format.attributeRenderer=function(){return function(p){if(p){var n=p.tableAlias?p.tableAlias:p.tableName;return n+&quot;.&quot;+p.dataIndex}}};var e;if(g==&quot;join&quot;){e={id:&quot;rightAttribute&quot;,name:&quot;rightAttribute&quot;,header:i18n.get(&quot;label.rightAttribute&quot;),width:100,sortable:false,dataIndex:&quot;rightAttribute&quot;,renderer:Ext.util.Format.attributeRenderer()}}else{e={header:i18n.get(&quot;label.rightAttribute&quot;),width:200,sortable:false,dataIndex:&quot;rightAttribute&quot;,editor:new Ext.form.TextField({allowBlank:false})}}var b={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[]};Ext.ux.PanelRecherche.superclass.constructor.call(this,Ext.apply({layout:&quot;fit&quot;,flex:0.45,id:a,title:l,resizable:true,autoHeight:false,viewConfig:{forceFit:true},autoScroll:true,store:m,enableColumnHide:false,enableColumnMove:false,enableColumnSort:false,clicksToEdit:2,tbar:b,columns:[{header:&quot;&quot;,width:50,sortable:false,dataIndex:&quot;opLogique&quot;,editor:k,renderer:Ext.util.Format.comboRenderer(k)},{header:&quot;&quot;,width:20,sortable:false,dataIndex:&quot;parentheseOuvrante&quot;},{id:&quot;leftAttribute&quot;,name:&quot;leftAttribute&quot;,header:i18n.get(&quot;header.leftAttribute&quot;),width:100,sortable:false,dataIndex:&quot;leftAttribute&quot;,renderer:Ext.util.Format.attributeRenderer()},{header:i18n.get(&quot;header.operateur&quot;),width:70,sortable:false,dataIndex:&quot;operateur&quot;,editor:d,renderer:Ext.util.Format.comboRenderer(d)},e,{header:&quot;&quot;,width:20,sortable:false,dataIndex:&quot;parentheseFermante&quot;,monType:&quot;parenthese&quot;}],stripeRows:true,sm:new Ext.grid.RowSelectionModel(),listeners:{celldblclick:function(q,z,s,u){var n;var p;var v;var t;if(s==1){n=q.getStore().getAt(z);v=q.getColumnModel().getDataIndex(s);t=n.get(v);n.set(v,t+&quot;(&quot;)}if(s==2){n=q.getStore().getAt(z);p=new sitools.admin.datasets.selectPredicat({field:&quot;leftAttribute&quot;,recordPredicat:n,storePredicat:c,viewPredicat:q.getView()});p.show(ID.BOX.DATASETS)}if(s==4&amp;&amp;g==&quot;join&quot;){n=q.getStore().getAt(z);p=new sitools.admin.datasets.selectPredicat({field:&quot;rightAttribute&quot;,recordPredicat:n,storePredicat:c,viewPredicat:q.getView()});p.show(ID.BOX.DATASETS)}if(s==5){n=q.getStore().getAt(z);v=q.getColumnModel().getDataIndex(s);t=n.get(v);n.set(v,t+&quot;)&quot;)}q.getView().refresh()},contextmenu:function(p){if(!Ext.isEmpty(Ext.getCmp(&quot;gridCritereCtxMenu&quot;))){Ext.getCmp(&quot;gridCritereCtxMenu&quot;).destroy()}this.contextMenu=new Ext.menu.Menu({id:&quot;gridCritereCtxMenu&quot;,items:[{text:i18n.get(&quot;label.ajoutCondition&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_condition.png&quot;,listeners:{scope:this,click:function(){var u=0;var q=this.getSelectionModel();if(q.hasSelection()){u=this.getStore().indexOf(q.getSelected())+1}var s=this.getStore().recordType;var t=new s({parentheseOuvrante:&quot; &quot;,parentheseFermante:&quot; &quot;});this.stopEditing();m.insert(u,t)}}},{text:i18n.get(&quot;label.suppressionCondition&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/delete_condition.png&quot;,listeners:{scope:this,click:function(){if(!this.getSelectionModel().hasSelection()){Ext.Msg.alert(i18n.get(&quot;warning.noselection&quot;),i18n.get(&quot;warning.noselection&quot;));return}var t=this.getSelectionModel().getSelections();for(var q=0,u;u=t[q];q++){m.remove(u)}}}},{text:i18n.get(&quot;label.suppressionParenthese&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/delete_parenthesis.png&quot;,listeners:{scope:this,click:function(){var q=this.getSelectionModel();if(!q.hasSelection()){Ext.Msg.alert(i18n.get(&quot;warning.noselection&quot;),i18n.get(&quot;warning.noselection&quot;));return}var t=q.getSelections();var s=0;q.each(function(u){u.data.parentheseOuvrante=&quot; &quot;;u.data.parentheseFermante=&quot; &quot;});this.getView().refresh()}}}]});var n=p.getXY();this.contextMenu.showAt(n);p.stopEvent()}}}))};Ext.extend(Ext.ux.PanelRecherche,Ext.grid.EditorGridPanel,{});Ext.reg(&quot;PanelRecherche&quot;,Ext.ux.PanelRecherche);Ext.namespace(&quot;sitools.component.datasets&quot;);sitools.component.datasets.selectItems=function(a){Ext.apply(this,a);var b=new Ext.Panel({layout:&quot;vbox&quot;,layoutConfig:{align:&quot;center&quot;,pack:&quot;center&quot;,defaultMargins:{top:10,right:0,bottom:0,left:0}},flex:0.06,defaults:{scope:this},items:[{xtype:&quot;button&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-right.png&quot;,handler:this._onAdd},{xtype:&quot;button&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/double-arrow-right.png&quot;,handler:this._onAddAll},{xtype:&quot;button&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-left.png&quot;,handler:this._onRemove},{xtype:&quot;button&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/double-arrow-left.png&quot;,handler:this._onRemoveAll}]});Ext.applyIf(this.grid1,{flex:this.defaultFlexGrid});Ext.applyIf(this.grid2,{flex:this.defaultFlexGrid});sitools.component.datasets.selectItems.superclass.constructor.call(this,Ext.apply({layout:&quot;hbox&quot;,layoutConfig:{flex:&quot;ratio&quot;,align:&quot;stretch&quot;},items:[this.grid1,b,this.grid2]}))};Ext.extend(sitools.component.datasets.selectItems,Ext.Panel,{grid1:null,grid2:null,defaultRecord:null,defaultFlexGrid:0.47,_onAdd:function(){var a=this.grid2.getStore();var b=this.grid1.getSelectionModel().getSelections();if(b.length===0){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}var c;Ext.each(b,function(d){c=d.copy();c.id=Ext.data.Record.id(c);Ext.each(this.defaultRecord,function(e){if(!c.get(e.name)){c.set(e.name,e.value)}},this);a.add(c)},this);this.grid2.getView().refresh()},_onAddAll:function(){var a=this.grid2.getStore();var b=this.grid1.getStore();var c;b.each(function(d){c=d.copy();c.id=Ext.data.Record.id(c);Ext.each(this.defaultRecord,function(e){if(!c.get(e.name)){c.set(e.name,e.value)}},this);a.add(c)},this)},_onRemove:function(){var a=this.grid2.getStore();var b=this.grid2.getSelectionModel().getSelections();if(b.length===0){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}Ext.each(b,function(c){a.remove(c)});this.grid2.getView().refresh()},_onRemoveAll:function(){var a=this.grid2.getStore();a.each(function(b){a.remove(b)})}});Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.GridUp=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-up.png&quot;;sitools.widget.GridUp.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType(&quot;grid&quot;)[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);if(b&gt;0){a.remove(d);a.insert(b-1,d);c.getSelectionModel().selectRow(b-1)}c.getView().refresh()}});sitools.widget.GridDown=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-down.png&quot;;sitools.widget.GridDown.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType(&quot;grid&quot;)[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);if(b&lt;a.getCount()-1){a.remove(d);a.insert(b+1,d);c.getSelectionModel().selectRow(b+1)}c.getView().refresh()}});sitools.widget.GridTop=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/double-arrow-up.png&quot;;sitools.widget.GridTop.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var b=this.findByType(&quot;grid&quot;)[0]}else{var b=Ext.getCmp(this.gridId)}if(!b){var b=this}var c=b.getSelectionModel().getSelected();if(!c){return}var a=b.getStore();if(!a){return}a.remove(c);a.insert(0,c);b.getSelectionModel().selectRow(0);b.getView().refresh()}});sitools.widget.GridBottom=Ext.extend(Ext.Button,{initComponent:function(){this.icon=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/double-arrow-down.png&quot;;sitools.widget.GridBottom.superclass.initComponent.call(this)},handler:function(){if(Ext.isEmpty(this.gridId)){var c=this.findByType(&quot;grid&quot;)[0]}else{var c=Ext.getCmp(this.gridId)}if(!c){var c=this}var d=c.getSelectionModel().getSelected();if(!d){return}var a=c.getStore();if(!a){return}var b=a.data.items.indexOf(d);a.remove(d);a.insert(a.getCount(),d);c.getSelectionModel().selectRow(a.getCount()-1);c.getView().refresh()}});Ext.namespace(&quot;Ext.ux&quot;);Ext.namespace(&quot;Ext.ux.Plugin&quot;);Ext.ux.Plugin.LiteRemoteComponent=function(a){var c=a.xtype||&quot;panel&quot;;var b=function(d){this.container.add(Ext.ComponentMgr.create(Ext.decode(d.responseText),c)).show();this.container.doLayout()};return{init:function(d){this.container=d;Ext.Ajax.request(Ext.apply(a,{success:b,scope:this}))}}};Ext.ux.Plugin.RemoteComponent=function(a){var d=a.xtype||&quot;panel&quot;;Ext.applyIf(a,{purgeSubscribers:true});this.initialConfig=a;Ext.apply(this,a);this.addEvents({beforeload:true,beforecreate:true,beforeadd:true,beforecomponshow:true,beforecontainshow:true,success:true});Ext.ux.Plugin.RemoteComponent.superclass.constructor.call(this,a);if(a.breakOn){this.on(a.breakOn,function(){return false})}var b=function(f){if(this.fireEvent(&quot;beforeadd&quot;,f,this)){var e=this.container.add(f);e.fireEvent(&quot;bodyResize&quot;,this);if(this.fireEvent(&quot;beforecomponshow&quot;,e,this)){return e}}}.createDelegate(this);var c=function(f){var g=Ext.decode(f.responseText);if(this.fireEvent(&quot;beforecreate&quot;,g,this)){var e=null;if(g instanceof Array){Ext.each(g,function(k,l){e=b(k).show()})}else{e=b(g).show()}if(this.fireEvent(&quot;beforecontainshow&quot;,e,this)){this.container.ownerCt.doLayout();this.fireEvent(&quot;success&quot;,e,this)}}if(this.purgeSubscribers){this.purgeListeners()}}.createDelegate(this);this.load=function(){if(this.fireEvent(&quot;beforeload&quot;,a,this)){if(a.mask){var e=new Ext.LoadMask(Ext.getDom(a.mask),Ext.apply({msg:&quot;loading components...&quot;},a.maskConfig||{}));e.show();this.on(&quot;success&quot;,e.hide,e)}Ext.Ajax.request(Ext.apply(a,{success:c,scope:this}))}};this.init=function(e){e.on(&quot;beforedestroy&quot;,function(){this.purgeListeners()},this);this.container=e;if(a.loadOn){if(a.loadOn instanceof Array){Ext.each(a.loadOn,function(k,m,g){var f=k.event||k.loadOn;var n=function(){this.load();Ext.each(g,function(l){(l.scope||e).un(f,n,this)}.createDelegate(this))}.createDelegate(this);(k.scope||e).on(f,n,this)}.createDelegate(this))}else{(a.loadOn.scope||e).on((a.loadOn.event||a.loadOn),this.load,this,{single:true})}}else{this.load()}}};Ext.extend(Ext.ux.Plugin.RemoteComponent,Ext.util.Observable);Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.LockingGridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(!this.cm&amp;&amp;!this.colModel&amp;&amp;Ext.isArray(this.columns)){this.colModel=new Ext.ux.grid.LockingColumnModel(this.columns);delete this.columns}Ext.ux.grid.LockingGridPanel.superclass.initComponent.call(this)},getView:function(){if(!this.view){this.view=new Ext.ux.grid.LockingGridView(this.viewConfig)}return this.view}});Ext.ux.grid.LockingEditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initComponent:function(){if(!this.cm&amp;&amp;!this.colModel&amp;&amp;Ext.isArray(this.columns)){this.colModel=new Ext.ux.grid.LockingColumnModel(this.columns);delete this.columns}Ext.ux.grid.LockingEditorGridPanel.superclass.initComponent.call(this)},getView:function(){if(!this.view){this.view=new Ext.ux.grid.LockingGridView(this.viewConfig)}return this.view}});Ext.applyIf(Ext.grid.GridView.prototype,{getScrollOffset:function(){return Ext.isDefined(this.scrollOffset)?this.scrollOffset:Ext.getScrollBarWidth()}});
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
/*!
 * Ext JS Library 3.4.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:&quot;Lock&quot;,unlockText:&quot;Unlock&quot;,rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.masterTpl){a.masterTpl=new Ext.Template('&lt;div class=&quot;x-grid3&quot; hidefocus=&quot;true&quot;&gt;','&lt;div class=&quot;x-grid3-locked&quot;&gt;','&lt;div class=&quot;x-grid3-header&quot;&gt;&lt;div class=&quot;x-grid3-header-inner&quot;&gt;&lt;div class=&quot;x-grid3-header-offset&quot; style=&quot;{lstyle}&quot;&gt;{lockedHeader}&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;x-clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-scroller&quot;&gt;&lt;div class=&quot;x-grid3-body&quot; style=&quot;{lstyle}&quot;&gt;{lockedBody}&lt;/div&gt;&lt;div class=&quot;x-grid3-scroll-spacer&quot;&gt;&lt;/div&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;,'&lt;div class=&quot;x-grid3-viewport x-grid3-unlocked&quot;&gt;','&lt;div class=&quot;x-grid3-header&quot;&gt;&lt;div class=&quot;x-grid3-header-inner&quot;&gt;&lt;div class=&quot;x-grid3-header-offset&quot; style=&quot;{ostyle}&quot;&gt;{header}&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;x-clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-scroller&quot;&gt;&lt;div class=&quot;x-grid3-body&quot; style=&quot;{bstyle}&quot;&gt;{body}&lt;/div&gt;&lt;a href=&quot;#&quot; class=&quot;x-grid3-focus&quot; tabIndex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;,'&lt;div class=&quot;x-grid3-resize-marker&quot;&gt;&amp;#160;&lt;/div&gt;','&lt;div class=&quot;x-grid3-resize-proxy&quot;&gt;&amp;#160;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;)}this.templates=a;Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(a){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),g=e.child(&quot;div.x-grid3-locked&quot;),c=g.child(&quot;div.x-grid3-header&quot;),b=g.child(&quot;div.x-grid3-scroller&quot;),f=e.child(&quot;div.x-grid3-viewport&quot;),d=f.child(&quot;div.x-grid3-header&quot;),a=f.child(&quot;div.x-grid3-scroller&quot;);if(this.grid.hideHeaders){c.setDisplayed(false);d.setDisplayed(false)}if(this.forceFit){a.setStyle(&quot;overflow-x&quot;,&quot;hidden&quot;)}Ext.apply(this,{el:e,mainWrap:f,mainHd:d,innerHd:d.dom.firstChild,scroller:a,mainBody:a.child(&quot;div.x-grid3-body&quot;),focusEl:a.child(&quot;a&quot;),resizeMarker:e.child(&quot;div.x-grid3-resize-marker&quot;),resizeProxy:e.child(&quot;div.x-grid3-resize-proxy&quot;),lockedWrap:g,lockedHd:c,lockedScroller:b,lockedBody:b.child(&quot;div.x-grid3-body&quot;),lockedInnerHd:c.child(&quot;div.x-grid3-header-inner&quot;,true)});this.focusEl.swallowEvent(&quot;click&quot;,true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(c,a){var b=this.cm.getLockedCount();if(a&lt;b){return this.getLockedRow(c).getElementsByTagName(&quot;td&quot;)[a]}return Ext.ux.grid.LockingGridView.superclass.getCell.call(this,c,a-b)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a&lt;b){return this.lockedHd.dom.getElementsByTagName(&quot;td&quot;)[a]}return Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,a-b)},addRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).addClass(a)}Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,c,a)},removeRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).removeClass(a)}Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,c,a)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,a)},removeRows:function(c,b){var a=this.lockedBody.dom,d=c;for(;d&lt;=b;d++){Ext.removeNode(a.childNodes[c])}Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,c,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop;Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(d,c){var a=this.sortClasses,e=this.lockedHd.select(&quot;td&quot;).removeClass(a),g=this.mainHd.select(&quot;td&quot;).removeClass(a),f=this.cm.getLockedCount(),b=a[c==&quot;DESC&quot;?1:0];if(d&lt;f){e.item(d).addClass(b)}else{g.item(d-f).addClass(b)}},updateAllColumnWidths:function(){var g=this.getTotalWidth(),p=this.cm.getColumnCount(),b=this.getLockedWidth(),d=this.cm.getLockedCount(),l=[],k,e;this.updateLockedWidth();for(e=0;e&lt;p;e++){l[e]=this.getColumnWidth(e);var f=this.getHeaderCell(e);f.style.width=l[e]}var a=this.getLockedRows(),n=this.getRows(),q,m,c;for(e=0,k=n.length;e&lt;k;e++){q=a[e];q.style.width=b;if(q.firstChild){q.firstChild.style.width=b;m=q.firstChild.rows[0];for(c=0;c&lt;d;c++){m.childNodes[c].style.width=l[c]}}q=n[e];q.style.width=g;if(q.firstChild){q.firstChild.style.width=g;m=q.firstChild.rows[0];for(c=d;c&lt;p;c++){m.childNodes[c-d].style.width=l[c]}}}this.onAllColumnWidthsUpdated(l,g);this.syncHeaderHeight()},updateColumnWidth:function(d,a){var n=this.getColumnWidth(d),e=this.cm.getLockedCount(),m,b,l,p;this.updateLockedWidth();if(d&lt;e){m=this.getLockedRows();b=this.getLockedWidth();l=d}else{m=this.getRows();b=this.getTotalWidth();l=d-e}var g=this.getHeaderCell(d);g.style.width=n;for(var f=0,k=m.length;f&lt;k;f++){p=m[f];p.style.width=b;if(p.firstChild){p.firstChild.style.width=b;p.firstChild.rows[0].childNodes[l].style.width=n}}this.onColumnWidthUpdated(d,n,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(b,g){var d=this.cm.getLockedCount(),n,a,m,p,l=g?&quot;none&quot;:&quot;&quot;;this.updateLockedWidth();if(b&lt;d){n=this.getLockedRows();a=this.getLockedWidth();m=b}else{n=this.getRows();a=this.getTotalWidth();m=b-d}var f=this.getHeaderCell(b);f.style.display=l;for(var e=0,k=n.length;e&lt;k;e++){p=n[e];p.style.width=a;if(p.firstChild){p.firstChild.style.width=a;p.firstChild.rows[0].childNodes[m].style.display=l}}this.onColumnHiddenUpdated(b,g,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(g,m,v,a,u,C){var d=this.templates,f=d.cell,k=d.row,q=u-1,e=&quot;width:&quot;+this.getTotalWidth()+&quot;;&quot;,b=&quot;width:&quot;+this.getLockedWidth()+&quot;;&quot;,J=[],M=[],A,l,K,z={},n={},t;for(var B=0,E=m.length;B&lt;E;B++){t=m[B];A=[];l=[];var s=(B+a);for(var D=0;D&lt;u;D++){K=g[D];z.id=K.id;z.css=(D===0?&quot;x-grid3-cell-first &quot;:(D==q?&quot;x-grid3-cell-last &quot;:&quot;&quot;))+(this.cm.config[D].cellCls?&quot; &quot;+this.cm.config[D].cellCls:&quot;&quot;);z.attr=z.cellAttr=&quot;&quot;;z.value=K.renderer(t.data[K.name],z,t,s,D,v);z.style=K.style;if(Ext.isEmpty(z.value)){z.value=&quot;&amp;#160;&quot;}if(this.markDirty&amp;&amp;t.dirty&amp;&amp;Ext.isDefined(t.modified[K.name])){z.css+=&quot; x-grid3-dirty-cell&quot;}if(K.locked){l[l.length]=f.apply(z)}else{A[A.length]=f.apply(z)}}var L=[];if(C&amp;&amp;((s+1)%2===0)){L[0]=&quot;x-grid3-row-alt&quot;}if(t.dirty){L[1]=&quot; x-grid3-dirty-row&quot;}n.cols=u;if(this.getRowClass){L[2]=this.getRowClass(t,s,n,v)}n.alt=L.join(&quot; &quot;);n.cells=A.join(&quot;&quot;);n.tstyle=e;J[J.length]=k.apply(n);n.cells=l.join(&quot;&quot;);n.tstyle=b;M[M.length]=k.apply(n)}return[J.join(&quot;&quot;),M.join(&quot;&quot;)]},processRows:function(b,k){if(!this.ds||this.ds.getCount()&lt;1){return}var f=this.getRows(),e=this.getLockedRows(),g,d;k=k||!this.grid.stripeRows;b=b||0;for(var c=0,a=f.length;c&lt;a;++c){g=f[c];d=e[c];g.rowIndex=c;d.rowIndex=c;if(!k){g.className=g.className.replace(this.rowClsRe,&quot; &quot;);d.className=d.className.replace(this.rowClsRe,&quot; &quot;);if((c+1)%2===0){g.className+=&quot; x-grid3-row-alt&quot;;d.className+=&quot; x-grid3-row-alt&quot;}}this.syncRowHeights(g,d)}if(b===0){Ext.fly(f[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(f[f.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)},syncRowHeights:function(f,e){if(this.syncHeights){var d=Ext.get(f),b=Ext.get(e),c=d.getHeight(),a=b.getHeight();if(c&gt;a){b.setHeight(c)}else{if(a&gt;c){d.setHeight(a)}}}},afterRender:function(){if(!this.ds||!this.cm){return}var a=this.renderRows()||[&quot;&amp;#160;&quot;,&quot;&amp;#160;&quot;];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent(&quot;viewready&quot;,this.grid)},renderUI:function(){var b=this.templates,c=this.renderHeaders(),a=b.body.apply({rows:&quot;&amp;#160;&quot;});return b.masterTpl.apply({body:a,header:c[0],ostyle:&quot;width:&quot;+this.getOffsetWidth()+&quot;;&quot;,bstyle:&quot;width:&quot;+this.getTotalWidth()+&quot;;&quot;,lockedBody:a,lockedHeader:c[1],lstyle:&quot;width:&quot;+this.getLockedWidth()+&quot;;&quot;})},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on(&quot;click&quot;,this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on(&quot;click&quot;,this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on(&quot;scroll&quot;,this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+&quot;-hctx&quot;});this.hmenu.add({itemId:&quot;asc&quot;,text:this.sortAscText,cls:&quot;xg-hmenu-sort-asc&quot;},{itemId:&quot;desc&quot;,text:this.sortDescText,cls:&quot;xg-hmenu-sort-desc&quot;});if(this.grid.enableColLock!==false){this.hmenu.add(&quot;-&quot;,{itemId:&quot;lock&quot;,text:this.lockText,cls:&quot;xg-hmenu-lock&quot;},{itemId:&quot;unlock&quot;,text:this.unlockText,cls:&quot;xg-hmenu-unlock&quot;})}this.hmenu.add(&quot;-&quot;,{itemId:&quot;help&quot;,text:&quot;help&quot;,cls:&quot;xg-hmenu-help&quot;});if(a.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:a.id+&quot;-hcols-menu&quot;});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add(&quot;-&quot;,{itemId:&quot;columns&quot;,hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:&quot;x-cols-icon&quot;})}this.hmenu.on(&quot;itemclick&quot;,this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||&quot;GridDD&quot;})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var d=this.grid;var k=d.getGridEl();var a=k.getSize(true);var b=a.width;if(!d.hideHeaders&amp;&amp;(b&lt;20||a.height&lt;20)){return}this.syncHeaderHeight();if(d.autoHeight){this.scroller.dom.style.overflow=&quot;visible&quot;;this.lockedScroller.dom.style.overflow=&quot;visible&quot;;if(Ext.isWebKit){this.scroller.dom.style.position=&quot;static&quot;;this.lockedScroller.dom.style.position=&quot;static&quot;}}else{this.el.setSize(a.width,a.height);var f=this.mainHd.getHeight();var e=a.height-(f)}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=b){this.fitColumns(false,false);this.lastViewWidth=b}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(b,e)},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+&quot;px&quot;},renderHeaders:function(){var k=this.cm,f=this.templates,d=f.hcell,b=[],g=[],a={},e=k.getColumnCount(),l=e-1;for(var c=0;c&lt;e;c++){a.id=k.getColumnId(c);a.value=k.getColumnHeader(c)||&quot;&quot;;a.style=this.getColumnStyle(c,true);a.tooltip=this.getColumnTooltip(c);a.css=(c===0?&quot;x-grid3-cell-first &quot;:(c==l?&quot;x-grid3-cell-last &quot;:&quot;&quot;))+(k.config[c].headerCls?&quot; &quot;+k.config[c].headerCls:&quot;&quot;);if(k.config[c].align==&quot;right&quot;){a.istyle=&quot;padding-right:16px&quot;}else{delete a.istyle}if(k.isLocked(c)){g[g.length]=d.apply(a)}else{b[b.length]=d.apply(a)}}return[f.header.apply({cells:b.join(&quot;&quot;),tstyle:&quot;width:&quot;+this.getTotalWidth()+&quot;;&quot;}),f.header.apply({cells:g.join(&quot;&quot;),tstyle:&quot;width:&quot;+this.getLockedWidth()+&quot;;&quot;})]},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a){return null}var d=a.cell,b=a.row;return d?Ext.fly(d).getXY():[this.scroller.getX(),Ext.fly(b).getY()]},syncFocusEl:function(c,a,b){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,c,a,a&lt;this.cm.getLockedCount()?false:b)},ensureVisible:function(c,a,b){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,c,a,a&lt;this.cm.getLockedCount()?false:b)},insertRows:function(a,g,d,f){var c=a.getCount()-1;if(!f&amp;&amp;g===0&amp;&amp;d&gt;=c){this.refresh()}else{if(!f){this.fireEvent(&quot;beforerowsinserted&quot;,this,g,d)}var b=this.renderRows(g,d),e=this.getRow(g);if(e){if(g===0){this.removeRowClass(0,this.firstRowCls)}Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,e,b[0]);e=this.getLockedRow(g);Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,e,b[1])}else{this.removeRowClass(c-1,this.lastRowCls);Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.mainBody.dom,b[0]);Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.lockedBody.dom,b[1])}if(!f){this.fireEvent(&quot;rowsinserted&quot;,this,g,d);this.processRows(g)}else{if(g===0||g&gt;=c){this.addRowClass(g,g===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(g)},getColumnStyle:function(a,c){var b=!c?this.cm.config[a].cellStyle||this.cm.config[a].css||&quot;&quot;:this.cm.config[a].headerStyle||&quot;&quot;;b+=&quot;width:&quot;+this.getColumnWidth(a)+&quot;;&quot;;if(this.cm.isHidden(a)){b+=&quot;display:none;&quot;}var d=this.cm.config[a].align;if(d){b+=&quot;text-align:&quot;+d+&quot;;&quot;}return b},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+&quot;px&quot;},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+&quot;px&quot;},getColumnData:function(){var d=[],a=this.cm,e=a.getColumnCount();for(var c=0;c&lt;e;c++){var b=a.getDataIndex(c);d[c]={name:(!Ext.isDefined(b)?this.ds.fields.get(c).name:b),renderer:a.getRenderer(c),scope:a.getRendererScope(c),id:a.getColumnId(c),style:this.getColumnStyle(c),locked:a.isLocked(c)}}return d},renderBody:function(){var a=this.renderRows()||[&quot;&amp;#160;&quot;,&quot;&amp;#160;&quot;];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(c){var g=this.ds,v=this.cm.getColumnCount(),b=this.getColumnData(),n=v-1,a=[&quot;x-grid3-row&quot;],m={tstyle:String.format(&quot;width: {0};&quot;,this.getTotalWidth())},l={tstyle:String.format(&quot;width: {0};&quot;,this.getLockedWidth())},f=[],e=[],s=this.templates.cell,q,k,p,d,u,t,z;if(Ext.isNumber(c)){q=c;c=g.getAt(q)}else{q=g.indexOf(c)}if(!c||q&lt;0){return}for(z=0;z&lt;v;z++){d=b[z];if(z==0){t=&quot;x-grid3-cell-first&quot;}else{t=(z==n)?&quot;x-grid3-cell-last &quot;:&quot;&quot;}u={id:d.id,style:d.style,css:t,attr:&quot;&quot;,cellAttr:&quot;&quot;};u.value=d.renderer.call(d.scope,c.data[d.name],u,c,q,z,g);if(Ext.isEmpty(u.value)){u.value=&quot; &quot;}if(this.markDirty&amp;&amp;c.dirty&amp;&amp;typeof c.modified[d.name]!=&quot;undefined&quot;){u.css+=&quot; x-grid3-dirty-cell&quot;}if(d.locked){e[z]=s.apply(u)}else{f[z]=s.apply(u)}}k=this.getRow(q);k.className=&quot;&quot;;p=this.getLockedRow(q);p.className=&quot;&quot;;if(this.grid.stripeRows&amp;&amp;((q+1)%2===0)){a.push(&quot;x-grid3-row-alt&quot;)}if(this.getRowClass){m.cols=v;a.push(this.getRowClass(c,q,m,g))}this.fly(k).addClass(a).setStyle(m.tstyle);m.cells=f.join(&quot;&quot;);k.innerHTML=this.templates.rowInner.apply(m);this.fly(p).addClass(a).setStyle(l.tstyle);l.cells=e.join(&quot;&quot;);p.innerHTML=this.templates.rowInner.apply(l);p.rowIndex=q;this.syncRowHeights(k,p);this.fireEvent(&quot;rowupdated&quot;,this,q,c)},refresh:function(b){this.fireEvent(&quot;beforerefresh&quot;,this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent(&quot;refresh&quot;,this)},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un(&quot;columnlockchange&quot;,this.onColumnLock,this)}Ext.ux.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on(&quot;columnlockchange&quot;,this.onColumnLock,this)}},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(d){var b=this.hdCtxIndex,a=this.cm,e=d.getItemId(),c=a.getLockedCount();switch(e){case&quot;lock&quot;:if(a.getColumnCount(true)&lt;=c+1){this.onDenyColumnLock();return undefined}a.setLocked(b,true,c!=b);if(c!=b){a.moveColumn(b,c);this.grid.fireEvent(&quot;columnmove&quot;,b,c)}break;case&quot;unlock&quot;:if(c-1!=b){a.setLocked(b,false,true);a.moveColumn(b,c-1);this.grid.fireEvent(&quot;columnmove&quot;,b,c-1)}else{a.setLocked(b,false)}break;case&quot;help&quot;:a.showHelp(b);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,d)}return true},handleHdDown:function(g,d){Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,g,d);if(this.grid.enableColLock!==false){if(Ext.fly(d).hasClass(&quot;x-grid3-hd-btn&quot;)){var f=this.findHeaderCell(d),c=this.getCellIndex(f),b=this.hmenu.items,a=this.cm;b.get(&quot;lock&quot;).setDisabled(a.isLocked(c));b.get(&quot;unlock&quot;).setDisabled(!a.isLocked(c));b.get(&quot;help&quot;).setDisabled(a.isHelp(c))}}},syncHeaderHeight:function(){var d=Ext.fly(this.innerHd).child(&quot;tr&quot;,true),b=Ext.fly(this.lockedInnerHd).child(&quot;tr&quot;,true);d.style.height=&quot;auto&quot;;b.style.height=&quot;auto&quot;;var e=d.offsetHeight,c=b.offsetHeight,a=Math.max(c,e)+&quot;px&quot;;d.style.height=a;b.style.height=a},updateLockedWidth:function(){var g=this.cm.getTotalLockedWidth(),a=this.cm.getTotalWidth()-g,c=this.grid.getGridEl().getSize(true),b=Ext.isBorderBox?0:this.lockedBorderWidth,d=Ext.isBorderBox?0:this.rowBorderWidth,e=Math.max(c.width-g-b-d,0)+&quot;px&quot;,f=this.getScrollOffset();if(!this.grid.autoHeight){var k=Math.max(c.height-this.mainHd.getHeight(),0)+&quot;px&quot;;this.lockedScroller.dom.style.height=k;this.scroller.dom.style.height=k}this.lockedWrap.dom.style.width=(g+d)+&quot;px&quot;;this.scroller.dom.style.width=e;this.mainWrap.dom.style.left=(g+b+d)+&quot;px&quot;;if(this.innerHd){this.lockedInnerHd.firstChild.style.width=g+&quot;px&quot;;this.lockedInnerHd.firstChild.firstChild.style.width=g+&quot;px&quot;;this.innerHd.style.width=e;this.innerHd.firstChild.style.width=(a+d+f)+&quot;px&quot;;this.innerHd.firstChild.firstChild.style.width=a+&quot;px&quot;}if(this.mainBody){this.lockedBody.dom.style.width=(g+d)+&quot;px&quot;;this.mainBody.dom.style.width=(a+d)+&quot;px&quot;}},getLockedBody:function(){return this.lockedBody}});Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isHelp:function(a){return Ext.isEmpty(this.config[a].helpUrl)},showHelp:function(a){showHelp(this.config[a].helpUrl)},isLocked:function(a){return this.config[a].locked===true},setLocked:function(b,c,a){if(this.isLocked(b)==c){return}this.config[b].locked=c;if(!a){this.fireEvent(&quot;columnlockchange&quot;,this,b,c)}},getTotalLockedWidth:function(){var b=0;for(var c=0,a=this.config.length;c&lt;a;c++){if(this.isLocked(c)&amp;&amp;!this.isHidden(c)){b+=this.getColumnWidth(c)}}return b},getLockedCount:function(){var a=this.config.length;for(var b=0;b&lt;a;b++){if(!this.isLocked(b)){return b}}return a},moveColumn:function(d,c){var a=this.isLocked(d),b=this.isLocked(c);if(d&lt;c&amp;&amp;a&amp;&amp;!b){this.setLocked(d,false,true)}else{if(d&gt;c&amp;&amp;!a&amp;&amp;b){this.setLocked(d,true,true)}}Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}});Ext.namespace(&quot;Ext.ux&quot;);Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||&quot;x-icon-information&quot;,cls:&quot;x-notification&quot;,width:200,autoHeight:true,plain:false,draggable:false,shadow:false,bodyStyle:&quot;text-align:center&quot;});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.apply(this)},setMessage:function(a){this.body.update(a)},setTitle:function(b,a){Ext.ux.Notification.superclass.setTitle.call(this,b,a||this.iconCls)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass(&quot;fixed&quot;);if(this.autoDestroy){this.task.cancel()}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on(&quot;click&quot;,this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)&gt;-1){this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,&quot;br-br&quot;,[-20,-40-((this.getSize().height+10)*this.pos)]);this.el.slideIn(&quot;b&quot;,{duration:1,callback:this.afterShow,scope:this})},animHide:function(){this.el.ghost(&quot;b&quot;,{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn});Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.MultiSelect=Ext.extend(Ext.form.Field,{ddReorder:false,appendOnly:false,width:100,height:100,displayField:0,valueField:1,allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minSelectionsText:&quot;Minimum {0} item(s) required&quot;,maxSelectionsText:&quot;Maximum {0} item(s) allowed&quot;,delimiter:&quot;,&quot;,defaultAutoCreate:{tag:&quot;div&quot;},initComponent:function(){Ext.ux.form.MultiSelect.superclass.initComponent.call(this);if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;text&quot;],data:this.store});this.valueField=&quot;value&quot;}else{this.store=new Ext.data.ArrayStore({fields:[&quot;text&quot;],data:this.store,expandData:true});this.valueField=&quot;text&quot;}this.displayField=&quot;text&quot;}else{this.store=Ext.StoreMgr.lookup(this.store);this.displayField=this.store.displayField;this.valueField=this.store.valueField}this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(c,b){Ext.ux.form.MultiSelect.superclass.onRender.call(this,c,b);var a=this.fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height-20,width:this.width,style:&quot;padding:0;&quot;,tbar:this.tbar});a.body.addClass(&quot;ux-mselect&quot;);this.view=new Ext.ListView({multiSelect:true,store:this.store,columns:[{header:&quot;Value&quot;,width:1,dataIndex:this.displayField}],hideHeaders:true});a.add(this.view);this.view.on(&quot;click&quot;,this.onViewClick,this);this.view.on(&quot;beforeclick&quot;,this.onViewBeforeClick,this);this.view.on(&quot;dblclick&quot;,this.onViewDblClick,this);this.hiddenName=this.name||Ext.id();var d={tag:&quot;input&quot;,type:&quot;hidden&quot;,value:&quot;&quot;,name:this.hiddenName};this.hiddenField=this.el.createChild(d);this.hiddenField.dom.disabled=this.hiddenName!=this.name;a.doLayout()},afterRender:function(){Ext.ux.form.MultiSelect.superclass.afterRender.call(this);if(this.ddReorder&amp;&amp;!this.dragGroup&amp;&amp;!this.dropGroup){this.dragGroup=this.dropGroup=&quot;MultiselectDD-&quot;+Ext.id()}if(this.draggable||this.dragGroup){this.dragZone=new Ext.ux.form.MultiSelect.DragZone(this,{ddGroup:this.dragGroup})}if(this.droppable||this.dropGroup){this.dropZone=new Ext.ux.form.MultiSelect.DropZone(this,{ddGroup:this.dropGroup})}if(this.values){this.setValue(this.values)}},onViewClick:function(c,a,b,d){this.fireEvent(&quot;change&quot;,this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent(&quot;click&quot;,this,d);this.validate()},onViewBeforeClick:function(c,a,b,d){if(this.disabled||this.readOnly){return false}},onViewDblClick:function(c,a,b,d){return this.fireEvent(&quot;dblclick&quot;,c,a,b,d)},getValue:function(a){var e=[];var d=this.view.getSelectedIndexes();if(d.length==0){return&quot;&quot;}for(var b=0;b&lt;d.length;b++){var c=this.store.getAt(d[b]).get((a!=null)?a:this.valueField);if(Ext.isString(c)){c=c}e.push(c)}return e.join(this.delimiter)},setValue:function(a){var b;var d=[];this.view.clearSelections();this.hiddenField.dom.value=&quot;&quot;;if(!a||(a==&quot;&quot;)){return}if(!Ext.isArray(a)){a=a.split(this.delimiter)}for(var c=0;c&lt;a.length;c++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp(&quot;^&quot;+a[c]+&quot;$&quot;,&quot;i&quot;)).itemAt(0));d.push(b)}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue(&quot;&quot;)},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length&lt;1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length&lt;this.minSelections){this.markInvalid(String.format(this.minSelectionsText,this.minSelections));return false}if(a.length&gt;this.maxSelections){this.markInvalid(String.format(this.maxSelectionsText,this.maxSelections));return false}return true},disable:function(){this.disabled=true;if(!Ext.isEmpty(this.hiddenField)){this.hiddenField.dom.disabled=true}if(!Ext.isEmpty(this.fs)){this.fs.disable()}},enable:function(){this.disabled=false;this.hiddenField.dom.disabled=false;this.fs.enable()},destroy:function(){Ext.destroy(this.fs,this.dragZone,this.dropZone);Ext.ux.form.MultiSelect.superclass.destroy.call(this)}});Ext.reg(&quot;multiselect&quot;,Ext.ux.form.MultiSelect);Ext.ux.Multiselect=Ext.ux.form.MultiSelect;Ext.ux.form.MultiSelect.DragZone=function(d,c){this.ms=d;this.view=d.view;var b=c.ddGroup||&quot;MultiselectDD&quot;;var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DragZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDraggable(b)};Ext.extend(Ext.ux.form.MultiSelect.DragZone,Ext.dd.DragZone,{onInitDrag:function(a,c){var b=Ext.get(this.dragData.ddel.cloneNode(true));this.proxy.update(b.dom);b.setWidth(b.child(&quot;em&quot;).getWidth());this.onStartDrag(a,c);return true},collectSelection:function(b){b.repairXY=Ext.fly(this.view.getSelectedNodes()[0]).getXY();var a=0;this.view.store.each(function(d){if(this.view.isSelected(a)){var e=this.view.getNode(a);var c=e.cloneNode(true);c.id=Ext.id();b.ddel.appendChild(c);b.records.push(this.view.store.getAt(a));b.viewNodes.push(e)}a++},this)},onEndDrag:function(a,b){var c=Ext.get(this.dragData.ddel);if(c&amp;&amp;c.hasClass(&quot;multi-proxy&quot;)){c.remove()}},getDragData:function(d){var c=this.view.findItemFromChild(d.getTarget());if(c){if(!this.view.isSelected(c)&amp;&amp;!d.ctrlKey&amp;&amp;!d.shiftKey){this.view.select(c);this.ms.setValue(this.ms.getValue())}if(this.view.getSelectionCount()==0||d.ctrlKey||d.shiftKey){return false}var b={sourceView:this.view,viewNodes:[],records:[]};if(this.view.getSelectionCount()==1){var a=this.view.getSelectedIndexes()[0];var f=this.view.getNode(a);b.viewNodes.push(b.ddel=f);b.records.push(this.view.store.getAt(a));b.repairXY=Ext.fly(f).getXY()}else{b.ddel=document.createElement(&quot;div&quot;);b.ddel.className=&quot;multi-proxy&quot;;this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},setDraggable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDraggable,this);return}this.addToGroup(a)}});Ext.ux.form.MultiSelect.DropZone=function(d,c){this.ms=d;this.view=d.view;var b=c.ddGroup||&quot;MultiselectDD&quot;;var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DropZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDroppable(b)};Ext.extend(Ext.ux.form.MultiSelect.DropZone,Ext.dd.DropZone,{getTargetFromEvent:function(b){var a=b.getTarget();return a},getDropPoint:function(g,m,d){if(m==this.ms.fs.body.dom){return&quot;below&quot;}var f=Ext.lib.Dom.getY(m),a=f+m.offsetHeight;var l=f+(a-f)/2;var k=Ext.lib.Event.getPageY(g);if(k&lt;=l){return&quot;above&quot;}else{return&quot;below&quot;}},isValidDropPoint:function(b,e,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var c=a.viewNodes[0];if(c==e){return false}if((b==&quot;below&quot;)&amp;&amp;(e.nextSibling==c)){return false}if((b==&quot;above&quot;)&amp;&amp;(e.previousSibling==c)){return false}return true},onNodeEnter:function(d,a,c,b){return false},onNodeOver:function(k,a,g,d){var b=this.dropNotAllowed;var f=this.getDropPoint(g,k,a);if(this.isValidDropPoint(f,k,d)){if(this.ms.appendOnly){return&quot;x-tree-drop-ok-below&quot;}if(f){var c;if(f==&quot;above&quot;){b=k.previousSibling?&quot;x-tree-drop-ok-between&quot;:&quot;x-tree-drop-ok-above&quot;;c=&quot;x-view-drag-insert-above&quot;}else{b=k.nextSibling?&quot;x-tree-drop-ok-between&quot;:&quot;x-tree-drop-ok-below&quot;;c=&quot;x-view-drag-insert-below&quot;}if(this.lastInsertClass!=c){Ext.fly(k).replaceClass(this.lastInsertClass,c);this.lastInsertClass=c}}}return b},onNodeOut:function(d,a,c,b){this.removeDropIndicators(d)},onNodeDrop:function(b,l,k,f){if(this.ms.fireEvent(&quot;drop&quot;,this,b,l,k,f)===false){return false}var m=this.getDropPoint(k,b,l);if(b!=this.ms.fs.body.dom){b=this.view.findItemFromChild(b)}if(this.ms.appendOnly){insertAt=this.view.store.getCount()}else{insertAt=b==this.ms.fs.body.dom?this.view.store.getCount()-1:this.view.indexOf(b);if(m==&quot;below&quot;){insertAt++}}var c=false;if(f.sourceView==this.view){if(m==&quot;below&quot;){if(f.viewNodes[0]==b){f.viewNodes.shift()}}else{if(f.viewNodes[f.viewNodes.length-1]==b){f.viewNodes.pop()}}if(!f.viewNodes.length){return false}if(insertAt&gt;this.view.store.indexOf(f.records[0])){c=&quot;down&quot;;insertAt--}}for(var g=0;g&lt;f.records.length;g++){var a=f.records[g];if(f.sourceView){f.sourceView.store.remove(a)}this.view.store.insert(c==&quot;down&quot;?insertAt:insertAt++,a);var d=this.view.store.sortInfo;if(d){this.view.store.sort(d.field,d.direction)}}return true},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass([&quot;x-view-drag-insert-above&quot;,&quot;x-view-drag-insert-left&quot;,&quot;x-view-drag-insert-right&quot;,&quot;x-view-drag-insert-below&quot;]);this.lastInsertClass=&quot;_noclass&quot;}},setDroppable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDroppable,this);return}this.addToGroup(a)}});Ext.ns(&quot;sitools.common.forms&quot;);sitools.common.forms.formParameterToComponent=function(parameter,dataUrl,formId,datasetCm,context){var valuesToSelect=null;this.component=null;var value,values,items,i,component,defaultValues,existsWidgetForParameterCode,selectedValue,minValue,maxValue,disabledDates;var constructor=eval(parameter.jsUserObject);component=new constructor({parameterId:parameter.id,values:Ext.isArray(parameter.values)?parameter.values:[],code:parameter.code,type:parameter.type,label:parameter.label,height:parameter.height,widthBox:parameter.width,valueSelection:parameter.valueSelection,parentParam:parameter.parentParam,dataUrl:dataUrl,autoComplete:parameter.autoComplete,formId:formId,dimensionId:parameter.dimensionId,unit:parameter.unit,css:parameter.css,defaultValues:parameter.defaultValues,extraParams:parameter.extraParams,datasetCm:datasetCm,context:context});return{parameter:parameter,component:component}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.DatasetContext=function(){this.context=&quot;dataset&quot;;this.getRefUnit=function(b){var c=b.code[0];if(Ext.isEmpty(b.datasetCm)){return}var a;Ext.each(b.datasetCm,function(d){if(d.columnAlias==c){a=d.unit}});return a}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.ProjectContext=function(){this.context=&quot;project&quot;;this.getRefUnit=function(a){return a.unit}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.ComponentFactory=function(a){if(a==&quot;dataset&quot;){return new sitools.common.forms.DatasetContext()}if(a==&quot;project&quot;){return new sitools.common.forms.ProjectContext()}};Ext.ns(&quot;sitools.common.forms&quot;);sitools.common.forms.AbstractWithUnit=Ext.extend(Ext.Container,{dimensionId:null,userUnit:null,userDimension:null,initComponent:function(){this.userDimension=this.dimensionId;this.userUnit=this.unit;this.storeUnits=new Ext.data.JsonStore({id:&quot;storeUnitSelect&quot;,root:&quot;dimension.units&quot;,idProperty:&quot;id&quot;,fields:[{name:&quot;unitName&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;}]});sitools.common.forms.AbstractWithUnit.superclass.initComponent.call(this)},loadUnits:function(a){if(!this.unitsLoaded){this.storeUnits.removeAll();Ext.Ajax.request({method:&quot;GET&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension/&quot;+this.dimensionId,scope:this,success:function(d){var b=Ext.decode(d.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}var c=b.dimension.sitoolsUnits;this.dimensionName=b.dimension.name;for(var e=0;e&lt;c.length;e++){this.storeUnits.add(new Ext.data.Record(c[e]))}},failure:alertFailure,callback:function(){this.unitsLoaded=true;this.showWinUnits(a)}})}else{this.showWinUnits(a)}},showWinUnits:function(c){var b=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;label&quot;,width:100}],defaults:{sortable:true,width:100}});var d=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridUnits=new Ext.grid.GridPanel({autoScroll:true,store:this.storeUnits,cm:b,sm:d,layout:&quot;fit&quot;,listeners:{scope:this,rowClick:function(e,f){this.onValidateUnits()}}});var a=new Ext.Window({layout:&quot;fit&quot;,width:200,title:i18n.get(&quot;title.unitList&quot;),modal:true,height:300,items:[this.gridUnits],buttons:[{text:i18n.get(&quot;label.ok&quot;),handler:this.onValidateUnits,scope:this},{text:i18n.get(&quot;label.cancel&quot;),scope:a,handler:function(){this.ownerCt.ownerCt.close()}}]});a.show();a.setPosition(c.getXY()[0],c.getXY()[1])},onValidateUnits:function(){var b=this.gridUnits.getSelectionModel().getSelected();if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noSelection&quot;));return}this.userUnit=b.data;this.userDimension=this.dimensionName;var a=this.getEl().query(&quot;button&quot;)[0];if(!Ext.isEmpty(a)){this.getEl().query(&quot;button&quot;)[0].update(b.get(&quot;label&quot;))}this.gridUnits.ownerCt.close()},getUnitComponent:function(){var b=this.context.getRefUnit(this);if(!Ext.isEmpty(this.dimensionId)){var a=new Ext.Button({scope:this,text:Ext.isEmpty(b)?&quot;    &quot;:b.label,width:90,handler:function(c,d){this.loadUnits(d)}});unit=new Ext.Container({layout:&quot;hbox&quot;,layoutConfig:{pack:&quot;center&quot;,align:&quot;middle&quot;},margins:{top:0,right:0,bottom:0,left:10},width:100,items:[a]})}else{if(!Ext.isEmpty(b)){unit=new Ext.Container({html:b.label,margins:{top:0,right:0,bottom:0,left:10},flex:1})}else{unit=null}}return unit}});Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:&quot;&quot;,width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:&quot;&quot;,id:&quot;expander&quot;,lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl==&quot;string&quot;){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&amp;&amp;!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?&quot;x-grid3-row-expanded&quot;:&quot;x-grid3-row-collapsed&quot;},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on(&quot;render&quot;,this.onRender,this);b.on(&quot;destroy&quot;,this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on(&quot;mousedown&quot;,this.onMouseDown,this,{delegate:&quot;.x-grid3-row-expander&quot;});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on(&quot;rowdblclick&quot;,this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un(&quot;mousedown&quot;,this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(k){var f=this.grid;var l=f.getSelectionModel();var b=l.getSelections();for(var c=0,a=b.length;c&lt;a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(&quot;.x-grid3-row&quot;);this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan=&quot;2&quot;';return'&lt;div class=&quot;x-grid3-row-expander&quot;&gt;&amp;#160;&lt;/div&gt;'},beforeExpand:function(b,a,c){if(this.fireEvent(&quot;beforeexpand&quot;,this,b,a,c)!==false){if(this.tpl&amp;&amp;this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a==&quot;number&quot;){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass(&quot;x-grid3-row-collapsed&quot;)?&quot;expandRow&quot;:&quot;collapseRow&quot;](a)},expandRow:function(c){if(typeof c==&quot;number&quot;){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode(&quot;tr:nth(2) div.x-grid3-row-body&quot;,c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass(&quot;x-grid3-row-collapsed&quot;,&quot;x-grid3-row-expanded&quot;);this.fireEvent(&quot;expand&quot;,this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c==&quot;number&quot;){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child(&quot;tr:nth(1) div.x-grid3-row-body&quot;,true);if(this.fireEvent(&quot;beforecollapse&quot;,this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass(&quot;x-grid3-row-expanded&quot;,&quot;x-grid3-row-collapsed&quot;);this.fireEvent(&quot;collapse&quot;,this,b,a,c.rowIndex)}}});Ext.preg(&quot;rowexpander&quot;,Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.Box=Ext.extend(Ext.Panel,{width:&quot;98%&quot;,frame:true,baseCls:&quot;x-box&quot;,cls:&quot;x-box-blue module-root centering&quot;,_title:&quot;&quot;,constructor:function(a){sitools.widget.Box.superclass.constructor.call(this,Ext.apply({_title:a.label,_idItem:a.idItem},a))},initComponent:function(){this.items.unshift({xtype:&quot;component&quot;,html:this._title,cls:&quot;subtitle icon-&quot;+this.idItem});sitools.widget.Box.superclass.initComponent.call(this)}});Ext.reg(&quot;s-box&quot;,sitools.widget.Box);sitools.widget.JsonStore=Ext.extend(Ext.data.JsonStore,{dirty:false,_setDirty:function(a){this.dirty=a},_getDirty:function(){return this.dirty},add:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.add.call(this,a)},remove:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.remove.call(this,a)}});sitools.widget.menuButton=Ext.extend(Ext.Button,{constructor:function(a){a=Ext.apply({iconCls:&quot;menu-button&quot;},a);sitools.widget.menuButton.superclass.constructor.call(this,a)}});Ext.reg(&quot;s-menuButton&quot;,sitools.widget.menuButton);sitools.widget.templateTreeNode=function(a){var c;if(a.tpl===undefined){c=new Ext.Template(&quot;&lt;div &gt;{text}&lt;b&gt;{nbRecords} records&lt;/b&gt;&lt;img src='{urlImage}'&gt;&lt;/img&gt;&lt;a style='text-align:right' href='{urlReadme}'&gt;readme&lt;/a&gt;&lt;/div&gt;&quot;)}else{c=a.tpl}a.text=c.apply(a);a.leaf=false;var b=Ext.apply({children:[]},a);sitools.widget.templateTreeNode.superclass.constructor.call(this,b)};Ext.extend(sitools.widget.templateTreeNode,Ext.tree.AsyncTreeNode,{});Ext.tree.TreePanel.nodeTypes.templateTreeNode=sitools.widget.templateTreeNode;sitools.widget.sortersTool=Ext.extend(Ext.Window,{initComponent:function(){var f=[[&quot;&quot;,&quot;&quot;]];var c;if(!Ext.isEmpty(this.columnModel.columns)){var c=this.columnModel.columns}else{c=this.columnModel}Ext.each(c,function(g){f.push([g.columnAlias,g.header])});this.storeCombo=new Ext.data.ArrayStore({fields:[&quot;dataIndex&quot;,&quot;columnHeader&quot;],data:f});this.f=new Ext.form.FormPanel();var d=this.store.getSortState(),a;if(!Ext.isEmpty(d)){if(Ext.isArray(d.sorters)){this.sorters=d.sorters}else{this.sorters=[d]}a=this.sorters.length}else{this.sorter=[];a=3}for(var b=0;b&lt;a;b++){var e=this.buildCompositeField(b);this.f.add(e)}Ext.apply(this,{title:i18n.get(&quot;label.multiSort&quot;),autoScroll:true,width:400,modal:true,items:[this.f],buttons:[{text:i18n.get(&quot;label.add&quot;),scope:this,handler:this.onAdd},{text:i18n.get(&quot;label.remove&quot;),scope:this,handler:this.onRemove},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});sitools.widget.sortersTool.superclass.initComponent.call(this)},onValidate:function(){var a=[];Ext.each(this.f.items.items,function(b){if(!Ext.isEmpty(b.items.items[0].getValue())){a.push({field:b.items.items[0].getValue(),direction:b.items.items[1].getValue().getGroupValue()})}},this);if(a.length&lt;1){this.close();return}else{if(a.length==1){this.store.sort(a[0].field,a[0].direction)}else{this.store.sort(a)}}this.close()},buildCompositeField:function(a){var c=new Ext.form.ComboBox({typeAhead:true,name:&quot;field&quot;+1,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:this.storeCombo,valueField:&quot;dataIndex&quot;,displayField:&quot;columnHeader&quot;,flex:0.6});var b=new Ext.form.RadioGroup({fieldLabel:i18n.get(&quot;label.direction&quot;),flex:0.4,value:&quot;ASC&quot;,items:[{boxLabel:&quot;ASC&quot;,name:&quot;direction&quot;+a,inputValue:&quot;ASC&quot;},{boxLabel:&quot;DESC&quot;,name:&quot;direction&quot;+a,inputValue:&quot;DESC&quot;}]});var d=new Ext.form.CompositeField({labelWidth:100,anchor:&quot;100%&quot;,fieldLabel:i18n.get(&quot;label.order&quot;),items:[c,b]});return d},onAdd:function(){var a=this.f.items.length;var b=this.buildCompositeField(a);this.f.add(b);this.f.doLayout();this.doLayout()},onRemove:function(){var a=this.f.items.length-1;if(a&lt;0){return}this.f.remove(this.f.getComponent(a));this.f.doLayout();this.doLayout()},afterRender:function(){sitools.widget.sortersTool.superclass.afterRender.call(this);this.setPosition(this.pos);var a=0;Ext.each(this.sorters,function(c){var b=this.f.getComponent(a);b.items.items[0].setValue(c.field);b.items.items[1].setValue(c.direction);a++},this)}});Ext.reg(&quot;sitools.widget.sortersTool&quot;,sitools.widget.sortersTool);sitools.widget.filterTool=Ext.extend(Ext.Window,{paramPrefix:&quot;filter&quot;,initComponent:function(){var e=[[&quot;&quot;,&quot;&quot;]];var c;if(!Ext.isEmpty(this.columnModel.columns)){var c=this.columnModel.columns}else{c=this.columnModel}Ext.each(c,function(f){e.push({columnAlias:f.columnAlias,columnHeader:f.header,columnType:sql2ext.get(f.sqlColumnType)})});this.storeCombo=new Ext.data.JsonStore({fields:[&quot;columnAlias&quot;,&quot;columnHeader&quot;,&quot;columnType&quot;],data:e});this.f=new Ext.Panel();this.filters=this.store.filtersCfg;var a;if(!Ext.isEmpty(this.filters)){a=this.filters.length}else{this.filters=[];a=3}for(var b=0;b&lt;a;b++){var d=this.buildCompositeField(b);this.f.add(d)}Ext.apply(this,{title:i18n.get(&quot;label.filter&quot;),autoScroll:true,width:400,modal:true,items:[this.f],buttons:[{text:i18n.get(&quot;label.add&quot;),scope:this,handler:this.onAdd},{text:i18n.get(&quot;label.remove&quot;),scope:this,handler:this.onRemove},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});sitools.widget.sortersTool.superclass.initComponent.call(this)},getCompositeField:function(a){return this.f.items.items[a]},onValidate:function(){if(Ext.isEmpty(this.store.filters)){this.store.filters=new sitools.widget.FiltersCollection()}this.store.filters.clear();var d=[];var e=[];var c=0;var a=this.store;Ext.each(this.f.items.items,function(k){if(!Ext.isEmpty(k.items.items[0].getValue())){var g=k.findBy(function(m){return m.specificType==&quot;filter&quot;});var l;if(!Ext.isEmpty(g)&amp;&amp;!Ext.isEmpty(g[0])){var f=g[0];l=f.getValue();Ext.each(l,function(m){a.filters.add(c++,m);if(!Ext.isEmpty(m)){d.push(m)}});if(!Ext.isEmpty(f.getConfig())){e.push(f.getConfig())}}}},this);this.store.filtersCfg=e;var b=this.store.lastOptions||{};b.params=b.params||{};this.cleanParams(b.params);this.store.isNewFilter=true;this.store.load(b);this.close()},cleanParams:function(c){if(this.encode){delete c[this.paramPrefix]}else{var b,a;b=new RegExp(&quot;^&quot;+this.paramPrefix+&quot;[[0-9]+]&quot;);for(a in c){if(b.test(a)){delete c[a]}}}},buildCompositeField:function(a){var c=new Ext.form.ComboBox({index:a,typeAhead:true,name:&quot;field&quot;+1,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:this.storeCombo,valueField:&quot;columnAlias&quot;,displayField:&quot;columnHeader&quot;,flex:0.4,listeners:{select:function(k,m,f){if(Ext.isEmpty(m.data.columnAlias)){return}var l=k.ownerCt;var e=l.items.items[1];e.removeAll();switch(m.data.columnType){case (&quot;numeric&quot;):var g=new sitools.widget.NumericFilter({columnAlias:m.data.columnAlias});e.add(g);l.setHeight(g._getHeight());e.setHeight(g._getHeight());break;case (&quot;string&quot;):var g=new sitools.widget.StringFilter({columnAlias:m.data.columnAlias});e.add(g);l.setHeight(g._getHeight());e.setHeight(g._getHeight());break;case (&quot;dateAsString&quot;):var g=new sitools.widget.DateFilter({columnAlias:m.data.columnAlias});e.add(g);l.setHeight(g._getHeight());e.setHeight(g._getHeight());break;default:var g=new sitools.widget.StringFilter({columnAlias:m.data.columnAlias});e.add(g);l.setHeight(g._getHeight());e.setHeight(g._getHeight());break}}}});var b=new Ext.Container({flex:0.6});var d=new Ext.Container({layout:&quot;hbox&quot;,items:[c,b],style:{padding:&quot;5px&quot;}});return d},onAdd:function(){var a=this.f.items.length;var b=this.buildCompositeField(a);this.f.add(b);this.f.doLayout();this.doLayout()},onRemove:function(){var a=this.f.items.length-1;if(a&lt;0){return}this.f.remove(this.f.getComponent(a));this.f.doLayout();this.doLayout()},afterRender:function(){sitools.widget.sortersTool.superclass.afterRender.call(this);this.setPosition(this.pos);var a=0;Ext.each(this.filters,function(b){var c=this.f.getComponent(a);this.updateFilterUI(c,b);a++},this)},updateFilterUI:function(a,d){var f=a.items.items[0];var b=f.getStore();var c=b.find(&quot;columnAlias&quot;,d.columnAlias);if(c){var g=b.getAt(c)}f.setValue(d.columnAlias);f.fireEvent(&quot;select&quot;,f,g,c);var e=a.findBy(function(k){return k.specificType==&quot;filter&quot;});e[0].setValue(d.value)}});Ext.reg(&quot;sitools.widget.sortersTool&quot;,sitools.widget.sortersTool);sitools.widget.GridSorterToolbar=Ext.extend(Ext.Toolbar,{initComponent:function(){sitools.widget.GridSorterToolbar.superclass.initComponent.call(this);this.add(&quot;-&gt;&quot;,new sitools.widget.GridTop({gridId:this.gridId}),new sitools.widget.GridUp({gridId:this.gridId}),new sitools.widget.GridDown({gridId:this.gridId}),new sitools.widget.GridBottom({gridId:this.gridId}))}});Ext.reg(&quot;sitools.widget.GridSorterToolbar&quot;,sitools.widget.GridSorterToolbar);sitools.widget.ViolationRowExpander=Ext.extend(Ext.ux.grid.RowExpander,{getRowClass:function(b,e,f,d){var a=sitools.widget.ViolationRowExpander.superclass.getRowClass.call(this,b,e,f,d);var c=b.get(&quot;violation&quot;);if(!Ext.isEmpty(c)){if(c.level==&quot;CRITICAL&quot;){a+=&quot; red-row&quot;}else{if(c.level==&quot;WARNING&quot;){a+=&quot; orange-row&quot;}}}return a}});Ext.reg(&quot;sitools.widget.ViolationRowExpander&quot;,sitools.widget.ViolationRowExpander);sitools.widget.colorField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(b){var a=new Ext.menu.ColorMenu({scope:this,handler:function(c,d){this.setValue(&quot;#&quot;+d);this.setFontColor(&quot;#&quot;+d)}});a.showAt(b.getXY())},setFontColor:function(b){var a=function(e){return parseInt(e,16)};var c=[a(b.slice(1,3)),a(b.slice(3,5)),a(b.slice(5))];var d=(c[0]+c[1]+c[2])/3;this.el.setStyle({color:(d&gt;128)?&quot;#000&quot;:&quot;#FFF&quot;,&quot;background-color&quot;:b,&quot;background-image&quot;:&quot;none&quot;})},listeners:{afterrender:function(a){a.setFontColor(a.getValue())}}});sitools.widget.DateFieldWithToday=Ext.extend(Ext.form.DateField,{regToday:new RegExp(&quot;^{\\$TODAY}&quot;),invalidTextWithToday:&quot;Impossible to make a date with {0}. A valid example is {$TODAY} + 1&quot;,parseDate:function(f){if(!f||Ext.isDate(f)){return f}if(this.regToday.test(f)){return f}var b=this.safeParse(f,this.format),c=this.altFormats,e=this.altFormatsArray;if(!b&amp;&amp;c){e=e||c.split(&quot;|&quot;);for(var d=0,a=e.length;d&lt;a&amp;&amp;!b;d++){b=this.safeParse(f,e[d])}}return b},getErrors:function(f){var k=Ext.form.DateField.superclass.getErrors.apply(this,arguments);f=this.formatDate(f||this.processValue(this.getRawValue()));if(f.length&lt;1){return k}var c=f;var g=false;if(this.regToday.test(f)){try{f=sitools.common.utils.Date.stringWithTodayToDate(f);if(!sitools.common.utils.Date.isValidDate(f)){throw&quot;&quot;}}catch(e){k.push(String.format(this.invalidTextWithToday,c));return k}}else{f=this.parseDate(f)}if(!f){k.push(String.format(this.invalidText,c,this.format));return k}g=f.getTime();if(this.minValue&amp;&amp;g&lt;this.minValue.clearTime().getTime()){k.push(String.format(this.minText,this.formatDate(this.minValue)))}if(this.maxValue&amp;&amp;g&gt;this.maxValue.clearTime().getTime()){k.push(String.format(this.maxText,this.formatDate(this.maxValue)))}if(this.disabledDays){var a=f.getDay();for(var b=0;b&lt;this.disabledDays.length;b++){if(a===this.disabledDays[b]){k.push(this.disabledDaysText);break}}}var d=this.formatDate(f);if(this.disabledDatesRE&amp;&amp;this.disabledDatesRE.test(d)){k.push(String.format(this.disabledDatesText,d))}return k},setValue:function(a){if(this.regToday.test(a)){return Ext.form.DateField.superclass.setValue.call(this,a)}else{return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))}}});function utils_logout(){Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;);Ext.Ajax.defaultHeaders.Authorization=&quot;&quot;;window.location.reload()}var ImageChooser=function(a){this.config=a};ImageChooser.prototype={lookup:{},show:function(c,f){if(!this.win){this.initTemplates();this.store=new Ext.data.JsonStore({url:this.config.url,root:&quot;items&quot;,fields:[&quot;name&quot;,&quot;url&quot;,{name:&quot;size&quot;,type:&quot;float&quot;},{name:&quot;lastmod&quot;,type:&quot;date&quot;,dateFormat:&quot;timestamp&quot;}],listeners:{load:{fn:function(){this.view.select(0)},scope:this,single:true}}});this.store.load();var d=function(g){if(g.size&lt;1024){return g.size+&quot; bytes&quot;}else{return(Math.round(((g.size*10)/1024))/10)+&quot; KB&quot;}};var e=function(g){g.shortName=g.name.ellipse(15);g.sizeString=d(g);g.dateString=new Date(g.lastmod).format(&quot;d/m/Y g:i a&quot;);this.lookup[g.name]=g;return g};this.view=new Ext.DataView({tpl:this.thumbTemplate,id:&quot;imageChooserDataViewId&quot;,singleSelect:true,overClass:&quot;x-view-over&quot;,itemSelector:&quot;div.thumb-wrap&quot;,emptyText:'&lt;div style=&quot;padding:10px;&quot;&gt;No images match the specified filter&lt;/div&gt;',store:this.store,listeners:{selectionchange:{fn:this.showDetails,scope:this,buffer:100},dblclick:{fn:this.doCallback,scope:this},loadexception:{fn:this.onLoadException,scope:this},beforeselect:{fn:function(g){return g.store.getRange().length&gt;0}}},prepareData:e.createDelegate(this)});if(!Ext.isEmpty(b)){b.destroy()}var b=new Ext.FormPanel({fileUpload:true,frame:true,formId:&quot;formUploadId&quot;,autoHeight:true,bodyStyle:&quot;padding: 10px 10px 0 10px;&quot;,labelWidth:50,defaults:{anchor:&quot;95%&quot;,allowBlank:false,msgTarget:&quot;side&quot;},items:[{xtype:&quot;fileuploadfield&quot;,id:&quot;form-file&quot;,fieldLabel:&quot;Photo&quot;,name:&quot;image&quot;,buttonText:&quot;&quot;,buttonCfg:{iconCls:&quot;upload-icon&quot;}}],buttons:[{text:&quot;upload&quot;,handler:function(){if(b.getForm().isValid()){var g=b.getForm();Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/upload/?media=json&quot;,form:&quot;formUploadId&quot;,waitMsg:&quot;wait...&quot;,method:&quot;PUT&quot;,success:function(k){new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.imageUploaded&quot;),autoDestroy:true,hideDelay:1000}).show(document);Ext.getCmp(&quot;imageChooserDataViewId&quot;).refresh()},failure:function(k){Ext.Msg.alert(i18n.get(&quot;label.error&quot;))},callback:function(){Ext.getCmp(&quot;imageChooserDataViewId&quot;).getStore().load();Ext.getCmp(&quot;imageChooserDataViewId&quot;).refresh()}})}}}]});var a={title:i18n.get(&quot;label.chooseImage&quot;),id:&quot;img-chooser-dlg&quot;,layout:&quot;border&quot;,minWidth:500,minHeight:450,modal:true,border:false,items:[{id:&quot;img-chooser-view&quot;,region:&quot;center&quot;,autoScroll:true,items:this.view,tbar:[{text:i18n.get(&quot;label.filter&quot;)},{xtype:&quot;textfield&quot;,id:&quot;filter&quot;,selectOnFocus:true,width:100,listeners:{render:{fn:function(){Ext.getCmp(&quot;filter&quot;).getEl().on(&quot;keyup&quot;,function(){this.filter()},this,{buffer:500})},scope:this}}},&quot; &quot;,&quot;-&quot;,{text:i18n.get(&quot;label.sortBy&quot;)},{id:&quot;sortSelect&quot;,xtype:&quot;combo&quot;,typeAhead:true,triggerAction:&quot;all&quot;,width:100,editable:false,mode:&quot;local&quot;,displayField:&quot;desc&quot;,valueField:&quot;name&quot;,lazyInit:false,value:&quot;name&quot;,store:new Ext.data.ArrayStore({fields:[&quot;name&quot;,&quot;desc&quot;],data:[[&quot;name&quot;,&quot;Name&quot;],[&quot;size&quot;,&quot;File Size&quot;],[&quot;lastmod&quot;,&quot;Last Modified&quot;]]}),listeners:{select:{fn:this.sortImages,scope:this}}}]},{id:&quot;img-detail-panel&quot;,region:&quot;east&quot;,split:true,width:150,minWidth:150,maxWidth:250},{id:&quot;img-upload-panel&quot;,title:i18n.get(&quot;label.upload&quot;),region:&quot;south&quot;,collapsible:true,autoHeight:true,items:[b]}],buttons:[{id:&quot;ok-btn&quot;,text:&quot;OK&quot;,handler:this.doCallback,scope:this},{text:&quot;Cancel&quot;,handler:function(){this.win.close()},scope:this}],keys:{key:27,handler:function(){this.win.close()},scope:this}};Ext.apply(a,this.config);this.win=new Ext.Window(a)}this.reset();this.win.show(c);this.callback=f;this.animateTarget=c},initTemplates:function(){this.thumbTemplate=new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;thumb-wrap&quot; id=&quot;{name}&quot;&gt;','&lt;div class=&quot;thumb&quot;&gt;&lt;img src=&quot;{url}&quot; title=&quot;{name}&quot;&gt;&lt;/div&gt;',&quot;&lt;span&gt;{shortName}&lt;/span&gt;&lt;/div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;);this.thumbTemplate.compile();this.detailsTemplate=new Ext.XTemplate('&lt;div class=&quot;details&quot;&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;img src=&quot;{url}&quot;&gt;&lt;div class=&quot;details-info&quot;&gt;',&quot;&lt;b&gt;Image Name:&lt;/b&gt;&quot;,&quot;&lt;span&gt;{name}&lt;/span&gt;&quot;,&quot;&lt;b&gt;Size:&lt;/b&gt;&quot;,&quot;&lt;span&gt;{sizeString}&lt;/span&gt;&quot;,&quot;&lt;b&gt;Last Modified:&lt;/b&gt;&quot;,&quot;&lt;span&gt;{dateString}&lt;/span&gt;&lt;/div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/div&gt;&quot;);this.detailsTemplate.compile()},showDetails:function(){var b=this.view.getSelectedNodes();var c=Ext.getCmp(&quot;img-detail-panel&quot;).body;if(b&amp;&amp;b.length&gt;0){b=b[0];Ext.getCmp(&quot;ok-btn&quot;).enable();var a=this.lookup[b.id];c.hide();this.detailsTemplate.overwrite(c,a);c.slideIn(&quot;l&quot;,{stopFx:true,duration:0.2})}else{Ext.getCmp(&quot;ok-btn&quot;).disable();c.update(&quot;&quot;)}},filter:function(){var a=Ext.getCmp(&quot;filter&quot;);this.view.store.filter(&quot;name&quot;,a.getValue());this.view.select(0)},sortImages:function(){var a=Ext.getCmp(&quot;sortSelect&quot;).getValue();this.view.store.sort(a,a==&quot;name&quot;?&quot;asc&quot;:&quot;desc&quot;);this.view.select(0)},reset:function(){if(this.win.rendered){Ext.getCmp(&quot;filter&quot;).reset();this.view.getEl().dom.scrollTop=0}this.view.store.clearFilter();this.view.select(0)},doCallback:function(){var c=this.view.getSelectedNodes()[0];var e=this.callback;var d=this.lookup;var a=this.config;if(c&amp;&amp;e){var b=d[c.id];e(b,a)}this.win.close()},onLoadException:function(a,b){this.view.getEl().update('&lt;div style=&quot;padding:10px;&quot;&gt;Error loading images.&lt;/div&gt;')}};String.prototype.ellipse=function(a){if(this.length&gt;a){return this.substr(0,a-3)+&quot;...&quot;}return this};Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:&quot;Browse...&quot;,buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents(&quot;fileselected&quot;)},onRender:function(c,a){Ext.ux.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:&quot;x-form-field-wrap x-form-file-wrap&quot;});this.el.addClass(&quot;x-form-file-text&quot;);this.el.dom.removeAttribute(&quot;name&quot;);this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:&quot;x-form-file-btn&quot;+(b.iconCls?&quot; x-btn-icon&quot;:&quot;&quot;)}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;])},mouseleave:function(){this.button.removeClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;,&quot;x-btn-click&quot;])},mousedown:function(){this.button.addClass(&quot;x-btn-click&quot;)},mouseup:function(){this.button.removeClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;,&quot;x-btn-click&quot;])},change:function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent(&quot;fileselected&quot;,this,a)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:&quot;x-form-file&quot;,tag:&quot;input&quot;,type:&quot;file&quot;,size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+&quot;-file&quot;},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,&quot;tl-tr&quot;,[2,0])}});Ext.reg(&quot;fileuploadfield&quot;,Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.form.SitoolsSelectImage=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){function b(d,c){c.fieldUrl.setValue(d.url);c.fieldUrl.fireEvent(&quot;change&quot;,this,d.url,c.fieldUrl.startValue)}var a=new ImageChooser({url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/upload/?media=json&quot;,width:515,height:450,fieldUrl:this});a.show(document,b)}}});Ext.reg(&quot;sitoolsSelectImage&quot;,Ext.form.SitoolsSelectImage);var loginErrLength=&quot;Login minimum 4 character !&quot;;var loginErrUnique=&quot;Login already in use !&quot;;var loginSuccess=&quot;Login avaliable&quot;;var emailErrFormat=&quot;Email not valid !&quot;;var emailErrUnique=&quot;Email already in use !&quot;;var emailSuccess=&quot;Email valid &amp; avaliable&quot;;Ext.apply(Ext.form.VTypes,{uniqueloginMask:/[a-z0-9_\.\-@\+]/i,uniquelogin:function(a){if(a.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}},uniqueloginText:loginErrUnique,uniqueemailMask:/[a-z0-9_\.\-@\+]/i,uniqueemail:function(b){var a=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(a.test(b)){return true}else{return false}},uniqueemailText:emailErrFormat,password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:&quot;Passwords do not match&quot;,passwordlength:function(a){if(a.length&lt;6||a.length&gt;40){return false}else{return true}},passwordlengthText:&quot;Invalid Password Length. It must be between 6 and 40&quot;});function resetLoginValidator(a){Ext.apply(Ext.form.VTypes,{uniquelogin:function(b){if(b.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}}})}function resetEmailValidator(a){Ext.apply(Ext.form.VTypes,{uniqueemail:function(c){var b=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(b.test(c)){return true}else{return false}return(a)}})}Ext.namespace(&quot;sitools.component.version&quot;);sitools.component.version.sitoolsVersion=Ext.extend(Ext.Panel,{layout:&quot;fit&quot;,version:null,initComponent:function(){this.versionUrl=loadUrl.get(&quot;APP_URL&quot;)+&quot;/version&quot;;var f=new Ext.form.Label({html:&quot;&lt;h2&gt;SITools2&lt;/h2&quot;});var e=new Ext.form.Label({html:&quot;&lt;img src=&quot;+loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/logo_02_tailleMoyenne.png&gt;&quot;});var c=new Ext.form.Label({html:&quot;&lt;p&gt;Copyright 2010, 2011, 2012 CNES&lt;/p&gt;&quot;});var a=new Ext.form.Label({html:'&lt;a href=&quot;http://www.sitools2.sourceforge.net&quot;&gt;sitools2.sourceforge.net&lt;/&gt;'});this.versionLabel=new Ext.form.Label({});var b=new Ext.Panel({title:i18n.get(&quot;label.version&quot;),layout:&quot;fit&quot;,padding:10});var d=new Ext.ux.ManagedIFrame.Panel({title:i18n.get(&quot;label.licence&quot;),layout:&quot;fit&quot;,defaultSrc:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/licences/gpl-3.0.txt&quot;});b.add([e,f,this.versionLabel,c,a]);this.tabs=new Ext.TabPanel({activeTab:0,items:[b,d]});this.items=[this.tabs];this.listeners={scope:this,resize:function(k){var g=k.body.getSize();this.tabs.setSize(g)}};sitools.component.version.sitoolsVersion.superclass.initComponent.call(this)},afterRender:function(){sitools.component.version.sitoolsVersion.superclass.afterRender.apply(this,arguments);Ext.Ajax.request({url:this.versionUrl,method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.message);return false}this.version=c.version;this.versionLabel.setText(&quot;&lt;h3&gt;Version : &quot;+this.version+&quot;&lt;/h3&gt;&quot;,false)},failure:alertFailure});var a=this.ownerCt.body.getSize();this.tabs.setSize(a)}});function showVersion(){var a=Ext.getCmp(&quot;winVersionId&quot;);if(!a){var b=new sitools.component.version.sitoolsVersion();a=new Ext.Window({title:i18n.get(&quot;label.version&quot;),id:&quot;winVersionId&quot;,items:[b],modal:false,width:700,height:480,resizable:false,buttons:[{text:i18n.get(&quot;label.close&quot;),handler:function(){this.ownerCt.ownerCt.close()}}]});a.show()}else{a.show()}}Ext.SitoolsDatePicker=Ext.extend(Ext.BoxComponent,{todayText:&quot;Today&quot;,okText:&quot;&amp;#160;OK&amp;#160;&quot;,cancelText:&quot;Cancel&quot;,todayTip:&quot;{0} (Spacebar)&quot;,minText:&quot;This date is before the minimum date&quot;,maxText:&quot;This date is after the maximum date&quot;,format:&quot;m/d/y&quot;,disabledDaysText:&quot;Disabled&quot;,disabledDatesText:&quot;Disabled&quot;,monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:&quot;Next Month (Control+Right)&quot;,prevText:&quot;Previous Month (Control+Left)&quot;,monthYearText:&quot;Choose a month (Control+Up/Down to move years)&quot;,startDay:0,showToday:true,showTime:false,focusOnSelect:true,initHour:12,initComponent:function(){Ext.SitoolsDatePicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime(true):new Date().clearTime();this.hourValue=this.value?this.value.getHours():new Date().getHours();this.minuteValue=this.value?this.value.getMinutes():new Date().getMinutes();this.secondValue=this.value?this.value.getSeconds():new Date().getSeconds();this.addEvents(&quot;select&quot;);if(this.handler){this.on(&quot;select&quot;,this.handler,this.scope||this)}this.initDisabledDays()},initDisabledDays:function(){if(!this.disabledDatesRE&amp;&amp;this.disabledDates){var b=this.disabledDates,a=b.length-1,c=&quot;(?:&quot;;Ext.each(b,function(f,e){c+=Ext.isDate(f)?&quot;^&quot;+Ext.escapeRe(f.dateFormat(this.format))+&quot;$&quot;:b[e];if(e!=a){c+=&quot;|&quot;}},this);this.disabledDatesRE=new RegExp(c+&quot;)&quot;)}},setDisabledDates:function(a){if(Ext.isArray(a)){this.disabledDates=a;this.disabledDatesRE=null}else{this.disabledDatesRE=a}this.initDisabledDays();this.update(this.value,true)},setDisabledDays:function(a){this.disabledDays=a;this.update(this.value,true)},setMinDate:function(a){this.minDate=a;this.update(this.value,true)},setMaxDate:function(a){this.maxDate=a;this.update(this.value,true)},setValue:function(a){this.value=a;this.update(this.value)},getValue:function(){return this.value},focus:function(){this.update(this.activeDate);if(this.showTime){this.updateTime(this.activeDate)}},updateTime:function(a){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())},onEnable:function(a){Ext.SitoolsDatePicker.superclass.onEnable.call(this);this.doDisabled(false);this.update(a?this.value:this.activeDate);if(Ext.isIE){this.el.repaint()}},onDisable:function(){Ext.SitoolsDatePicker.superclass.onDisable.call(this);this.doDisabled(true);if(Ext.isIE&amp;&amp;!Ext.isIE8){Ext.each([].concat(this.textNodes,this.el.query(&quot;th span&quot;)),function(a){Ext.fly(a).repaint()})}},doDisabled:function(a){this.keyNav.setDisabled(a);this.prevRepeater.setDisabled(a);this.nextRepeater.setDisabled(a);if(this.showToday){this.todayKeyListener.setDisabled(a);this.todayBtn.setDisabled(a)}},onRender:function(a,g){var c=['&lt;table cellspacing=&quot;0&quot;&gt;','&lt;tr&gt;&lt;td class=&quot;x-date-left&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;',this.prevText,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-middle&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;td class=&quot;x-date-right&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;',this.nextText,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;','&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;&lt;table class=&quot;x-date-inner&quot; cellspacing=&quot;0&quot;&gt;&lt;thead&gt;&lt;tr&gt;'],f=this.dayNames,e;for(e=0;e&lt;7;e++){var k=this.startDay+e;if(k&gt;6){k=k-7}c.push(&quot;&lt;th&gt;&lt;span&gt;&quot;,f[k].substr(0,1),&quot;&lt;/span&gt;&lt;/th&gt;&quot;)}c[c.length]=&quot;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&quot;;for(e=0;e&lt;42;e++){if(e%7===0&amp;&amp;e!==0){c[c.length]=&quot;&lt;/tr&gt;&lt;tr&gt;&quot;}c[c.length]='&lt;td&gt;&lt;a href=&quot;#&quot; hidefocus=&quot;on&quot; class=&quot;x-date-date&quot; tabIndex=&quot;1&quot;&gt;&lt;em&gt;&lt;span&gt;&lt;/span&gt;&lt;/em&gt;&lt;/a&gt;&lt;/td&gt;'}c.push(&quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&quot;,this.showTime?'&lt;tr&gt;&lt;td colspan=&quot;3&quot; class=&quot;x-date-time&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;/tr&gt;':&quot;&quot;,this.showToday?'&lt;tr&gt;&lt;td colspan=&quot;3&quot; class=&quot;x-date-bottom&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;/tr&gt;':&quot;&quot;,'&lt;/table&gt;&lt;div class=&quot;x-date-mp&quot;&gt;&lt;/div&gt;');var b=document.createElement(&quot;div&quot;);b.className=&quot;x-date-picker&quot;;b.innerHTML=c.join(&quot;&quot;);a.dom.insertBefore(b,g);this.el=Ext.get(b);this.eventEl=Ext.get(b.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child(&quot;td.x-date-left a&quot;),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child(&quot;td.x-date-right a&quot;),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down(&quot;div.x-date-mp&quot;);this.monthPicker.enableDisplayMode(&quot;block&quot;);this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(d){if(d.ctrlKey){this.showPrevMonth()}else{this.update(this.activeDate.add(&quot;d&quot;,-1))}},right:function(d){if(d.ctrlKey){this.showNextMonth()}else{this.update(this.activeDate.add(&quot;d&quot;,1))}},up:function(d){if(d.ctrlKey){this.showNextYear()}else{this.update(this.activeDate.add(&quot;d&quot;,-7))}},down:function(d){if(d.ctrlKey){this.showPrevYear()}else{this.update(this.activeDate.add(&quot;d&quot;,7))}},pageUp:function(d){this.showNextMonth()},pageDown:function(d){this.showPrevMonth()},enter:function(d){d.stopPropagation();return true},scope:this});this.cells=this.el.select(&quot;table.x-date-inner tbody td&quot;);this.textNodes=this.el.query(&quot;table.x-date-inner tbody span&quot;);this.mbtn=new Ext.Button({text:&quot;&amp;#160;&quot;,tooltip:this.monthYearText,renderTo:this.el.child(&quot;td.x-date-middle&quot;,true)});this.mbtn.el.child(&quot;em&quot;).addClass(&quot;x-btn-arrow&quot;);if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var l=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child(&quot;td.x-date-bottom&quot;,true),text:String.format(this.todayText,l),tooltip:String.format(this.todayTip,l),handler:this.selectToday,scope:this})}if(this.showTime){this.hourField=new Ext.form.TextField({value:this.hourValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.secondField.focus()}else{this.minuteField.focus()}}}},maxLength:2,maskRe:/[0-9]/,disabled:false,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=23&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});this.minuteField=new Ext.form.TextField({value:this.minuteValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.hourField.focus()}else{this.secondField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=59&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});this.secondField=new Ext.form.TextField({value:this.minuteValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.minuteField.focus()}else{this.hourField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=59&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});var p=new Ext.form.DisplayField({value:&quot;:&quot;});var n=new Ext.form.DisplayField({value:&quot;:&quot;});this.timeForm=new Ext.form.FormPanel({labelWidth:1,itemsCls:&quot;sitools-no-margin&quot;,items:[{xtype:&quot;compositefield&quot;,width:135,style:{padding:&quot;3px&quot;},items:[this.hourField,p,this.minuteField,n,this.secondField]}],renderTo:this.el.child(&quot;td.x-date-time&quot;,true)})}this.mon(this.eventEl,&quot;mousewheel&quot;,this.handleMouseWheel,this);this.mon(this.eventEl,&quot;click&quot;,this.handleDateClick,this,{delegate:&quot;a.x-date-date&quot;});this.mon(this.mbtn,&quot;click&quot;,this.showMonthPicker,this);this.onEnable(true)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var a=['&lt;table border=&quot;0&quot; cellspacing=&quot;0&quot;&gt;'];for(var b=0;b&lt;6;b++){a.push('&lt;tr&gt;&lt;td class=&quot;x-date-mp-month&quot;&gt;&lt;a href=&quot;#&quot;&gt;',Date.getShortMonthName(b),&quot;&lt;/a&gt;&lt;/td&gt;&quot;,'&lt;td class=&quot;x-date-mp-month x-date-mp-sep&quot;&gt;&lt;a href=&quot;#&quot;&gt;',Date.getShortMonthName(b+6),&quot;&lt;/a&gt;&lt;/td&gt;&quot;,b===0?'&lt;td class=&quot;x-date-mp-ybtn&quot; align=&quot;center&quot;&gt;&lt;a class=&quot;x-date-mp-prev&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-mp-ybtn&quot; align=&quot;center&quot;&gt;&lt;a class=&quot;x-date-mp-next&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;':'&lt;td class=&quot;x-date-mp-year&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-mp-year&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;')}a.push('&lt;tr class=&quot;x-date-mp-btns&quot;&gt;&lt;td colspan=&quot;4&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;x-date-mp-ok&quot;&gt;',this.okText,'&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;x-date-mp-cancel&quot;&gt;',this.cancelText,&quot;&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;&quot;,&quot;&lt;/table&gt;&quot;);this.monthPicker.update(a.join(&quot;&quot;));this.mon(this.monthPicker,&quot;click&quot;,this.onMonthClick,this);this.mon(this.monthPicker,&quot;dblclick&quot;,this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select(&quot;td.x-date-mp-month&quot;);this.mpYears=this.monthPicker.select(&quot;td.x-date-mp-year&quot;);this.mpMonths.each(function(c,d,e){e+=1;if((e%2)===0){c.dom.xmonth=5+Math.round(e*0.5)}else{c.dom.xmonth=Math.round((e-1)*0.5)}})}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();var a=this.el.getSize();this.monthPicker.setSize(a);this.monthPicker.child(&quot;table&quot;).setSize(a);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn(&quot;t&quot;,{duration:0.2})}},updateMPYear:function(e){this.mpyear=e;var c=this.mpYears.elements;for(var b=1;b&lt;=10;b++){var d=c[b-1],a;if((b%2)===0){a=e+Math.round(b*0.5);d.firstChild.innerHTML=a;d.xyear=a}else{a=e-(5-Math.round(b*0.5));d.firstChild.innerHTML=a;d.xyear=a}this.mpYears.item(b-1)[a==this.mpSelYear?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;x-date-mp-sel&quot;)}},updateMPMonth:function(a){this.mpMonths.each(function(b,c,d){b[b.dom.xmonth==a?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;x-date-mp-sel&quot;)})},selectMPMonth:function(a){},onMonthClick:function(f,b){f.stopEvent();var c=new Ext.Element(b),a;if(c.is(&quot;button.x-date-mp-cancel&quot;)){this.hideMonthPicker()}else{if(c.is(&quot;button.x-date-mp-ok&quot;)){var g=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());if(g.getMonth()!=this.mpSelMonth){g=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(g);this.hideMonthPicker()}else{if((a=c.up(&quot;td.x-date-mp-month&quot;,2))){this.mpMonths.removeClass(&quot;x-date-mp-sel&quot;);a.addClass(&quot;x-date-mp-sel&quot;);this.mpSelMonth=a.dom.xmonth}else{if((a=c.up(&quot;td.x-date-mp-year&quot;,2))){this.mpYears.removeClass(&quot;x-date-mp-sel&quot;);a.addClass(&quot;x-date-mp-sel&quot;);this.mpSelYear=a.dom.xyear}else{if(c.is(&quot;a.x-date-mp-prev&quot;)){this.updateMPYear(this.mpyear-10)}else{if(c.is(&quot;a.x-date-mp-next&quot;)){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(d,b){d.stopEvent();var c=new Ext.Element(b),a;if((a=c.up(&quot;td.x-date-mp-month&quot;,2))){this.update(new Date(this.mpSelYear,a.dom.xmonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}else{if((a=c.up(&quot;td.x-date-mp-year&quot;,2))){this.update(new Date(a.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}}},hideMonthPicker:function(a){if(this.monthPicker){if(a===true){this.monthPicker.hide()}else{this.monthPicker.slideOut(&quot;t&quot;,{duration:0.2})}}},showPrevMonth:function(a){this.update(this.activeDate.add(&quot;mo&quot;,-1))},showNextMonth:function(a){this.update(this.activeDate.add(&quot;mo&quot;,1))},showPrevYear:function(){this.update(this.activeDate.add(&quot;y&quot;,-1))},showNextYear:function(){this.update(this.activeDate.add(&quot;y&quot;,1))},handleMouseWheel:function(a){a.stopEvent();if(!this.disabled){var b=a.getWheelDelta();if(b&gt;0){this.showPrevMonth()}else{if(b&lt;0){this.showNextMonth()}}}},handleDateClick:function(c,b){c.stopEvent();if(!this.disabled&amp;&amp;b.dateValue&amp;&amp;!Ext.fly(b.parentNode).hasClass(&quot;x-date-disabled&quot;)){this.cancelFocus=this.focusOnSelect===false;var a=new Date(b.dateValue);if(this.showTime){a=a.add(Date.HOUR,this.hourField.getValue());a=a.add(Date.MINUTE,this.minuteField.getValue());a=a.add(Date.SECOND,this.secondField.getValue());if(!this.hourField.isValid()||!this.minuteField.isValid()||!this.secondField.isValid()){return}}this.setValue(a);delete this.cancelFocus;this.fireEvent(&quot;select&quot;,this,this.value)}},selectToday:function(){if(this.todayBtn&amp;&amp;!this.todayBtn.disabled){var a=new Date();this.setValue(a);if(this.showTime){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())}this.fireEvent(&quot;select&quot;,this,this.value)}},update:function(E,B){if(this.rendered){if(!Ext.isDate(E)){E=new Date()}var a=this.activeDate,u=this.isVisible();var p=new Date(E.getTime());p.setHours(0);p.setMinutes(0);p.setMilliseconds(0);p.setSeconds(0);this.activeDate=E;if(!B&amp;&amp;a&amp;&amp;this.el){var s=p.getTime();if(a.getMonth()==p.getMonth()&amp;&amp;a.getFullYear()==p.getFullYear()){this.cells.removeClass(&quot;x-date-selected&quot;);this.cells.each(function(d){if(d.dom.firstChild.dateValue==s){d.addClass(&quot;x-date-selected&quot;);if(u&amp;&amp;!this.cancelFocus){Ext.fly(d.dom.firstChild).focus(50)}return false}},this);return}}var l=E.getDaysInMonth(),v=E.getFirstDateOfMonth(),f=v.getDay()-this.startDay;if(f&lt;0){f+=7}l+=f;var C=E.add(&quot;mo&quot;,-1),g=C.getDaysInMonth()-f,e=this.cells.elements,z=this.textNodes,D=(new Date(C.getFullYear(),C.getMonth(),g,this.initHour));D.setHours(C.getHours());D.setMinutes(C.getMinutes());D.setSeconds(C.getSeconds());today=new Date().getTime(),sel=E.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(&quot;&quot;):false,ddaysText=this.disabledDaysText,format=this.format;if(this.showToday){var n=new Date().clearTime(),c=(n&lt;min||n&gt;max||(ddMatch&amp;&amp;format&amp;&amp;ddMatch.test(n.dateFormat(format)))||(ddays&amp;&amp;ddays.indexOf(n.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(c);this.todayKeyListener[c?&quot;disable&quot;:&quot;enable&quot;]()}}var m=function(M,d){d.title=&quot;&quot;;var K=D.clearTime(true).getTime();d.firstChild.dateValue=K;if(K==today){d.className+=&quot; x-date-today&quot;;d.title=M.todayText}if(K==sel){d.className+=&quot; x-date-selected&quot;;if(u){Ext.fly(d.firstChild).focus(50)}}if(K&lt;min){d.className=&quot; x-date-disabled&quot;;d.title=M.minText;return}if(K&gt;max){d.className=&quot; x-date-disabled&quot;;d.title=M.maxText;return}if(ddays){if(ddays.indexOf(D.getDay())!=-1){d.title=ddaysText;d.className=&quot; x-date-disabled&quot;}}if(ddMatch&amp;&amp;format){var L=D.dateFormat(format);if(ddMatch.test(L)){d.title=ddText.replace(&quot;%0&quot;,L);d.className=&quot; x-date-disabled&quot;}}};var A=0;for(;A&lt;f;A++){z[A].innerHTML=(++g);D.setDate(D.getDate()+1);e[A].className=&quot;x-date-prevday&quot;;m(this,e[A])}for(;A&lt;l;A++){var b=A-f+1;z[A].innerHTML=(b);D.setDate(D.getDate()+1);e[A].className=&quot;x-date-active&quot;;m(this,e[A])}var J=0;for(;A&lt;42;A++){z[A].innerHTML=(++J);D.setDate(D.getDate()+1);e[A].className=&quot;x-date-nextday&quot;;m(this,e[A])}this.mbtn.setText(this.monthNames[E.getMonth()]+&quot; &quot;+E.getFullYear());if(!this.internalRender){var k=this.el.dom.firstChild,q=k.offsetWidth;this.el.setWidth(q+this.el.getBorderWidth(&quot;lr&quot;));Ext.fly(k).setWidth(q);this.internalRender=true;if(Ext.isOpera&amp;&amp;!this.secondPass){k.rows[0].cells[1].style.width=(q-(k.rows[0].cells[0].offsetWidth+k.rows[0].cells[2].offsetWidth))+&quot;px&quot;;this.secondPass=true;this.update.defer(10,this,[E])}}}},beforeDestroy:function(){if(this.rendered){Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);delete this.textNodes;delete this.cells.elements}}});Ext.reg(&quot;datepicker&quot;,Ext.SitoolsDatePicker);var DEFAULT_NATIVEJSON=false;var DEFAULT_TIMEOUT=30000;var DEFAULT_TIMEBUF=10;var DEFAULT_NBRETRY=0;var LOCALE=&quot;en&quot;;var DEFAULT_HELP_WIDTH=600;var DEFAULT_HELP_HEIGHT=400;var ADMIN_PANEL_HEIGHT=300;var ADMIN_PANEL_NB_ELEMENTS=10;var SHOW_HELP=true;var COOKIE_DURATION=20;var SITOOLS_DATE_FORMAT=&quot;Y-m-d\\TH:i:s.u&quot;;var SITOOLS_DEFAULT_IHM_DATE_FORMAT=&quot;Y-m-d H:i:s.u&quot;;Ext.Ajax.defaultHeaders={Accept:&quot;application/json&quot;,&quot;User-Agent&quot;:&quot;Sitools&quot;};var onBeforeRequest=function(g,d){var c=new Date();if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;scheme&quot;))){if(Ext.util.Cookies.get(&quot;scheme&quot;)==&quot;HTTP_Digest&quot;){var e=null;var k=&quot;GET&quot;;if(!Ext.isEmpty(d.method)){k=d.method}var b=d.url;if(Ext.isEmpty(d.url)&amp;&amp;!Ext.isEmpty(d.scope)){if(!Ext.isEmpty(d.scope.url)){b=d.scope.url}}var a=Ext.util.Cookies.get(&quot;A1&quot;);var f=new Digest({usr:Ext.util.Cookies.get(&quot;userLogin&quot;),algorithm:Ext.util.Cookies.get(&quot;algorithm&quot;),realm:Ext.util.Cookies.get(&quot;realm&quot;),url:b,nonce:Ext.util.Cookies.get(&quot;nonce&quot;),method:k,mode:&quot;digest&quot;,A1:a});Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:f.getDigestAuth()})}else{if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;hashCode&quot;))){Ext.util.Cookies.set(&quot;hashCode&quot;,Ext.util.Cookies.get(&quot;hashCode&quot;),c.add(Date.MINUTE,COOKIE_DURATION));Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get(&quot;hashCode&quot;)})}}}if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;userLogin&quot;))){Ext.util.Cookies.set(&quot;userLogin&quot;,Ext.util.Cookies.get(&quot;userLogin&quot;),c.add(Date.MINUTE,20))}};Ext.Ajax.on(&quot;beforerequest&quot;,onBeforeRequest,this);var onRequestException=function(c,a,b){if(!b.doNotHandleRequestexception){if((a.status==403)&amp;&amp;!Ext.isEmpty(Ext.util.Cookies.get(&quot;hashCode&quot;))){Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get(&quot;label.session.expired&quot;),a.responseText)}else{Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get(&quot;label.error&quot;),a.responseText)}}};Ext.Ajax.on(&quot;requestexception&quot;,onRequestException,this);var helpUrl;Ext.BLANK_IMAGE_URL=&quot;/sitools/cots/extjs/resources/images/default/s.gif&quot;;Ext.USE_NATIVE_JSON=DEFAULT_NATIVEJSON;Ext.Ajax.timeout=DEFAULT_TIMEOUT;var treePanel,mainPanel,helpPanel;var SERVER_OK=200;function alertFailure(b,d){var a;if(b.status==SERVER_OK){var c=Ext.decode(b.responseText).message;a=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+i18n.get(c)}else{a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+i18n.get(b.statusText)}Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a)}function showResponse(b){try{var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(a.message));return false}var c=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(a.message),autoDestroy:true,hideDelay:1000}).show(document);return true}catch(d){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.javascriptError&quot;)+&quot; : &quot;+d);return false}}Ext.apply(Ext.form.VTypes,{name:function(){var a=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`{}|~/]+.*$&quot;);return function(b){return !a.test(b)}}(),nameText:&quot;Invalid caracters : should not contain . * [ ! \&quot; # $ % &amp; ' ( ) * + , : ; &lt; = &gt; ? @  ` { } | ~ / ] + . * $&quot;,image:function(){var a=new RegExp(&quot;^[http://]+[/:a-zA-Z0-9-_]+.*(jpg|gif|png|bmp|ico)$&quot;);return function(b){return a.test(b)}}(),imageText:&quot;Invalid image URL : should start with http and finish with a image extension&quot;,attachment:function(){var c=new RegExp(&quot;^/.*$&quot;);var b=new RegExp(&quot;^.*//.*$&quot;);var a=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`{}|~]+.*$&quot;);return function(d){return(c.test(d)&amp;&amp;!b.test(d)&amp;&amp;!a.test(d))}}(),attachmentText:&quot;invalid Attachment : should not contain ! \&quot; # $ % &amp; ' ( ) * + , : ; &lt; = &gt; ? @  ` { } | ~ ] + . * and must begin with /&quot;,nameWithoutSpace:function(){var a=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`{}|~ ]+.*$&quot;);return function(b){return !a.test(b)}}(),nameWithoutSpaceText:i18n.get(&quot;label.invalidCaracters&quot;),withoutSpace:function(){var a=new RegExp(&quot;^.*[ ]+.*$&quot;);return function(b){return !a.test(b)}}(),withoutSpaceText:i18n.get(&quot;label.invalidCaracters&quot;),uri:function(){var b=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?/;var a=new RegExp(&quot;^.*[ ]+$&quot;);return function(c){return b.test(c)&amp;&amp;!a.test(c)}}(),uriText:&quot;The format of the URL is invalid, should start with http, ftp or https and finish without space&quot;});Ext.override(Ext.grid.GridPanel,{stripeRows:true});Ext.override(Ext.ux.Spinner,{spin:function(d,b){var a=parseFloat(this.field.getValue());var c=(b===true)?this.alternateIncrementValue:this.incrementValue;if(d===true){a-=c}else{a+=c}a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setValue(a)}});Ext.override(Ext.form.Field,{tooltip:null,listeners:{render:function(){Ext.form.Field.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var a={};if(Ext.isString(this.tooltip)){a={html:this.tooltip,width:200,dismissDelay:5000}}else{if(Ext.isObject(this.tooltip)){a=this.tooltip}else{return}}Ext.apply(a,{target:this.el});this.tTip=new Ext.ToolTip(a)}}}});function onClickOption(b){var d=b+&quot;?method=options&amp;media=text/html&quot;;var c=Ext.Ajax.defaultHeaders.Authorization;Ext.Ajax.defaultHeaders.Authorization=&quot;&quot;;var a=Ext.util.Cookies.get(&quot;scheme&quot;);var e=Ext.util.Cookies.get(&quot;hashCode&quot;);Ext.util.Cookies.set(&quot;scheme&quot;,null);Ext.util.Cookies.set(&quot;hashCode&quot;,null);Ext.Ajax.un(&quot;requestexception&quot;,onRequestException,this);Ext.Ajax.request({url:d,headers:{Authorization:&quot;none&quot;},method:&quot;GET&quot;,success:function(g){if(g.status==200){var f=window.open(d)}Ext.Ajax.defaultHeaders.Authorization=c;Ext.util.Cookies.set(&quot;scheme&quot;,a);Ext.util.Cookies.set(&quot;hashCode&quot;,e);Ext.Ajax.on(&quot;requestexception&quot;,onRequestException,this)},callback:function(){Ext.util.Cookies.set(&quot;scheme&quot;,a);Ext.util.Cookies.set(&quot;hashCode&quot;,e);Ext.Ajax.on(&quot;requestexception&quot;,onRequestException,this)},failure:function(f){Ext.Ajax.defaultHeaders.Authorization=c;Ext.util.Cookies.set(&quot;scheme&quot;,a);Ext.util.Cookies.set(&quot;hashCode&quot;,e);if(f.status==403){Ext.Ajax.request({url:b+&quot;?media=text/html&quot;,method:&quot;OPTIONS&quot;,success:function(k){var g=window.open(&quot;&quot;,b);g.document.write(k.responseText);g.document.close()},failure:function(g){},scope:this})}Ext.Ajax.on(&quot;requestexception&quot;,onRequestException,this)},scope:this})}function includeJs(e){if(Ext.isEmpty(e)){return}var d=false;var k=&quot;script&quot;;var c=&quot;src&quot;;var a=document.getElementsByTagName(k);var b;for(var g=a.length;g&gt;0;g--){b=a[g-1];if(b&amp;&amp;b.getAttribute(c)!==null&amp;&amp;b.getAttribute(c).indexOf(e)!=-1){d=true}}if(!d){var f=document.getElementsByTagName(&quot;head&quot;)[0];b=document.createElement(&quot;script&quot;);b.setAttribute(&quot;src&quot;,e);b.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);f.appendChild(b)}}Ext.override(Ext.PagingToolbar,{initComponent:function(){var a=Ext.Toolbar;var c=[this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:&quot;x-tbar-page-first&quot;,disabled:true,handler:this.moveFirst,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:&quot;x-tbar-page-prev&quot;,disabled:true,handler:this.movePrevious,scope:this}),&quot;-&quot;,this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:&quot;x-tbar-page-number&quot;,allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),&quot;-&quot;,this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:&quot;x-tbar-page-next&quot;,disabled:true,handler:this.moveNext,scope:this}),this.last=new a.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:&quot;x-tbar-page-last&quot;,disabled:true,handler:this.moveLast,scope:this}),&quot;-&quot;];var b=this.items||this.buttons||[];if(this.prependButtons){this.items=b.concat(c)}else{this.items=c.concat(b)}delete this.buttons;if(this.displayInfo){this.items.push(&quot;-&gt;&quot;);this.items.push(this.displayItem=new a.TextItem({}))}Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents(&quot;change&quot;,&quot;beforechange&quot;);this.on(&quot;afterlayout&quot;,this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)},onFirstLayout:function(){this.refresh=new Ext.Toolbar.Button({tooltip:i18n.get(&quot;label.refreshText&quot;),overflowText:i18n.get(&quot;label.refreshText&quot;),iconCls:&quot;x-tbar-loading&quot;,handler:this.doRefresh,scope:this});this.insert(10,this.refresh);if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}}});Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on(&quot;beforeshow&quot;,this.onBeforeShow,this);if(this.strict==(Ext.isIE7&amp;&amp;Ext.isStrict)){this.on(&quot;show&quot;,this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.SitoolsDatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:&quot;x-menu-date-item&quot;,id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,[&quot;select&quot;]);this.on(&quot;show&quot;,this.picker.focus,this.picker);this.on(&quot;select&quot;,this.menuHide,this);if(this.handler){this.on(&quot;select&quot;,this.handler,this.scope||this)}}});Ext.override(Ext.form.DateField,{showTime:false,onTriggerClick:function(){if(this.disabled){return}if(Ext.isEmpty(this.menu)){this.menu=new Ext.menu.DateMenu({hideOnClick:false,showTime:this.showTime,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,&quot;tl-bl?&quot;);this.menuEvents(&quot;on&quot;)}});Ext.override(Ext.slider.SingleSlider,{listeners:{afterrender:function(a){a.syncThumb()}},doSnap:function(b){if(!(this.increment&amp;&amp;b)){return b}var d=b,c=this.increment,a=b%c;if(a!==0){d-=a;if(a*2&gt;=c){d+=c}else{if(a*2&lt;-c){d-=c}}}if(Ext.isString(d)){d=parseFloat(d)}return d.constrain(this.minValue,this.maxValue)}});var ID={PANEL:{MENU:&quot;menuPanelId&quot;,TREE:&quot;treePanelId&quot;,MAIN:&quot;mainPanelId&quot;,HELP:&quot;helpPanelId&quot;,DATAVIEW:&quot;dataviewPanelId&quot;},CMP:{TOOLBAR:&quot;toolbarId&quot;,MENU:&quot;menuId&quot;},WIN:{LOGIN:&quot;loginWinId&quot;,HELP:&quot;helpWinId&quot;},BOX:{REG:&quot;regBoxId&quot;,USER:&quot;userBoxId&quot;,GROUP:&quot;groupBoxId&quot;,ROLE:&quot;roleBoxId&quot;,FIREWALL:&quot;firewallBoxId&quot;,PROJECTS:&quot;projectsBoxId&quot;,DATASETS:&quot;datasetsBoxId&quot;,DICTIONARY:&quot;dictionaryBoxId&quot;,TEMPLATE:&quot;templateBoxId&quot;,DATABASE:&quot;databaseBoxId&quot;,FORMS:&quot;formsBoxId&quot;,APPLICATION:&quot;applicationsBoxId&quot;,USERSTORAGE:&quot;userStorageBoxId&quot;,GRAPHS:&quot;graphsBoxId&quot;,CONVERTERS:&quot;convertersBoxId&quot;,RSSPROJECTS:&quot;rssProjectsId&quot;,STORAGES:&quot;storagesBoxId&quot;,PROJECTPLUGIN:&quot;projectPluginBoxId&quot;,UNITS:&quot;unitsBoxId&quot;,DATASETVIEW:&quot;datasetViewBoxId&quot;,PROJECTMODULE:&quot;projectModuleBoxId&quot;,FILEEDITORFTL:&quot;fileEditorFtlBoxId&quot;,FILEEDITORCSS:&quot;fileEditorCssBoxId&quot;,FILEEDITORLICENCE:&quot;fileEditorLicenceBoxId&quot;,COLLECTIONS:&quot;collectionBoxId&quot;,MULTIDS:&quot;multiDsBoxId&quot;,APPLICATIONPLUGIN:&quot;applicationPluginBoxId&quot;},PROP:{DATASETVIEW:&quot;datasetViewPropId&quot;,PROJECTMODULE:&quot;projectModulePropId&quot;,FILEEDITORPROP:&quot;fileEditorBoxId&quot;,MULTIDSPROP:&quot;multiDsPropId&quot;},COMPONENT_SETUP:{DATABASE:&quot;cmpSetupDatabaseId&quot;,PROJECT:&quot;cmpSetupProjectId&quot;,OPENSEARCH:&quot;cmpOpenSearchId&quot;,COLLECTIONS:&quot;cmpCollectionsId&quot;,MULTIDS:&quot;cmpMultiDsId&quot;},ITEM:{OKBUTTON:&quot;okButtonId&quot;,CANCELBUTTON:&quot;cancelButtonId&quot;}};var user=null;var viewport=null;var treePanel=null;var dataViewMenu=null;var seeAlsoMenu=null;var dataViewWin=null;var mainPanel=null;var seeAlsoPanel=null;var helpUrl=null;var componentsPanel=null;function onMenuSelect(a){if(Ext.isEmpty(a.getItemId())){return}if(a.getItemId()==&quot;menu_logout&quot;){utils_logout()}else{Ext.Msg.alert(&quot;Click on Menu: &quot;,a.getItemId())}}function showHelp(a){if(Ext.isEmpty(a)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.noHelpUrl&quot;));return}var b=Ext.getCmp(ID.WIN.HELP);if(!b){var c=new Ext.ux.ManagedIFrame.Panel({id:ID.WIN.HELP,layout:&quot;fit&quot;,defaultSrc:a,defaults:{padding:10}});b=new Ext.Window({title:i18n.get(&quot;label.help&quot;),width:DEFAULT_HELP_WIDTH,autoScroll:true,modal:true,id:&quot;winHelpId&quot;,height:DEFAULT_HELP_HEIGHT,items:[c],buttons:[{text:&quot;close&quot;,handler:function(){this.ownerCt.ownerCt.close()}}],listeners:{resize:function(f,e,d){this.findById(ID.WIN.HELP).setHeight(d-65)}}});b.show();b.doLayout(false,true);c.setHeight(b.getHeight()-65)}else{b.show()}}var clientAdmin={initDatasetViews:function(a){Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_VIEWS_URL&quot;),params:{sort:&quot;priority&quot;,dir:&quot;DESC&quot;},method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{var d=c.data;Ext.each(d,function(e){includeJs(e.fileUrl)})}},callback:function(){a.call(this)}})},initGui:function(){var a={xtype:&quot;tbbutton&quot;,text:i18n.get(&quot;label.logout&quot;),itemId:&quot;menu_logout&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/logout.png&quot;,handler:function(){utils_logout()}};var e={xtype:&quot;toolbar&quot;,id:ID.CMP.TOOLBAR,items:[{xtype:&quot;label&quot;,html:&quot;&lt;img src=res/images/cnes.png width=92 height=28&gt;&quot;},{xtype:&quot;label&quot;,text:i18n.get(&quot;label.title&quot;)},&quot;-&gt;&quot;,{xtype:&quot;label&quot;,text:i18n.get(&quot;label.welcome&quot;)+&quot; &quot;+Ext.util.Cookies.get(&quot;userLogin&quot;)},&quot;-&quot;,{text:&quot;Version&quot;,id:&quot;versionButtonId&quot;,handler:function(){showVersion()},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/version.png&quot;},&quot;-&quot;,{text:&quot;Show Help&quot;,enableToggle:true,toggleHandler:function(l,k){var g=Ext.getCmp(ID.PANEL.HELP);if(!k){g.toggleCollapse(false);SHOW_HELP=false}else{g.toggleCollapse(true);SHOW_HELP=true}},pressed:true,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/help.png&quot;},&quot;-&quot;,{text:&quot;Advanced Mode&quot;,id:&quot;switchModeId&quot;,enableToggle:true,pressed:true,toggleHandler:function(m,l){var k=Ext.getCmp(ID.PANEL.MAIN);var g=Ext.getCmp(ID.PANEL.TREE);if(l){g.show();k.getTopToolbar().hide();k.doLayout();dataViewWin.hide()}else{g.hide();if(Ext.isEmpty(dataViewWin)){seeAlsoMenu=new sitools.admin.menu.seeAlso();seeAlsoPanel=new Ext.Panel({id:&quot;seeAlsoId&quot;,flex:1,autoScroll:true,width:265,html:'&lt;div class=&quot;title-seeAlso&quot;&gt;&lt;/div&gt;',cls:&quot;background-seeAlso&quot;,height:Ext.getBody().getSize().height-110,items:[seeAlsoMenu]});seeAlsoMenu.getStore().loadData({links:[]});dataViewMenu=new sitools.admin.menu.dataView();var p=new Ext.Panel({id:&quot;panDataview&quot;,flex:2,items:[dataViewMenu],listeners:{resize:function(q){var s=q.body.getSize();dataViewMenu.setSize({height:s.height-5,width:s.width-5});seeAlsoPanel.setSize(q.body.getSize())}}});dataViewWin=new Ext.Window({border:false,id:ID.PANEL.DATAVIEW,layout:&quot;hbox&quot;,resizable:false,layoutConfig:{align:&quot;stretch&quot;,pack:&quot;start&quot;},closable:false,draggable:false,items:[seeAlsoPanel,p],height:Ext.getBody().getSize().height-82,width:Ext.getBody().getSize().width,y:82,allButtons:[],tbar:{cls:&quot;root-toolbar&quot;,id:&quot;idToolbarView&quot;}})}dataViewWin.show();k.getTopToolbar().show();var n=dataViewWin.getEl();n.fadeIn({endOpacity:0.95,easing:&quot;easeOut&quot;,duration:0.5})}viewport.doLayout()}},a]};var c=new Ext.Panel({id:ID.PANEL.MENU,region:&quot;north&quot;,layout:&quot;fit&quot;,height:28,items:[e]});treePanel=new Ext.Panel({id:ID.PANEL.TREE,region:&quot;west&quot;,title:i18n.get(&quot;label.menu&quot;),split:true,autoScroll:true,width:250,layout:&quot;fit&quot;,defaults:{padding:10}});var d=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,title:i18n.get(&quot;label.help&quot;),split:true,collapsible:true,autoScroll:true,layout:&quot;fit&quot;,defaults:{padding:10}});var b=new sitools.admin.menu.dataView();mainPanel=new Ext.Panel({layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;,pack:&quot;start&quot;},xtype:&quot;panel&quot;,id:ID.PANEL.MAIN,tbar:{cls:&quot;root-toolbar&quot;,id:&quot;idConfig&quot;},title:i18n.get(&quot;label.main&quot;),items:[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,height:1200,autoLoad:&quot;res/html/&quot;+LOCALE+&quot;/welcome.html&quot;}],region:&quot;center&quot;});viewport=new Ext.Viewport({layout:&quot;border&quot;,items:[c,treePanel,mainPanel],listeners:{scope:this,resize:function(){if(dataViewWin){dataViewWin.setSize({height:Ext.getBody().getSize().height-87,width:Ext.getBody().getSize().width-5});dataViewWin.setPosition(0,82);dataViewWin.doLayout()}}}});var f=new sitools.admin.menu.TreeMenu(&quot;res/json/menu.json&quot;);treePanel.add(f);treePanel.doLayout()}};function initAppli(){Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_FORMCOMPONENTS_URL&quot;),params:{sort:&quot;priority&quot;,dir:&quot;DESC&quot;},method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{var c=b.data;Ext.each(c,function(d){includeJs(d.fileUrlAdmin);includeJs(d.fileUrlUser)})}},callback:function(){sql2ext.load(loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-user/conf/sql2ext.properties&quot;);var a=function(){clientAdmin.initGui()};clientAdmin.initDatasetViews(a)}})}function getI(a){return a.getId()}function getCmp(a){return Ext.getCmp(a)}function getMenu(){return Ext.getCmp(ID.CMP.MENU)}function getMenuRoot(){return getMenu().getRootNode()}function getMenuNode(a){return getMenu().getNodeById(a)}Ext.namespace(&quot;sitools.admin.menu&quot;);sitools.admin.menu.dataView=Ext.extend(Ext.DataView,{id:&quot;nodes&quot;,itemSelector:&quot;div.nodes&quot;,overClass:&quot;nodes-hover&quot;,singleSelect:true,multiSelect:false,autoScroll:true,initComponent:function(){var a=new Ext.XTemplate('&lt;div id=&quot;adminMenu&quot;&gt;','&lt;div class=&quot;title&quot;&gt;Choose a Task...&lt;/div&gt;','&lt;div class=&quot;float columns&quot;&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;tpl if=&quot;(this.round(xcount /2) - xindex) &lt; 0&quot;&gt;&lt;/div&gt;',&quot;&lt;div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,'&lt;div id=&quot;{nodeName}&quot; class=&quot;nodes&quot;&gt;','&lt;img class=&quot;float&quot;','&lt;tpl if=&quot;this.isNotEmpty(children)&quot;&gt;','ext:qtip=&quot;','&lt;tpl for=&quot;children&quot;&gt;',&quot;{textChildren}&lt;br&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,'&quot; ',&quot;&lt;/tpl&gt;&quot;,'width=&quot;96&quot; height=&quot;96&quot; src=&quot;','&lt;tpl if=&quot;this.isNotEmpty(iconMenu)&quot;&gt;',&quot;{iconMenu}&quot;,&quot;&lt;/tpl&gt;&quot;,'&lt;tpl if=&quot;this.isEmpty(iconMenu)&quot;&gt;',&quot;/sitools/common/res/images/icons/menu/collections.png&quot;,&quot;&lt;/tpl&gt;&quot;,'&quot; /&gt;',&quot;&lt;span&gt;{name}&lt;/span&gt;&quot;,&quot;&lt;/div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/div&gt;&quot;,'&lt;img class=&quot;icon-sitools&quot; src=&quot;/sitools/common/res/images/icons/menu/logoSitools.png&quot; /&gt;',&quot;&lt;/div&gt;&quot;,{compiled:true,isNotEmpty:function(b){return !Ext.isEmpty(b)},isEmpty:function(b){return Ext.isEmpty(b)},round:function(b){return Math.round(b)}});this.tpl=a;this.height=Ext.getBody().getSize().height-100;this.listeners={dblclick:function(b,d,c,f){var k=c.id;var g=c.childNodes[1].textContent;this.openSubCategory(b,g,f,k)},click:function(b,d,c,f){var g=dataViewMenu.getStore().getAt(d);seeAlsoMenu.getStore().loadData(g.data)},afterrender:function(b){Ext.Ajax.request({url:&quot;res/json/menu.json&quot;,method:&quot;GET&quot;,success:function(c){b.allData=Ext.decode(c.responseText);mainPanel.toolbars[0].addText(&quot;Path : / Menu&quot;);mainPanel.toolbars[0].addSeparator();b.openSubCategory(b,&quot;root&quot;)},failure:function(){Ext.Msg.alert(&quot;Error&quot;,&quot;Cannot load nodes from menu.json&quot;)},scope:b})}};this.store=new Ext.data.JsonStore({root:&quot;&quot;,restful:true,remoteSort:false,fields:[{name:&quot;name&quot;,mapping:&quot;text&quot;},{name:&quot;nodeName&quot;},{name:&quot;id&quot;},{name:&quot;parentNode&quot;},{name:&quot;children&quot;},{name:&quot;iconMenu&quot;},{name:&quot;category&quot;},{name:&quot;links&quot;},{name:&quot;label&quot;},{name:&quot;path&quot;}]});this.allButtons=[];sitools.admin.menu.dataView.superclass.initComponent.call(this)},openSubCategory:function(c,f,d,g){var a=this.populateStore(c,f);if(a){var b={xtype:&quot;button&quot;,overCls:&quot;nodes-hover&quot;,labelStyle:&quot;font-weight:bold !important;&quot;,text:f,id:f+&quot;Id&quot;,nodeName:g,scope:c,handler:function(k,m){this.populateStore(this,k.getText());this.deleteItemsFromToolbar(mainPanel.toolbars[0],k.getText());dataViewWin.show();mainPanel.getTopToolbar().show();var l=dataViewWin.getEl();l.fadeIn({endOpacity:0.95,easing:&quot;easeOut&quot;,duration:0.5})}};this.allButtons.push(b);mainPanel.toolbars[0].addButton(b);mainPanel.toolbars[0].add([&quot;-&quot;]);mainPanel.doLayout()}else{this.treeAction(f,g)}},deleteItemsFromToolbar:function(d,e){var c=[];var b=d.items.items[0].text;d.removeAll();d.addText(b);d.addSeparator();for(var a=0;a&lt;this.allButtons.length;a++){d.addButton(this.allButtons[a]);d.addSeparator();c[a]=this.allButtons[a];if(this.allButtons[a].text==e){break}}this.allButtons=c;mainPanel.doLayout()},populateStore:function(b,c){var a=b.getChildrenByParentNode(b.allData,c);if(!Ext.isEmpty(a)){b.store.removeAll();Ext.each(a,function(d){d.text=i18n.get(&quot;label.&quot;+d.nodeName);Ext.each(d.children,function(e){e.textChildren=i18n.get(&quot;label.&quot;+e.nodeName)})});b.store.loadData(a);return true}else{return false}},getChildrenByParentNode:function(d,a){if(Ext.isEmpty(d)){return null}if(a==&quot;root&quot;){return d}else{for(var c=0;c&lt;d.length;c++){if(d[c].text==a){return d[c].children}else{var b=this.getChildrenByParentNode(d[c].children,a);if(!Ext.isEmpty(b)){return b}}}}},treeAction:function(e,f){var d=e+&quot;id&quot;;if(!Ext.isDefined(f)){Ext.Msg.alert(&quot;warning&quot;,&quot;Undefined&quot;);return}var c=this.getSelectedRecords()[0];if(!Ext.ComponentMgr.isRegistered(&quot;s-&quot;+f)){Ext.Msg.alert(&quot;warning&quot;,&quot;label.component 's-&quot;+f+&quot;' msg.undefined&quot;);return}var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:&quot;100%&quot;,items:[{xtype:&quot;s-box&quot;,label:i18n.get(&quot;label.&quot;+f),items:[{xtype:&quot;s-&quot;+f,sitoolsType:&quot;mainAdminPanel&quot;}],idItem:c.get(&quot;id&quot;)}],listeners:{resize:function(k,m,g){var l=k.items.items[0].body.getSize();var n=k.items.items[0].items.items[0].getEl();l={height:l.height-(n.getHeight()+n.getMargins(&quot;t&quot;)+n.getMargins(&quot;b&quot;)),width:l.width-8};var p=k.find(&quot;sitoolsType&quot;,&quot;mainAdminPanel&quot;);p[0].setSize(l)}}});var b=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,width:&quot;100%&quot;,flex:1,defaultSrc:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+f+&quot;.html&quot;,defaults:{padding:10}});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+f+&quot;.html&quot;;mainPanel.getTopToolbar().show();dataViewWin.hide()}});Ext.namespace(&quot;sitools.admin.menu&quot;);sitools.admin.menu.seeAlso=Ext.extend(Ext.DataView,{id:&quot;links&quot;,itemSelector:&quot;div.links&quot;,overClass:&quot;links-hover&quot;,singleSelect:true,multiSelect:false,autoScroll:false,initComponent:function(){var a=new Ext.XTemplate('&lt;div class=&quot;title-seeAlso&quot;&gt;See Also...&lt;/div&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;tpl if=&quot;this.isNotEmpty(links)&quot;&gt;','&lt;tpl for=&quot;links&quot;&gt;','&lt;div id=&quot;{nodeName}&quot; name=&quot;{text}&quot; class=&quot;links&quot;&gt;','&lt;img class=&quot;icon-seeAlso&quot; width=&quot;16&quot; height=&quot;16&quot; src=&quot;{iconMenu}&quot; /&gt;','&lt;span id=&quot;{nodeName}&quot;&gt;{label}&lt;/span&gt;',&quot;&lt;/div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,{compiled:true,isNotEmpty:function(b){return !Ext.isEmpty(b)},isEmpty:function(b){return Ext.isEmpty(b)}});this.tpl=a;this.height=Ext.getBody().getSize().height-220;this.listeners={click:function(b,d,c,g){var m=c.id;var l=c.attributes[1].textContent;var k=seeAlsoMenu.getStore().getAt(0);var f=this.getPath(k,l);this.openSubCategory(b,l,g,m,f)}};this.store=new Ext.data.JsonStore({root:&quot;&quot;,restful:true,remoteSort:false,fields:[{name:&quot;nodeName&quot;},{name:&quot;id&quot;},{name:&quot;parentNode&quot;},{name:&quot;children&quot;},{name:&quot;iconMenu&quot;},{name:&quot;category&quot;},{name:&quot;links&quot;},{name:&quot;label&quot;},{name:&quot;path&quot;}]});this.allButtons=[];sitools.admin.menu.seeAlso.superclass.initComponent.call(this)},getPath:function(e,d){var c=new RegExp(&quot;/&quot;);for(var b=0;b&lt;e.data.links.length;b++){if(e.data.links[b].text==d){var a=e.data.links[b].path.split(c);return a}}},openSubCategory:function(m,g,d,f,n){dataViewMenu.allButtons=[];var a=this.populateStore(m,g);var k=mainPanel.toolbars[0];var l=k.items.items[0].text;k.removeAll();k.addText(l);k.addSeparator();this.addRootButton();for(var b=0;b&lt;n.length;b++){var c={xtype:&quot;button&quot;,text:n[b],id:n[b]+&quot;Id&quot;,scope:m,path:n,handler:function(p,s){this.populateStore(this,p.getText());dataViewMenu.deleteItemsFromToolbar(mainPanel.toolbars[0],p.getText(),n);dataViewWin.show();mainPanel.getTopToolbar().show();var q=dataViewWin.getEl();q.fadeIn({endOpacity:0.95,easing:&quot;easeOut&quot;,duration:0.5})}};this.addButton(c,k)}mainPanel.doLayout();if(!a){this.treeAction(g,f)}},addButton:function(a,b){b.add(a);b.addSeparator();dataViewMenu.allButtons.push(a)},addRootButton:function(){var a={xtype:&quot;button&quot;,text:&quot;root&quot;,id:&quot;rootId&quot;,scope:this,handler:function(b,d){this.populateStore(this,b.getText());dataViewMenu.deleteItemsFromToolbar(mainPanel.toolbars[0],b.getText());dataViewWin.show();mainPanel.getTopToolbar().show();var c=dataViewWin.getEl();c.fadeIn({endOpacity:0.95,easing:&quot;easeOut&quot;,duration:0.5})}};this.addButton(a,mainPanel.toolbars[0]);mainPanel.doLayout()},populateStore:function(b,c){var a=b.getChildrenByParentNode(dataViewMenu.allData,c);if(!Ext.isEmpty(a)){b.store.removeAll();dataViewMenu.store.removeAll();dataViewMenu.store.loadData(a);return true}else{return false}},getChildrenByParentNode:function(d,a){if(Ext.isEmpty(d)){return null}if(a==&quot;root&quot;){return d}else{for(var c=0;c&lt;d.length;c++){if(d[c].text==a){return d[c].children}else{var b=this.getChildrenByParentNode(d[c].children,a);if(!Ext.isEmpty(b)){return b}}}}},treeAction:function(e,f){var d=e+&quot;id&quot;;if(!Ext.isDefined(f)){Ext.Msg.alert(&quot;warning&quot;,&quot;Undefined&quot;);return}var c=this.getSelectedRecords()[0];if(!Ext.ComponentMgr.isRegistered(&quot;s-&quot;+f)){Ext.Msg.alert(&quot;warning&quot;,&quot;label.component 's-&quot;+f+&quot;' msg.undefined&quot;);return}var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:&quot;100%&quot;,items:[{xtype:&quot;s-box&quot;,label:i18n.get(&quot;label.&quot;+f),items:[{xtype:&quot;s-&quot;+f,sitoolsType:&quot;mainAdminPanel&quot;}],idItem:d}],listeners:{resize:function(k,m,g){var l=k.items.items[0].body.getSize();var n=k.items.items[0].items.items[0].getEl();l={height:l.height-(n.getHeight()+n.getMargins(&quot;t&quot;)+n.getMargins(&quot;b&quot;)),width:l.width-8};var p=k.find(&quot;sitoolsType&quot;,&quot;mainAdminPanel&quot;);p[0].setSize(l)}}});var b=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,width:&quot;100%&quot;,flex:1,defaultSrc:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+f+&quot;.html&quot;,defaults:{padding:10}});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+f+&quot;.html&quot;;mainPanel.getTopToolbar().show();dataViewWin.hide()}});Ext.namespace(&quot;sitools.admin.menu&quot;);sitools.admin.menu.TreeMenu=Ext.extend(Object,{constructor:function(b){var a=new Ext.tree.TreePanel({id:ID.CMP.MENU,component:this,useArrows:false,autoScroll:true,animate:true,root:{nodeType:&quot;async&quot;},loader:new Ext.tree.TreeLoader({requestMethod:&quot;GET&quot;,url:b}),rootVisible:false,listeners:{beforeload:function(c){c.setText(i18n.get(&quot;label.&quot;+c.attributes.nodeName));return c.isRoot||Ext.isDefined(c.attributes.children)},load:function(c){c.eachChild(function(d){d.setText(i18n.get(&quot;label.&quot;+d.attributes.nodeName));return true})},click:function(c){if(c.isLeaf()){this.component.treeAction(c)}}}});a.getRootNode().expand(true);return a},treeAction:function(c){var e=c.attributes.nodeName;var d=c.attributes.id;if(!Ext.isDefined(e)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;msg.nodeundefined&quot;));return}if(!Ext.ComponentMgr.isRegistered(&quot;s-&quot;+e)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.component&quot;)+&quot; 's-&quot;+e+&quot;' &quot;+i18n.get(&quot;msg.undefined&quot;));return}ann(mainPanel,&quot;mainPanel is null&quot;);var a=new sitools.admin.menu.dataView();mainPanel.removeAll();mainPanel.add({width:&quot;100%&quot;,items:[{xtype:&quot;s-box&quot;,label:i18n.get(&quot;label.&quot;+e),items:[{xtype:&quot;s-&quot;+e,sitoolsType:&quot;mainAdminPanel&quot;}],idItem:d}],listeners:{resize:function(g,l,f){var k=g.items.items[0].body.getSize();var m=g.items.items[0].items.items[0].getEl();k={height:k.height-(m.getHeight()+m.getMargins(&quot;t&quot;)+m.getMargins(&quot;b&quot;)),width:k.width-8};var n=g.find(&quot;sitoolsType&quot;,&quot;mainAdminPanel&quot;);n[0].setSize(k)}}});var b=new Ext.ux.ManagedIFrame.Panel({id:ID.PANEL.HELP,width:&quot;100%&quot;,flex:1,defaultSrc:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+e+&quot;.html&quot;,defaults:{padding:10}});mainPanel.add(b);mainPanel.doLayout();b.setVisible(SHOW_HELP);helpUrl=loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/&quot;+e+&quot;.html&quot;}});Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.RegCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.REG,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_INSCRIPTIONS_ADMIN_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;identifier&quot;,type:&quot;string&quot;},{name:&quot;firstName&quot;,type:&quot;string&quot;},{name:&quot;lastName&quot;,type:&quot;string&quot;},{name:&quot;email&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.login&quot;),dataIndex:&quot;identifier&quot;,width:100},{header:i18n.get(&quot;label.firstName&quot;),dataIndex:&quot;firstName&quot;,width:100},{header:i18n.get(&quot;label.lastName&quot;),dataIndex:&quot;lastName&quot;,width:100},{header:i18n.get(&quot;label.email&quot;),dataIndex:&quot;email&quot;,width:100}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.validate&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_validate.png&quot;,handler:this.onValidate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.RegCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RegCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onValidate:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;PUT&quot;,scope:this,success:function(b){this.store.reload()},failure:alertFailure})},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.RegPropPanel({url:this.url+&quot;/&quot;+b.id,store:this.store});a.show(ID.BOX.REG)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;userCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}this.store.reload();var d=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(b.message),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg(&quot;s-regcrud&quot;,sitools.admin.usergroups.RegCrudPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.UserCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.USER,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/users&quot;;this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,url:this.url,idProperty:&quot;identifier&quot;,remoteSort:true,fields:[{name:&quot;identifier&quot;,type:&quot;string&quot;},{name:&quot;firstName&quot;,type:&quot;string&quot;},{name:&quot;lastName&quot;,type:&quot;string&quot;},{name:&quot;email&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.login&quot;),dataIndex:&quot;identifier&quot;,width:100},{header:i18n.get(&quot;label.firstName&quot;),dataIndex:&quot;firstName&quot;,width:100},{header:i18n.get(&quot;label.lastName&quot;),dataIndex:&quot;lastName&quot;,width:250},{header:i18n.get(&quot;label.email&quot;),dataIndex:&quot;email&quot;,width:200}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this._onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.usergroups.UserCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.UserCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.usergroups.UserPropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.USER)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.UserPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore()});a.show(ID.BOX.USER)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;userCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}this.store.reload();var d=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(b.message),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg(&quot;s-usercrud&quot;,sitools.admin.usergroups.UserCrudPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.GroupCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/groups&quot;;this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:200},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.users&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_userman.png&quot;,handler:this.onMembers,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.GroupCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.GroupCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.usergroups.GroupPropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.GROUP)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.GroupPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore()});a.show(ID.BOX.GROUP)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;msg.group.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onMembers:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.UsersPanel({mode:&quot;list&quot;,url:this.url+&quot;/&quot;+b.id+&quot;/users&quot;,data:b.data});a.show(ID.BOX.GROUP)}});Ext.reg(&quot;s-groupcrud&quot;,sitools.admin.usergroups.GroupCrudPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.RoleCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.ROLE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ROLES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:200},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.users&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_userman.png&quot;,handler:this.onUsers,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.groups&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_groupman.png&quot;,handler:this.onGroups,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.usergroups.RoleCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RoleCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.usergroups.RolePropPanel({url:this.url,action:&quot;create&quot;,store:this.store});a.show(ID.BOX.ROLE)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.RolePropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.store});a.show(ID.BOX.ROLE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;roleCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onUsers:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.UsersPanel({mode:&quot;list&quot;,url:this.url+&quot;/&quot;+b.id+&quot;/users&quot;,data:b.data});a.show(ID.BOX.ROLE)},onGroups:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.GroupsPanel({mode:&quot;list&quot;,url:this.url+&quot;/&quot;+b.id+&quot;/groups&quot;,data:b.data});a.show(ID.BOX.ROLE)}});Ext.reg(&quot;s-rolecrud&quot;,sitools.admin.usergroups.RoleCrudPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.RolePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,initComponent:function(){if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyRole&quot;)}else{this.title=i18n.get(&quot;label.createRole&quot;)}this.items=[{xtype:&quot;panel&quot;,height:450,title:i18n.get(&quot;label.roleInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;,fieldLabel:i18n.get(&quot;label.id&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,growMax:400}]}],buttons:[{id:ID.ITEM.OKBUTTON,text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onModify},{id:ID.ITEM.CANCELBUTTON,text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.RolePropPanel.superclass.initComponent.call(this)},onModify:function(){var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:a.getValues(),success:function(c){var b=Ext.decode(c.responseText);if(b.success){this.store.reload();this.close()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message)}},failure:alertFailure})}else{Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,jsonData:a.getValues(),failure:alertFailure,success:function(c){var b=Ext.decode(c.responseText);if(b.success){this.store.reload();this.close()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message)}}})}},onRender:function(){sitools.admin.usergroups.RolePropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType(&quot;form&quot;)[0].getForm();if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);if(c.success){a.setValues(c.role)}else{this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.message);return}},failure:alertFailure})}}}});Ext.reg(&quot;s-roleprop&quot;,sitools.admin.usergroups.RolePropPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.RegPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,storePanel:null,initComponent:function(){this.storePanel=this.store;this.title=i18n.get(&quot;label.modifyRegister&quot;);var d=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;scope&quot;,type:&quot;string&quot;}],autoLoad:false});var c=[[&quot;Editable&quot;],[&quot;ReadOnly&quot;],[&quot;Hidden&quot;]];var e=new Ext.data.ArrayStore({fields:[&quot;scope&quot;],data:c});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;headers.value&quot;),dataIndex:&quot;value&quot;,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;headers.scope&quot;),dataIndex:&quot;scope&quot;,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:&quot;all&quot;,lazyRender:true,lazyInit:false,mode:&quot;local&quot;,forceSelection:true,valueField:&quot;scope&quot;,displayField:&quot;scope&quot;,store:e})}],defaults:{sortable:false,width:100}});var f=new Ext.Toolbar({defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateProperties},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteProperties}]});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get(&quot;title.properties&quot;),id:&quot;userGridProperties&quot;,height:180,store:d,tbar:f,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:&quot;panel&quot;,height:450,items:[{xtype:&quot;panel&quot;,title:i18n.get(&quot;label.userInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;id&quot;,hidden:true},{xtype:&quot;textfield&quot;,name:&quot;identifier&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,name:&quot;firstName&quot;,fieldLabel:i18n.get(&quot;label.firstName&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,name:&quot;lastName&quot;,fieldLabel:i18n.get(&quot;label.lastName&quot;),anchor:&quot;100%&quot;,growMax:400},{xtype:&quot;textfield&quot;,name:&quot;email&quot;,fieldLabel:i18n.get(&quot;label.email&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,name:&quot;password&quot;,id:&quot;regPassword&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.confirmPassword&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,name:&quot;confirmPassword&quot;,submitValue:false,initialPassField:&quot;regPassword&quot;,vtype:&quot;password&quot;}]}]},this.gridProperties],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onModify},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.RegPropPanel.superclass.initComponent.call(this)},onCreateProperties:function(){var a=new Ext.data.Record();this.gridProperties.getStore().insert(this.gridProperties.getStore().getCount(),a)},onDeleteProperties:function(){var b=this.gridProperties.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridProperties.getStore().remove(c)}},onModify:function(){var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var b=a.getValues();b.properties=[];this.gridProperties.getStore().each(function(c){b.properties.push({name:c.data.name,value:c.data.value,scope:c.data.scope})});Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(!d.success){alertFailure(c);this.storePanel.reload();return}this.close();this.storePanel.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.RegPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);c.inscription.password=&quot;&quot;;a.setValues(c.inscription);if(!Ext.isEmpty(c.inscription.properties)){Ext.each(c.inscription.properties,function(d){var e=new Ext.data.Record({name:d.name,value:d.value,scope:d.scope});this.gridProperties.getStore().add(e)},this)}},failure:alertFailure})}}});Ext.reg(&quot;s-regprop&quot;,sitools.admin.usergroups.RegPropPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.UserPropPanel=Ext.extend(Ext.Window,{id:&quot;winCreateUser&quot;,width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createUser&quot;)}else{this.title=i18n.get(&quot;label.modifyUser&quot;)}var d=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;scope&quot;,type:&quot;string&quot;}],autoLoad:false});var c=[[&quot;Editable&quot;],[&quot;ReadOnly&quot;],[&quot;Hidden&quot;]];var e=new Ext.data.ArrayStore({fields:[&quot;scope&quot;],data:c});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;headers.value&quot;),dataIndex:&quot;value&quot;,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;headers.scope&quot;),dataIndex:&quot;scope&quot;,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:&quot;all&quot;,lazyRender:true,lazyInit:false,mode:&quot;local&quot;,forceSelection:true,valueField:&quot;scope&quot;,displayField:&quot;scope&quot;,store:e})}],defaults:{sortable:false,width:100}});var f=new Ext.Toolbar({defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateProperties},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteProperties}]});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get(&quot;title.properties&quot;),id:&quot;userGridProperties&quot;,height:180,store:d,tbar:f,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:&quot;panel&quot;,height:450,title:i18n.get(&quot;label.userInfo&quot;),items:[{xtype:&quot;form&quot;,id:&quot;formCreateUser&quot;,border:false,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;firstName&quot;,fieldLabel:i18n.get(&quot;label.firstName&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;lastName&quot;,fieldLabel:i18n.get(&quot;label.lastName&quot;),anchor:&quot;100%&quot;,growMax:400,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;email&quot;,fieldLabel:i18n.get(&quot;label.email&quot;),vtype:&quot;uniqueemail&quot;,allowBlank:false,validationEvent:&quot;&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,name:&quot;identifier&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),anchor:&quot;100%&quot;,allowBlank:false,disabled:this.action==&quot;create&quot;?false:true,vtype:&quot;name&quot;,id:&quot;nameField&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,name:&quot;secret&quot;,value:&quot;&quot;,id:&quot;passwordField&quot;,vtype:&quot;passwordlength&quot;},{id:&quot;confirmSecret&quot;,xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.confirmPassword&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,initialPassField:&quot;passwordField&quot;,vtype:&quot;password&quot;,name:&quot;confirmSecret&quot;,submitValue:false,value:&quot;&quot;},{xtype:&quot;button&quot;,name:&quot;generate&quot;,id:&quot;generatePass&quot;,text:i18n.get(&quot;label.generatePassword&quot;),anchor:&quot;9%&quot;,handler:this.generatePassword}]},this.gridProperties],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onModifyOrCreate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.UserPropPanel.superclass.initComponent.call(this)},onCreateProperties:function(){var a=new Ext.data.Record();this.gridProperties.getStore().insert(this.gridProperties.getStore().getCount(),a)},onDeleteProperties:function(){var b=this.gridProperties.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridProperties.getStore().remove(c)}},onModifyOrCreate:function(){var c=(this.action==&quot;create&quot;)?&quot;POST&quot;:&quot;PUT&quot;;var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var b=a.getValues();b.properties=[];this.gridProperties.getStore().each(function(d){b.properties.push({name:d.data.name,value:d.data.value,scope:d.data.scope})});Ext.Ajax.request({url:this.url,method:c,scope:this,jsonData:b,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),e.message);return false}this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.UserPropPanel.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(a){var c=this.findByType(&quot;form&quot;)[0].getForm();var b=Ext.decode(a.responseText);if(b.user!==undefined){c.setValues(b.user);c.findField(&quot;identifier&quot;).setValue(b.user.identifier);if(!Ext.isEmpty(b.user.properties)){Ext.each(b.user.properties,function(d){var e=new Ext.data.Record({name:d.name,value:d.value,scope:d.scope});this.gridProperties.getStore().add(e)},this)}}},failure:alertFailure})}},generatePassword:function(){var d=&quot;!0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz&quot;;var g=6;var c=&quot;&quot;;for(var b=0;b&lt;g;b++){var a=Math.floor(Math.random()*d.length);c+=d.substring(a,a+1)}var e=Ext.getCmp(&quot;formCreateUser&quot;).getForm();e.findField(&quot;secret&quot;).setValue(c);e.findField(&quot;confirmSecret&quot;).setValue(c)}});Ext.reg(&quot;s-userprop&quot;,sitools.admin.usergroups.UserPropPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.GroupPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createGroup&quot;)}else{this.title=i18n.get(&quot;label.modifyGroup&quot;)}this.items=[{xtype:&quot;panel&quot;,height:450,title:i18n.get(&quot;label.groupInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,disabled:this.action!=&quot;create&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,growMax:400}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onModifyOrCreate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.usergroups.GroupPropPanel.superclass.initComponent.call(this)},onModifyOrCreate:function(){var a={};var b=this.findByType(&quot;form&quot;)[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}Ext.iterate(b.getFieldValues(),function(d,e){a[d]=e});var c=(this.action===&quot;create&quot;)?&quot;POST&quot;:&quot;PUT&quot;;if(!b.isValid()){Ext.Msg.alert(i18n.get(&quot;warning.invalidForm&quot;));return}Ext.Ajax.request({url:this.url,method:c,scope:this,jsonData:a,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(e.message));return false}this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.admin.usergroups.GroupPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,success:function(b){var c=Ext.decode(b.responseText);if(c.group!==undefined){a.setValues(c.group)}},failure:alertFailure})}}});Ext.reg(&quot;s-groupprop&quot;,sitools.admin.usergroups.GroupPropPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.UsersPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,idProperty:&quot;identifier&quot;,url:this.url,fields:[{name:&quot;identifier&quot;,type:&quot;string&quot;},{name:&quot;firstName&quot;,type:&quot;string&quot;},{name:&quot;lastName&quot;,type:&quot;string&quot;}]});this.grid=new Ext.grid.GridPanel({xtype:&quot;grid&quot;,sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.login&quot;),dataIndex:&quot;identifier&quot;},{header:i18n.get(&quot;label.firstName&quot;),dataIndex:&quot;firstName&quot;},{header:i18n.get(&quot;label.lastName&quot;),dataIndex:&quot;lastName&quot;}],bbar:{xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)}});this.items=[{xtype:&quot;panel&quot;,title:this.mode==&quot;list&quot;?i18n.get(&quot;label.members&quot;):i18n.get(&quot;label.selectUsers&quot;),items:[this.grid],tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this,hidden:true},items:[{text:i18n.get(&quot;label.add&quot;),hidden:(this.mode==&quot;select&quot;||this.mode==&quot;selectUnique&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate},{text:i18n.get(&quot;label.remove&quot;),hidden:(this.mode==&quot;select&quot;||this.mode==&quot;selectUnique&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,hidden:this.mode==&quot;list&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.ok&quot;),handler:this._onAdd,hidden:this.mode==&quot;list&quot;},{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK,hidden:(this.mode==&quot;select&quot;||this.mode==&quot;selectUnique&quot;)},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]}}];sitools.admin.usergroups.UsersPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.UsersPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.loadError&quot;))}}})},_onCreate:function(){var a=new sitools.admin.usergroups.UsersPanel({mode:&quot;select&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/users?media=json&quot;,storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.store.remove(a)},_onAdd:function(){if(this.mode==&quot;select&quot;){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(d){b.push(new this.store.recordType({identifier:d.data.identifier,firstName:d.data.firstName,lastName:d.data.lastName}))});this.storeref.add(b)}if(this.mode==&quot;selectUnique&quot;){var c=this.grid.getSelectionModel().getSelected();this.displayField.setValue(c.data.firstName+&quot; &quot;+c.data.lastName);this.valueField.setValue(c.data.identifier)}this.close()},_onOK:function(){var a=this.data;a.users=[];this.store.each(function(b){var c={id:b.data.identifier};a.users.push(c)});Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:a,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(c.message));return false}this.close();this.store.reload()},failure:alertFailure})},_onCancel:function(){this.destroy()}});Ext.reg(&quot;s-users&quot;,sitools.admin.usergroups.UsersPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.GroupsPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,idProperty:&quot;name&quot;,url:this.url,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.grid=new Ext.grid.GridPanel({xtype:&quot;grid&quot;,sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;}],bbar:{xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)}});this.items=[{xtype:&quot;panel&quot;,title:this.mode==&quot;list&quot;?i18n.get(&quot;label.groups&quot;):i18n.get(&quot;label.selectGroups&quot;),items:[this.grid],tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate},{text:i18n.get(&quot;label.remove&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,hidden:this.mode==&quot;list&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.add&quot;),handler:this._onAdd,hidden:this.mode==&quot;list&quot;},{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK,hidden:this.mode==&quot;select&quot;},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]}}];sitools.admin.usergroups.GroupsPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.GroupsPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.loadError&quot;))}}})},_onCreate:function(){var a=new sitools.admin.usergroups.GroupsPanel({mode:&quot;select&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/groups?media=json&quot;,storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.store.remove(a)},_onAdd:function(){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(c){b.push(new this.store.recordType({name:c.data.name,description:c.data.description}))});this.storeref.add(b);this.close()},_onOK:function(){var a=this.data;a.groups=[];this.store.each(function(b){var c={id:b.data.name};a.groups.push(c)});Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:a,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(c.message));return false}this.close();this.store.reload()},failure:alertFailure})},_onCancel:function(){this.destroy()}});Ext.reg(&quot;s-groups&quot;,sitools.admin.usergroups.GroupsPanel);Ext.namespace(&quot;sitools.admin.projects&quot;);sitools.admin.projects.datasetsWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,id:&quot;projectsDatasetWinId&quot;,initComponent:function(){this.title=i18n.get(&quot;label.datasets&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,idProperty:&quot;id&quot;,totalProperty:&quot;total&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;),fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;mediaType&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;nbRecords&quot;,type:&quot;string&quot;},{name:&quot;sitoolsAttachementForUsers&quot;,type:&quot;string&quot;},{name:&quot;image&quot;},{name:&quot;descriptionHTML&quot;,type:&quot;string&quot;}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;}]});this.items=[{xtype:&quot;panel&quot;,title:i18n.get(&quot;label.selectDataset&quot;),items:[this.grid],bbar:{xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)}}];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onOK},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:this._onCancel}];sitools.admin.projects.datasetsWin.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.datasetsWin.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.loadError&quot;))}}})},_onOK:function(){Ext.each(this.grid.getSelectionModel().getSelections(),function(c){if(this.storeDatasets.find(&quot;id&quot;,c.data.id)==-1){var b=c.data.image;var a=[{name:&quot;nbRecord&quot;,value:c.data.nbRecords},{name:&quot;descriptionHTML&quot;,value:c.data.descriptionHTML}];if(!Ext.isEmpty(b)){a.push({name:&quot;imageUrl&quot;,value:b.url})}this.storeDatasets.add(new Ext.data.Record({id:c.data.id,name:c.data.name,description:c.data.description,type:c.data.type,mediaType:c.data.mediaType,visible:c.data.visible,status:c.data.status,properties:a,url:c.data.sitoolsAttachementForUsers}))}},this);this.close()},_onCancel:function(){this.destroy()}});Ext.namespace(&quot;sitools.component.projects&quot;);sitools.component.projects.ProjectsPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,dataSets:&quot;&quot;,id:ID.COMPONENT_SETUP.PROJECT,allModulesDetached:false,allModulesInvisible:false,initComponent:function(){var g=this.action;if(this.action==&quot;view&quot;){this.title=i18n.get(&quot;label.viewProject&quot;)}if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyProject&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createProject&quot;)}var m=new Ext.data.JsonStore({id:&quot;storeDataSets&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;mediaType&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;properties&quot;},{name:&quot;url&quot;,type:&quot;string&quot;}]});var l=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:100}],defaults:{sortable:true,width:100}});var n=new Ext.grid.RowSelectionModel({singleSelect:false});var f={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate},{text:i18n.get(&quot;label.remove&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,hidden:this.mode==&quot;list&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.gridDataSets=new Ext.grid.EditorGridPanel({id:&quot;gridDataSets&quot;,title:i18n.get(&quot;title.gridDataSets&quot;),store:m,tbar:f,cm:l,sm:n,viewConfig:{forceFit:true},listeners:{activate:function(){if(g==&quot;view&quot;){this.getEl().mask()}}}});this.formProject=new Ext.FormPanel({title:i18n.get(&quot;label.projectInfo&quot;),xtype:&quot;form&quot;,border:false,autoScroll:true,padding:10,trackResetOnLoad:true,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;hidden&quot;,name:&quot;maintenance&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:30,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,vtype:&quot;attachment&quot;,name:&quot;sitoolsAttachementForUsers&quot;,fieldLabel:i18n.get(&quot;label.userAttach&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,growMax:400},{xtype:&quot;textfield&quot;,name:&quot;css&quot;,fieldLabel:i18n.get(&quot;label.css&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;checkbox&quot;,name:&quot;visible&quot;,fieldLabel:i18n.get(&quot;label.isVisible&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;htmleditor&quot;,id:&quot;htmlDescription&quot;,fieldLabel:i18n.get(&quot;label.descriptionHTML&quot;),height:150,anchor:&quot;95%&quot;},{xtype:&quot;htmleditor&quot;,id:&quot;htmlHeader&quot;,fieldLabel:i18n.get(&quot;label.htmlHeader&quot;),height:150,anchor:&quot;95%&quot;},{xtype:&quot;htmleditor&quot;,id:&quot;maintenanceText&quot;,fieldLabel:i18n.get(&quot;label.maintenanceText&quot;),height:150,anchor:&quot;95%&quot;}],listeners:{activate:function(){if(g==&quot;view&quot;){this.getEl().mask()}}}});this.allModulesAttachedBtn=new Ext.Button({text:this.allModulesDetached?i18n.get(&quot;label.allDetached&quot;):i18n.get(&quot;label.allAttached&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onAllModulesAttached,scope:this});this.allModulesVisibleBtn=new Ext.Button({text:this.allModulesInvisible?i18n.get(&quot;label.allInvisible&quot;):i18n.get(&quot;label.allVisible&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onAllModulesVisible,scope:this});this.listRolesBtn=new Ext.Button({text:i18n.get(&quot;label.rolecrud&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_role.png&quot;,scope:this,handler:this._onRoles});var k={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,gridId:&quot;gridModules&quot;,items:[this.allModulesAttachedBtn,this.allModulesVisibleBtn,this.listRolesBtn]};var e=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:false,autoSave:false,autoLoad:false,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_MODULES_URL&quot;),idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;author&quot;,type:&quot;string&quot;},{name:&quot;version&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;icon&quot;,type:&quot;string&quot;},{name:&quot;title&quot;,type:&quot;string&quot;},{name:&quot;imagePath&quot;,type:&quot;string&quot;},{name:&quot;defaultWidth&quot;},{name:&quot;defaultHeight&quot;},{name:&quot;x&quot;},{name:&quot;y&quot;},{name:&quot;xtype&quot;,type:&quot;string&quot;},{name:&quot;specificType&quot;,type:&quot;string&quot;},{name:&quot;dependencies&quot;},{name:&quot;attached&quot;,type:&quot;boolean&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;priority&quot;,type:&quot;numeric&quot;},{name:&quot;listRoles&quot;}],listeners:{scope:this,update:function(q,p){var s=q.indexOf(p);if(p.get(&quot;attached&quot;)===false){p.set(&quot;visible&quot;,false)}if(q.allAttached()){this.allModulesAttachedBtn.setText(i18n.get(&quot;label.Detached&quot;));this.allModulesDetached=true}if(q.allDetached()){this.allModulesAttachedBtn.setText(i18n.get(&quot;label.Attached&quot;));this.allModulesDetached=false;this.allModulesVisibleBtn.setText(i18n.get(&quot;label.allVisible&quot;));this.allModulesInvisible=false}}},allAttached:function(){var p=true;this.each(function(q){if(q.get(&quot;attached&quot;)===false){p=false;return false}});return p},allDetached:function(){var p=true;this.each(function(q){if(q.get(&quot;attached&quot;)===true){p=false;return false}});return p}});var d=new Ext.grid.RowSelectionModel({singleSelect:false});var a=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.attached&quot;),dataIndex:&quot;attached&quot;,width:55});var c=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.visible&quot;),dataIndex:&quot;visible&quot;,width:55});var b=new Ext.grid.ColumnModel({columns:[a,{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:100},c],defaults:{sortable:true,width:100}});this.modulePanel=new Ext.grid.GridPanel({id:&quot;gridModules&quot;,title:i18n.get(&quot;title.modules&quot;),store:e,cm:b,sm:d,tbar:k,viewConfig:{forceFit:true},listeners:{activate:function(){if(g==&quot;view&quot;){this.getEl().mask()}}},plugins:[a,c]});this.tabPanel=new Ext.TabPanel({height:550,activeTab:0,items:[this.formProject,this.gridDataSets,this.modulePanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate,hidden:this.action==&quot;view&quot;},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];this.listeners={scope:this,resize:function(t,s,p){var q=t.body.getSize();this.tabPanel.setSize(q)}};sitools.component.projects.ProjectsPropPanel.superclass.initComponent.call(this)},_onCreate:function(){var a=new sitools.admin.projects.datasetsWin({mode:&quot;select&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/datasets&quot;,storeDatasets:this.gridDataSets.getStore()});a.show(this)},_onDelete:function(){var a=this.gridDataSets.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.gridDataSets.getStore().remove(a)},_onRoles:function(){var b=this.modulePanel.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.usergroups.RolesPanel({mode:&quot;list&quot;,rec:b});a.show(ID.BOX.ROLE)},onUpload:function(){function b(d,c){c.fieldUrl.setValue(d.url)}var a=new ImageChooser({url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/json/componentList.json&quot;,width:515,height:350,fieldUrl:this.ownerCt.items.items[0]});a.show(document,b)},onValidate:function(){var c=this.findByType(&quot;form&quot;)[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}if(this.action==&quot;modify&quot;){var b=c.findField(&quot;name&quot;).getValue();var a=c.findField(&quot;name&quot;).originalValue;if(a!=b){Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;projectProp.warning.projectName.changed&quot;),scope:this,fn:function(d,e){if(d==&quot;yes&quot;){this.onSaveProject()}}})}else{this.onSaveProject()}}else{this.onSaveProject()}},onSaveProject:function(){var d=this.findByType(&quot;form&quot;)[0].getForm();var k={};Ext.iterate(d.getValues(),function(f,l){if(f==&quot;image&quot;){k.image={};k.image.url=l;k.image.type=&quot;Image&quot;;k.image.mediaType=&quot;Image&quot;}else{if(f!=&quot;visible&quot;){k[f]=l}}},this);var c=d.findField(&quot;visible&quot;);k.visible=c.getValue();var a=this.findById(&quot;gridDataSets&quot;).getStore();if(a.getCount()&gt;0){k.dataSets=[];a.each(function(f){k.dataSets.push({id:f.data.id,description:f.data.description,name:f.data.name,mediaType:&quot;DataSet&quot;,type:&quot;DataSet&quot;,visible:f.data.visible,status:f.data.status,properties:f.data.properties,url:f.data.url})})}var e=this.modulePanel.getStore();if(e.getCount()&gt;0){k.modules=[];var b=0;e.each(function(f){if(f.data.attached){if(Ext.isEmpty(f.data.listRoles)){f.data.listRoles=undefined}k.modules.push({author:f.data.author,defaultHeight:f.data.defaultHeight,defaultWidth:f.data.defaultWidth,dependencies:f.data.dependencies,description:f.data.description,id:f.data.id,icon:f.data.icon,imagePath:f.data.imagePath,name:f.data.name,specificType:f.data.specificType,title:f.data.title,url:f.data.url,version:f.data.version,visible:f.data.visible,x:f.data.x,xtype:f.data.xtype,y:f.data.y,priority:b,listRoles:f.data.listRoles});b++}})}var g=(this.action==&quot;modify&quot;)?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.url,method:g,scope:this,jsonData:k,success:function(f){var l=Ext.decode(f.responseText);if(l.success===false){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(l.message))}else{this.close();this.store.reload()}},failure:alertFailure})},onRender:function(){sitools.component.projects.ProjectsPropPanel.superclass.onRender.apply(this,arguments);if(this.url){if(this.action==&quot;modify&quot;||this.action==&quot;view&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(d){var k=this.findByType(&quot;form&quot;)[0].getForm();var e=this.findById(&quot;gridDataSets&quot;);var c=e.getStore();var g=Ext.decode(d.responseText).project;var b=g.dataSets;Ext.each(b,function(f){var m={};m.id=f.id;m.name=f.name;m.description=f.description;m.type=f.description;m.mediaType=f.mediaType;m.status=f.status;m.visible=f.visible;m.properties=f.properties;m.url=f.url;c.add(new Ext.data.Record(m))});var l={};l.id=g.id;l.name=g.name;l.description=g.description;l.sitoolsAttachementForUsers=g.sitoolsAttachementForUsers;l.image=g.image.url;l.css=g.css;l.visible=g.visible;l.htmlHeader=g.htmlHeader;l.htmlDescription=g.htmlDescription;l.maintenanceText=g.maintenanceText;l.maintenance=g.maintenance;var a=new Ext.data.Record(l);k.loadRecord(a);this.modulePanel.getStore().load({scope:this,callback:function(f){this.displayProjectModules(f,g)}})},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}else{this.modulePanel.getStore().load({scope:this,callback:function(a){this.displayProjectModules()}})}}},displayProjectModules:function(b,a){if(this.action==&quot;create&quot;){this.modulePanel.getStore().each(function(c){c.set(&quot;attached&quot;,true);c.set(&quot;visible&quot;,true)})}else{Ext.each(b,function(c){c.set(&quot;priority&quot;,b.length+1);Ext.each(a.modules,function(d){if(c.id==d.id){c.set(&quot;attached&quot;,true);c.set(&quot;visible&quot;,d.visible);c.set(&quot;priority&quot;,d.priority);c.set(&quot;listRoles&quot;,d.listRoles);return false}})})}this.modulePanel.getStore().sort(&quot;priority&quot;)},_onAllModulesAttached:function(){this.modulePanel.getStore().each(function(a){a.set(&quot;attached&quot;,!this.allModulesDetached)},this);if(this.allModulesDetached){this.allModulesInvisible=false;this.allModulesVisibleBtn.setText(i18n.get(&quot;label.allVisible&quot;))}},_onAllModulesVisible:function(){this.modulePanel.getStore().each(function(a){if(!this.allModulesInvisible){a.set(&quot;attached&quot;,!this.allModulesInvisible)}a.set(&quot;visible&quot;,!this.allModulesInvisible)},this);this.allModulesInvisible=!this.allModulesInvisible;this.allModulesVisibleBtn.setText(this.allModulesInvisible?i18n.get(&quot;label.allInvisible&quot;):i18n.get(&quot;label.allVisible&quot;))}});Ext.reg(&quot;s-projectsprop&quot;,sitools.component.projects.ProjectsPropPanel);Ext.namespace(&quot;sitools.component.projects&quot;);sitools.component.projects.projectsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.PROJECTS,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;image&quot;,type:&quot;string&quot;,mapping:&quot;image.url&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;maintenance&quot;,type:&quot;boolean&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.image&quot;),dataIndex:&quot;image&quot;,width:300},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:150},{header:i18n.get(&quot;label.maintenance&quot;),dataIndex:&quot;maintenance&quot;,width:150,renderer:function(a){if(a){return'&lt;div class=&quot;sitools-maintenance&quot;&gt;&amp;nbsp;&lt;/div&gt;'}else{return&quot;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&quot;}}}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;},&quot;-&quot;,{text:i18n.get(&quot;label.startmaintenance&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onStartMaintenance,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.stopmaintenance&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onStopMaintenance,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.projects.projectsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.projects.projectsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.projects.ProjectsPropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.PROJECTS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.projects.ProjectsPropPanel({url:this.url+&quot;/&quot;+b.id,action:b.data.status==&quot;ACTIVE&quot;?&quot;view&quot;:&quot;modify&quot;,store:this.getStore(),projectName:b.name,projectAttachement:b.sitoolsAttachementForUsers});a.show(ID.BOX.PROJECTS)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;projectCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},_onStartMaintenance:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/startmaintenance&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onStopMaintenance:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/stopmaintenance&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-projects&quot;,sitools.component.projects.projectsCrudPanel);Ext.namespace(&quot;sitools.admin.collections&quot;);sitools.admin.collections.CollectionsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.COLLECTIONS,pageSize:10,initComponent:function(){this.urlCollections=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_COLLECTIONS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.urlCollections,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}],autoLoad:true});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.collections.CollectionsCrudPanel.superclass.initComponent.call(this)},onCreate:function(){var a=new sitools.admin.collections.CollectionsPropPanel({urlCollections:this.urlCollections,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.FORMS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.collections.CollectionsPropPanel({urlCollections:this.urlCollections+&quot;/&quot;+b.data.id,action:&quot;modify&quot;,store:this.getStore()});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;collectionsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlCollections+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-collections&quot;,sitools.admin.collections.CollectionsCrudPanel);Ext.namespace(&quot;sitools.admin.collections&quot;);sitools.admin.collections.CollectionsPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,dataSets:&quot;&quot;,id:ID.COMPONENT_SETUP.COLLECTIONS,allModulesDetached:false,allModulesInvisible:false,initComponent:function(){var c=this.action;if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyCollection&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createCollection&quot;)}var d=new Ext.data.JsonStore({id:&quot;storeDataSets&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;mediaType&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;properties&quot;},{name:&quot;url&quot;,type:&quot;string&quot;}]});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:100}],defaults:{sortable:true,width:100}});var b=new Ext.grid.RowSelectionModel({singleSelect:false});var e={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onAttachDataset},{text:i18n.get(&quot;label.remove&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDeleteDataset}]};this.gridDataSets=new Ext.grid.GridPanel({id:&quot;gridDataSets&quot;,flex:1,title:i18n.get(&quot;title.gridDataSets&quot;),store:d,tbar:e,cm:a,sm:b,viewConfig:{forceFit:true},listeners:{activate:function(){if(c==&quot;view&quot;){this.getEl().mask()}}}});this.formCollection=new Ext.FormPanel({title:i18n.get(&quot;label.CollectionInfo&quot;),xtype:&quot;form&quot;,border:false,padding:10,trackResetOnLoad:true,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:30,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;}]});this.mainPanel=new Ext.Panel({height:550,layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;},items:[this.formCollection,this.gridDataSets],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate,hidden:this.action==&quot;view&quot;},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});this.items=[this.mainPanel];this.listeners={scope:this,resize:function(l,k,f){var g=l.body.getSize();this.mainPanel.setSize(g)}};sitools.admin.collections.CollectionsPropPanel.superclass.initComponent.call(this)},_onAttachDataset:function(){var a=new sitools.admin.projects.datasetsWin({mode:&quot;select&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/datasets&quot;,storeDatasets:this.gridDataSets.getStore()});a.show(this)},_onDeleteDataset:function(){var a=this.gridDataSets.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.gridDataSets.getStore().remove(a)},onValidate:function(){var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}this.onSaveCollection()},onSaveCollection:function(){var b=this.findByType(&quot;form&quot;)[0].getForm();var d={};Ext.iterate(b.getValues(),function(e,f){d[e]=f},this);var a=this.findById(&quot;gridDataSets&quot;).getStore();if(a.getCount()&gt;0){d.dataSets=[];a.each(function(e){d.dataSets.push({id:e.data.id,description:e.data.description,name:e.data.name,mediaType:&quot;DataSet&quot;,type:&quot;DataSet&quot;,visible:e.data.visible,status:e.data.status,properties:e.data.properties,url:e.data.url})})}var c=(this.action==&quot;modify&quot;)?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.urlCollections,method:c,scope:this,jsonData:d,success:function(e){var f=Ext.decode(e.responseText);if(f.success===false){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(f.message))}else{this.close();this.store.reload()}},failure:alertFailure})},onRender:function(){sitools.admin.collections.CollectionsPropPanel.superclass.onRender.apply(this,arguments);if(this.urlCollections){if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.urlCollections,method:&quot;GET&quot;,scope:this,success:function(d){var k=this.findByType(&quot;form&quot;)[0].getForm();var e=this.findById(&quot;gridDataSets&quot;);var c=e.getStore();var g=Ext.decode(d.responseText).collection;var b=g.dataSets;Ext.each(b,function(f){var m={};m.id=f.id;m.name=f.name;m.description=f.description;m.type=f.description;m.mediaType=f.mediaType;m.status=f.status;m.visible=f.visible;m.properties=f.properties;m.url=f.url;c.add(new Ext.data.Record(m))});var l={};l.id=g.id;l.name=g.name;l.description=g.description;var a=new Ext.data.Record(l);k.loadRecord(a)},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}}}});Ext.reg(&quot;s-collectionsprop&quot;,sitools.admin.collections.CollectionsPropPanel);Ext.namespace(&quot;sitools.admin.multiDs&quot;);sitools.admin.multiDs.MultiDsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.MULTIDS,pageSize:10,urlMultiDs:&quot;/tmp&quot;,initComponent:function(){this.baseUrlMultiDs=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;);this.urlProjects=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;);this.httpProxyMultiDs=new Ext.data.HttpProxy({url:this.baseUrlMultiDs,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:this.httpProxyMultiDs,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;collection&quot;},{name:&quot;dictionary&quot;}]});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.urlProjects,root:&quot;data&quot;,autoLoad:true});this.comboProjects=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectProjects&quot;),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.loadProject(d.data.id)}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.comboProjects,{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.multiDs.MultiDsCrudPanel.superclass.initComponent.call(this)},loadProject:function(a){this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+&quot;/&quot;+a+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){var b=this.comboProjects.getValue();if(Ext.isEmpty(b)){return}this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+&quot;/&quot;+b+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),true);var a=new sitools.admin.multiDs.MultiDsPropPanel({urlMultiDs:this.baseUrlMultiDs+&quot;/&quot;+b+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.FORMS)},onModify:function(){var b=this.comboProjects.getValue();if(Ext.isEmpty(b)){return}var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+&quot;/&quot;+b+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),true);var a=new sitools.admin.multiDs.MultiDsPropPanel({urlMultiDs:this.baseUrlMultiDs+&quot;/&quot;+b+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),action:&quot;modify&quot;,store:this.getStore(),formId:c.data.id,collection:c.data.collection,dictionary:c.data.dictionary});a.show(ID.PROP.MULTIDSPROP)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;formsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(b){var a=this.comboProjects.getValue();if(Ext.isEmpty(a)){return}Ext.Ajax.request({url:this.baseUrlMultiDs+&quot;/&quot;+a+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;)+&quot;/&quot;+b.id,method:&quot;DELETE&quot;,scope:this,success:function(c){if(showResponse(c)){this.httpProxyMultiDs.setUrl(this.baseUrlMultiDs+&quot;/&quot;+a+loadUrl.get(&quot;APP_FORMPROJECT_URL&quot;),true);this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-multiDs&quot;,sitools.admin.multiDs.MultiDsCrudPanel);Ext.namespace(&quot;sitools.admin.multiDs&quot;);sitools.admin.multiDs.MultiDsPropPanel=Ext.extend(Ext.Window,{width:700,height:630,modal:true,pageSize:10,id:ID.COMPONENT_SETUP.MULTIDS,collectionId:null,dictionaryId:null,urlCollections:null,propServiceDefaultUrl:&quot;/propService&quot;,multiDSServiceDefaultUrl:&quot;/multiDsService&quot;,formSize:{width:500,height:550},initComponent:function(){this.urlCollections=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_COLLECTIONS_URL&quot;);this.urlDictionnaires=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;);var f=this.action;if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyForm&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createForm&quot;)}var d=new Ext.data.JsonStore({id:&quot;storeCollections&quot;,restful:true,url:this.urlCollections,root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;dataSets&quot;}],autoLoad:true,listeners:{scope:this,load:function(z){this.fireEvent(&quot;collectionStoreLoaded&quot;,z)}}});this.comboCollections=new Ext.form.ComboBox({disabled:false,id:&quot;comboCollections&quot;,store:d,fieldLabel:i18n.get(&quot;label.collection&quot;),mode:&quot;local&quot;,displayField:&quot;name&quot;,valueField:&quot;name&quot;,typeAhead:true,name:&quot;comboCollections&quot;,forceSelection:true,triggerAction:&quot;all&quot;,editable:false,emptyText:i18n.get(&quot;label.CollectionsSelect&quot;),selectOnFocus:true,anchor:&quot;95%&quot;,itemSelector:&quot;div.search-item&quot;,allowBlank:false,autoSelect:true,maxHeight:200,tpl:new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;search-item combo-datasetview&quot;&gt;&lt;div class=&quot;combo-datasetview-name&quot;&gt;{name}&lt;/div&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription-datasetview&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',&quot;&lt;/div&gt;&lt;/tpl&gt;&quot;,{compiled:true,descEmpty:function(z){return Ext.isEmpty(z)}}),listeners:{change:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;collectionChanged&quot;,B,A,z)},beforeselect:function(C,z){var B=z.get(&quot;name&quot;);var A=C.getValue();this.getBubbleTarget().fireEvent(&quot;collectionChanged&quot;,C,B,A)}}});var m=new Ext.data.JsonStore({id:&quot;storeDictionnaires&quot;,restful:true,url:this.urlDictionnaires,root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}],autoLoad:true,listeners:{scope:this,load:function(z){this.fireEvent(&quot;dictionaryStoreLoaded&quot;,z)}}});this.comboDictionnaires=new Ext.form.ComboBox({disabled:false,id:&quot;comboDictionnaires&quot;,store:m,fieldLabel:i18n.get(&quot;label.dictionary&quot;),displayField:&quot;name&quot;,valueField:&quot;name&quot;,typeAhead:true,name:&quot;comboDictionnaires&quot;,forceSelection:true,triggerAction:&quot;all&quot;,editable:false,emptyText:i18n.get(&quot;label.DictionarySelect&quot;),selectOnFocus:true,anchor:&quot;95%&quot;,itemSelector:&quot;div.search-item&quot;,allowBlank:false,autoSelect:true,maxHeight:200,tpl:new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;search-item combo-datasetview&quot;&gt;&lt;div class=&quot;combo-datasetview-name&quot;&gt;{name}&lt;/div&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription-datasetview&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',&quot;&lt;/div&gt;&lt;/tpl&gt;&quot;,{compiled:true,descEmpty:function(z){return Ext.isEmpty(z)}}),listeners:{change:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;dictionaryChanged&quot;,B,A,z)},beforeselect:function(C,z){var B=z.get(&quot;name&quot;);var A=C.getValue();this.getBubbleTarget().fireEvent(&quot;dictionaryChanged&quot;,C,B,A)}}});this.mainForm=new Ext.FormPanel({xtype:&quot;form&quot;,border:false,padding:10,trackResetOnLoad:true,id:&quot;formMainFormId&quot;,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:30,allowBlank:false,vtype:&quot;nameWithoutSpace&quot;,listeners:{scope:this,blur:function(A){if(A.isValid()){var z=A.ownerCt.getForm().findField(&quot;urlServicePropertiesSearch&quot;);if(Ext.isEmpty(z.getValue())){z.setValue(&quot;/&quot;+A.getValue()+this.propServiceDefaultUrl)}var B=A.ownerCt.getForm().findField(&quot;urlServiceDatasetSearch&quot;);if(Ext.isEmpty(B.getValue())){B.setValue(&quot;/&quot;+A.getValue()+this.multiDSServiceDefaultUrl)}}}}},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,vtype:&quot;attachment&quot;,name:&quot;urlServicePropertiesSearch&quot;,fieldLabel:i18n.get(&quot;label.urlServicePropertiesSearch&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,vtype:&quot;attachment&quot;,name:&quot;urlServiceDatasetSearch&quot;,fieldLabel:i18n.get(&quot;label.urlServiceDatasetSearch&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,name:&quot;css&quot;,fieldLabel:i18n.get(&quot;label.css&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,name:&quot;nbDatasetsMax&quot;,fieldLabel:i18n.get(&quot;label.nbDatasetsMax&quot;),anchor:&quot;100%&quot;,maxLength:100},this.comboCollections,this.comboDictionnaires,{xtype:&quot;hidden&quot;,name:&quot;idServicePropertiesSearch&quot;},{xtype:&quot;hidden&quot;,name:&quot;idServiceDatasetSearch&quot;}],listeners:{activate:function(){if(f==&quot;view&quot;){this.getEl().mask()}},collectionChanged:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;collectionChanged&quot;,B,A,z)},dictionaryChanged:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;dictionaryChanged&quot;,B,A,z)}},flex:1});var q=new Ext.data.HttpProxy({url:this.action==&quot;create&quot;?&quot;/tmp&quot;:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_COLLECTIONS_URL&quot;)+&quot;/&quot;+this.collection.id+&quot;/concepts/&quot;+this.dictionary.id,restful:true});var v=new Ext.data.JsonStore({root:&quot;data&quot;,proxy:q,restful:true,remoteSort:false,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}],autoLoad:this.action!=&quot;create&quot;});var n=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,type:&quot;string&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,type:&quot;string&quot;}]});this.gridConcepts=new Ext.grid.GridPanel({store:v,cm:n,title:i18n.get(&quot;label.sharedConcepts&quot;),flex:1,viewConfig:{forceFit:true}});var k=new Ext.Panel({title:i18n.get(&quot;label.FormInfo&quot;),layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;},items:[this.mainForm,this.gridConcepts],listeners:{collectionChanged:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;collectionChanged&quot;,B,A,z)},dictionaryChanged:function(B,A,z){this.getBubbleTarget().fireEvent(&quot;dictionaryChanged&quot;,B,A,z)}}});var u=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;}],autoLoad:false});var s=new Ext.grid.RowSelectionModel({singleSelect:true});var b=new Ext.data.JsonStore({fields:[&quot;name&quot;],data:[{name:&quot;TEXTFIELD&quot;},{name:&quot;NUMERIC_BETWEEN&quot;},{name:&quot;DATE_BETWEEN&quot;},{name:&quot;NUMBER_FIELD&quot;}]});var c=new Ext.form.ComboBox({store:b,mode:&quot;local&quot;,typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,selectOnFocus:true,dataIndex:&quot;orderBy&quot;,lazyRender:true,listClass:&quot;x-combo-list-small&quot;,valueField:&quot;name&quot;,displayField:&quot;name&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;x-combo-list-item comboItem&quot;&gt;{name}&lt;/div&gt;&lt;/tpl&gt;',width:55});var g=new Ext.data.HttpProxy({url:this.urlCollections+&quot;/&quot;+this.collectionId+&quot;/properties&quot;,restful:true,method:&quot;GET&quot;});this.storeComboProperties=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;description&quot;],proxy:g,root:&quot;data&quot;});var p=new Ext.form.ComboBox({disabled:false,id:&quot;comboProperties&quot;,store:this.storeComboProperties,displayField:&quot;name&quot;,valueField:&quot;name&quot;,typeAhead:true,mode:&quot;local&quot;,name:&quot;comboProperties&quot;,forceSelection:true,triggerAction:&quot;all&quot;,editable:false,emptyText:i18n.get(&quot;label.comboPropertiesSelect&quot;),selectOnFocus:true,allowBlank:false,autoSelect:true});var l=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,editor:p},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;,editor:c}],defaults:{sortable:false,width:100}});var e={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,gridId:&quot;gridProperties&quot;,items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:function(){var z=this.gridProperties;var A=new Ext.data.Record();z.getStore().insert(0,A)},scope:this},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:function(){var A=this.gridProperties;var B=A.getSelectionModel().getSelections();var z,C;for(z=0;B[z];z++){C=B[z];A.getStore().remove(C)}},scope:this}]};this.gridProperties=new Ext.grid.EditorGridPanel({layout:&quot;fit&quot;,title:i18n.get(&quot;title.properties&quot;),id:&quot;gridProperties&quot;,store:u,tbar:e,cm:l,sm:s,viewConfig:{forceFit:true},listeners:{scope:this,activate:function(){this.storeComboProperties.proxy.setUrl(this.urlCollections+&quot;/&quot;+this.collectionId+&quot;/properties&quot;);this.storeComboProperties.reload()}}});this.formComponentsStore=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;code&quot;,type:&quot;string&quot;},{name:&quot;values&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;height&quot;,type:&quot;int&quot;},{name:&quot;xpos&quot;,type:&quot;int&quot;},{name:&quot;ypos&quot;,type:&quot;int&quot;},{name:&quot;css&quot;,type:&quot;string&quot;},{name:&quot;jsAdminObject&quot;,type:&quot;string&quot;},{name:&quot;jsUserObject&quot;,type:&quot;string&quot;},{name:&quot;defaultValues&quot;},{name:&quot;valueSelection&quot;,type:&quot;string&quot;},{name:&quot;autoComplete&quot;,type:&quot;boolean&quot;},{name:&quot;parentParam&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;},{name:&quot;extraParams&quot;}],autoLoad:false});this.absoluteLayout=new sitools.admin.forms.ComponentsDisplayPanel({formComponentsStore:this.formComponentsStore,storeConcepts:this.gridConcepts.getStore(),context:&quot;project&quot;,formSize:this.formSize});var t=new Ext.Panel({flex:1,autoScroll:true,items:[this.absoluteLayout]});this.componentListPanel=new sitools.admin.forms.componentsListPanel({formComponentsStore:this.formComponentsStore,action:&quot;create&quot;,context:&quot;project&quot;,storeConcepts:this.gridConcepts.getStore()});var a=new Ext.Panel({layout:&quot;hbox&quot;,title:i18n.get(&quot;label.disposition&quot;),layoutConfig:{align:&quot;stretch&quot;},items:[this.componentListPanel,t],listeners:{scope:this,activate:function(){this.absoluteLayout.fireEvent(&quot;activate&quot;);var D=this.absoluteLayout;var E=D.body.dom;var z=this.formComponentsStore;var A=this.storeConcepts;var C=this.gridConcepts;var B=new Ext.dd.DropTarget(E,{ddGroup:&quot;gridComponentsList&quot;,notifyDrop:function(O,N,M){var K=N.xy;var L=Ext.get(D.body).getXY();var J={x:K[0]-L[0],y:K[1]-L[1]};var P=O.dragData.selections[0];var Q=new sitools.admin.forms.componentPropPanel({urlAdmin:P.data.jsonDefinitionAdmin,ctype:P.data.type,action:&quot;create&quot;,componentDefaultHeight:P.data.componentDefaultHeight,componentDefaultWidth:P.data.componentDefaultWidth,dimensionId:P.data.dimensionId,unit:P.data.unit,extraParams:P.data.extraParams,jsAdminObject:P.data.jsAdminObject,jsUserObject:P.data.jsUserObject,context:&quot;project&quot;,storeConcepts:C.getStore(),absoluteLayout:D,record:P,formComponentsStore:z,xyOnCreate:J});Q.show()}})}}});this.tabPanel=new Ext.TabPanel({height:550,activeTab:0,items:[k,this.gridProperties,a],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate,hidden:this.action==&quot;view&quot;},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,collectionChanged:function(D,C,A){var z=D.getStore().find(&quot;name&quot;,C);var E=D.getStore().getAt(z);if(!Ext.isEmpty(A)&amp;&amp;C!=A&amp;&amp;this.formComponentsStore.getCount()&gt;0){var B=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;warning.changeCollection&quot;),scope:this,fn:function(J,K){if(J==&quot;yes&quot;){this.collectionId=E.data.id;this.loadConcepts();this.eraseComponents();this.eraseProperties()}else{D.setValue(A)}}})}else{this.collectionId=E.data.id;this.loadConcepts()}},dictionaryChanged:function(D,C,A){var z=D.getStore().find(&quot;name&quot;,C);var E=D.getStore().getAt(z);if(!Ext.isEmpty(A)&amp;&amp;C!=A&amp;&amp;this.formComponentsStore.getCount()&gt;0){var B=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;warning.changeDictionary&quot;),scope:this,fn:function(J,K){if(J==&quot;yes&quot;){this.dictionaryId=E.data.id;this.loadConcepts();this.eraseComponents()}else{D.setValue(A)}}})}else{this.dictionaryId=E.data.id;this.loadConcepts()}}}});this.items=[this.tabPanel];this.listeners={scope:this,resize:function(C,B,z){var A=C.body.getSize();this.tabPanel.setSize(A)},dictionaryStoreLoaded:function(z){var A=z.find(&quot;name&quot;,this.comboCollections.getValue());var B=this.comboCollections.getStore().getAt(A);if(Ext.isEmpty(B)){return}this.collectionId=B.data.id;if(!Ext.isEmpty(this.collectionId)&amp;&amp;!Ext.isEmpty(this.dictionaryId)){this.loadConcepts()}},collectionStoreLoaded:function(z){var A=z.find(&quot;name&quot;,this.comboDictionnaires.getValue());var B=this.comboDictionnaires.getStore().getAt(A);if(Ext.isEmpty(B)){return}this.dictionaryId=B.data.id;if(!Ext.isEmpty(this.collectionId)&amp;&amp;!Ext.isEmpty(this.dictionaryId)){this.loadConcepts()}}};sitools.component.projects.ProjectsPropPanel.superclass.initComponent.call(this)},loadConcepts:function(){var a=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_COLLECTIONS_URL&quot;)+&quot;/&quot;+this.collectionId+&quot;/concepts/&quot;+this.dictionaryId;this.gridConcepts.getStore().proxy.setUrl(a);this.gridConcepts.getStore().load()},eraseComponents:function(){this.formComponentsStore.removeAll()},eraseProperties:function(){this.gridProperties.getStore().removeAll()},onValidate:function(){var g=this.findByType(&quot;form&quot;)[0].getForm();if(!g.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}var l={};Ext.iterate(g.getValues(),function(m,n){var q,f;if(m==&quot;comboCollections&quot;){f=this.comboCollections.getStore().find(&quot;name&quot;,this.comboCollections.getValue());q=this.comboCollections.getStore().getAt(f);var p={name:q.data.name,id:q.data.id,description:q.data.description};l.collection=p}else{if(m==&quot;comboDictionnaires&quot;){f=this.comboDictionnaires.getStore().find(&quot;name&quot;,this.comboDictionnaires.getValue());q=this.comboDictionnaires.getStore().getAt(f);var s={name:q.data.name,id:q.data.id,description:q.data.description};l.dictionary=s}else{l[m]=n}}},this);var d=this.formSize.width;var a=this.formSize.height;l.width=d;l.height=a;var e=this.gridProperties.getStore();if(e.getCount()&gt;0){l.properties=[]}e.each(function(f){l.properties.push(f.data)});var b=this.formComponentsStore;if(b.getCount()&gt;0){l.parameters=[]}b.each(function(f){l.parameters.push({type:f.data.type,code:f.data.code,label:f.data.label,values:f.data.values,width:f.data.width,height:f.data.height,xpos:f.data.xpos,ypos:f.data.ypos,id:f.data.id,css:f.data.css,jsAdminObject:f.data.jsAdminObject,jsUserObject:f.data.jsUserObject,defaultValues:f.data.defaultValues,valueSelection:f.data.valueSelection,autoComplete:f.data.autoComplete,parentParam:f.data.parentParam,dimensionId:f.data.dimensionId,unit:f.data.unit,extraParams:f.data.extraParams})});var k=(this.action==&quot;modify&quot;)?&quot;PUT&quot;:&quot;POST&quot;;var c=(this.action==&quot;modify&quot;)?this.urlMultiDs+&quot;/&quot;+this.formId:this.urlMultiDs;Ext.Ajax.request({url:c,method:k,scope:this,jsonData:l,success:function(f){var m=Ext.decode(f.responseText);if(m.success===false){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(m.message))}else{this.close();this.store.reload()}},failure:alertFailure})},onRender:function(){sitools.admin.multiDs.MultiDsPropPanel.superclass.onRender.apply(this,arguments);if(this.formId){if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.urlMultiDs+&quot;/&quot;+this.formId,method:&quot;GET&quot;,scope:this,success:function(l){var b=Ext.decode(l.responseText);if(!b.success){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}var k=this.findByType(&quot;form&quot;)[0].getForm();var e=b.formProject;if(!Ext.isEmpty(e.width)){this.formSize.width=e.width}if(!Ext.isEmpty(e.height)){this.formSize.height=e.height}var c={};c.id=e.id;c.name=e.name;c.description=e.description;c.css=e.css;c.nbDatasetsMax=e.nbDatasetsMax;c.urlServicePropertiesSearch=e.urlServicePropertiesSearch;c.urlServiceDatasetSearch=e.urlServiceDatasetSearch;c.idServiceDatasetSearch=e.idServiceDatasetSearch;c.idServicePropertiesSearch=e.idServicePropertiesSearch;var g=new Ext.data.Record(c);k.loadRecord(g);this.comboCollections.setValue(e.collection.name);this.comboDictionnaires.setValue(e.dictionary.name);this.collectionId=e.collection.id;this.dictionaryId=e.dictionary.id;if(e.properties){var m=e.properties;var p=this.gridProperties.getStore();Ext.each(m,function(f){p.add(new Ext.data.Record(f))})}if(e.parameters){var n=e.parameters;var a=this.formComponentsStore;var d;for(d=0;d&lt;n.length;d++){a.add(new Ext.data.Record({type:n[d].type,code:n[d].code,label:n[d].label,values:n[d].values,width:n[d].width,height:n[d].height,xpos:n[d].xpos,ypos:n[d].ypos,id:n[d].id,css:n[d].css,jsAdminObject:n[d].jsAdminObject,jsUserObject:n[d].jsUserObject,defaultValues:n[d].defaultValues,valueSelection:n[d].valueSelection,autoComplete:n[d].autoComplete,parentParam:n[d].parentParam,dimensionId:n[d].dimensionId,unit:n[d].unit,extraParams:n[d].extraParams}))}}this.doLayout()},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}}}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.selectPredicat=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,id:&quot;selectPredicatId&quot;,initComponent:function(){this.title=i18n.get(&quot;label.selectPredicat&quot;);this.cmSelectPredicat=new Ext.grid.ColumnModel({columns:[{id:&quot;tableAlias&quot;,header:i18n.get(&quot;headers.tableAlias&quot;),sortable:true,dataIndex:&quot;tableAlias&quot;},{id:&quot;tableName&quot;,header:i18n.get(&quot;headers.tableName&quot;),sortable:true,dataIndex:&quot;tableName&quot;},{id:&quot;name&quot;,header:i18n.get(&quot;headers.alias&quot;),sortable:true,dataIndex:&quot;columnAlias&quot;}]});this.smSelectPredicat=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridSelectPredicat=new Ext.grid.GridPanel({title:i18n.get(&quot;title.gridSelectPredicat&quot;),height:380,autoScroll:true,store:this.storePredicat,cm:this.cmSelectPredicat,sm:this.smSelectPredicat});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[this.gridSelectPredicat],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.selectPredicat.superclass.initComponent.call(this)},onValidate:function(){var b=this.gridSelectPredicat.getSelectionModel().getSelected();var a=b.data.tableAlias?b.data.tableAlias:b.data.tableName;a=a+&quot;.&quot;+b.data.dataIndex;this.recordPredicat.data.nomAffiche=a;if(this.field==&quot;leftAttribute&quot;){this.recordPredicat.data.leftAttribute={tableName:b.data.tableName,tableAlias:b.data.tableAlias,dataIndex:b.data.dataIndex,schema:b.data.schemaName,columnAlias:b.data.columnAlias,specificColumnType:b.data.specificColumnType}}else{this.recordPredicat.data.rightAttribute={tableName:b.data.tableName,tableAlias:b.data.tableAlias,dataIndex:b.data.dataIndex,schema:b.data.schemaName,columnAlias:b.data.columnAlias,specificColumnType:b.data.specificColumnType}}this.viewPredicat.refresh();this.close()}});Ext.reg(&quot;s-datasetspredicat&quot;,sitools.admin.datasets.selectPredicat);Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.joinConditionWin=Ext.extend(Ext.Window,{width:650,modal:true,closable:false,pageSize:10,resizable:false,id:&quot;joinConditionWin&quot;,initComponent:function(){this.storeColumnDataset.filterBy(function(e){return e.data.specificColumnType==&quot;DATABASE&quot;});var b;try{b=this.node.attributes.predicat||{}}catch(d){b={}}this.logicOperator=new Ext.form.ComboBox({typeAhead:false,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,width:50,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[&quot;&quot;,&quot;&quot;],[&quot;on&quot;,&quot;on&quot;],[&quot;and&quot;,&quot;and&quot;],[&quot;or&quot;,&quot;or&quot;]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;,value:Ext.isEmpty(b.logicOperator)?&quot;on&quot;:b.logicOperator});var a=new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;x-combo-list-item&quot;&gt;','&lt;tpl if=&quot;this.isNull(tableAlias)&quot;&gt;','&lt;tpl if=&quot;this.isNotNull(tableName)&quot;&gt;{[values.tableName.toUpperCase()]}.&lt;/tpl&gt;',&quot;&lt;/tpl&gt;&quot;,'&lt;tpl if=&quot;this.isNotNull(tableAlias)&quot;&gt;[values.tableAlias.toUpperCase()].&lt;/tpl&gt;',&quot;{columnAlias}&lt;/div&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,{compiled:true,isNull:function(e){return Ext.isEmpty(e)},isNotNull:function(e){return !Ext.isEmpty(e)},isDatabase:function(e){return e==&quot;DATABASE&quot;}});this.leftAttribute=new Ext.form.ComboBox({fieldLabel:&quot;left&quot;,typeAhead:false,triggerAction:&quot;all&quot;,forceSelection:true,id:&quot;leftAttributeField&quot;,flex:2,lazyRender:true,mode:&quot;local&quot;,displayField:&quot;columnAlias&quot;,valueField:&quot;columnAlias&quot;,store:this.storeColumnDataset,value:b.leftAttribute?b.leftAttribute.columnAlias:null,tpl:a});this.compareOperator=new Ext.form.ComboBox({typeAhead:false,forceSelection:true,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,width:50,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[&quot; = &quot;,&quot;=&quot;],[&quot; &gt; &quot;,&quot;&gt;&quot;],[&quot; &gt;= &quot;,&quot;&gt;=&quot;],[&quot; &lt; &quot;,&quot;&lt;&quot;],[&quot; &lt;= &quot;,&quot;&lt;=&quot;],[&quot; like &quot;,&quot;like&quot;],[&quot; != &quot;,&quot;!=&quot;]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;,value:Ext.isEmpty(b.compareOperator)?&quot;=&quot;:b.compareOperator});this.rightAttribute=new Ext.form.ComboBox({fieldLabel:&quot;left&quot;,typeAhead:false,triggerAction:&quot;all&quot;,forceSelection:true,lazyRender:true,id:&quot;rightAttributeField&quot;,mode:&quot;local&quot;,flex:2,displayField:&quot;columnAlias&quot;,valueField:&quot;columnAlias&quot;,store:this.storeColumnDataset,value:b.rightAttribute?b.rightAttribute.columnAlias:null,tpl:a});var c=new Ext.form.FormPanel({labelWidth:100,bodyStyle:&quot;padding:5px 5px 0&quot;,width:640,items:[{xtype:&quot;compositefield&quot;,fieldLabel:i18n.get(&quot;label.joinCondition&quot;),defaults:{flex:1},items:[this.logicOperator,this.leftAttribute,this.compareOperator,this.rightAttribute]}]});this.title=i18n.get(&quot;label.joinCondition&quot;);this.items=[c];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK,scope:this},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel,scope:this}];sitools.admin.datasets.joinConditionWin.superclass.initComponent.call(this)},_onOK:function(){this.storeColumnDataset.clearFilter();var d=this.rightAttribute.getStore().getAt(this.rightAttribute.getStore().findExact(&quot;columnAlias&quot;,this.rightAttribute.getValue())).data;var a=this.leftAttribute.getStore().getAt(this.leftAttribute.getStore().findExact(&quot;columnAlias&quot;,this.leftAttribute.getValue())).data;var c={logicOperator:this.logicOperator.getValue(),rightAttribute:{id:d.id,dataIndex:d.dataIndex,header:d.header,toolTip:d.toolTip,width:d.width,sortable:d.sortable,visible:d.visible,filter:d.filter,sqlColumnType:d.sqlColumnType,columnOrder:d.columnOrder,primaryKey:d.primaryKey,schema:d.schemaName,tableAlias:d.tableAlias,tableName:d.tableName,specificColumnType:d.specificColumnType,columnAlias:d.columnAlias,datasetDetailUrl:d.datasetDetailUrl,columnAliasDetail:d.columnAliasDetail,notion:d.notion,javaSqlColumnType:d.javaSqlColumnType,columnClass:d.columnClass,image:d.image,dimensionId:d.dimensionId,unit:d.unit},leftAttribute:{id:a.id,dataIndex:a.dataIndex,header:a.header,toolTip:a.toolTip,width:a.width,sortable:a.sortable,visible:a.visible,filter:a.filter,sqlColumnType:a.sqlColumnType,columnOrder:a.columnOrder,primaryKey:a.primaryKey,schema:a.schemaName,tableAlias:a.tableAlias,tableName:a.tableName,specificColumnType:a.specificColumnType,columnAlias:a.columnAlias,datasetDetailUrl:a.datasetDetailUrl,columnAliasDetail:a.columnAliasDetail,notion:a.notion,javaSqlColumnType:a.javaSqlColumnType,columnClass:a.columnClass,image:a.image,dimensionId:a.dimensionId,unit:a.unit},compareOperator:this.compareOperator.getValue()};if(this.mode==&quot;edit&quot;){this.node.attributes.predicat=c;this.node.setText(this.getNodeText(c))}else{var b={leaf:true,predicat:c,text:this.getNodeText(c),type:&quot;join&quot;};if(!this.node.isExpanded()){this.node.expand()}if(this.node.childNodes.length!==0){this.node.insertBefore(b,this.node.findChild(&quot;leaf&quot;,false))}else{this.node.appendChild(b)}}this.destroy()},getNodeText:function(a){a.leftAttribute=a.leftAttribute||{};a.rightAttribute=a.rightAttribute||{};return String.format(&quot;{0} {1} {2} {3}&quot;,a.logicOperator,this.getDisplayName(a.leftAttribute),a.compareOperator,this.getDisplayName(a.rightAttribute))},_onCancel:function(){this.storeColumnDataset.clearFilter();this.destroy()},getDisplayName:function(a){if(a.specificColumnType==&quot;DATABASE&quot;){return String.format(&quot;{0}.{1}&quot;,Ext.isEmpty(a.tableAlias)?a.tableName:a.tableAlias,a.columnAlias)}else{return a.columnAlias}}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.joinTableWin=Ext.extend(Ext.Window,{width:350,height:300,modal:true,closable:false,layout:&quot;fit&quot;,initComponent:function(){this.title=i18n.get(&quot;label.tables&quot;);var a=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),width:160,sortable:true,dataIndex:&quot;name&quot;},{id:&quot;alias&quot;,header:i18n.get(&quot;headers.tableAlias&quot;),width:80,sortable:true,dataIndex:&quot;alias&quot;,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false})}]});var b=new sitools.widget.JsonStore({id:&quot;storeTablesDataset&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;alias&quot;,type:&quot;string&quot;},{name:&quot;schemaName&quot;,type:&quot;string&quot;}]});b.add(this.gridTablesDataset.getStore().data.items);this.grid=new Ext.grid.GridPanel({layout:&quot;fit&quot;,store:b,cm:a,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoScroll:true,enableDragDrop:false,stripeRows:true,title:&quot;Tables Dataset&quot;});this.items=[this.grid];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK,scope:this},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel,scope:this}];sitools.admin.datasets.joinTableWin.superclass.initComponent.call(this)},_onOK:function(){var b=this.grid.getSelectionModel().getSelected();if(!Ext.isEmpty(b)){if(this.mode==&quot;edit&quot;){this.node.setText(this.typeJointure+&quot; &quot;+b.data.name);this.node.attributes.table={alias:b.data.alias,name:b.data.name,schema:b.data.schemaName}}else{if(this.mode==&quot;edit-root&quot;){this.node.setText(b.data.name);this.node.attributes.table={alias:b.data.alias,name:b.data.name,schema:b.data.schemaName}}else{var a={text:this.typeJointure+&quot; &quot;+b.data.name,typeJointure:this.typeJointure,type:&quot;table&quot;,table:{name:b.data.name,alias:b.data.alias,schema:b.data.schemaName},leaf:false,children:[]};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(a);this.destroy()}}}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}},_onCancel:function(){this.destroy()}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.joinPanel=Ext.extend(Ext.Panel,{border:false,urlJDBC:loadUrl.get(&quot;APP_URL&quot;)+&quot;/&quot;,autoScroll:true,layout:&quot;fit&quot;,height:180,initComponent:function(){this.title=&quot;Join Configuration&quot;;this.tree=new sitools.component.datasets.joinCrudTreePanel({datasetId:this.datasetId,gridTablesDataset:this.gridTablesDataset,storeColumnDataset:this.storeColumnDataset,action:this.action});this.items=[this.tree];this.addEvents(&quot;contextmenu&quot;);sitools.admin.datasets.joinPanel.superclass.initComponent.call(this)},loadGraph:function(){this.removeAll();this.tree=new sitools.component.datasets.joinCrudTreePanel({datasetId:this.datasetId});this.tree.getRootNode().expand(true);this.add(this.tree);this.doLayout()},_onSave:function(){var d=this.comboProjects.getValue();if(!Ext.isEmpty(d)){var b=this.tree.getRootNode();var a=[];var g=b.childNodes;var e;for(e=0;e&lt;g.length;e++){this.getAllNodes(g[e],a)}var c=this.tree.getIdGraph();var f={nodeList:a,id:c};var k=(!Ext.isEmpty(c))?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.urlProjects+&quot;/&quot;+d+&quot;/graph&quot;,method:k,scope:this,jsonData:f,success:function(l){var n=Ext.decode(l.responseText);if(!n.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),n.message);return false}else{var m=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.graphSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.loadGraph(d)}},failure:alertFailure})}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={text:a.text,predicat:a.predicat,leaf:a.leaf};c.push(d)}else{d={text:a.text,children:[],type:a.attributes.type,typeJointure:a.attributes.typeJointure,table:a.attributes.table,leaf:false};c.push(d);var e=a.childNodes;var b;for(b=0;b&lt;e.length;b++){this.getAllNodes(e[b],d.children)}}}},buildDefault:function(){this.tree.buildDefault()},deleteJoinPanelItems:function(){this.tree.deleteJoinPanelItems()}});sitools.component.datasets.joinCrudTreePanel=Ext.extend(Ext.tree.TreePanel,{loader:null,projectId:null,layout:&quot;fit&quot;,autoScroll:true,initComponent:function(){var a;a=new Ext.tree.TreeNode({text:this.name,leaf:false,expanded:true});Ext.apply(this,{rootVisible:true,layout:&quot;fit&quot;,enableDD:false,root:a,contextMenuRoot:new Ext.menu.Menu({items:[{id:&quot;create-node&quot;,text:i18n.get(&quot;Add Table&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_folder.png&quot;,menu:{items:[{id:&quot;INNER_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.innerJoin&quot;)},{id:&quot;CROSS_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.crossJoin&quot;)},{id:&quot;LEFT_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.leftJoin&quot;)},{id:&quot;LEFT_OUTER_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.leftOuterJoin&quot;)},{id:&quot;RIGHT_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.rightJoin&quot;)},{id:&quot;RIGHT_OUTER_JOIN&quot;,action:&quot;addTable&quot;,text:i18n.get(&quot;label.rightOuterJoin&quot;)}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}},{id:&quot;edit-root&quot;,text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuNode:new Ext.menu.Menu({items:[{id:&quot;add-joinCondition&quot;,text:i18n.get(&quot;Add Join Condition&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_datasets.png&quot;},{id:&quot;edit-node&quot;,text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;},{id:&quot;edit-jointure&quot;,text:i18n.get(&quot;editJointure&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;,menu:{items:[{id:&quot;INNER_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.innerJoin&quot;)},{id:&quot;CROSS_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.crossJoin&quot;)},{id:&quot;LEFT_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.leftJoin&quot;)},{id:&quot;LEFT_OUTER_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.leftOuterJoin&quot;)},{id:&quot;RIGHT_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.rightJoin&quot;)},{id:&quot;RIGHT_OUTER_JOIN&quot;,action:&quot;editJointure&quot;,text:i18n.get(&quot;label.rightOuterJoin&quot;)}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}},{id:&quot;delete-node&quot;,text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_delete.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuLeaf:new Ext.menu.Menu({items:[{id:&quot;edit-node&quot;,text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;},{id:&quot;delete-node&quot;,text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_delete.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),listeners:{scope:this,contextmenu:function(b,d){d.stopEvent();b.select();var f;if(b==this.getRootNode()){f=b.getOwnerTree().contextMenuRoot;f.contextNode=this.getRootNode()}else{if(b.isLeaf()){f=b.getOwnerTree().contextMenuLeaf}else{f=b.getOwnerTree().contextMenuNode}f.contextNode=b}f.showAt(d.getXY())},beforenodedrop:function(b){if(b.target.attributes.type==b.data.node.attributes.type){return false}return true}}});sitools.component.datasets.joinCrudTreePanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.datasets.joinCrudTreePanel.superclass.onRender.apply(this,arguments)},_cxtMenuHandler:function(d){var c,a;switch(d.id){case&quot;delete-node&quot;:var b=Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.graphs.node.delete&quot;),scope:this,fn:function(e,f){if(e==&quot;yes&quot;){var g=d.parentMenu.contextNode;if(g.parentNode){g.remove()}}}});break;case&quot;add-joinCondition&quot;:c=d.parentMenu.contextNode;a=new sitools.admin.datasets.joinConditionWin({node:c,mode:&quot;create&quot;,storeColumnDataset:this.storeColumnDataset});a.show(this);break;case&quot;INNER_JOIN&quot;:case&quot;LEFT_JOIN&quot;:case&quot;CROSS_JOIN&quot;:case&quot;LEFT_OUTER_JOIN&quot;:case&quot;RIGHT_JOIN&quot;:case&quot;RIGHT_OUTER_JOIN&quot;:if(d.action==&quot;addTable&quot;){c=d.parentMenu.parentMenu.contextNode;a=new sitools.admin.datasets.joinTableWin({node:c,mode:&quot;create&quot;,gridTablesDataset:this.gridTablesDataset,typeJointure:d.id});a.show()}if(d.action==&quot;editJointure&quot;){c=d.parentMenu.parentMenu.contextNode;c.attributes.typeJointure=d.id;c.setText(this.getNodeText(c.attributes))}break;case&quot;edit-node&quot;:c=d.parentMenu.contextNode;if(c.isLeaf()){a=new sitools.admin.datasets.joinConditionWin({node:c,mode:&quot;edit&quot;,storeColumnDataset:this.storeColumnDataset})}else{a=new sitools.admin.datasets.joinTableWin({node:c,mode:&quot;edit&quot;,gridTablesDataset:this.gridTablesDataset,typeJointure:c.attributes.typeJointure})}a.show();break;case&quot;edit-root&quot;:c=d.parentMenu.contextNode;a=new sitools.admin.datasets.joinTableWin({node:c,mode:&quot;edit-root&quot;,gridTablesDataset:this.gridTablesDataset});a.show();break}},getIdGraph:function(){return this.loader.getIdGraph()},buildDefault:function(){if(this.gridTablesDataset.getStore().getCount()!==0&amp;&amp;Ext.isEmpty(this.getRootNode().attributes.table)){var c=this.gridTablesDataset.getStore().getAt(0);var a=this.getRootNode();Ext.apply(a,{text:c.data.name,leaf:false,children:[],type:&quot;table&quot;});a.setText(c.data.name);Ext.apply(a.attributes,{table:{name:c.data.name,alias:c.data.alias,schema:c.data.schemaName}});var b=0;this.gridTablesDataset.getStore().each(function(d){if(b!==0){a.appendChild({typeJointure:&quot;INNER_JOIN&quot;,text:&quot;INNER_JOIN &quot;+d.data.name,table:{name:d.data.name,alias:d.data.alias,schema:d.data.schemaName},leaf:false,type:&quot;table&quot;,children:[]})}b++},this)}},loadTree:function(c){var b=this.getRootNode();var a=c.structure.mainTable;if(!Ext.isEmpty(a)){Ext.apply(b,{text:a.name,leaf:false,expanded:true});Ext.apply(b.attributes,{table:a})}Ext.each(c.structure.nodeList,function(d){this.loadNode(d,b)},this)},loadNode:function(d,c){var e;if(d.leaf){Ext.apply(d,{text:this.getNodeText(d),nodeType:&quot;sync&quot;,expanded:true});e=new Ext.tree.TreeNode(d);d.children=[];c.appendChild(e)}else{Ext.apply(d,{text:this.getNodeText(d),nodeType:&quot;sync&quot;,iconCls:&quot;x-tree-node-folder&quot;,expanded:true});var b=d.children;c.appendChild(d);var a=c.lastChild;Ext.each(b,function(f){this.loadNode(f,a)},this)}},getNodeText:function(c){if(c.leaf){var a=c.predicat||{};a.leftAttribute=a.leftAttribute||{};a.rightAttribute=a.rightAttribute||{};return String.format(&quot;{0} {1} {2} {3}&quot;,a.logicOperator,this.getDisplayName(a.leftAttribute),a.compareOperator,this.getDisplayName(a.rightAttribute))}else{var b=!Ext.isEmpty(c.table)?c.table:c.attributes.table;if(!Ext.isEmpty(b)){return c.typeJointure+&quot; &quot;+b.name}else{return&quot;wrong node&quot;}}},getDisplayName:function(a){if(a.specificColumnType==&quot;DATABASE&quot;){return String.format(&quot;{0}.{1}&quot;,Ext.isEmpty(a.tableAlias)?a.tableName:a.tableAlias,a.columnAlias)}else{return a.columnAlias}},deleteJoinPanelItems:function(){var a=new Ext.tree.TreeNode({text:this.name,leaf:false,expanded:true});this.setRootNode(a)}});Ext.apply(Ext.tree.TreePanel.nodeTypes,{sync:Ext.tree.TreeNode});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.gridFieldSetup=function(c){var b=new Ext.data.JsonStore({id:&quot;storeColumnSelect&quot;,root:&quot;ColumnModel&quot;,idProperty:&quot;columnAlias&quot;,remoteSort:false,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;dataIndex&quot;,type:&quot;string&quot;},{name:&quot;schemaName&quot;,mapping:&quot;schema&quot;,type:&quot;string&quot;},{name:&quot;tableAlias&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;header&quot;,type:&quot;string&quot;},{name:&quot;toolTip&quot;,type:&quot;string&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;sortable&quot;,type:&quot;boolean&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;filter&quot;,type:&quot;boolean&quot;},{name:&quot;columnOrder&quot;,type:&quot;int&quot;},{name:&quot;columnRendererCategory&quot;,type:&quot;String&quot;},{name:&quot;columnRenderer&quot;,type:&quot;object&quot;},{name:&quot;primaryKey&quot;,type:&quot;boolean&quot;},{name:&quot;sqlColumnType&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;specificColumnType&quot;,type:&quot;string&quot;},{name:&quot;javaSqlColumnType&quot;,type:&quot;int&quot;},{name:&quot;columnClass&quot;,type:&quot;int&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;},{name:&quot;format&quot;,type:&quot;string&quot;}],listeners:{add:function(u,t){Ext.each(t,function(v){if(v.data.specificColumnType==&quot;DATABASE&quot;){if(Ext.isEmpty(v.data.header)){v.data.header=v.data.dataIndex}if(Ext.isEmpty(v.data.columnAlias)){v.data.columnAlias=v.data.dataIndex.toLowerCase()}if(sql2ext.get(v.get(&quot;sqlColumnType&quot;))==&quot;dateAsString&quot;&amp;&amp;Ext.isEmpty(v.data.format)){v.data.format=SITOOLS_DEFAULT_IHM_DATE_FORMAT}}})}}});var d=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.visible&quot;),dataIndex:&quot;visible&quot;,width:55,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/visible.html&quot;});var g=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.sortable&quot;),dataIndex:&quot;sortable&quot;,width:55,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/sortable.html&quot;});var q=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.primaryKey&quot;),dataIndex:&quot;primaryKey&quot;,width:55,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/primaryKey.html&quot;});var k=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;display&quot;],data:[[&quot;&quot;,&quot;&quot;],[&quot;ASC&quot;,&quot;ASC&quot;],[&quot;DESC&quot;,&quot;DESC&quot;]]});var a=new Ext.form.ComboBox({header:i18n.get(&quot;headers.orderBy&quot;),store:k,mode:&quot;local&quot;,typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,selectOnFocus:true,dataIndex:&quot;orderBy&quot;,lazyRender:true,listClass:&quot;x-combo-list-small&quot;,valueField:&quot;value&quot;,displayField:&quot;display&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;x-combo-list-item comboItem&quot;&gt;{display}&lt;/div&gt;&lt;/tpl&gt;',width:55,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/orderBy.html&quot;});var p=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;display&quot;,&quot;tooltip&quot;],data:[[&quot;&quot;,&quot;&quot;],[&quot;Image&quot;,&quot;Image&quot;,i18n.get(&quot;label.image.tooltip&quot;)],[&quot;URL&quot;,&quot;URL&quot;,i18n.get(&quot;label.url.tooltip&quot;)],[&quot;DataSetLink&quot;,&quot;DataSetLink&quot;,i18n.get(&quot;label.datasetlink.tooltip&quot;)],[&quot;Other&quot;,&quot;Other&quot;,i18n.get(&quot;label.other.tooltip&quot;)]]});var m=new Ext.form.ComboBox({disabled:this.action==&quot;view&quot;?true:false,store:p,mode:&quot;local&quot;,typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,selectOnFocus:true,data:&quot;light&quot;,lazyRender:true,listClass:&quot;x-combo-list-small&quot;,valueField:&quot;value&quot;,displayField:&quot;display&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div ext:qtip=&quot;{tooltip}&quot; class=&quot;x-combo-list-item comboItem&quot;&gt;{display}&lt;/div&gt;&lt;/tpl&gt;',listeners:{scope:this,select:function(B,u){var A=B.getValue();var z=(Ext.isEmpty(B.lastValue))?B.startValue:B.lastValue;var t=this.getSelectionModel().getSelected();if(!Ext.isEmpty(A)){var v=new sitools.admin.datasets.columnRendererWin({selectedRecord:t,gridView:this.getView(),columnRendererType:A,datasetColumnStore:b,lastColumnRendererType:z});v.show()}}}});var f=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.filter&quot;),dataIndex:&quot;filter&quot;,width:55,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/filters.html&quot;});var n=new Ext.ux.grid.LockingColumnModel({columns:[{header:i18n.get(&quot;headers.sqlDefinition&quot;),dataIndex:&quot;dataIndex&quot;,width:120,locked:true,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/sqlDefinition.html&quot;},{header:i18n.get(&quot;headers.tableName&quot;),dataIndex:&quot;tableName&quot;,width:80},{header:i18n.get(&quot;headers.tableAlias&quot;),dataIndex:&quot;tableAlias&quot;,width:80},{header:i18n.get(&quot;headers.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;,width:80,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false,allowBlank:false,maxLength:50,validator:function(t){var u=new RegExp(&quot;^.*[!\&quot;#$%&amp;'/()*+,:;&lt;=&gt;?@\\`{}|~]+.*$&quot;);if(!u.test(t)){return !u.test(t)}else{return i18n.get(&quot;label.invalidColumnAlias&quot;)}}}),helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/columnAlias.html&quot;},{header:i18n.get(&quot;headers.format&quot;),dataIndex:&quot;format&quot;,width:80,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false,allowBlank:true,maxLength:50,value:&quot;Y-m-d\\TH:i:s.u&quot;}),helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/format.html&quot;},{header:i18n.get(&quot;headers.unit&quot;),dataIndex:&quot;unit&quot;,width:80,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;client-admin/res/help/&quot;+LOCALE+&quot;/dataset/unit.html&quot;,renderer:function(t){if(Ext.isEmpty(t)){return&quot;&quot;}else{return t.label}}},{header:i18n.get(&quot;headers.header&quot;),dataIndex:&quot;header&quot;,width:80,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false,allowBlank:false,maxLength:50}),helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;client-admin/res/help/&quot;+LOCALE+&quot;/dataset/headers.html&quot;},{header:i18n.get(&quot;headers.width&quot;),dataIndex:&quot;width&quot;,width:40,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false,allowBlank:false,maxLength:50})},g,d,f,{header:i18n.get(&quot;headers.orderBy&quot;),dataIndex:&quot;orderBy&quot;,width:55,editor:a,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/orderBy.html&quot;},q,{header:i18n.get(&quot;headers.previewUrl&quot;),dataIndex:&quot;columnRendererCategory&quot;,width:120,editor:m,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/previewUrl.html&quot;},{header:i18n.get(&quot;headers.tooltip&quot;),dataIndex:&quot;toolTip&quot;,width:80,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;client-admin/res/help/&quot;+LOCALE+&quot;/dataset/tooltip.html&quot;,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false,allowBlank:false,maxLength:50})}],defaults:{sortable:false,width:80}});var s=new Ext.grid.RowSelectionModel({singleSelect:true});var l=new Ext.menu.Menu({defaults:{scope:this},items:[{text:i18n.get(&quot;label.assignUnit&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh_clue.png&quot;,handler:this.onAssignUnit},{text:i18n.get(&quot;label.deleteUnit&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh_clue.png&quot;,handler:this.onDeleteUnit}]});var e={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateColumn},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModifyColumn},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteColumn},{text:i18n.get(&quot;label.action&quot;),menu:l}]};sitools.admin.datasets.gridFieldSetup.superclass.constructor.call(this,Ext.apply({id:&quot;gridColumnSelect&quot;,title:i18n.get(&quot;title.gridColumn&quot;),layout:&quot;fit&quot;,store:b,tbar:e,cm:n,sm:s,urlDictionary:c.urlDictionary,urlDimension:c.urlDimension,urlDataset:c.urlDataset,action:c.action,plugins:[g,d,f,q],listeners:{scope:this,beforeedit:function(u){if(u.column==4){var t=u.grid;var v=u.record;if(sql2ext.get(v.get(&quot;sqlColumnType&quot;))!=&quot;dateAsString&quot;){return false}}return true}}}))};Ext.extend(sitools.admin.datasets.gridFieldSetup,Ext.ux.grid.LockingEditorGridPanel,{onAssignUnit:function(){var b=this;var c=b.getSelectionModel().getSelected();if(!c){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}var a=new sitools.admin.datasets.unitWin({recordColumn:c,viewColumn:b.getView(),urlDimension:this.urlDimension});a.show(ID.BOX.DATASETS)},onCreateColumn:function(){var a=new sitools.admin.datasets.columnsPropPanel({action:&quot;create&quot;,store:this.getStore()});a.show()},onModifyColumn:function(){var b=this.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}if(b.get(&quot;specificColumnType&quot;)==&quot;DATABASE&quot;){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.cannotUpdateDatabaseColumn&quot;));return}var a=new sitools.admin.datasets.columnsPropPanel({action:&quot;modify&quot;,store:this.getStore(),recordColumn:b});a.show()},onDeleteColumn:function(){var a=this;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}a.getStore().remove(b);a.getView().refresh()},onDeleteUnit:function(){var a=this;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}b.set(&quot;unit&quot;,null);b.set(&quot;dimensionId&quot;,null)},getData:function(c){var b;this.getStore().removeAll();for(b=0;b&lt;c.length;b++){var a;var d=c[b].columnRenderer;var e=&quot;&quot;;if(!Ext.isEmpty(d)){e=ColumnRendererEnum.getColumnRendererCategoryFromBehavior(d.behavior)}this.getStore().add(new Ext.data.Record({id:c[b].id,dataIndex:c[b].dataIndex,header:c[b].header,toolTip:c[b].toolTip,width:c[b].width,sortable:c[b].sortable,orderBy:c[b].orderBy,visible:c[b].visible,filter:c[b].filter,sqlColumnType:c[b].sqlColumnType,columnOrder:c[b].columnOrder,primaryKey:c[b].primaryKey,columnRenderer:d,columnRendererCategory:e,schemaName:c[b].schema,tableName:c[b].tableName,tableAlias:c[b].tableAlias,specificColumnType:c[b].specificColumnType,columnAlias:c[b].columnAlias,javaSqlColumnType:c[b].javaSqlColumnType,columnClass:c[b].columnClass,format:c[b].format,dimensionId:c[b].dimensionId,unit:c[b].unit}))}},gridFieldSetupValidation:function(){var a={success:true,message:&quot;&quot;};var b=this.getStore();var f=0;var e=0;if(b.getCount()&gt;0){var c;for(c=0;c&lt;b.getCount();c++){var g=b.getAt(c).data;if(g.columnAlias.toLowerCase()!=g.columnAlias){a={success:false,message:String.format(i18n.get(&quot;label.columnAliasMaj&quot;),g.columnAlias)};return a}if(!Ext.isEmpty(g.primaryKey)&amp;&amp;g.primaryKey){f++;if(Ext.isEmpty(g.filter)||!g.filter){a={success:false,message:String.format(i18n.get(&quot;label.columnPKNoFilter&quot;),g.columnAlias)};return a}}if(!Ext.isEmpty(g.orderBy)&amp;&amp;g.orderBy){e++}}if(f!=1){a={success:false,message:f+i18n.get(&quot;label.wrongPrimaryKey&quot;)};return a}if(e&lt;1){a={success:false,message:i18n.get(&quot;label.noOrderBy&quot;)};return a}}var d=this.checkForDoublon();if(d.found){a={success:false,message:i18n.get(&quot;label.doublonFound&quot;)+d.doublon}}return a},checkForDoublon:function(){var g=null,c;var a=this.getStore();var f=false;for(c=0;c&lt;a.getCount()&amp;&amp;!f;c++){var e=a.getAt(c).data;f=false;for(var b=0;b&lt;a.getCount()&amp;&amp;g===null&amp;&amp;!f;b++){var d=a.getAt(b).data;if(e.columnAlias==d.columnAlias&amp;&amp;e!=d){f=true;g=e.columnAlias}}}return{found:f,doublon:g}}});Ext.ux.sitoolsGridView=Ext.extend(Ext.grid.GridView,{beforeColMenuShow:function(){var a=this.cm,c=a.getColumnCount();this.colMenu.removeAll();for(var b=0;b&lt;c;b++){if(a.config[b].hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:&quot;col-&quot;+a.getColumnId(b),text:a.getColumnHeader(b),checked:!a.isHidden(b),hideOnClick:false,disabled:a.config[b].hideable===false,listeners:{scope:this,checkchange:function(e,f){if(f){var d=extColModelToSrv(this.cm);this.grid.getStore().load({params:{colModel:Ext.util.JSON.encode(d)}})}}}}))}}},doRender:function(d,A,m,a,t,v){var e=this.templates,c=e.cell,D=e.row,p=t-1;var b=&quot;width:&quot;+this.getTotalWidth()+&quot;;&quot;;var k=[],l=[],n={tstyle:b},s={},g,f;for(var u=0,B=A.length;u&lt;B;u++){f=A[u];l=[];var q=u+a;for(var z=0;z&lt;t;z++){g=d[z];s.id=g.id;s.css=z===0?&quot;x-grid3-cell-first &quot;:(z==p?&quot;x-grid3-cell-last &quot;:&quot;&quot;);s.attr=s.cellAttr=&quot;&quot;;s.style=g.style;s.value=g.renderer.call(g.scope,f.data[g.name],s,f,q,z,m);if(Ext.isEmpty(s.value)){s.value=&quot;&amp;#160;&quot;}if(this.markDirty&amp;&amp;f.dirty&amp;&amp;Ext.isDefined(f.modified[g.name])){s.css+=&quot; x-grid3-dirty-cell&quot;}l[l.length]=c.apply(s)}var C=[];if(v&amp;&amp;((q+1)%2===0)){C[0]=&quot;x-grid3-row-alt&quot;}if(f.dirty){C[1]=&quot; x-grid3-dirty-row&quot;}n.cols=t;if(this.getRowClass){C[2]=this.getRowClass(f,q,n,m)}n.alt=C.join(&quot; &quot;);n.cells=l.join(&quot;&quot;);k[k.length]=D.apply(n)}if(A.length==0){var C=[];n.cols=t;n.cells=&quot; &quot;;k[0]=D.apply(n)}return k.join(&quot;&quot;)},renderRows:function(l,c){var d=this.grid,f=d.colModel,a=d.store,m=d.stripeRows;var k=f.getColumnCount();var e=this.getColumnData();l=l||0;c=!Ext.isDefined(c)?a.getCount()-1:c;var b=a.getRange(l,c);return this.doRender(e,b,a,l,k,m)}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.GridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(this.cls){this.cls+=&quot; ext-ux-livegrid&quot;}else{this.cls=&quot;ext-ux-livegrid&quot;}Ext.ux.grid.livegrid.GridPanel.superclass.initComponent.call(this)},onRender:function(b,a){Ext.ux.grid.livegrid.GridPanel.superclass.onRender.call(this,b,a);var c=this.getStore();if(c._autoLoad===true){delete c._autoLoad;c.load()}},walkCells:function(k,c,f,e,d){var g=this.store;var a=g.getCount;g.getCount=g.getTotalCount;var b=Ext.ux.grid.livegrid.GridPanel.superclass.walkCells.call(this,k,c,f,e,d);g.getCount=a;return b}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.GridView=function(a){this.addEvents({beforebuffer:true,buffer:true,bufferfailure:true,cursormove:true,abortrequest:true});this.horizontalScrollOffset=17;this._checkEmptyBody=true;Ext.apply(this,a);this.templates={};this.templates.master=new Ext.Template('&lt;div class=&quot;x-grid3&quot; hidefocus=&quot;true&quot;&gt;&lt;div class=&quot;liveScroller&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-viewport&quot;&quot;&gt;','&lt;div class=&quot;x-grid3-header&quot;&gt;&lt;div class=&quot;x-grid3-header-inner&quot;&gt;&lt;div class=&quot;x-grid3-header-offset&quot; style=&quot;{ostyle}&quot;&gt;{header}&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;x-clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-scroller&quot; style=&quot;overflow-y:hidden !important;&quot;&gt;&lt;div class=&quot;x-grid3-body&quot; style=&quot;{bstyle}&quot;&gt;{body}&lt;/div&gt;&lt;a href=&quot;#&quot; class=&quot;x-grid3-focus&quot; tabIndex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;,'&lt;div class=&quot;x-grid3-resize-marker&quot;&gt;&amp;#160;&lt;/div&gt;','&lt;div class=&quot;x-grid3-resize-proxy&quot;&gt;&amp;#160;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;);this._gridViewSuperclass=Ext.ux.grid.livegrid.GridView.superclass;this._gridViewSuperclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.GridView,Ext.ux.sitoolsGridView,{hdHeight:0,rowClipped:0,liveScroller:null,liveScrollerInsets:null,rowHeight:-1,visibleRows:1,lastIndex:-1,lastRowIndex:0,lastScrollPos:0,rowIndex:0,isBuffering:false,requestQueue:-1,loadMask:false,loadMaskDisplayed:false,isPrebuffering:false,_loadMaskAnchor:null,_displayWarningTooManyRows:true,reset:function(d){if(d===false){this.ds.modified=[];this.rowIndex=0;this.lastScrollPos=0;this.lastRowIndex=0;this.lastIndex=0;this.adjustVisibleRows();this.adjustScrollerPos(-this.liveScroller.dom.scrollTop,true);this.showLoadMask(false);var b=this.processRows;this.processRows=Ext.emptyFn;this.refresh(true);this.processRows=b;this.processRows(0);this.fireEvent(&quot;cursormove&quot;,this,0,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return false}else{var c={colModel:Ext.util.JSON.encode(extColModelToSrv(this.cm))};var a=this.ds.sortInfo;if(a){Ext.apply(c,{dir:a.direction,sort:a.field})}return this.ds.load({params:c})}},render:function(){if(this.autoFill){var a=this.grid.ownerCt;if(a&amp;&amp;a.getLayout()){a.on(&quot;afterlayout&quot;,function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI()},renderUI:function(){var b=this.grid;var c=b.enableDragDrop||b.enableDrag;b.enableDragDrop=false;b.enableDrag=false;var a=this._gridViewSuperclass.renderUI.call(this);b=this.grid;b.enableDragDrop=c;b.enableDrag=c;if(c){this.dragZone=new Ext.ux.grid.livegrid.DragZone(b,{ddGroup:b.ddGroup||&quot;GridDD&quot;})}return a},afterRenderUI:function(){this._gridViewSuperclass.afterRenderUI.call(this);if(this.loadMask){this._loadMaskAnchor=Ext.get(this.mainBody.dom.parentNode.parentNode);Ext.apply(this.loadMask,{msgCls:&quot;x-mask-loading&quot;});this._loadMaskAnchor.mask(this.loadMask.msg,this.loadMask.msgCls);var b=this._loadMaskAnchor.dom;var a=Ext.Element.data;a(b,&quot;mask&quot;).addClass(&quot;ext-ux-livegrid&quot;);a(b,&quot;mask&quot;).setDisplayed(false);a(b,&quot;maskMsg&quot;).setDisplayed(false)}},init:function(a){this._gridViewSuperclass.init.call(this,a);a.on(&quot;expand&quot;,this._onExpand,this)},initData:function(b,a){if(this.ds){this.ds.un(&quot;bulkremove&quot;,this.onBulkRemove,this);this.ds.un(&quot;beforeload&quot;,this.onBeforeLoad,this)}if(b){b.on(&quot;bulkremove&quot;,this.onBulkRemove,this);b.on(&quot;beforeload&quot;,this.onBeforeLoad,this)}this._gridViewSuperclass.initData.call(this,b,a)},renderBody:function(){var a=this.renderRows(0,this.visibleRows-1);return this.templates.body.apply({rows:a})},doRender:function(c,b,e,a,d,f){return this._gridViewSuperclass.doRender.call(this,c,b,e,a+this.ds.bufferRange[0],d,f)},initElements:function(){var g=Ext.Element;var c=this.grid.getGridEl().dom.firstChild;var b=c.childNodes;this.el=new g(c);this.mainWrap=new g(b[1]);this.liveScroller=new g(b[0]);var e=this.liveScroller.dom.firstChild;this.liveScrollerInsets=[e];var a=e.nextSibling;while(!Ext.isEmpty(a)){this.liveScrollerInsets.push(a);a=a.nextSibling}this.liveScroller.on(&quot;scroll&quot;,this.onLiveScroll,this,{buffer:this.scrollDelay});var d=this.mainWrap.dom.firstChild;this.mainHd=new g(d);this.hdHeight=d.offsetHeight;this.innerHd=this.mainHd.dom.firstChild;this.scroller=new g(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle(&quot;overflow-x&quot;,&quot;hidden&quot;)}this.mainBody=new g(this.scroller.dom.firstChild);this.mainBody.on(&quot;mousewheel&quot;,this.handleWheel,this);this.focusEl=new g(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent(&quot;click&quot;,true);this.resizeMarker=new g(b[2]);this.resizeProxy=new g(b[3])},layout:function(){if(!this.mainBody){return}var f=this.grid;var l=f.getGridEl(),n=this.cm,b=f.autoExpandColumn,a=this;var d=l.getSize(true);var m=d.width;if(!f.hideHeaders&amp;&amp;m&lt;20||d.height&lt;20){return}if(f.autoHeight){this.scroller.dom.style.overflow=&quot;visible&quot;;if(Ext.isWebKit){this.scroller.dom.style.position=&quot;static&quot;}}else{this.el.setSize(d.width,d.height);var k=this.mainHd.getHeight();var e=d.height-(k);this.scroller.setSize(m,e);if(this.innerHd){this.innerHd.style.width=(m)+&quot;px&quot;}}this.liveScroller.dom.style.top=this.hdHeight+&quot;px&quot;;if(this.forceFit){if(this.lastViewWidth!=m){this.fitColumns(false,false);this.lastViewWidth=m}}else{this.autoExpand()}this.adjustVisibleRows();this.adjustBufferInset();this.onLayout(m,e)},removeRow:function(a){Ext.removeNode(this.getRow(a))},removeRows:function(c,a){var b=this.mainBody.dom;for(var d=c;d&lt;=a;d++){Ext.removeNode(b.childNodes[c])}},_onExpand:function(a){this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*this.rowIndex,true)},onColumnMove:function(a,c,b){this.indexMap=null;this.replaceLiveRows(this.rowIndex,true);this.updateHeaders();this.updateHeaderSortState();this.afterMove(b);this.grid.fireEvent(&quot;columnmove&quot;,c,b)},onColumnWidthUpdated:function(c,a,b){this.adjustVisibleRows();this.adjustBufferInset()},onAllColumnWidthsUpdated:function(a,b){this.adjustVisibleRows();this.adjustBufferInset()},onRowSelect:function(a){if(a&lt;this.rowIndex||a&gt;this.rowIndex+this.visibleRows){return}this.addRowClass(a,this.selectedRowClass)},onRowDeselect:function(a){if(a&lt;this.rowIndex||a&gt;this.rowIndex+this.visibleRows){return}this.removeRowClass(a,this.selectedRowClass)},onClear:function(){this.reset(false)},onBulkRemove:function(p,q){var k=null;var m=0;var t=0;var n=q.length;var a=false;var l=false;var f=0;if(n===0){return}var c=this.rowIndex;var b=0;var e=0;var d=0;for(var g=0;g&lt;n;g++){k=q[g][0];m=q[g][1];t=(m!=Number.MIN_VALUE&amp;&amp;m!=Number.MAX_VALUE)?m+this.ds.bufferRange[0]:m;if(t&lt;this.rowIndex){b++}else{if(t&gt;=this.rowIndex&amp;&amp;t&lt;=this.rowIndex+(this.visibleRows-1)){d++}else{if(t&gt;=this.rowIndex+this.visibleRows){e++}}}this.fireEvent(&quot;beforerowremoved&quot;,this,t,k);this.fireEvent(&quot;rowremoved&quot;,this,t,k)}var s=this.ds.totalLength;this.rowIndex=Math.max(0,Math.min(this.rowIndex-b,s-(this.visibleRows-1)));this.lastRowIndex=this.rowIndex;this.adjustScrollerPos(-(b*this.rowHeight),true);this.updateLiveRows(this.rowIndex,true);this.adjustBufferInset();this.processRows(0,undefined,false)},onRemove:function(c,a,b){this.onBulkRemove(c,[[a,b]])},onAdd:function(b,c,g){if(this._checkEmptyBody){if(this.mainBody.dom.innerHTML==&quot;&amp;nbsp;&quot;){this.mainBody.dom.innerHTML=&quot;&quot;}this._checkEmptyBody=false}var f=c.length;if(g==Number.MAX_VALUE||g==Number.MIN_VALUE){this.fireEvent(&quot;beforerowsinserted&quot;,this,g,g);if(g==Number.MIN_VALUE){this.rowIndex=this.rowIndex+f;this.lastRowIndex=this.rowIndex;this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*f,true);this.fireEvent(&quot;rowsinserted&quot;,this,g,g,f);this.processRows(0,undefined,false);this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return}this.adjustBufferInset();this.fireEvent(&quot;rowsinserted&quot;,this,g,g,f);return}var a=g+this.ds.bufferRange[0];var e=a+(f-1);var k=this.getRows().length;var d=0;var l=0;if(a&gt;this.rowIndex+(this.visibleRows-1)){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,e);this.fireEvent(&quot;rowsinserted&quot;,this,a,e,f);this.adjustVisibleRows();this.adjustBufferInset()}else{if(a&gt;=this.rowIndex&amp;&amp;a&lt;=this.rowIndex+(this.visibleRows-1)){d=g;l=g+(f-1);this.lastRowIndex=this.rowIndex;this.rowIndex=(a&gt;this.rowIndex)?this.rowIndex:a;this.insertRows(b,d,l);if(this.lastRowIndex!=this.rowIndex){this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}this.adjustVisibleRows();this.adjustBufferInset()}else{if(a&lt;this.rowIndex){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,e);this.rowIndex=this.rowIndex+f;this.lastRowIndex=this.rowIndex;this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*f,true);this.fireEvent(&quot;rowsinserted&quot;,this,a,e,f);this.processRows(0,undefined,true);this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}}}},onBeforeLoad:function(b,c){var d=b.proxy;if(d.activeRequest&amp;&amp;d.activeRequest[Ext.data.Api.actions.read]){d.getConnection().abort(d.activeRequest[Ext.data.Api.actions.read])}this.fireEvent(&quot;abortrequest&quot;,b,c);this.isBuffering=false;this.isPreBuffering=false;c.params=c.params||{};var a=Ext.apply;a(c,{scope:this,callback:function(){this.reset(false)},suspendLoadEvent:false});a(c.params,{start:0,limit:this.ds.bufferSize});return true},onLoad:function(c,b,a){this.adjustBufferInset()},onDataChange:function(a){this.updateHeaderSortState()},liveBufferUpdate:function(a,b,d){if(d===true){this.adjustBufferInset();this.fireEvent(&quot;buffer&quot;,this,this.ds,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,b);this.grid.selModel.replaceSelections(a);this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false);if(this.requestQueue&gt;=0){var c=this.requestQueue;this.requestQueue=-1;this.updateLiveRows(c);return}if(this.isInRange(this.rowIndex)){this.replaceLiveRows(this.rowIndex,b.forceRepaint)}else{this.updateLiveRows(this.rowIndex)}return}else{this.fireEvent(&quot;bufferfailure&quot;,this,this.ds,b)}this.requestQueue=-1;this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false)},handleWheel:function(a){if(this.rowHeight==-1){a.stopEvent();return}var b=a.getWheelDelta();this.adjustScrollerPos(-(b*this.rowHeight));a.stopEvent()},onLiveScroll:function(){var a=this.liveScroller.dom.scrollTop;var b=Math.floor((a)/this.rowHeight);this.rowIndex=b;if(b==this.lastRowIndex){return}this.updateLiveRows(b);this.lastScrollPos=this.liveScroller.dom.scrollTop},refreshRow:function(a){var d=this.ds,c;if(typeof a==&quot;number&quot;){c=a;a=d.getAt(c)}else{c=d.indexOf(a)}var b=c+this.ds.bufferRange[0];if(b&lt;this.rowIndex||b&gt;=this.rowIndex+this.visibleRows){this.fireEvent(&quot;rowupdated&quot;,this,b,a);return}this.insertRows(d,c,c,true);this.fireEvent(&quot;rowupdated&quot;,this,b,a)},processRows:function(f,d,a){if(!this.ds||this.ds.getCount()&lt;1){return}d=d||!this.grid.stripeRows;var g=this.rowIndex;var l=this.getRows();var c=0;var k=null;for(var e=0,b=l.length;e&lt;b;e++){k=l[e];k.rowIndex=c=g+e;k.className=k.className.replace(this.rowClsRe,&quot; &quot;);if(!d&amp;&amp;(c+1)%2===0){k.className+=&quot; x-grid3-row-alt&quot;}if(a!==false){if(this.grid.selModel.isSelected(this.ds.getAt(c))===true){this.addRowClass(c,this.selectedRowClass)}else{this.removeRowClass(c,this.selectedRowClass)}this.fly(k).removeClass(&quot;x-grid3-row-over&quot;)}}if(g===0){Ext.fly(l[0]).addClass(this.firstRowCls)}else{if(g+l.length==this.ds.totalLength){Ext.fly(l[l.length-1]).addClass(this.lastRowCls)}}},insertRows:function(e,b,q,p){var a=b+this.ds.bufferRange[0];var f=q+this.ds.bufferRange[0];if(!p){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,f)}if(p!==true&amp;&amp;(this.getRows().length+(q-b))&gt;=this.visibleRows){this.removeRows((this.visibleRows-1)-(q-b),this.visibleRows-1)}else{if(p){this.removeRows(a-this.rowIndex,f-this.rowIndex)}}var g=(b==q)?q:Math.min(q,(this.rowIndex-this.ds.bufferRange[0])+(this.visibleRows-1));var d=this.renderRows(b,g);var l=this.getRow(a);if(l){Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,l,d)}else{Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.mainBody.dom,d)}if(p===true){var n=this.getRows();var m=this.rowIndex;for(var c=0,k=n.length;c&lt;k;c++){n[c].rowIndex=m+c}}if(!p){this.fireEvent(&quot;rowsinserted&quot;,this,a,f,(f-a)+1);this.processRows(0,undefined,true)}},getRow:function(a){if(a-this.rowIndex&lt;0){return null}return this.getRows()[a-this.rowIndex]},getCell:function(c,a){var b=this.getRow(c);return b?b.getElementsByTagName(&quot;td&quot;)[a]:null},focusCell:function(d,a,c){var b=this.ensureVisible(d,a,c);if(!b){return}this.focusEl.setXY(b);if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},ensureVisible:function(p,d,b){if(typeof p!=&quot;number&quot;){p=p.rowIndex}if(p&lt;0||p&gt;=this.ds.totalLength){return}d=(d!==undefined?d:0);var l=p-this.rowIndex;if(this.rowClipped&amp;&amp;p==this.rowIndex+this.visibleRows-1){this.adjustScrollerPos(this.rowHeight)}else{if(p&gt;=this.rowIndex+this.visibleRows){this.adjustScrollerPos(((p-(this.rowIndex+this.visibleRows))+1)*this.rowHeight)}else{if(p&lt;=this.rowIndex){this.adjustScrollerPos((l)*this.rowHeight)}}}var k=this.getRow(p),e;if(!k){return}if(!(b===false&amp;&amp;d===0)){while(this.cm.isHidden(d)){d++}e=this.getCell(p,d)}var n=this.scroller.dom;if(b!==false){var m=parseInt(e.offsetLeft,10);var g=m+e.offsetWidth;var f=parseInt(n.scrollLeft,10);var a=f+n.clientWidth;if(m&lt;f){n.scrollLeft=m}else{if(g&gt;a){n.scrollLeft=g-n.clientWidth}}}return e?Ext.fly(e).getXY():[n.scrollLeft+this.el.getX(),Ext.fly(k).getY()]},isRecordRendered:function(a){var b=this.ds.indexOf(a);if(b&gt;=this.rowIndex&amp;&amp;b&lt;this.rowIndex+this.visibleRows){return true}return false},isInRange:function(b){var a=Math.min(this.ds.totalLength-1,b+(this.visibleRows-1));return(b&gt;=this.ds.bufferRange[0])&amp;&amp;(a&lt;=this.ds.bufferRange[1])},getPredictedBufferIndex:function(a,b,c){if(!b){if(a+this.ds.bufferSize&gt;=this.ds.totalLength){return this.ds.totalLength-this.ds.bufferSize}return Math.max(0,(a+this.visibleRows)-Math.round(this.ds.bufferSize/2))}if(!c){return Math.max(0,(a-this.ds.bufferSize)+this.visibleRows)}if(c){return Math.max(0,Math.min(a,this.ds.totalLength-this.ds.bufferSize))}},updateLiveRows:function(g,k,d){var m=this.isInRange(g);if(this.isBuffering){if(this.isPrebuffering){if(m){this.replaceLiveRows(g,k)}else{this.showLoadMask(true)}}this.fireEvent(&quot;cursormove&quot;,this,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);this.requestQueue=g;return}var e=this.lastIndex;this.lastIndex=g;m=this.isInRange(g);var l=false;if(m&amp;&amp;d!==true){this.replaceLiveRows(g,k);this.fireEvent(&quot;cursormove&quot;,this,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);if(g&gt;e){l=true;var n=this.ds.totalLength;if(g+this.visibleRows+this.nearLimit&lt;=this.ds.bufferRange[1]){return}if(this.ds.bufferRange[1]+1&gt;=n){return}}else{if(g&lt;e){l=false;if(this.ds.bufferRange[0]&lt;=0){return}if(g-this.nearLimit&gt;this.ds.bufferRange[0]){return}}else{return}}this.isPrebuffering=true}this.isBuffering=true;var b=this.getPredictedBufferIndex(g,m,l);if(!m){this.showLoadMask(true)}this.ds.suspendEvents();var f=this.ds.sortInfo;var c={};if(this.ds.lastOptions){Ext.apply(c,this.ds.lastOptions.params)}c.start=b;c.limit=this.ds.bufferSize;c.nocount=true;if(f){c.dir=f.direction;c.sort=f.field}var a={forceRepaint:k,callback:this.liveBufferUpdate,scope:this,params:c,suspendLoadEvent:true};this.fireEvent(&quot;beforebuffer&quot;,this,this.ds,g,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,a);this.ds.load(a);this.ds.resumeEvents()},showLoadMask:function(b){if(!this.loadMask||b==this.loadMaskDisplayed){return}var e=this._loadMaskAnchor.dom;var d=Ext.Element.data;var a=d(e,&quot;mask&quot;);var c=d(e,&quot;maskMsg&quot;);if(b){a.setDisplayed(true);c.setDisplayed(true);c.center(this._loadMaskAnchor);if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;this._loadMaskAnchor.getStyle(&quot;height&quot;)==&quot;auto&quot;){a.setSize(undefined,this._loadMaskAnchor.getHeight())}}else{a.setDisplayed(false);c.setDisplayed(false)}this.loadMaskDisplayed=b},replaceLiveRows:function(k,g,c){var d=k-this.lastRowIndex;if(d===0&amp;&amp;g!==true){return}var a=d&gt;0;d=Math.abs(d);var b=this.ds.bufferRange;var l=k-b[0];var e=Math.min(l+this.visibleRows-1,b[1]-b[0]);if(d&gt;=this.visibleRows||d===0){this.mainBody.update(this.renderRows(l,e))}else{if(a){this.removeRows(0,d-1);if(l+this.visibleRows-d&lt;=b[1]-b[0]){var f=this.renderRows(l+this.visibleRows-d,e);Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.mainBody.dom,f)}}else{this.removeRows(this.visibleRows-d,this.visibleRows-1);f=this.renderRows(l,l+d-1);Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,this.mainBody.dom.firstChild,f)}}if(c!==false){this.processRows(0,undefined,true)}this.lastRowIndex=k},adjustBufferInset:function(){var m=this.liveScroller.dom;var f=this.grid,b=f.store;var l=f.getGridEl();var q=l.getSize().width;var a=(b.totalLength==this.visibleRows-this.rowClipped)?0:Math.max(0,b.totalLength-(this.visibleRows-this.rowClipped));if(a===0){this.scroller.setWidth(q);m.style.display=&quot;none&quot;;return}else{this.scroller.setWidth(q-this.getScrollOffset());m.style.display=&quot;&quot;}var t=this.cm.getTotalWidth()+this.getScrollOffset()&gt;q;var p=m.parentNode.offsetHeight+((b.totalLength&gt;0&amp;&amp;t)?-this.horizontalScrollOffset:0)-this.hdHeight;m.style.height=Math.max(p,this.horizontalScrollOffset*2)+&quot;px&quot;;this.liveScroller.dom.style.width=(this.getScrollOffset()+2)+&quot;px&quot;;if(this.rowHeight==-1){return}var e=(a===0?0:p+(a*this.rowHeight));if(e&gt;35791380){e=35000000;var s=Math.floor(e/this.rowHeight);if(this._displayWarningTooManyRows){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),String.format(i18n.get(&quot;label.tooManyRecords&quot;),s,this.visibleRows+a));this._displayWarningTooManyRows=false}}var n=e;var k=this.liveScrollerInsets.length;if(e===0){e=0}else{e=Math.round(e/k)}for(var d=0;d&lt;k;d++){if(d==k-1&amp;&amp;e!==0){e-=(e*k)-n}this.liveScrollerInsets[d].style.height=e+&quot;px&quot;}},adjustVisibleRows:function(){if(this.rowHeight==-1){if(this.getRows()[0]){this.rowHeight=this.getRows()[0].offsetHeight;if(this.rowHeight&lt;=0){this.rowHeight=-1;return}}else{return}}var f=this.grid,d=f.store;var k=f.getGridEl();var m=this.cm;var p=k.getSize();var b=p.width;var e=p.height;var l=b-this.getScrollOffset();if(m.getTotalWidth()&gt;l){e-=this.horizontalScrollOffset}e-=this.mainHd.getHeight();var n=d.totalLength||0;var a=Math.max(1,Math.floor(e/this.rowHeight));this.rowClipped=0;if(n&gt;a&amp;&amp;this.rowHeight/3&lt;(e-(a*this.rowHeight))){a=Math.min(a+1,n);this.rowClipped=1}if(this.visibleRows==a){return}this.visibleRows=a;if(this.isBuffering&amp;&amp;!this.isPrebuffering){return}if(this.rowIndex+(a-this.rowClipped)&gt;n){this.rowIndex=Math.max(0,n-(a-this.rowClipped));this.lastRowIndex=this.rowIndex}this.updateLiveRows(this.rowIndex,true)},adjustScrollerPos:function(d,a){if(d===0){return}var c=this.liveScroller;var b=c.dom;if(a===true){c.un(&quot;scroll&quot;,this.onLiveScroll,this)}this.lastScrollPos=b.scrollTop;b.scrollTop+=d;if(a===true){b.scrollTop=b.scrollTop;c.on(&quot;scroll&quot;,this.onLiveScroll,this,{buffer:this.scrollDelay})}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.JsonReader=function(a,b){Ext.ux.grid.livegrid.JsonReader.superclass.constructor.call(this,a,b)};Ext.extend(Ext.ux.grid.livegrid.JsonReader,Ext.data.JsonReader,{buildExtractors:function(){if(this.ef){return}var a=this.meta;if(a.versionProperty){this.getVersion=this.createAccessor(a.versionProperty)}Ext.ux.grid.livegrid.JsonReader.superclass.buildExtractors.call(this)},readRecords:function(c){if(!this.__readRecords){this.__readRecords=Ext.ux.grid.livegrid.JsonReader.superclass.readRecords}var b=this.__readRecords.call(this,c);if(this.meta.versionProperty){var a=this.getVersion(c);b.version=(a===undefined||a===&quot;&quot;)?null:a}if(Ext.isEmpty(c.total)){b.totalRecords=this.totalRecordsSitools}else{this.totalRecordsSitools=c.total}return b}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.RowSelectionModel=function(a){this.addEvents({selectiondirty:true,handleMouseDown:true});Ext.apply(this,a);this.pendingSelections={};Ext.ux.grid.livegrid.RowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.RowSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Ext.ux.grid.livegrid.RowSelectionModel.superclass.initEvents.call(this);this.grid.view.on(&quot;rowsinserted&quot;,this.onAdd,this);this.grid.store.on(&quot;selectionsload&quot;,this.onSelectionsLoad,this)},handleMouseDown:function(d,k,f){if(f.button!==0||this.isLocked()){return}var a=this.grid.getView();if(f.shiftKey&amp;&amp;!this.singleSelect&amp;&amp;this.last!==false){var c=this.last;this.selectRange(c,k,f.ctrlKey);this.last=c;this.fireEvent(&quot;handleMouseDown&quot;,this)}else{var b=this.isSelected(k);if(f.ctrlKey&amp;&amp;b){this.deselectRow(k);this.fireEvent(&quot;handleMouseDown&quot;,this)}else{if(!b||this.getCount()&gt;1){this.selectRow(k,f.ctrlKey||f.shiftKey);this.fireEvent(&quot;handleMouseDown&quot;,this)}}}},onRemove:function(b,d,g){var a=this.getPendingSelections();var c=a.length;var f=false;if(d==Number.MIN_VALUE||d==Number.MAX_VALUE){if(g){if(this.isIdSelected(g.id)&amp;&amp;d==Number.MIN_VALUE){this.shiftSelections(this.grid.store.bufferRange[1],-1)}this.selections.remove(g);f=true}if(d==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0])}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(c!==0){this.fireEvent(&quot;selectiondirty&quot;,this,d,1)}}else{f=this.isIdSelected(g.id);if(!f){return}this.selections.remove(g);if(c!==0){var k=a[0];var e=a[c-1];if(d&lt;=e||d&lt;=k){this.shiftSelections(d,-1);this.fireEvent(&quot;selectiondirty&quot;,this,d,1)}}}if(f){this.fireEvent(&quot;selectionchange&quot;,this)}},onAdd:function(g,e,d,b){var a=this.getPendingSelections();var k=a.length;if((e==Number.MIN_VALUE||e==Number.MAX_VALUE)){if(e==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0]);this.shiftSelections(this.grid.store.bufferRange[1],b)}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(k!==0){this.fireEvent(&quot;selectiondirty&quot;,this,e,r)}return}var f=a[0];var c=a[k-1];var l=e;if(l&lt;=c||l&lt;=f){this.fireEvent(&quot;selectiondirty&quot;,this,l,b);this.shiftSelections(l,b)}},shiftSelections:function(p,c){var k=0;var n=0;var b={};var d=this.grid.store;var l=p-d.bufferRange[0];var f=0;var q=this.grid.store.totalLength;var e=null;var a=this.getPendingSelections();var m=a.length;if(m===0){return}for(var g=0;g&lt;m;g++){k=a[g];if(k&lt;p){continue}n=k+c;f=l+c;if(n&gt;=q){break}e=d.getAt(f);if(e){this.selections.add(e)}else{b[n]=true}this.allSelections[n]=true}this.pendingSelections=b},onSelectionsLoad:function(c,b,a){this.replaceSelections(b)},hasNext:function(){return this.last!==false&amp;&amp;(this.last+1)&lt;this.grid.store.getTotalCount()},getCount:function(){return this.selections.length+this.getPendingSelections().length},isSelected:function(a){if(typeof a==&quot;number&quot;){var b=a;a=this.grid.store.getAt(b);if(!a){var d=this.getPendingSelections().indexOf(b);if(d!=-1){return true}return false}}var c=a;return(c&amp;&amp;this.selections.key(c.id)?true:false)},deselectRecord:function(a,c){if(this.locked){return}var e=this.selections.key(a.id);if(!e){return}var b=this.grid.store;var d=b.indexOfId(a.id);if(d==-1){d=b.findInsertIndex(a);if(d!=Number.MIN_VALUE&amp;&amp;d!=Number.MAX_VALUE){d+=b.bufferRange[0]}}else{delete this.pendingSelections[d]}if(this.last==d){this.last=false}if(this.lastActive==d){this.lastActive=false}delete this.allSelections[d];this.selections.remove(a);if(!c){this.grid.getView().onRowDeselect(d)}this.fireEvent(&quot;rowdeselect&quot;,this,d,a);this.fireEvent(&quot;selectionchange&quot;,this)},deselectRow:function(b,a){if(this.locked){return}if(this.last==b){this.last=false}if(this.lastActive==b){this.lastActive=false}var c=this.grid.store.getAt(b);delete this.allSelections[b];delete this.pendingSelections[b];if(c){this.selections.remove(c)}if(!a){this.grid.getView().onRowDeselect(b)}this.fireEvent(&quot;rowdeselect&quot;,this,b,c);this.fireEvent(&quot;selectionchange&quot;,this)},selectRow:function(b,d,a){if(this.locked||b&lt;0||b&gt;=this.grid.store.getTotalCount()){return}var c=this.grid.store.getAt(b);if(this.fireEvent(&quot;beforerowselect&quot;,this,b,d,c)!==false){if(!d||this.singleSelect){this.clearSelections()}if(c){this.selections.add(c);delete this.pendingSelections[b]}else{this.pendingSelections[b]=true}this.allSelections[b]=true;this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent(&quot;rowselect&quot;,this,b,c);this.fireEvent(&quot;selectionchange&quot;,this)}},clearPendingSelections:function(g,f){if(f===undefined){f=Number.MAX_VALUE}var b={};var a=this.getPendingSelections();var d=a.length;var c=0;for(var e=0;e&lt;d;e++){c=a[e];if(c&lt;=f&amp;&amp;c&gt;=g){continue}b[c]=true}this.pendingSelections=b},replaceSelections:function(e){if(!e||e.length===0){return}var d=this.grid.store;var f=null;var m=[];var a=this.getPendingSelections();var n=a.length;var c=this.selections;var l=0;for(var g=0;g&lt;n;g++){l=a[g];f=d.getAt(l);if(f){c.add(f);m.push(f.id);delete this.pendingSelections[l]}}var b=null;var k=null;for(g=0,k=e.length;g&lt;k;g++){f=e[g];b=f.id;if(m.indexOf(b)==-1&amp;&amp;c.containsKey(b)){c.add(f)}}},getPendingSelections:function(f){var d=1;var c=[];var b=0;var g=[];for(var e in this.pendingSelections){g.push(parseInt(e))}g.sort(function(l,k){if(l&gt;k){return 1}else{if(l&lt;k){return -1}else{return 0}}});if(!f){return g}var a=g.length;if(a===0){return[]}c[b]=[g[0],g[0]];for(var e=0,a=a-1;e&lt;a;e++){if(g[e+1]-g[e]==1){c[b][1]=g[e+1]}else{b++;c[b]=[g[e+1],g[e+1]]}}return c},getAllSelections:function(f){var d=1;var c=[];var b=0;var g=[];for(var e in this.allSelections){g.push(parseInt(e))}g.sort(function(l,k){if(l&gt;k){return 1}else{if(l&lt;k){return -1}else{return 0}}});if(!f){return g}var a=g.length;if(a===0){return[]}c[b]=[g[0],g[0]];for(var e=0,a=a-1;e&lt;a;e++){if(g[e+1]-g[e]==1){c[b][1]=g[e+1]}else{b++;c[b]=[g[e+1],g[e+1]]}}return c},clearSelections:function(a){if(this.locked){return}if(a!==true){var d=this.grid.store;var b=this.selections;var c=-1;b.each(function(e){c=d.indexOfId(e.id);if(c!=-1){this.deselectRow(c+d.bufferRange[0])}},this);b.clear();this.pendingSelections={}}else{this.selections.clear();this.pendingSelections={}}this.allSelections={};this.last=false},selectRange:function(b,a,d){if(this.locked){return}if(!d){this.clearSelections()}if(b&lt;=a){for(var c=b;c&lt;=a;c++){this.selectRow(c,true)}}else{for(var c=b;c&gt;=a;c--){this.selectRow(c,true)}}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.Store=function(a){a=a||{};a.remoteSort=true;this._autoLoad=a.autoLoad?true:false;a.autoLoad=false;this.addEvents(&quot;bulkremove&quot;,&quot;versionchange&quot;,&quot;beforeselectionsload&quot;,&quot;selectionsload&quot;);Ext.ux.grid.livegrid.Store.superclass.constructor.call(this,a);this.totalLength=0;this.bufferRange=[-1,-1];this.on(&quot;clear&quot;,function(){this.bufferRange=[-1,-1]},this);if(this.url&amp;&amp;!this.selectionsProxy){this.selectionsProxy=new Ext.data.HttpProxy({url:this.url})}};Ext.extend(Ext.ux.grid.livegrid.Store,Ext.data.Store,{version:null,insert:function(d,c){c=[].concat(c);d=d&gt;=this.bufferSize?Number.MAX_VALUE:d;if(d==Number.MIN_VALUE||d==Number.MAX_VALUE){var b=c.length;if(d==Number.MIN_VALUE){this.bufferRange[0]+=b;this.bufferRange[1]+=b}this.totalLength+=b;this.fireEvent(&quot;add&quot;,this,c,d);return}var f=false;var g=c;if(c.length+d&gt;=this.bufferSize){f=true;g=c.splice(0,this.bufferSize-d)}this.totalLength+=g.length;if(this.bufferRange[0]&lt;=-1){this.bufferRange[0]=0}if(this.bufferRange[1]&lt;(this.bufferSize-1)){this.bufferRange[1]=Math.min(this.bufferRange[1]+g.length,this.bufferSize-1)}for(var e=0,a=g.length;e&lt;a;e++){this.data.insert(d,g[e]);g[e].join(this)}while(this.getCount()&gt;this.bufferSize){this.data.remove(this.data.last())}this.fireEvent(&quot;add&quot;,this,g,d);if(f===true){this.fireEvent(&quot;add&quot;,this,c,Number.MAX_VALUE)}},remove:function(b,a){var c=this._getIndex(b);if(c&lt;0){this.totalLength-=1;if(this.pruneModifiedRecords){this.modified.remove(b)}this.bufferRange[0]=Math.max(-1,this.bufferRange[0]-1);this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);if(a!==true){this.fireEvent(&quot;remove&quot;,this,b,c)}return c}this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);this.data.removeAt(c);if(this.pruneModifiedRecords){this.modified.remove(b)}this.totalLength-=1;if(a!==true){this.fireEvent(&quot;remove&quot;,this,b,c)}return c},_getIndex:function(a){var b=this.indexOfId(a.id);if(b&lt;0){b=this.findInsertIndex(a)}return b},bulkRemove:function(b){var g=null;var e=[];var d=0;var a=b.length;var f=[];for(var c=0;c&lt;a;c++){g=b[c];f[g.id]=this._getIndex(g)}for(var c=0;c&lt;a;c++){g=b[c];this.remove(g,true);e.push([g,f[g.id]])}this.fireEvent(&quot;bulkremove&quot;,this,e)},removeAll:function(){this.totalLength=0;this.bufferRange=[-1,-1];this.data.clear();if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent(&quot;clear&quot;,this)},loadRanges:function(b){var a=b.length;if(a&gt;0&amp;&amp;!this.selectionsProxy.activeRequest[Ext.data.Api.actions.read]&amp;&amp;this.fireEvent(&quot;beforeselectionsload&quot;,this,b)!==false){var e=this.lastOptions.params;var f={};f.ranges=Ext.encode(b);if(e){if(e.sort){f.sort=e.sort}if(e.dir){f.dir=e.dir}}var c={};for(var d in this.lastOptions){c.i=this.lastOptions.i}c.ranges=f.ranges;this.selectionsProxy.doRequest(Ext.data.Api.actions.read,null,c,this.reader,this.selectionsLoaded,this,c)}},loadSelections:function(a){if(a.length===0){return}this.loadRanges(a)},selectionsLoaded:function(f,b,e){if(this.checkVersionChange(f,b,e)!==false){var d=f.records;for(var c=0,a=d.length;c&lt;a;c++){d[c].join(this)}this.fireEvent(&quot;selectionsload&quot;,this,f.records,Ext.decode(b.ranges))}else{this.fireEvent(&quot;selectionsload&quot;,this,[],Ext.decode(b.ranges))}},checkVersionChange:function(d,b,c){if(d&amp;&amp;c!==false){if(d.version!==undefined){var a=this.version;this.version=d.version;if(this.version!==a){return this.fireEvent(&quot;versionchange&quot;,this,a,this.version)}}}},findInsertIndex:function(a){this.remoteSort=false;var b=Ext.ux.grid.livegrid.Store.superclass.findInsertIndex.call(this,a);this.remoteSort=true;if(this.bufferRange[0]&lt;=0&amp;&amp;b===0){return b}else{if(this.bufferRange[0]&gt;0&amp;&amp;b===0){return Number.MIN_VALUE}else{if(b&gt;=this.bufferSize){return Number.MAX_VALUE}}}return b},sortData:function(c,d){d=d||&quot;ASC&quot;;var a=this.fields.get(c).sortType;var b=function(f,e){var k=a(f.data[c]),g=a(e.data[c]);return k&gt;g?1:(k&lt;g?-1:0)};this.data.sort(d,b)},onMetaChange:function(b,a,c){this.version=null;Ext.ux.grid.livegrid.Store.superclass.onMetaChange.call(this,b,a,c)},loadRecords:function(c,a,b){this.checkVersionChange(c,a,b);if(!c){this.bufferRange=[-1,-1]}else{this.bufferRange=[a.params.start,Math.max(0,Math.min((a.params.start+a.params.limit)-1,c.totalRecords-1))]}if(a.suspendLoadEvent===true){this.suspendEvents()}Ext.ux.grid.livegrid.Store.superclass.loadRecords.call(this,c,a,b);if(a.suspendLoadEvent===true){this.resumeEvents()}},getAt:function(a){if(this.bufferRange[0]==-1){return undefined}var b=a-this.bufferRange[0];return this.data.itemAt(b)},clearFilter:function(){},isFiltered:function(){},collect:function(){},createFilterFn:function(){},sum:function(){},filter:function(){},filterBy:function(){},query:function(){},queryBy:function(){},find:function(){},findBy:function(){}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.Toolbar=Ext.extend(Ext.Toolbar,{displayMsg:&quot;&quot;,emptyMsg:&quot;No data to display&quot;,refreshText:&quot;Refresh&quot;,initComponent:function(){this.displayMsg=i18n.get(&quot;paging.display&quot;);Ext.ux.grid.livegrid.Toolbar.superclass.initComponent.call(this);if(this.grid){this.view=this.grid.getView()}var a=this;this.view.init=this.view.init.createSequence(function(){a.bind(this)},this.view)},updateInfo:function(d,c,a){if(this.displayEl){var b=a===0?this.emptyMsg:String.format(this.displayMsg,d+1,d+c,a);this.displayEl.update(b)}},unbind:function(a){var b;var c;if(a instanceof Ext.grid.GridView){c=a}else{c=a.getView()}b=a.ds;b.un(&quot;loadexception&quot;,this.enableLoading,this);b.un(&quot;beforeload&quot;,this.disableLoading,this);b.un(&quot;load&quot;,this.enableLoading,this);c.un(&quot;rowremoved&quot;,this.onRowRemoved,this);c.un(&quot;rowsinserted&quot;,this.onRowsInserted,this);c.un(&quot;beforebuffer&quot;,this.beforeBuffer,this);c.un(&quot;cursormove&quot;,this.onCursorMove,this);c.un(&quot;buffer&quot;,this.onBuffer,this);c.un(&quot;bufferfailure&quot;,this.enableLoading,this);this.view=undefined},bind:function(a){this.view=a;var b=a.ds;b.on(&quot;loadexception&quot;,this.enableLoading,this);b.on(&quot;beforeload&quot;,this.disableLoading,this);b.on(&quot;load&quot;,this.enableLoading,this);a.on(&quot;rowremoved&quot;,this.onRowRemoved,this);a.on(&quot;rowsinserted&quot;,this.onRowsInserted,this);a.on(&quot;beforebuffer&quot;,this.beforeBuffer,this);a.on(&quot;cursormove&quot;,this.onCursorMove,this);a.on(&quot;buffer&quot;,this.onBuffer,this);a.on(&quot;bufferfailure&quot;,this.enableLoading,this)},enableLoading:function(){this.loading.setDisabled(false)},disableLoading:function(){this.loading.setDisabled(true)},onCursorMove:function(b,d,c,a){this.updateInfo(d,c,a)},onRowsInserted:function(b,c,a){this.updateInfo(b.rowIndex,Math.min(b.ds.totalLength,b.visibleRows-b.rowClipped),b.ds.totalLength)},onRowRemoved:function(b,c,a){this.updateInfo(b.rowIndex,Math.min(b.ds.totalLength,b.visibleRows-b.rowClipped),b.ds.totalLength)},beforeBuffer:function(b,c,f,e,a,d){this.loading.disable();this.updateInfo(f,e,a)},onBuffer:function(b,c,k,g,a){this.loading.enable();this.updateInfo(k,g,a);var d=Ext.getCmp(&quot;plot&quot;+this.ownerCt.datasetId);if(d){var e=d.findById(&quot;plot-right-panel&quot;);var f=e.fireEvent(&quot;buffer&quot;,c,k,g,a)}},onClick:function(a){switch(a){case&quot;refresh&quot;:if(this.view.reset(true)){this.loading.disable()}else{this.loading.enable()}break}},onRender:function(b,a){Ext.PagingToolbar.superclass.onRender.call(this,b,a);this.loading=new Ext.Toolbar.Button({tooltip:this.refreshText,iconCls:&quot;x-tbar-loading&quot;,handler:this.onClick.createDelegate(this,[&quot;refresh&quot;])});this.addButton(this.loading);this.addSeparator();if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:&quot;x-paging-info&quot;})}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.DragZone=function(b,a){Ext.ux.grid.livegrid.DragZone.superclass.constructor.call(this,b,a);this.view.ds.on(&quot;beforeselectionsload&quot;,this._onBeforeSelectionsLoad,this);this.view.ds.on(&quot;selectionsload&quot;,this._onSelectionsLoad,this)};Ext.extend(Ext.ux.grid.livegrid.DragZone,Ext.grid.GridDragZone,{isDropValid:true,onInitDrag:function(a){this.view.ds.loadSelections(this.grid.selModel.getPendingSelections(true));Ext.ux.grid.livegrid.DragZone.superclass.onInitDrag.call(this,a)},_onBeforeSelectionsLoad:function(){this.isDropValid=false;Ext.fly(this.proxy.el.dom.firstChild).addClass(&quot;ext-ux-livegrid-drop-waiting&quot;)},_onSelectionsLoad:function(){this.isDropValid=true;this.ddel.innerHTML=this.grid.getDragDropText();Ext.fly(this.proxy.el.dom.firstChild).removeClass(&quot;ext-ux-livegrid-drop-waiting&quot;)}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initEvents:function(){Ext.ux.grid.livegrid.EditorGridPanel.superclass.initEvents.call(this);this.view.on(&quot;cursormove&quot;,this.stopEditing,this,[true])},startEditing:function(b,a){this.stopEditing();if(this.colModel.isCellEditable(a,b)){this.view.ensureVisible(b,a,true);if(!this.store.getAt(b)){return}}return Ext.ux.grid.livegrid.EditorGridPanel.superclass.startEditing.call(this,b,a)},walkCells:function(e,a,d,c,b){return Ext.ux.grid.livegrid.GridPanel.prototype.walkCells.call(this,e,a,d,c,b)},onRender:function(b,a){return Ext.ux.grid.livegrid.GridPanel.prototype.onRender.call(this,b,a)},initComponent:function(){if(this.cls){this.cls+=&quot; ext-ux-livegrid&quot;}else{this.cls=&quot;ext-ux-livegrid&quot;}return Ext.ux.grid.livegrid.EditorGridPanel.superclass.initComponent.call(this)}});Ext.namespace(&quot;sitools.user.component.dataviews.livegrid&quot;);Ext.override(Ext.ux.grid.livegrid.Store,{multiSort:function(b,a){this.hasMultiSort=true;a=a||&quot;ASC&quot;;if(this.multiSortInfo&amp;&amp;a==this.multiSortInfo.direction){a=a.toggle(&quot;ASC&quot;,&quot;DESC&quot;)}this.multiSortInfo={sorters:b,direction:a};if(this.remoteSort){this.load(this.lastOptions)}else{this.applySort();this.fireEvent(&quot;datachanged&quot;,this)}},getSortState:function(){return this.hasMultiSort?this.multiSortInfo:this.sortInfo},load:function(c){c=Ext.apply({},c);this.storeOptions(c);if((this.sortInfo||this.multiSortInfo)&amp;&amp;this.remoteSort){var b=this.paramNames;c.params=Ext.apply({},c.params);this.isInSort=true;var a=b.sort;if(this.hasMultiSort){c.params[b.sort]=Ext.encode({ordersList:this.multiSortInfo.sorters})}else{c.params[b.sort]=Ext.encode({ordersList:[this.sortInfo]})}}try{return this.execute(&quot;read&quot;,null,c)}catch(d){this.handleException(d);return false}}});sitools.user.component.dataviews.livegrid.StoreLiveGrid=function(d){if(Ext.isEmpty(d)){return false}var c;if(!Ext.isEmpty(d.userPreference)&amp;&amp;d.userPreference.datasetView==&quot;Ext.ux.livegrid&quot;&amp;&amp;!Ext.isEmpty(d.userPreference.colModel)){c=Ext.applyIf(d.userPreference.colModel,d.datasetCm)}else{c=d.datasetCm}var a=getColumnModel(c);var f=this.getFields(d.datasetCm);var b=this.getPrimaryKey(d.datasetCm);var k=new Ext.ux.grid.livegrid.JsonReader({idProperty:b,root:&quot;data&quot;,versionProperty:&quot;version&quot;,totalProperty:&quot;total&quot;},f);var g;if(this.userPreference){c=extColModelToSrv(a);g={colModel:Ext.util.JSON.encode(c)}}else{g={}}var e=0;this.formParams={};if(!Ext.isEmpty(d.formParams)){Ext.each(d.formParams,function(l){this.formParams[&quot;p[&quot;+e+&quot;]&quot;]=l;e+=1},this);Ext.apply(g,this.formParams)}e=0;if(!Ext.isEmpty(d.formMultiDsParams)){Ext.each(d.formMultiDsParams,function(l){this.formParams[&quot;c[&quot;+e+&quot;]&quot;]=l;e+=1},this);Ext.apply(g,this.formParams)}Ext.apply(d,{autoLoad:true,bufferSize:DEFAULT_LIVEGRID_BUFFER_SIZE,restful:true,reader:k,url:d.urlRecords,dataUrl:d.sitoolsAttachementForUsers,baseParams:g,listeners:{scope:this,exception:function(t,p,q,n,m,l){this.mainView.ownerCt.minimize();var s=this.mainView.ownerCt;Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:m.responseText,buttons:Ext.Msg.OK,fn:function(){s.close()}})}}});sitools.user.component.dataviews.livegrid.StoreLiveGrid.superclass.constructor.call(this,d)};Ext.extend(sitools.user.component.dataviews.livegrid.StoreLiveGrid,Ext.ux.grid.livegrid.Store,{getFields:function(c){var a=[];var b=0;if(!Ext.isEmpty(c)){Ext.each(c,function(e,d,f){a[b]=new Ext.data.Field({name:e.columnAlias,primaryKey:e.primaryKey,type:sql2ext.get(e.sqlColumnType)});if(sql2ext.get(e.sqlColumnType)==&quot;boolean&quot;){Ext.apply(a[b],{convert:function(k,g){if(k==&quot;f&quot;||k==&quot;false&quot;||k===0){return 0}if(k==&quot;t&quot;||k==&quot;true&quot;||k==1){return 1}return k}})}b++},this)}return a},getPrimaryKey:function(c){var b=0,a=&quot;&quot;;if(!Ext.isEmpty(c)){Ext.each(c,function(e,d,f){if(!Ext.isEmpty(e.primaryKey)){if(e.primaryKey){a=e.columnAlias}}},this)}return a},getFormParams:function(){return this.formParams},paramValueToApi:function(b){var a=b.type+&quot;|&quot;+b.code+&quot;|&quot;+b.value;if(!Ext.isEmpty(b.userDimension)&amp;&amp;!Ext.isEmpty(b.userUnit)){a+=&quot;|&quot;+b.userDimension+&quot;|&quot;+b.userUnit.unitName}return a}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.datasetViewConfig=Ext.extend(Ext.form.FormPanel,{padding:10,initComponent:function(){this.title=i18n.get(&quot;label.viewConfig&quot;);var b=this.action;var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;description&quot;,&quot;jsObject&quot;,&quot;fileUrl&quot;],url:this.urlDatasetViews,root:&quot;data&quot;,listeners:{scope:this,load:function(c,d){if(Ext.isEmpty(this.comboDatasetViews.getValue())){if(!Ext.isEmpty(d[0])){this.comboDatasetViews.setValue(d[0].id);this.comboDatasetViews.fireEvent(&quot;select&quot;,this.comboDatasetViews,d[0])}}}}});this.comboDatasetViews=new Ext.form.ComboBox({disabled:this.action==&quot;view&quot;?true:false,id:&quot;comboDatasetViews&quot;,store:a,fieldLabel:i18n.get(&quot;label.datasetViews&quot;),displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,name:&quot;comboDatasetViews&quot;,forceSelection:true,triggerAction:&quot;all&quot;,editable:false,emptyText:i18n.get(&quot;label.datasetViewsSelect&quot;),selectOnFocus:true,anchor:&quot;95%&quot;,itemSelector:&quot;div.search-item&quot;,allowBlank:false,autoSelect:true,maxHeight:200,validator:function(c){if(Ext.isEmpty(c)){return false}else{return true}},tpl:new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;search-item combo-datasetview&quot;&gt;&lt;div class=&quot;combo-datasetview-name&quot;&gt;{name}&lt;/div&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription-datasetview&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',&quot;&lt;/div&gt;&lt;/tpl&gt;&quot;,{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),listeners:{scope:this,select:function(d,e,c){this.buildViewConfig(e)}}});this.parametersFieldset=new Ext.form.FieldSet({title:i18n.get(&quot;label.parameters&quot;),anchor:&quot;95%&quot;});Ext.apply(this,{items:[this.comboDatasetViews,this.parametersFieldset],listeners:{activate:function(){if(b==&quot;view&quot;){this.getEl().mask()}}}});sitools.admin.datasets.datasetViewConfig.superclass.initComponent.call(this)},getDatasetViewsCombo:function(){return this.comboDatasetViews},setViewConfigParamsValue:function(a){this.viewConfigParamsValue=a},buildViewConfig:function(recSelected){try{this.parametersFieldset.removeAll();var getParametersMethod=eval(recSelected.get(&quot;jsObject&quot;)+&quot;.getParameters&quot;);if(!Ext.isFunction(getParametersMethod)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.notImplementedMethod&quot;));return}var parameters=getParametersMethod();if(Ext.isEmpty(parameters)){this.parametersFieldset.setVisible(false)}else{this.parametersFieldset.setVisible(true)}Ext.each(parameters,function(param){var parameterValue=this.findDefaultParameterValue(param);var JsObj=eval(param.jsObj);var config=Ext.applyIf(param.config,{anchor:&quot;95%&quot;});if(!Ext.isEmpty(parameterValue)){Ext.apply(param.config,{value:parameterValue})}this.parametersFieldset.add(new JsObj(config))},this);this.doLayout()}catch(err){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.notImplementedMethod&quot;));return}},getParametersValue:function(){var a=[];if(Ext.isEmpty(this.parametersFieldset.items)){return a}this.parametersFieldset.items.each(function(b){a.push({name:b.parameterName,value:b.getValue()})},this);return a},findDefaultParameterValue:function(b){var a;Ext.each(this.viewConfigParamsValue,function(c){if(c.name==b.config.parameterName){a=c.value}});return a}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.datasetForm=Ext.extend(Ext.Panel,{initComponent:function(){var b=this.action;var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;sitoolsAttachementForUsers&quot;],url:this.urlDatasources,root:&quot;data&quot;,listeners:{scope:this,load:function(c,d){if(Ext.isEmpty(this.comboDataSource.getValue())){if(!Ext.isEmpty(d[0])){this.comboDataSource.setValue(d[0].id)}}}}});this.comboDataSource=new Ext.form.ComboBox({disabled:this.action==&quot;view&quot;?true:false,id:&quot;comboDataSource&quot;,store:a,fieldLabel:i18n.get(&quot;label.dataSource&quot;),displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,name:&quot;comboDataSource&quot;,forceSelection:true,triggerAction:&quot;all&quot;,editable:false,emptyText:i18n.get(&quot;label.dataSourceSelect&quot;),selectOnFocus:true,anchor:&quot;50%&quot;,value:&quot;&quot;,listeners:{scope:this,change:function(e,d,c){this.getBubbleTarget().fireEvent(&quot;datasourceChanged&quot;,e,d,c)}},validator:function(c){if(Ext.isEmpty(c)){return false}else{return true}}});Ext.apply(this,{layout:&quot;fit&quot;,title:i18n.get(&quot;label.datasetInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,defaults:{disabled:this.action==&quot;view&quot;?true:false},items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;95%&quot;,vtype:&quot;name&quot;,maxLength:50},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;95%&quot;,maxLength:200},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,vtype:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;95%&quot;,growMax:400},this.comboDataSource,{xtype:&quot;textfield&quot;,vtype:&quot;attachment&quot;,name:&quot;sitoolsAttachementForUsers&quot;,id:&quot;sitoolsAttachementForUsers&quot;,fieldLabel:i18n.get(&quot;label.userAttach&quot;),anchor:&quot;95%&quot;,maxLength:100},{xtype:&quot;checkbox&quot;,name:&quot;visible&quot;,id:&quot;visible&quot;,fieldLabel:i18n.get(&quot;label.isVisible&quot;),anchor:&quot;95%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,disabled:true,name:&quot;expirationDate&quot;,id:&quot;expirationDate&quot;,fieldLabel:i18n.get(&quot;label.expirationDate&quot;),anchor:&quot;95%&quot;,maxLength:100},{xtype:&quot;htmleditor&quot;,id:&quot;descriptionHTML&quot;,fieldLabel:i18n.get(&quot;label.descriptionHTML&quot;),height:150,anchor:&quot;95%&quot;},{xtype:&quot;hidden&quot;,name:&quot;dirty&quot;,value:false}]}],listeners:{activate:function(){if(b==&quot;view&quot;){this.getEl().mask()}}}});sitools.admin.datasets.datasetForm.superclass.initComponent.call(this)},getDataSourceCombo:function(){return this.comboDataSource},getDataSourceUrl:function(){var a=this.getDataSourceCombo().getStore().getById(this.getDataSourceCombo().getValue());if(!a){return false}return a.data.sitoolsAttachementForUsers}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.abstractDatasetWin={minWidth:700,minHeight:480,width:700,height:480,modal:true,defaultColumnWidth:100,defaultColumnVisible:true,defaultColumnSortable:true,defaultColumnFiltrable:true,queryType:&quot;W&quot;,id:&quot;datasetsMultiTablesPanel&quot;,resizable:true,onUpload:function(){function b(d,c){c.fieldUrl.setValue(d.url)}var a=new ImageChooser({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_UPLOAD_URL&quot;)+&quot;/?media=json&quot;,width:515,height:350,fieldUrl:this.ownerCt.items.items[0]});a.show(document,b)},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={leaf:true,predicat:a.attributes.predicat,type:a.attributes.type};c.push(d)}else{d={table:a.attributes.table,typeJointure:a.attributes.typeJointure,children:[],leaf:false,type:a.attributes.type};c.push(d);var e=a.childNodes;var b;for(b=0;b&lt;e.length;b++){this.getAllNodes(e[b],d.children)}}}},loadDataset:function(){if(this.action==&quot;modify&quot;||this.action==&quot;view&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(s){var m;var d=Ext.decode(s.responseText);if(!d.success){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),d.message);return}var q=this.findByType(&quot;form&quot;)[0].getForm();var v=this.findById(&quot;gridColumnSelect&quot;).getStore();var l=d.dataset;this.initialData=l;var e={};e.id=l.id;e.name=l.name;e.description=l.description;if(!Ext.isEmpty(l.image)){e.image=l.image.url}e.sitoolsAttachementForUsers=l.sitoolsAttachementForUsers;e.expirationDate=l.expirationDate;e.queryType=l.queryType;e.visible=l.visible;e.orderBy=l.orderBy;e.descriptionHTML=l.descriptionHTML;e.dirty=l.dirty;var n=new Ext.data.Record(e);q.loadRecord(n);this.queryType=l.queryType;Ext.getCmp(&quot;radioQueryType&quot;).setValue(this.queryType);Ext.getCmp(&quot;sqlQuery&quot;).setValue(l.sqlQuery);this.formulairePrincipal.getDataSourceCombo().getStore().load({scope:this,callback:function(){if(l.datasource){this.findByType(&quot;form&quot;)[0].getComponent(&quot;comboDataSource&quot;).setValue(l.datasource.id)}}});this.viewConfigPanel.getDatasetViewsCombo().getStore().load({scope:this,callback:function(B){if(l.datasetView){var A=this.viewConfigPanel.getDatasetViewsCombo().getStore();var f=A.getAt(A.find(&quot;id&quot;,l.datasetView.id));this.viewConfigPanel.getDatasetViewsCombo().setValue(l.datasetView.id);this.viewConfigPanel.setViewConfigParamsValue(l.datasetViewConfig);this.viewConfigPanel.getDatasetViewsCombo().fireEvent(&quot;select&quot;,this.viewConfigPanel.getDatasetViewsCombo(),f)}}});if(l.structures){var z=l.structures;var a=this.gridTablesDataset.getStore();for(m=0;m&lt;z.length;m++){a.add(new Ext.data.Record({name:z[m].name,alias:z[m].alias,schemaName:z[m].schemaName}))}}if(l.predicat){var g=l.predicat;var b=this.wizardWhereClause.getStore();for(m=0;m&lt;g.length;m++){var k;if(g[m]){k={tableName:g[m].leftAttribute.tableName,tableAlias:g[m].leftAttribute.tableAlias,schemaName:g[m].leftAttribute.schemaName,dataIndex:g[m].leftAttribute.dataIndex,columnAlias:g[m].leftAttribute.columnAlias,specificColumnType:g[m].leftAttribute.specificColumnType};var c=b.recordType;e=new c({parentheseFermante:g[m].closedParenthesis,parentheseOuvrante:g[m].openParenthesis,opLogique:g[m].logicOperator,operateur:g[m].compareOperator,leftAttribute:k,rightAttribute:g[m].rightValue.$});b.add(e)}}}if(!l.columnModel){return}var p=l.columnModel;this.findById(&quot;gridColumnSelect&quot;).getData(p);if(!Ext.isEmpty(l.structure)){this.wizardJoinCondition.items.items[0].loadTree(l)}if(l.properties){var u=this.gridProperties.getStore();var t;Ext.each(l.properties,function(A){if(A.type==&quot;Date&quot;){var f=Date.parseDate(A.value,SITOOLS_DATE_FORMAT);if(Ext.isEmpty(f)){A.value=&quot;invalid date&quot;}else{A.value=f.format(SITOOLS_DEFAULT_IHM_DATE_FORMAT)}}t=new Ext.data.Record(A);u.add(t)})}},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}else{this.formulairePrincipal.getDataSourceCombo().getStore().load();this.viewConfigPanel.getDatasetViewsCombo().getStore().load()}}};Ext.namespace(&quot;sitools.component.datasets&quot;);sitools.component.datasets.datasetsMultiTablesPanel=Ext.extend(Ext.Window,{closeAction:&quot;close&quot;,initComponent:function(){Ext.apply(this,sitools.admin.datasets.abstractDatasetWin);this.urlDictionary=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;);this.urlDatasources=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASOURCES_URL&quot;);this.urlDimension=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension&quot;;this.urlDatasetViews=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_VIEWS_URL&quot;);var k=this.action;if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyDataset&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.datasetProject&quot;)}if(this.action==&quot;view&quot;){this.title=i18n.get(&quot;label.viewDataset&quot;)}this.gridColumn=new sitools.admin.datasets.gridFieldSetup({urlDictionary:this.urlDictionary,urlDimension:this.urlDimension,action:k,urlDataset:this.url});this.gridColumn.addListener(&quot;activate&quot;,function(z){if(k==&quot;view&quot;){z.getEl().mask()}});this.formulairePrincipal=new sitools.admin.datasets.datasetForm({urlDatasetViews:this.urlDatasetViews,action:this.action,urlDatasources:this.urlDatasources,observer:this});this.httpProxyJDBC=new Ext.data.HttpProxy({url:loadUrl.get(&quot;APP_URL&quot;),restful:true,method:&quot;GET&quot;});this.storeTablesJDBC=new Ext.data.JsonStore({root:&quot;database.tables&quot;,fields:[{name:&quot;url&quot;},{name:&quot;schemaName&quot;,mapping:&quot;schema&quot;},{name:&quot;name&quot;}],proxy:this.httpProxyJDBC,listeners:{scope:this,beforeload:function(){this.dataSourceUrl=this.formulairePrincipal.getDataSourceUrl();this.httpProxyJDBC.setUrl(this.dataSourceUrl);this.httpProxyColumns.setUrl(this.dataSourceUrl)}}});this.cmTablesJDBC=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),width:160,sortable:true,dataIndex:&quot;name&quot;}]});this.gridTablesJDBC=new Ext.grid.GridPanel({layout:&quot;fit&quot;,store:this.storeTablesJDBC,cm:this.cmTablesJDBC,sm:new Ext.grid.RowSelectionModel({}),enableDragDrop:true,stripeRows:true,title:&quot;Tables JDBC&quot;,id:&quot;Tables_JDBC&quot;});var v=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),width:160,sortable:true,dataIndex:&quot;name&quot;},{id:&quot;alias&quot;,header:i18n.get(&quot;headers.tableAlias&quot;),width:80,sortable:true,dataIndex:&quot;alias&quot;,editor:new Ext.form.TextField({disabled:this.action==&quot;view&quot;?true:false})}]});this.storeTablesDataset=new sitools.widget.JsonStore({id:&quot;storeTablesDataset&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;alias&quot;,type:&quot;string&quot;},{name:&quot;schemaName&quot;,type:&quot;string&quot;}]});this.gridTablesDataset=new Ext.grid.EditorGridPanel({layout:&quot;fit&quot;,store:this.storeTablesDataset,cm:v,sm:new Ext.grid.RowSelectionModel({}),autoScroll:true,enableDragDrop:true,stripeRows:true,title:&quot;Tables Dataset&quot;});var e=new sitools.component.datasets.selectItems({grid1:this.gridTablesJDBC,grid2:this.gridTablesDataset,defaultRecord:{}});var l=new Ext.Panel({title:i18n.get(&quot;label.selectTables&quot;),layout:&quot;fit&quot;,items:[e],id:&quot;selectTablesPanel&quot;,listeners:{scope:this,activate:function(z){this.storeTablesJDBC.load();if(k==&quot;view&quot;){z.getEl().mask()}}}});this.httpProxyColumns=new Ext.data.HttpProxy({url:&quot;/&quot;,restful:true,method:&quot;GET&quot;});var u=new Ext.data.JsonStore({proxy:this.httpProxyColumns,root:&quot;table.attributes&quot;,autoLoad:false,fields:[{name:&quot;name&quot;},{name:&quot;tableName&quot;},{name:&quot;schemaName&quot;},{name:&quot;structure&quot;},{name:&quot;nomAffiche&quot;},{name:&quot;sqlColumnType&quot;,mapping:&quot;type&quot;},{name:&quot;javaSqlColumnType&quot;,mapping:&quot;javaSqlType&quot;},{name:&quot;columnClass&quot;}],listeners:{scope:this,beforeload:function(A){var z=this.formulairePrincipal.getDataSourceCombo().getStore().getById(this.formulairePrincipal.getDataSourceCombo().getValue());this.dataSourceUrl=z.data.sitoolsAttachementForUsers;if(!this.dataSourceUrl){return false}this.httpProxyJDBC.setUrl(this.dataSourceUrl);this.httpProxyColumns.setUrl(this.dataSourceUrl)},add:function(A,z){Ext.each(z,function(B){B.data.structure={tableName:B.data.tableName,tableAlias:B.data.tableAlias,schemaName:B.data.schemaName,dataIndex:B.data.dataIndex};var C=B.data.tableAlias?B.data.tableAlias:B.data.tableName;C+=&quot;.&quot;+B.data.dataIndex;B.data.nomAffiche=C})}}});var a=new Ext.grid.ColumnModel({columns:[{id:&quot;tableName&quot;,header:i18n.get(&quot;headers.tableName&quot;),sortable:true,dataIndex:&quot;tableName&quot;},{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),sortable:true,dataIndex:&quot;dataIndex&quot;}]});var d=new Ext.grid.ColumnModel({columns:[{id:&quot;tableAlias&quot;,header:i18n.get(&quot;headers.tableAlias&quot;),sortable:true,dataIndex:&quot;tableAlias&quot;},{id:&quot;tableName&quot;,header:i18n.get(&quot;headers.tableName&quot;),sortable:true,dataIndex:&quot;tableName&quot;},{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),sortable:true,dataIndex:&quot;dataIndex&quot;}]});this.gridColumnTables=new Ext.grid.GridPanel({layout:&quot;fit&quot;,store:u,id:&quot;gridColumnTables&quot;,cm:a,enableDragDrop:true,stripeRows:true,title:&quot;Columns Table&quot;});this.gridColumnDataSet=new Ext.grid.GridPanel({layout:&quot;fit&quot;,store:this.gridColumn.getStore(),cm:d,autoScroll:true,enableDragDrop:true,stripeRows:true,title:&quot;Columns Dataset&quot;});var m=[{name:&quot;width&quot;,value:this.defaultColumnWidth},{name:&quot;visible&quot;,value:this.defaultColumnVisible},{name:&quot;sortable&quot;,value:this.defaultColumnSortable},{name:&quot;filter&quot;,value:this.defaultColumnFiltrable},{name:&quot;specificColumnType&quot;,value:&quot;DATABASE&quot;}];var s=new sitools.component.datasets.selectItems({grid1:this.gridColumnTables,grid2:this.gridColumnDataSet,defaultRecord:m});s.addListener(&quot;activate&quot;,function(z){if(k==&quot;view&quot;){z.getEl().mask()}});this.panelSelectFields=new Ext.Panel({layout:&quot;fit&quot;,title:i18n.get(&quot;label.selectFields&quot;),items:[s],id:&quot;datasetsMultiTablesPanel_SelectFields&quot;,listeners:{scope:this,activate:function(z){this.loadColumnsJDBC();if(k==&quot;view&quot;){z.getEl().mask()}}}});this.wizardJoinCondition=new sitools.admin.datasets.joinPanel({datasetId:this.datasetId,gridTablesDataset:this.gridTablesDataset,action:this.action,storeColumnDataset:this.gridColumnDataSet.getStore()});this.wizardWhereClause=new Ext.ux.PanelRecherche(&quot;whereClauseId&quot;,i18n.get(&quot;label.wizardWhereClause&quot;),this.gridColumn.getStore(),&quot;where&quot;);this.SqlWhereClause=new Ext.Panel({height:350,items:[{xtype:&quot;form&quot;,items:[{xtype:&quot;textarea&quot;,id:&quot;sqlQuery&quot;,autoScroll:true,height:350,anchor:&quot;100%&quot;,name:&quot;sqlQuery&quot;,validator:function(z){if(z.toLowerCase().match(&quot;where&quot;)){if(z.toLowerCase().match(&quot;from&quot;)){return true}else{return false}}else{return false}},invalidText:i18n.get(&quot;label.invalidSQl&quot;)}]}]});var p=new Ext.form.FormPanel({height:30,flex:0.1,id:&quot;selecteurId&quot;,items:[{xtype:&quot;radiogroup&quot;,id:&quot;radioQueryType&quot;,fieldLabel:i18n.get(&quot;label.queryType&quot;),width:300,height:30,items:[{disabled:this.action==&quot;view&quot;?true:false,boxLabel:i18n.get(&quot;label.assistant&quot;),name:&quot;queryType&quot;,inputValue:&quot;W&quot;,checked:true},{disabled:this.action==&quot;view&quot;?true:false,boxLabel:i18n.get(&quot;label.sql&quot;),name:&quot;queryType&quot;,inputValue:&quot;S&quot;}],listeners:{scope:this,change:function(A,z){if(!Ext.isEmpty(z)){this.queryType=z.inputValue}if(this.queryType==&quot;W&quot;){this.whereClausePanel.remove(this.SqlWhereClause,false);this.SqlWhereClause.hide();this.whereClausePanel.add(this.wizardJoinCondition);this.whereClausePanel.add(this.wizardWhereClause);this.wizardJoinCondition.show();this.wizardWhereClause.show();this.whereClausePanel.doLayout()}else{this.whereClausePanel.remove(this.wizardJoinCondition,false);this.whereClausePanel.remove(this.wizardWhereClause,false);this.wizardJoinCondition.hide();this.wizardWhereClause.hide();this.whereClausePanel.add(this.SqlWhereClause);this.SqlWhereClause.show();this.whereClausePanel.doLayout()}}}}]});this.whereClausePanel=new Ext.Panel({flex:0.9,layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;}});var g=new Ext.Panel({layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;,flex:&quot;ratio&quot;},title:i18n.get(&quot;label.whereClause&quot;),items:[p,this.whereClausePanel],listeners:{scope:this,activate:function(){if(this.queryType==&quot;W&quot;){this.loadColumnsJDBC();this.wizardJoinCondition.buildDefault();this.whereClausePanel.add([this.wizardJoinCondition,this.wizardWhereClause]);this.whereClausePanel.doLayout()}else{this.whereClausePanel.add(this.SqlWhereClause);this.whereClausePanel.doLayout()}}}});g.addListener(&quot;activate&quot;,function(){if(k==&quot;view&quot;){this.getEl().mask()}});var t=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;}],autoLoad:false});var q=new Ext.grid.RowSelectionModel({singleSelect:true});var b=new Ext.data.JsonStore({fields:[&quot;name&quot;],data:[{name:&quot;String&quot;},{name:&quot;Enum&quot;},{name:&quot;Numeric&quot;},{name:&quot;Date&quot;}]});var c=new Ext.form.ComboBox({store:b,mode:&quot;local&quot;,typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,selectOnFocus:true,dataIndex:&quot;orderBy&quot;,lazyRender:true,listClass:&quot;x-combo-list-small&quot;,valueField:&quot;name&quot;,displayField:&quot;name&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;x-combo-list-item comboItem&quot;&gt;{name}&lt;/div&gt;&lt;/tpl&gt;',width:55});var n=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,editor:new Ext.form.TextField()},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;,editor:c},{header:i18n.get(&quot;headers.value&quot;),dataIndex:&quot;value&quot;,editor:new Ext.form.TextField()}],defaults:{sortable:false,width:100}});var f={defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateProperty},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteProperty}]};this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get(&quot;title.properties&quot;),id:&quot;componentGridProperties&quot;,tbar:f,anchor:&quot;95%&quot;,height:180,store:t,cm:n,sm:q,viewConfig:{forceFit:true},listeners:{scope:this,activate:function(z){if(k==&quot;view&quot;){z.getEl().mask()}},beforeedit:function(C){if(C.column==2){var z=C.grid;var D=C.record;var B=z.getColumnModel().columns[C.column];if(Ext.isEmpty(D.get(&quot;type&quot;))){return false}var A;switch(D.get(&quot;type&quot;)){case&quot;String&quot;:A=new Ext.form.TextField();break;case&quot;Numeric&quot;:A=new Ext.form.NumberField();break;case&quot;Date&quot;:A=new Ext.form.DateField({format:SITOOLS_DEFAULT_IHM_DATE_FORMAT,showTime:true});break;case&quot;Enum&quot;:A=new Ext.form.TextField();break}B.setEditor(A)}return true},afteredit:function(C){if(C.column==2){var z=C.grid;var D=C.record;var A=z.getColumnModel().columns[C.column];var B=C.value;if(Ext.isEmpty(D.get(&quot;type&quot;))){return false}switch(D.get(&quot;type&quot;)){case&quot;String&quot;:B=String.format(B);break;case&quot;Numeric&quot;:B=Ext.util.Format(B,&quot;0.00&quot;);break;case&quot;Date&quot;:B=B.format(SITOOLS_DEFAULT_IHM_DATE_FORMAT);break;case&quot;Enum&quot;:B=String.format(B);break}D.set(&quot;value&quot;,B)}}}});this.viewConfigPanel=new sitools.admin.datasets.datasetViewConfig({urlDatasetViews:this.urlDatasetViews,action:this.action});this.tabPanel=new Ext.TabPanel({height:450,layoutConfig:{layoutOnCardChange:true},activeTab:0,items:[this.formulairePrincipal,this.gridProperties,l,this.panelSelectFields,this.gridColumn,g,this.viewConfigPanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate,disabled:k==&quot;view&quot;?true:false},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:function(B,D,C){if(!Ext.isEmpty(C)&amp;&amp;C.id==&quot;gridColumnSelect&quot;){var z=this.gridColumn.gridFieldSetupValidation();if(!z.success){var A=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.error&quot;),html:z.message,autoDestroy:true,hideDelay:1000}).show(document);return false}}return true},datasourceChanged:function(D,C,A){var z=this.formulairePrincipal.getDataSourceCombo().getStore().getById(C);this.dataSourceUrl=z.data.sitoolsAttachementForUsers;this.httpProxyJDBC.setUrl(this.dataSourceUrl);this.httpProxyColumns.setUrl(this.dataSourceUrl);if(C!=A){if(this.gridColumnDataSet.getStore().getCount()&gt;0||this.wizardWhereClause.getStore().getCount()&gt;0||this.storeTablesDataset.getCount()&gt;0||(Ext.getCmp(&quot;sqlQuery&quot;).getValue()&amp;&amp;Ext.getCmp(&quot;sqlQuery&quot;).getValue()!==&quot;&quot;)){var B=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;warning.changeDatasource&quot;),scope:this,fn:function(E,J){if(E==&quot;yes&quot;){this.gridColumnDataSet.getStore().removeAll();this.wizardJoinCondition.deleteJoinPanelItems();this.wizardWhereClause.getStore().removeAll();this.storeTablesDataset.removeAll();Ext.getCmp(&quot;sqlQuery&quot;).setValue(&quot;&quot;)}else{D.setValue(A)}}})}}}}});this.listeners={scope:this,resize:function(C,B,z){var A=C.body.getSize();this.tabPanel.setSize(A)}};this.items=[this.tabPanel];sitools.component.datasets.datasetsMultiTablesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.datasets.datasetsMultiTablesPanel.superclass.onRender.apply(this,arguments);if(this.url){this.loadDataset()}},onValidate:function(){var d=this.datasetValidation();if(!d.success){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),d.message);return}var p=this.findByType(&quot;form&quot;)[0].getForm();if(!p.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var t={};Ext.iterate(p.getValues(),function(f,A){if(f==&quot;image&quot;){t.image={};t.image.url=A;t.image.type=&quot;Image&quot;;t.image.mediaType=&quot;Image&quot;}else{if(f==&quot;comboDataSource&quot;){t.datasource={};t.datasource.url=this.dataSourceUrl;t.datasource.id=this.formulairePrincipal.getDataSourceCombo().getValue();t.datasource.type=&quot;datasource&quot;;t.datasource.mediaType=&quot;datasource&quot;}else{if(f!=&quot;visible&quot;){t[f]=A}}}},this);t.datasetView={};var k=this.viewConfigPanel.getDatasetViewsCombo().getStore();var c=k.find(&quot;id&quot;,this.viewConfigPanel.getDatasetViewsCombo().getValue());var s=k.getAt(c);t.datasetView=s.data;t.datasetViewConfig=this.viewConfigPanel.getParametersValue();t.properties=[];this.gridProperties.getStore().each(function(B){if(B.data.type==&quot;Date&quot;){var A=B.get(&quot;value&quot;);var f=Date.parseDate(A,SITOOLS_DEFAULT_IHM_DATE_FORMAT);if(!Ext.isEmpty(f)){B.data.value=f.format(SITOOLS_DATE_FORMAT)}}t.properties.push(B.data)});var b=p.findField(&quot;visible&quot;);t.visible=b.getValue();t.queryType=this.queryType;t.sqlQuery=Ext.getCmp(&quot;sqlQuery&quot;).getValue();if(this.wizardJoinCondition&amp;&amp;this.wizardWhereClause){t.predicat=[]}if(this.wizardWhereClause){this.wizardWhereClause.getStore().each(function(f){t.predicat.push({closedParenthesis:f.data.parentheseFermante,openParenthesis:f.data.parentheseOuvrante,logicOperator:f.data.opLogique,compareOperator:f.data.operateur,leftAttribute:f.data.leftAttribute,rightValue:f.data.rightAttribute})})}t.structures=[];this.gridTablesDataset.getStore().each(function(f){t.structures.push({alias:f.data.alias,name:f.data.name,schemaName:f.data.schemaName,type:&quot;table&quot;})});var u=this.gridColumn.getStore();u.clearFilter();if(u.getCount()&gt;0){t.columnModel=[];var n;for(n=0;n&lt;u.getCount();n++){var g=u.getAt(n).data;var m={id:g.id,dataIndex:g.dataIndex,header:g.header,toolTip:g.toolTip,width:g.width,sortable:g.sortable,orderBy:g.orderBy,visible:g.visible,filter:g.filter,sqlColumnType:g.sqlColumnType,columnOrder:g.columnOrder,primaryKey:g.primaryKey,schema:g.schemaName,tableAlias:g.tableAlias,tableName:g.tableName,specificColumnType:g.specificColumnType,columnAlias:g.columnAlias,datasetDetailUrl:g.datasetDetailUrl,columnAliasDetail:g.columnAliasDetail,javaSqlColumnType:g.javaSqlColumnType,format:g.format,columnClass:g.columnClass,image:g.image,dimensionId:g.dimensionId,unit:g.unit};if(!Ext.isEmpty(g.columnRendererCategory)&amp;&amp;!Ext.isEmpty(g.columnRenderer)){m.columnRenderer=g.columnRenderer}t.columnModel.push(m)}}this.wizardJoinCondition.buildDefault();this.treeStructure=this.wizardJoinCondition.items.items[0];var z=this.treeStructure.getRootNode();if(Ext.isEmpty(z)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noStructure&quot;));return}var a=z.attributes.table;var v=[];var q=z.childNodes;for(var l=0;l&lt;q.length;l++){this.getAllNodes(q[l],v)}var e={mainTable:a,nodeList:v};t.structure=e;if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:t,success:function(A){var f=Ext.decode(A.responseText);if(!f.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),f.message);return}this.close();this.store.reload()},failure:alertFailure})}else{Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,jsonData:t,success:function(A){var f=Ext.decode(A.responseText);if(!f.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),f.message);return}this.close();this.store.reload()},failure:alertFailure})}},datasetValidation:function(){var a=this.gridColumn.gridFieldSetupValidation();if(this.queryType==&quot;S&quot;&amp;&amp;(Ext.getCmp(&quot;sqlQuery&quot;).getValue().substr(0,4)!=&quot;FROM&quot;||!Ext.getCmp(&quot;sqlQuery&quot;).getValue().toLowerCase().match(&quot;where&quot;))){a={success:false,message:i18n.get(&quot;label.invalidSQl&quot;)}}return a},loadColumnsJDBC:function(){var b=this.gridTablesDataset.getStore();var a=this.formulairePrincipal.getDataSourceCombo().getStore().getById(this.formulairePrincipal.getDataSourceCombo().getValue());this.dataSourceUrl=a.data.sitoolsAttachementForUsers;if(!this.dataSourceUrl){return false}if(b._getDirty()||b.getModifiedRecords().length&gt;0){var c=this.gridColumnTables.getStore();c.removeAll();this.httpProxyJDBC.setUrl(this.dataSourceUrl);this.httpProxyColumns.setUrl(this.dataSourceUrl);b.each(function(e){var d=this.gridColumnTables.getStore();Ext.Ajax.request({url:this.dataSourceUrl+&quot;/&quot;+e.data.name,method:&quot;GET&quot;,params:{tableName:e.data.name,tableAlias:e.data.alias,schemaName:e.data.schemaName},scope:this,success:function(l,k){var f=Ext.decode(l.responseText);if(f.success){var g=this.gridColumnTables.getStore();var m=f.table;Ext.each(m.attributes,function(q,n,p){this.gridColumnTables.getStore().add(new Ext.data.Record({dataIndex:q.name,schemaName:k.params.schemaName,tableName:k.params.tableName,tableAlias:k.params.tableAlias,sqlColumnType:q.type,javaSqlColumnType:q.javaSqlType,columnClass:q.columnClass}))},this)}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),f.message)}},failure:alertFailure})},this);b._setDirty(false);b.commitChanges()}},onCreateProperty:function(){var a=new Ext.data.Record({type:&quot;String&quot;});this.gridProperties.getStore().insert(0,a)},onDeleteProperty:function(){var b=this.gridProperties.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridProperties.getStore().remove(c)}}});Ext.reg(&quot;s-datasetsMultiTablesPanel&quot;,sitools.component.datasets.datasetsMultiTablesPanel);Ext.namespace(&quot;sitools.admin.datasets.columnRenderer&quot;);sitools.admin.datasets.columnRenderer.behaviorEnum={URL_LOCAL:&quot;localUrl&quot;,URL_EXT_NEW_TAB:&quot;extUrlNewTab&quot;,URL_EXT_DESKTOP:&quot;extUrlDesktop&quot;,IMAGE_NO_THUMB:&quot;ImgNoThumb&quot;,IMAGE_THUMB_FROM_IMAGE:&quot;ImgAutoThumb&quot;,IMAGE_FROM_SQL:&quot;ImgThumbSQL&quot;,DATASET_LINK:&quot;datasetLink&quot;,DATASET_ICON_LINK:&quot;datasetIconLink&quot;,NO_CLIENT_ACCESS:&quot;noClientAccess&quot;,getColumnRendererCategoryFromBehavior:function(b){var a;switch(b){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:a=&quot;URL&quot;;break;case ColumnRendererEnum.IMAGE_NO_THUMB:case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:a=&quot;Image&quot;;break;case ColumnRendererEnum.DATASET_LINK:case ColumnRendererEnum.DATASET_ICON_LINK:a=&quot;DataSetLink&quot;;break;case ColumnRendererEnum.NO_CLIENT_ACCESS:a=&quot;Other&quot;;break;default:a=&quot;&quot;;break}return a},isDisplayingImage:function(b){var a=false;switch(b.behavior){case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:case ColumnRendererEnum.DATASET_ICON_LINK:a=true;break;case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:if(b.type==&quot;Image&quot;){a=true}break}return a}};var ColumnRendererEnum=sitools.admin.datasets.columnRenderer.behaviorEnum;Ext.namespace(&quot;sitools.admin.datasets.columnRenderer&quot;);sitools.admin.datasets.columnRenderer.datasetLinkPanel=Ext.extend(Ext.Panel,{flex:1,layout:{type:&quot;vbox&quot;,align:&quot;stretch&quot;},border:false,initComponent:function(){this.urlDatasets=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.httpProxy=new Ext.data.HttpProxy({url:this.urlDatasets,restful:true,method:&quot;GET&quot;});this.storeColumns=new Ext.data.JsonStore({id:&quot;datasetColumnId&quot;,root:&quot;dataset.columnModel&quot;,idProperty:&quot;id&quot;,proxy:this.httpProxy,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;}]});this.gridViewColumns=new Ext.grid.GridView({forceFit:true,listeners:{scope:this,refresh:function(){if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;!Ext.isEmpty(this.columnRenderer.columnAlias)&amp;&amp;this.comboDatasets.getValue()==this.columnRenderer.datasetLinkUrl){var c=this.columnRenderer.columnAlias;var b=this.gridColumns.getStore().find(&quot;columnAlias&quot;,c);if(b!=-1){this.gridColumns.getSelectionModel().selectRow(b)}}}}});this.cmColumns=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.tableName&quot;),dataIndex:&quot;tableName&quot;},{header:i18n.get(&quot;headers.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;}],defaults:{sortable:true}});this.smColumns=new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,rowselect:function(b,d,c){Ext.getCmp(&quot;status_bar_column&quot;).hide();this.doLayout()}}});this.bbar=new Ext.ux.StatusBar({id:&quot;status_bar_column&quot;,hidden:true,text:i18n.get(&quot;label.no_column_selected&quot;),iconCls:&quot;x-status-error&quot;});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;sitoolsAttachementForUsers&quot;],url:this.urlDatasets,root:&quot;data&quot;,autoLoad:true,listeners:{scope:this,load:function(){if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;this.columnRenderer.behavior==this.behaviorType){var b=this.columnRenderer.datasetLinkUrl;var d=this.comboDatasets.getStore().find(&quot;sitoolsAttachementForUsers&quot;,b);if(d!=-1){this.comboDatasets.setValue(b);var c=this.comboDatasets.getStore().getAt(d);this.comboDatasets.fireEvent(&quot;select&quot;,this.comboDatasets,c,d)}}}}});this.comboDatasets=new Ext.form.ComboBox({store:a,name:&quot;comboDatasets&quot;,displayField:&quot;name&quot;,valueField:&quot;sitoolsAttachementForUsers&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectADataset&quot;),selectOnFocus:true,anchor:&quot;100%&quot;,fieldLabel:i18n.get(&quot;label.dataset&quot;),allowBlank:false,listeners:{scope:this,select:function(c,d,b){this.loadColumns(d.data.id)}}});this.gridColumns=new Ext.grid.GridPanel({id:&quot;gridColumnsSelect&quot;,title:i18n.get(&quot;title.datasetLinkDetails&quot;),layout:&quot;fit&quot;,flex:1,view:this.gridViewColumns,autoScroll:true,store:this.storeColumns,cm:this.cmColumns,sm:this.smColumns,bbar:this.bbar,tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.comboDatasets]}});this.items=[];if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){this.formImage=new Ext.form.FormPanel({padding:5,items:[{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,vtype:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,allowBlank:false}]});this.items.push(this.formImage)}else{this.title=&quot;&quot;}this.items.push(this.gridColumns);sitools.admin.datasets.columnRenderer.datasetLinkPanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRenderer.datasetLinkPanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;this.columnRenderer.behavior==this.behaviorType){if(this.columnRenderer.behavior==ColumnRendererEnum.DATASET_ICON_LINK&amp;&amp;!Ext.isEmpty(this.columnRenderer.image)){this.formImage.getForm().findField(&quot;image&quot;).setValue(this.columnRenderer.image.url)}}},isValid:function(){var b=true;if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){b=this.formImage.getForm().isValid()}if(b){b=this.comboDatasets.isValid();if(b){var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){b=false;Ext.getCmp(&quot;status_bar_column&quot;).show()}}}return b},fillSpecificValue:function(c){var e=this.comboDatasets.getValue();c.datasetLinkUrl=e;var b=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}c.columnAlias=b.get(&quot;columnAlias&quot;);if(this.behaviorType==ColumnRendererEnum.DATASET_ICON_LINK){var d=this.formImage.getForm().findField(&quot;image&quot;).getValue();var a={};if(!Ext.isEmpty(d)){a.url=d;a.type=&quot;Image&quot;;a.mediaType=&quot;Image&quot;}c.image=a}return true},loadColumns:function(a){this.httpProxy.setUrl(this.urlDatasets+&quot;/&quot;+a);this.gridColumns.getStore().load({callback:function(){this.gridColumns.getView().refresh()},scope:this})}});Ext.namespace(&quot;sitools.admin.datasets.columnRenderer&quot;);sitools.admin.datasets.columnRenderer.urlPanel=Ext.extend(Ext.Panel,{flex:1,layout:&quot;fit&quot;,initComponent:function(){this.formPanel=new Ext.form.FormPanel({defaults:{anchor:&quot;100%&quot;},padding:5,items:[{fieldLabel:i18n.get(&quot;label.display&quot;),name:&quot;display&quot;,xtype:&quot;radiogroup&quot;,columns:2,items:[{boxLabel:&quot;Text&quot;,name:&quot;display&quot;,inputValue:&quot;Text&quot;,checked:true},{boxLabel:&quot;Image&quot;,name:&quot;display&quot;,inputValue:&quot;Image&quot;}],listeners:{scope:this,change:function(b,c){var a=c.getGroupValue();var d=true;if(a==&quot;Text&quot;){d=false}this.formPanel.getForm().findField(&quot;linkText&quot;).setVisible(!d);this.formPanel.getForm().findField(&quot;linkText&quot;).setDisabled(d);this.formPanel.getForm().findField(&quot;image&quot;).setVisible(d);this.formPanel.getForm().findField(&quot;image&quot;).setDisabled(!d);this.doLayout()}}},{fieldLabel:i18n.get(&quot;label.linkText&quot;),name:&quot;linkText&quot;,xtype:&quot;textfield&quot;,allowBlank:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,vtype:&quot;image&quot;,hidden:true,disabled:true,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,growMax:400,allowBlank:false},{xtype:&quot;checkbox&quot;,fieldLabel:i18n.get(&quot;label.isDisplayable&quot;),name:&quot;displayable&quot;,anchor:&quot;100%&quot;,tooltip:i18n.get(&quot;label.isDisplayable.tooltip&quot;),hidden:(this.behaviorType!=ColumnRendererEnum.URL_EXT_DESKTOP),disabled:(this.behaviorType!=ColumnRendererEnum.URL_EXT_DESKTOP)}]});this.items=[this.formPanel];sitools.admin.datasets.columnRenderer.urlPanel.superclass.initComponent.call(this)},isValid:function(){var a=this.formPanel.getForm();return a.isValid()},fillSpecificValue:function(d){var c=this.formPanel.getForm();var f=c.findField(&quot;display&quot;).getValue().getGroupValue();if(&quot;Text&quot;==f){var b=c.findField(&quot;linkText&quot;).getValue();d.linkText=b}else{var e=c.findField(&quot;image&quot;).getValue();var a={};if(!Ext.isEmpty(e)){a.url=e;a.type=&quot;Image&quot;;a.mediaType=&quot;Image&quot;;d.image=a}}if(this.behaviorType==ColumnRendererEnum.URL_EXT_DESKTOP){d.displayable=c.findField(&quot;displayable&quot;).getValue()}return true},afterRender:function(){sitools.admin.datasets.columnRenderer.urlPanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;this.columnRenderer.behavior==this.behaviorType){var b=this.formPanel.getForm();var a={};var d;if(!Ext.isEmpty(this.columnRenderer.linkText)){a.linkText=this.columnRenderer.linkText;a.display=&quot;Text&quot;;d=false}if(!Ext.isEmpty(this.columnRenderer.image)){a.image=this.columnRenderer.image.url;a.display=&quot;Image&quot;;d=true}if(this.behaviorType==ColumnRendererEnum.URL_EXT_DESKTOP){a.displayable=this.columnRenderer.displayable}else{a.displayable=false}var c=new Ext.data.Record(a);b.loadRecord(c);b.findField(&quot;linkText&quot;).setVisible(!d);b.findField(&quot;linkText&quot;).setDisabled(d);b.findField(&quot;image&quot;).setVisible(d);b.findField(&quot;image&quot;).setDisabled(!d)}}});Ext.namespace(&quot;sitools.admin.datasets.columnRenderer&quot;);sitools.admin.datasets.columnRenderer.imagePanel=Ext.extend(Ext.Panel,{flex:1,layout:{type:&quot;vbox&quot;,align:&quot;stretch&quot;},initComponent:function(){this.items=[];switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:this.formPanel=new Ext.form.FormPanel({flex:1,defaults:{anchor:&quot;100%&quot;},padding:5,items:{fieldLabel:i18n.get(&quot;label.linkText&quot;),name:&quot;linkText&quot;,xtype:&quot;textfield&quot;,allowBlank:false}});this.items.push(this.formPanel);break;case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:this.title=undefined;this.border=false;this.frame=true;break;case ColumnRendererEnum.IMAGE_FROM_SQL:this.items.push(this.createDatasetColumnGrid(this.datasetColumnStore));break;default:break}sitools.admin.datasets.columnRenderer.imagePanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRenderer.imagePanel.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;this.columnRenderer.behavior==this.behaviorType){switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:this.formPanel.getForm().findField(&quot;linkText&quot;).setValue(this.columnRenderer.linkText);break}}},createDatasetColumnGrid:function(b){var c=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.tableName&quot;),dataIndex:&quot;tableName&quot;},{header:i18n.get(&quot;headers.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;}],defaults:{sortable:true,width:100}});var a=new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,rowselect:function(d,f,e){this.formPanel.getForm().findField(&quot;url&quot;).disable();Ext.getCmp(&quot;status_bar_column&quot;).hide();this.doLayout()},rowdeselect:function(d,f,e){this.formPanel.getForm().findField(&quot;url&quot;).enable()}}});this.bbar=new Ext.ux.StatusBar({id:&quot;status_bar_column&quot;,hidden:true,text:i18n.get(&quot;label.no_column_selected&quot;),iconCls:&quot;x-status-error&quot;});this.gridColumns=new Ext.grid.GridPanel({id:&quot;gridColumnsSelect&quot;,layout:&quot;fit&quot;,autoScroll:true,store:b,cm:c,sm:a,flex:1,bbar:this.bbar,viewConfig:{forceFit:true},listeners:{scope:this,viewReady:function(){if(!Ext.isEmpty(this.columnRenderer)&amp;&amp;!Ext.isEmpty(this.columnRenderer.columnAlias)){var e=this.columnRenderer.columnAlias;var d=this.gridColumns.getStore().find(&quot;columnAlias&quot;,e);if(d!=-1){this.gridColumns.getSelectionModel().selectRow(d)}}}}});return this.gridColumns},isValid:function(){var c=true,b;switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:b=this.formPanel.getForm();c=b.isValid();break;case ColumnRendererEnum.IMAGE_FROM_SQL:var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){c=false;Ext.getCmp(&quot;status_bar_column&quot;).show()}break}return c},fillSpecificValue:function(b){switch(this.behaviorType){case ColumnRendererEnum.IMAGE_NO_THUMB:b.linkText=this.formPanel.getForm().findField(&quot;linkText&quot;).getValue();break;case ColumnRendererEnum.IMAGE_FROM_SQL:var a=this.gridColumns.getSelectionModel().getSelected();if(Ext.isEmpty(a)){return false}b.columnAlias=a.get(&quot;columnAlias&quot;);break}return true}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.columnRendererWin=Ext.extend(Ext.Window,{width:400,height:600,modal:true,layout:{type:&quot;vbox&quot;,align:&quot;stretch&quot;},initComponent:function(){this.title=this.columnRendererType+&quot; &quot;+i18n.get(&quot;label.detailColumnDefinition&quot;);var b;switch(this.columnRendererType){case&quot;URL&quot;:b=[[i18n.get(&quot;label.url_local&quot;),ColumnRendererEnum.URL_LOCAL],[i18n.get(&quot;label.url_ext_new_tab&quot;),ColumnRendererEnum.URL_EXT_NEW_TAB],[i18n.get(&quot;label.url_ext_desktop&quot;),ColumnRendererEnum.URL_EXT_DESKTOP]];break;case&quot;Image&quot;:b=[[i18n.get(&quot;label.image_no_thumb&quot;),ColumnRendererEnum.IMAGE_NO_THUMB],[i18n.get(&quot;label.image_thumb_from_image&quot;),ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE],[i18n.get(&quot;label.image_from_sql&quot;),ColumnRendererEnum.IMAGE_FROM_SQL]];break;case&quot;DataSetLink&quot;:b=[[i18n.get(&quot;label.dataset_link&quot;),ColumnRendererEnum.DATASET_LINK],[i18n.get(&quot;label.dataset_icon_link&quot;),ColumnRendererEnum.DATASET_ICON_LINK]];break;case&quot;Other&quot;:b=[[i18n.get(&quot;label.noClientAccess&quot;),ColumnRendererEnum.NO_CLIENT_ACCESS]];break;default:break}var a=new Ext.data.ArrayStore({fields:[{name:&quot;name&quot;},{name:&quot;behavior&quot;}],data:b});this.comboBehavior=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;behavior&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectABehavior&quot;),fieldLabel:i18n.get(&quot;label.behavior&quot;),anchor:&quot;100%&quot;,selectOnFocus:true,allowBlank:false,listeners:{scope:this,select:function(f,g,c){if(!Ext.isEmpty(this.panelDetails)){this.remove(this.panelDetails);this.panelDetails=null}var e=g.get(&quot;behavior&quot;);var d=this.selectedRecord.get(&quot;columnRenderer&quot;);switch(this.columnRendererType){case&quot;URL&quot;:this.panelDetails=new sitools.admin.datasets.columnRenderer.urlPanel({behaviorType:e,title:i18n.get(&quot;label.behaviorDetails&quot;),columnRenderer:d});break;case&quot;Image&quot;:this.panelDetails=new sitools.admin.datasets.columnRenderer.imagePanel({behaviorType:e,title:i18n.get(&quot;label.behaviorDetails&quot;),datasetColumnStore:this.datasetColumnStore,columnRenderer:d});break;case&quot;DataSetLink&quot;:this.panelDetails=new sitools.admin.datasets.columnRenderer.datasetLinkPanel({behaviorType:e,title:i18n.get(&quot;label.behaviorDetails&quot;),columnRenderer:d});break;default:break}if(!Ext.isEmpty(this.panelDetails)){this.add(this.panelDetails);this.doLayout()}}}});this.behaviorForm=new Ext.form.FormPanel({title:i18n.get(&quot;label.behavior&quot;),height:80,padding:5,items:[this.comboBehavior,{fieldLabel:i18n.get(&quot;label.tooltip&quot;),name:&quot;toolTip&quot;,xtype:&quot;textfield&quot;,}]});this.items=[this.behaviorForm];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];this.listeners={scope:this,beforeclose:function(){if(!this.validAction){var c=this.lastColumnRendererType;this.selectedRecord.set(&quot;columnRendererCategory&quot;,c);this.gridView.refresh()}}};sitools.admin.datasets.columnRendererWin.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.columnRendererWin.superclass.afterRender.apply(this,arguments);var e=this.selectedRecord.get(&quot;columnRenderer&quot;);if(!Ext.isEmpty(e)){var d=e.behavior;var c=e.toolTip;this.behaviorForm.getForm().findField(&quot;toolTip&quot;).setValue(c);var b=this.comboBehavior.getStore().find(&quot;behavior&quot;,d);if(b!=-1){this.comboBehavior.setValue(d);var a=this.comboBehavior.getStore().getAt(b);this.comboBehavior.fireEvent(&quot;select&quot;,this.comboBehavior,a,b)}}},onValidate:function(){var c=this.comboBehavior.getValue();var d=this.behaviorForm.getForm().findField(&quot;toolTip&quot;).getValue();var a=true;if(this.behaviorForm.getForm().isValid()){var b={};b.behavior=c;b.toolTip=d;if(!Ext.isEmpty(this.panelDetails)){if(this.panelDetails.isValid()){this.panelDetails.fillSpecificValue(b)}else{a=false}}if(a){this.selectedRecord.set(&quot;columnRenderer&quot;,b);this.gridView.refresh();this.validAction=true;this.close()}}}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.datasetUrlWin=Ext.extend(Ext.Window,{width:400,height:400,modal:true,initComponent:function(){this.urlDatasets=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.title=i18n.get(&quot;label.detailColumnDefinition&quot;);this.httpProxy=new Ext.data.HttpProxy({url:this.urlDatasets,restful:true,method:&quot;GET&quot;});this.storeColumns=new Ext.data.JsonStore({id:&quot;datasetColumnId&quot;,root:&quot;dataset.columnModel&quot;,idProperty:&quot;id&quot;,proxy:this.httpProxy,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;}]});this.gridViewColumns=new Ext.grid.GridView({listeners:{scope:this,refresh:function(){if(!Ext.isEmpty(this.selectedRecord.data.columnAliasDetail)){var c=this.storeColumns.find(&quot;columnAlias&quot;,this.selectedRecord.data.columnAliasDetail);if(c&gt;-1){this.smColumns.selectRow(c)}}}}});this.cmColumns=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.tableName&quot;),dataIndex:&quot;tableName&quot;},{header:i18n.get(&quot;headers.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;}],defaults:{sortable:true,width:100}});this.smColumns=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridColumns=new Ext.grid.EditorGridPanel({id:&quot;gridColumnsSelect&quot;,title:i18n.get(&quot;title.gridColumns&quot;),layout:&quot;fit&quot;,height:280,view:this.gridViewColumns,autoScroll:true,store:this.storeColumns,cm:this.cmColumns,sm:this.smColumns});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;sitoolsAttachementForUsers&quot;],url:this.urlDatasets,root:&quot;data&quot;,autoLoad:true,listeners:{scope:this,load:function(){if(!Ext.isEmpty(this.selectedRecord.data.datasetDetailUrl)){this.comboDatasets.setValue(this.selectedRecord.data.datasetDetailUrl);this.loadColumns(this.selectedRecord.data.datasetDetailUrl)}}}});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;sitoolsAttachementForUsers&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:&quot;Select a dataset...&quot;,selectOnFocus:true,listeners:{scope:this,select:function(d,e,c){this.loadColumns(e.data.id)}}});this.formImage=new Ext.form.FormPanel({layout:&quot;fit&quot;,title:i18n.get(&quot;label.formImage&quot;),height:80,items:[{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,vtype:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,growMax:400}]});var b=[this.comboDatasets,this.gridColumns];if(this.withImage){this.height+=80;b.push(this.formImage)}this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,title:i18n.get(&quot;label.datasetSelect&quot;),items:b,buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.datasetUrlWin.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.datasetUrlWin.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.selectedRecord)&amp;&amp;!Ext.isEmpty(this.selectedRecord.data)&amp;&amp;!Ext.isEmpty(this.selectedRecord.data.image)){var b={};var a=this.formImage.getForm();b.image=this.selectedRecord.data.image.url;a.loadRecord(new Ext.data.Record(b))}},loadColumns:function(a){this.httpProxy.setUrl(this.urlDatasets+&quot;/&quot;+a);this.gridColumns.getStore().load({callback:function(){this.gridColumns.getView().refresh()},scope:this})},onValidate:function(){var c=this.gridColumns.getSelectionModel().getSelected();this.selectedRecord.data.datasetDetailUrl=this.comboDatasets.getValue();this.selectedRecord.data.columnAliasDetail=c.data.columnAlias;var a=this.formImage.getForm();var b=a.findField(&quot;image&quot;).getValue();if(!Ext.isEmpty(b)){this.selectedRecord.data.image={};this.selectedRecord.data.image.url=b;this.selectedRecord.data.image.type=&quot;Image&quot;;this.selectedRecord.data.image.mediaType=&quot;Image&quot;}this.gridView.refresh();this.close()}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.columnsPropPanel=Ext.extend(Ext.Window,{width:600,height:300,modal:true,id:&quot;columnPropId&quot;,dataSets:&quot;&quot;,initComponent:function(){this.title=i18n.get(&quot;label.details&quot;);var a=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;display&quot;],data:[[&quot;SQL&quot;,i18n.get(&quot;label.sql&quot;)],[&quot;VIRTUAL&quot;,i18n.get(&quot;label.virtual&quot;)]]});this.comboColumnType=new Ext.form.ComboBox({store:a,mode:&quot;local&quot;,fieldLabel:i18n.get(&quot;label.specificColumnType&quot;),typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,selectOnFocus:true,lazyRender:true,listClass:&quot;x-combo-list-small&quot;,valueField:&quot;value&quot;,displayField:&quot;display&quot;,anchor:&quot;90%&quot;,value:&quot;SQL&quot;,listeners:{scope:this,change:function(d,c,b){if(c==&quot;SQL&quot;){this.sqlDef.setDisabled(false)}else{this.sqlDef.setDisabled(true)}}}});this.columnAlias=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.columnAlias&quot;),anchor:&quot;90%&quot;,validator:function(b){var c=new RegExp(&quot;^.*[!\&quot;#$%&amp;'/()*+,:;&lt;=&gt;?@\\`{}|~]+.*$&quot;);if(!c.test(b)){return !c.test(b)}else{return i18n.get(&quot;label.invalidColumnAlias&quot;)}}});this.sqlDef=new Ext.form.TextArea({fieldLabel:i18n.get(&quot;label.SQLDefinition&quot;),anchor:&quot;90%&quot;});this.items=[{xtype:&quot;panel&quot;,height:250,items:[{xtype:&quot;form&quot;,border:false,labelWidth:150,padding:10,defaults:{disabled:false},items:[this.comboColumnType,this.columnAlias,this.sqlDef]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:function(){this.onValidate()}},{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.columnsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasets.columnsPropPanel.superclass.onRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.comboColumnType.setValue(this.recordColumn.get(&quot;specificColumnType&quot;));this.columnAlias.setValue(this.recordColumn.get(&quot;columnAlias&quot;));this.sqlDef.setValue(this.recordColumn.get(&quot;dataIndex&quot;))}},onValidate:function(){if(this.action==&quot;modify&quot;){this.recordColumn.set(&quot;specificColumnType&quot;,this.comboColumnType.getValue());this.recordColumn.set(&quot;columnAlias&quot;,this.columnAlias.getValue());this.recordColumn.set(&quot;dataIndex&quot;,this.sqlDef.getValue())}else{var a;if(this.comboColumnType.getValue()==&quot;SQL&quot;){a=new Ext.data.Record({dataIndex:this.sqlDef.getValue(),specificColumnType:&quot;SQL&quot;,header:this.columnAlias.getValue(),columnAlias:this.columnAlias.getValue(),width:100,visible:true,sortable:true,tableName:&quot;&quot;,tableAlias:&quot;&quot;})}else{a=new Ext.data.Record({specificColumnType:&quot;VIRTUAL&quot;,header:this.columnAlias.getValue(),columnAlias:this.columnAlias.getValue(),width:100,visible:true,sortable:true,tableName:&quot;&quot;,tableAlias:&quot;&quot;})}this.store.add(a)}this.close()}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.datasetsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:ADMIN_PANEL_HEIGHT,id:ID.BOX.DATASETS,sm:new Ext.grid.RowSelectionModel(),pageSize:ADMIN_PANEL_NB_ELEMENTS,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a=&quot;&quot;;var c=d.data;if(c.dirty==&quot;true&quot;){a=&quot;red-row&quot;}return a}},initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:true,url:this.url,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;dirty&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:350},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:90,sortable:true}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};var a=[];this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this,xtype:&quot;s-menuButton&quot;},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onEdit},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete},{text:i18n.get(&quot;label.opensearch&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_open_search.png&quot;,handler:this.onEditOpenSearch},{text:i18n.get(&quot;label.refresh&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_refresh.png&quot;,handler:this._onRefresh},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive},{text:i18n.get(&quot;label.sqlString&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/sql_request.png&quot;,handler:this._getSqlString},{text:i18n.get(&quot;label.semantic&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_dictionary.png&quot;,handler:this._onEditSemantic},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.listeners={scope:this,rowDblClick:this.onEdit};sitools.admin.datasets.datasetsCrudPanel.superclass.initComponent.call(this)},onEdit:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(a.data.status==&quot;ACTIVE&quot;){this.onView()}else{this.onModify()}},onRender:function(){sitools.admin.usergroups.GroupCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.DATASETS)},onView:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;view&quot;,store:this.getStore(),datasetId:b.id});a.show(ID.BOX.DATASETS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(b.data.status==i18n.get(&quot;status.active&quot;)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.wrongStatus&quot;));return}if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.datasets.datasetsMultiTablesPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore(),datasetId:b.id});a.show(ID.BOX.DATASETS)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;datasetCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},onEditOpenSearch:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.datasets.datasetsOpenSearch({url:this.url+&quot;/&quot;+b.id,action:&quot;edit&quot;,store:this.getStore()});a.show(ID.BOX.DATASETS)},_onRefresh:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(a.data.status!=i18n.get(&quot;status.active&quot;)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.wrongStatus&quot;));return}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/refresh&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_getSqlString:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/getSqlString&quot;,method:&quot;PUT&quot;,scope:this,success:function(c){var d=Ext.decode(c.responseText);if(d.success){var b=new Ext.Window({title:i18n.get(&quot;label.sqlString&quot;),height:300,width:500,modal:true,resizable:true,autoScroll:true,html:d.message,buttons:[{text:i18n.get(&quot;label.ok&quot;),handler:function(){this.ownerCt.ownerCt.close()}}]});b.show()}},failure:alertFailure})},_onEditSemantic:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.datasets.DicoMapping({url:this.url+&quot;/&quot;+b.id,masked:(b.data.status==&quot;ACTIVE&quot;)});a.show(ID.BOX.DATASETS)}});Ext.reg(&quot;s-datasets&quot;,sitools.admin.datasets.datasetsCrudPanel);Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.dictionaryWin=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;label.dictionary&quot;);this.httpProxy=new Ext.data.HttpProxy({url:this.urlDictionary,restful:true,method:&quot;GET&quot;});this.storeNotion=new Ext.data.JsonStore({id:&quot;storeNotionSelect&quot;,root:&quot;dictionary.notions&quot;,idProperty:&quot;id&quot;,proxy:this.httpProxy,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;dictionaryId&quot;,type:&quot;string&quot;}]});this.cmNotion=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.id&quot;),dataIndex:&quot;id&quot;,width:100},{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;headers.unit&quot;),dataIndex:&quot;unit&quot;,width:100},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;,width:50},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:100}],defaults:{sortable:true,width:100}});this.smNotion=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridNotion=new Ext.grid.EditorGridPanel({id:&quot;gridNotionSelect&quot;,title:i18n.get(&quot;title.gridNotion&quot;),layout:&quot;fit&quot;,height:350,autoScroll:true,store:this.storeNotion,cm:this.cmNotion,sm:this.smNotion});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.urlDictionary,root:&quot;data&quot;,autoLoad:true});this.comboDictionary=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:&quot;Select a dictionary...&quot;,selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.loadNotions(d.data.id)}}});this.items=[{xtype:&quot;panel&quot;,height:450,title:i18n.get(&quot;label.dictionarySelect&quot;),items:[this.comboDictionary,this.gridNotion],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.dictionaryWin.superclass.initComponent.call(this)},loadNotions:function(a){this.httpProxy.setUrl(this.urlDictionary+a);this.gridNotion.getStore().load({callback:function(){this.gridNotion.getView().refresh()},scope:this})},onValidate:function(){var a=this.gridNotion.getSelectionModel().getSelected();this.recordColumn.data.notion=a.data;this.recordColumn.data.notion.url=this.urlDictionary+this.comboDictionary.getValue()+&quot;/notions/&quot;+a.data.id;this.viewColumn.refresh();this.close()}});Ext.reg(&quot;s-datasetsdictionary&quot;,sitools.admin.datasets.dictionaryWin);Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.unitWin=Ext.extend(Ext.Window,{width:600,height:400,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;label.units&quot;);this.httpProxy=new Ext.data.HttpProxy({url:this.urlDimension,restful:true,method:&quot;GET&quot;});this.storeUnits=new Ext.data.JsonStore({id:&quot;storeUnitSelect&quot;,root:&quot;dimension.sitoolsUnits&quot;,idProperty:&quot;id&quot;,proxy:this.httpProxy,fields:[{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;unitName&quot;,type:&quot;string&quot;}]});this.cmUnits=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.label&quot;),dataIndex:&quot;label&quot;,width:100}],defaults:{sortable:true,width:100}});this.smUnits=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridUnits=new Ext.grid.GridPanel({id:&quot;gridUnitId&quot;,title:i18n.get(&quot;title.unitList&quot;),autoScroll:true,store:this.storeUnits,cm:this.cmUnits,sm:this.smUnits,region:&quot;center&quot;});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;description&quot;],url:this.urlDimension,root:&quot;data&quot;,autoLoad:true});this.cmDimensions=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:100}],defaults:{sortable:true,width:100}});this.smDimensions=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridDimensions=new Ext.grid.GridPanel({id:&quot;gridViewDimensionsId&quot;,title:i18n.get(&quot;title.DimensionsList&quot;),region:&quot;west&quot;,autoScroll:true,store:a,cm:this.cmDimensions,sm:this.smDimensions,width:200,collapsible:true,resizable:true,listeners:{scope:this,rowclick:function(b,e){var d=b.getStore().getAt(e);var c=d.get(&quot;id&quot;);this.loadUnits(c)}}});this.layout=&quot;border&quot;;this.items=[this.gridUnits,this.gridDimensions];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];sitools.admin.datasets.unitWin.superclass.initComponent.call(this)},loadUnits:function(a){this.httpProxy.setUrl(this.urlDimension+&quot;/&quot;+a);this.storeUnits.load({callback:function(){this.gridUnits.getView().refresh()},scope:this})},onValidate:function(){var b=this.gridUnits.getSelectionModel().getSelected();if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noSelection&quot;));return}var a=this.gridDimensions.getSelectionModel().getSelected();this.recordColumn.data.unit=b.data;this.recordColumn.data.dimensionId=a.data.id;this.viewColumn.refresh();this.close()}});Ext.reg(&quot;s-datasetsUnits&quot;,sitools.admin.datasets.unitWin);Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.datasetsOpenSearch=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,state:null,id:ID.COMPONENT_SETUP.OPENSEARCH,initComponent:function(){this.idOpenSearch=null;this.title=i18n.get(&quot;label.editOpenSearchIndexes&quot;);var f=[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;,maxLength:16,allowBlank:false},{fieldLabel:i18n.get(&quot;label.description&quot;),name:&quot;description&quot;,anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,growMax:400},{fieldLabel:i18n.get(&quot;label.lastImportDate&quot;),name:&quot;lastImportDate&quot;,anchor:&quot;100%&quot;,disabled:true}];this.formPanel=new Ext.FormPanel({labelWidth:100,height:120,frame:true,defaultType:&quot;textfield&quot;,items:f,region:&quot;north&quot;});var l=new Ext.data.JsonStore({root:&quot;dataset.columnModel&quot;,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;dataIndex&quot;,type:&quot;string&quot;},{name:&quot;width&quot;,type:&quot;string&quot;},{name:&quot;sortable&quot;,type:&quot;boolean&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;filter&quot;,type:&quot;boolean&quot;},{name:&quot;columnOrder&quot;,type:&quot;string&quot;},{name:&quot;columnType&quot;,type:&quot;string&quot;},{name:&quot;notion&quot;,type:&quot;string&quot;},{name:&quot;schema&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;sqlColumnType&quot;,type:&quot;string&quot;},{name:&quot;specificColumnType&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;indexed&quot;,type:&quot;boolean&quot;},{name:&quot;returned&quot;},{name:&quot;defaultSearchField&quot;,type:&quot;boolean&quot;},{name:&quot;uniqueKey&quot;,type:&quot;boolean&quot;},{name:&quot;primaryKey&quot;,type:&quot;boolean&quot;},{name:&quot;keyword&quot;,type:&quot;boolean&quot;},{name:&quot;solrType&quot;,type:&quot;string&quot;},{name:&quot;linkFieldRelative&quot;,type:&quot;boolean&quot;}]});var b=new Ext.grid.CheckColumn({header:i18n.get(&quot;header.indexed&quot;),dataIndex:&quot;indexed&quot;,width:60});var a=new Ext.grid.CheckColumn({header:i18n.get(&quot;header.defaultSearchField&quot;),dataIndex:&quot;defaultSearchField&quot;,width:120});var m=new Ext.grid.CheckColumn({header:i18n.get(&quot;header.uniqueKey&quot;),dataIndex:&quot;uniqueKey&quot;,width:80});var c=new Ext.grid.CheckColumn({header:i18n.get(&quot;header.useForKeyWord&quot;),dataIndex:&quot;keyword&quot;,width:80});this.rssFieldData=[[0,&quot;&quot;],[1,&quot;titleField&quot;],[2,&quot;linkField&quot;],[3,&quot;guidField&quot;],[4,&quot;pubDateField&quot;],[5,&quot;descriptionField&quot;]];var e={header:i18n.get(&quot;header.returned&quot;),dataIndex:&quot;returned&quot;,width:130,scope:this,editor:new Ext.form.ComboBox({typeAhead:true,triggerAction:&quot;all&quot;,lazyRender:true,lazyInit:false,mode:&quot;local&quot;,emptyText:&quot; &quot;,forceSelection:true,store:new Ext.data.ArrayStore({fields:[&quot;idRssField&quot;,&quot;textRssField&quot;],data:this.rssFieldData}),valueField:&quot;textRssField&quot;,displayField:&quot;textRssField&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;x-combo-list-item comboItem&quot;&gt;{textRssField}&lt;/div&gt;&lt;/tpl&gt;',listeners:{scope:this,select:function(s,p){if(p.data.textRssField==&quot;linkField&quot;){var q=new sitools.admin.datasets.datasetsOpenSearch.relativeLink({selectedRecord:this.grid.getSelectionModel().getSelected()});q.show()}}}})};this.solrTypeData=[[0,&quot;&quot;],[1,&quot;text&quot;],[2,&quot;text_ws&quot;],[3,&quot;string&quot;],[4,&quot;rss_date&quot;],[5,&quot;date&quot;]];var g={header:i18n.get(&quot;headers.solrType&quot;),dataIndex:&quot;solrType&quot;,width:130,helpUrl:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/&quot;+LOCALE+&quot;/dataset/opensearch/solrType.html&quot;,editor:new Ext.form.ComboBox({triggerAction:&quot;all&quot;,mode:&quot;local&quot;,emptyText:&quot; &quot;,store:new Ext.data.ArrayStore({fields:[&quot;idSolrType&quot;,&quot;textSolrType&quot;],data:this.solrTypeData}),valueField:&quot;textSolrType&quot;,displayField:&quot;textSolrType&quot;,tpl:'&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;x-combo-list-item comboItem&quot;&gt;{textSolrType}&lt;/div&gt;&lt;/tpl&gt;'})};var k=new Ext.ux.grid.LockingColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),id:&quot;dataIndex&quot;,dataIndex:&quot;columnAlias&quot;,locked:true},{header:i18n.get(&quot;headers.tableName&quot;),id:&quot;tableName&quot;,dataIndex:&quot;tableName&quot;,locked:true},b,e,a,m,c,g]});var d=[b,a,m,c];var n=new Ext.grid.RowSelectionModel({singleSelect:true});this.grid=new Ext.ux.grid.LockingEditorGridPanel({border:false,layout:&quot;fit&quot;,pageSize:10,urlDatasets:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;),cm:k,sm:n,store:l,plugins:d,autoExpandColumn:&quot;dataIndex&quot;,clicksToEdit:1,enableColumnMove:false,region:&quot;center&quot;,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(t,q){var p=&quot;&quot;;var s=t.data;if(!s.indexed&amp;&amp;!Ext.isEmpty(s.returned)){p=&quot;red-row&quot;}return p}}});this.layout=&quot;border&quot;;this.items=[this.formPanel,this.grid];this.saveAndQuitButton=new Ext.Button({text:i18n.get(&quot;label.save&quot;),scope:this,hidden:true});this.refreshStatusButton=new Ext.Button({text:i18n.get(&quot;label.refreshStatus&quot;),scope:this,handler:function(){this._onRefreshStatusHandler()},hidden:true});this.buttonCancel=new Ext.Button({text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this._onCancel()},hidden:true});this.buttons=[this.saveAndQuitButton,this.refreshStatusButton,this.buttonCancel,{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}];this.buttonState1=[{text:i18n.get(&quot;label.saveIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:this._onSaveIndexHandler,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.help&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/help.png&quot;,handler:this._onHelp,xtype:&quot;s-menuButton&quot;}];this.buttonState2=[{text:i18n.get(&quot;label.saveIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:this._onUpdateIndexHandler,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.deleteIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDeleteIndex,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.activateIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActivateIndex,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.help&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/help.png&quot;,handler:this._onHelp,xtype:&quot;s-menuButton&quot;}];this.buttonState3=[];this.buttonState4=[{text:i18n.get(&quot;label.refreshIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_refresh.png&quot;,handler:this._onRefreshIndex,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.desactivateIndex&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDesactivateIndex,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.help&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/help.png&quot;,handler:this._onHelp,xtype:&quot;s-menuButton&quot;}];this.state1=1;this.state2=2;this.state3=3;this.state4=4;this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},height:27};this.buttonbbar=new Ext.Button({text:i18n.get(&quot;label.errorDetails&quot;)});this.bbar=new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,items:[this.buttonbbar],text:i18n.get(&quot;label.osErrorLastExe&quot;),iconCls:&quot;x-status-error&quot;});this.grid.getView().addListener(&quot;refresh&quot;,function(){this.applyMask(this.state)},this);sitools.admin.datasets.datasetsOpenSearch.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasets.datasetsOpenSearch.superclass.onRender.apply(this,arguments);this.objectList={};Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var d=Ext.decode(b.responseText);if(!d.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),d.message);return false}this.idOpenSearch=d.dataset.id;var e=d.dataset.columnModel;var a=this.grid.getStore();for(var c=0;c&lt;e.length;c++){if(e[c].specificColumnType===&quot;DATABASE&quot;||e[c].specificColumnType===&quot;SQL&quot;){a.add(new Ext.data.Record(e[c]))}}this.loadModifications()}})},loadModifications:function(){Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),&quot;Server error&quot;);return false}b=b.opensearch;this.updateState(b);this.populateForm(b);this.populateStore(b)},failure:alertFailure})},populateStore:function(e){this.cleanGridInput();if(e!==undefined){var d;var c;var b=e.indexedColumns;if(b!==undefined){for(d=0;d&lt;b.length;d++){c=this.getObjectFromStore(&quot;id&quot;,b[d].idColumn);if(c!==undefined){c.indexed=true;c.solrType=b[d].type}}}var a=e.keywordColumns;if(a!==undefined){for(d=0;d&lt;a.length;d++){c=this.getObjectFromStore(&quot;columnAlias&quot;,a[d]);if(c!==undefined){c.keyword=true}}}c=this.getObjectFromStore(&quot;id&quot;,e.defaultSearchField);if(c!==undefined){c.defaultSearchField=true}c=this.getObjectFromStore(&quot;id&quot;,e.uniqueKey);if(c!==undefined){c.uniqueKey=true}this.setReturnField(&quot;titleField&quot;,e);this.setReturnField(&quot;linkField&quot;,e);this.setReturnField(&quot;guidField&quot;,e);this.setReturnField(&quot;pubDateField&quot;,e);this.setReturnField(&quot;descriptionField&quot;,e);if(a!==undefined){for(d=0;d&lt;a.length;d++){c=this.getObjectFromStore(&quot;dataIndex&quot;,a[d]);if(c!==undefined){c.keyword=true}}}this.grid.getView().refresh()}},updateState:function(a){Ext.getCmp(&quot;statusBar&quot;).hide();if(a!==undefined){if(a.status==&quot;ACTIVE&quot;){this.updateButtons(this.state4);this.state=this.state4}else{if(a.status==&quot;PENDING&quot;){this.updateButtons(this.state3);this.state=this.state3}else{this.updateButtons(this.state2);this.state=this.state2;if(!Ext.isEmpty(a.errorMsg)){Ext.getCmp(&quot;statusBar&quot;).show();this.buttonbbar.setHandler(function(){Ext.Msg.alert(i18n.get(&quot;msg.error&quot;),i18n.get(&quot;label.osErrorLastExe&quot;)+&quot;&lt;BR/&gt;&quot;+a.errorMsg+&quot;&lt;BR/&gt;&quot;+i18n.get(&quot;label.checkLogMoreInfo&quot;))})}}}}else{this.updateButtons(this.state1);this.state=this.state1}},populateForm:function(c){if(c!==undefined){var b=this.formPanel.getForm();var d={};d.name=c.name;d.description=c.description;if(c.image!==undefined){d.image=c.image.url}if(c.lastImportDate!==undefined){d.lastImportDate=c.lastImportDate}var a=new Ext.data.Record(d);b.loadRecord(a)}},getObjectFromStore:function(e,d){var a=this.grid.getStore();var c=a.find(e,d);if(c!=-1){var b=a.getAt(c);return b.data}else{return undefined}},setReturnField:function(d,c){var a=this.grid.getStore();if(c[d]!==undefined){var b=this.getObjectFromStore(&quot;id&quot;,c[d]);if(b!==undefined){b.returned=d;if(d==&quot;linkField&quot;){b.linkFieldRelative=c.linkFieldRelative}}}},updateButtons:function(b){var a=this.getTopToolbar();a.removeAll();this.hideLoadingMask();this.applyMask(b);if(b==this.state1){this.addButtonToToolbar(a,this.buttonState1);this.saveAndQuitButton.setHandler(this._onSaveAndQuitIndexHandler,this);this.saveAndQuitButton.show();this.refreshStatusButton.hide();this.buttonCancel.hide()}else{if(b==this.state2){this.addButtonToToolbar(a,this.buttonState2);this.saveAndQuitButton.show();this.saveAndQuitButton.setHandler(this._onUpdateAndQuitIndexHandler,this);this.refreshStatusButton.hide();this.buttonCancel.hide()}else{if(b==this.state3){this.addButtonToToolbar(a,this.buttonState2);this.saveAndQuitButton.hide();this.refreshStatusButton.show();this.buttonCancel.show()}else{if(b==this.state4){this.addButtonToToolbar(a,this.buttonState4);this.saveAndQuitButton.hide();this.refreshStatusButton.hide();this.buttonCancel.hide()}}}}this.doLayout()},applyMask:function(a){if(a==this.state4){this.grid.getView().getLockedBody().mask();this.grid.getView().mainBody.mask();this.formPanel.getEl().mask()}else{if(a==this.state3){this.applyLoadingMask()}else{this.grid.getView().getLockedBody().unmask();this.grid.getView().mainBody.unmask();this.formPanel.getEl().unmask()}}this.doLayout()},applyLoadingMask:function(){this.items.items[0].getEl().mask();this.getTopToolbar().getEl().mask();var a=new Ext.LoadMask(this.items.items[1].getEl(),{msg:i18n.get(&quot;label.waitForActivation&quot;)+&quot;&lt;br/&gt;&quot;+i18n.get(&quot;label.refreshOsToCheckStatus&quot;)});a.show()},hideLoadingMask:function(){this.items.items[0].getEl().unmask();this.items.items[1].getEl().unmask();this.getTopToolbar().getEl().unmask()},addButtonToToolbar:function(b,a){for(var c=0;c&lt;a.length;c++){b.add(a[c])}},_onActivateIndex:function(){this.applyLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;)+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c);this.populateStore(c)},failure:function(a,b){alertFailure(a,b)}})},_onDesactivateIndex:function(){Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;)+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c);this.populateStore(c)},failure:alertFailure})},_onUpdateAndQuitIndexHandler:function(){this._onSaveIndex(&quot;update&quot;,true)},_onSaveAndQuitIndexHandler:function(){this._onSaveIndex(&quot;create&quot;,true)},_onUpdateIndexHandler:function(){this._onSaveIndex(&quot;update&quot;,false)},_onSaveIndexHandler:function(){this._onSaveIndex(&quot;create&quot;,false)},_onHelp:function(){showHelp(loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-admin/res/help/en/openSearch.html&quot;)},_onSaveIndex:function(k,m){var t=this.grid.getStore();var u=this.checkForDoubloon(this.rssFieldData,t,&quot;returned&quot;);if(u!==null){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.doubloonReturnAsMsg&quot;)+u);return false}var a=this.grid.getView();var b=false;var f=[];var q=[];var c={};for(var p=0;p&lt;t.getCount();p++){var g=t.getAt(p).data;if(g.indexed){var l={};l.idColumn=g.id;if(!Ext.isEmpty(g.solrType)&amp;&amp;g.solrType!==&quot;&quot;){l.type=g.solrType}f.push(l)}if(g.keyword){q.push(g.columnAlias)}if(g.defaultSearchField){c.defaultSearchField=g.id}if(g.uniqueKey){c.uniqueKey=g.id}var n=g.returned;if(!Ext.isEmpty(g.returned)){c[g.returned]=g.id;if(!g.indexed){b=true}if(g.returned==&quot;linkField&quot;){c.linkFieldRelative=g.linkFieldRelative}}}if(b){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.osColReturnedButNotIndexed&quot;));return false}c.indexedColumns=f;c.keywordColumns=q;c.id=this.idOpenSearch;var d=this.formPanel.getForm();Ext.iterate(d.getValues(),function(v,z){if(v==&quot;image&quot;){c.image={};c.image.url=z;c.image.type=&quot;Image&quot;;c.image.mediaType=&quot;Image&quot;}else{c[v]=z}},this);if(f.length===0){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.noColumnMsg&quot;))}else{if(c.defaultSearchField===undefined){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.noDefaultSearchField&quot;))}else{if(c.uniqueKey===undefined){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.noUniqueKey&quot;))}else{if(!d.isValid()){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.formErrorValidation&quot;))}}}}var e=this.checkMapping(this.rssFieldData,t,&quot;returned&quot;);if(!e){var s=Ext.Msg.show({title:i18n.get(&quot;label.information&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.opensearch.checkMapping&quot;),scope:this,fn:function(v,z){if(v==&quot;yes&quot;){this._doSaveIndex(k,m,c)}}})}else{this._doSaveIndex(k,m,c)}},_doSaveIndex:function(c,a,b){var d=(c==&quot;create&quot;)?&quot;POST&quot;:&quot;PUT&quot;;Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;),method:d,scope:this,jsonData:b,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return false}if(!a){var f=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.indexSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.updateButtons(this.state2)}else{this.close()}},failure:alertFailure})},_onDeleteIndex:function(){var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.opensearch.delete&quot;),scope:this,fn:function(b,c){if(b==&quot;yes&quot;){this.doDelete()}}})},doDelete:function(){Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;),method:&quot;DELETE&quot;,scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return}this.cleanGridInput();this.cleanForm();this.updateButtons(this.state1)},failure:alertFailure})},cleanGridInput:function(){var b=this.grid.getStore();for(var a=0;a&lt;b.getCount();a++){var c=b.getAt(a).data;c.indexed=false;c.returned=undefined;c.defaultSearchField=false;c.uniqueKey=false;c.keyword=false;c.solrType=undefined}this.grid.getView().refresh()},cleanForm:function(){var a=this.formPanel.getForm();a.reset()},_onRefreshIndex:function(){this.applyLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;)+&quot;/refresh&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c)},failure:function(a,b){alertFailure(a,b)}})},_onRefreshStatusHandler:function(){Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(b){var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}var c=a.opensearch;this.updateState(c);this.populateForm(c)},failure:function(a,b){alertFailure(a,b)}})},_onCancel:function(){this.hideLoadingMask();Ext.Ajax.request({url:this.url+loadUrl.get(&quot;APP_OPENSEARCH_URL&quot;)+&quot;/cancel&quot;,method:&quot;PUT&quot;,scope:this,success:function(c){var a=Ext.decode(c.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}var b={};b.opensearch={};b.opensearch.status=&quot;INACTIVE&quot;;this.updateState(b)},failure:function(a,b){alertFailure(a,b)}})},checkForDoubloon:function(c,f,g){var k=[c.length];for(var d=0;d&lt;c.length;d++){k[d]=0}var e=null;for(d=0;d&lt;f.getCount()&amp;&amp;e===null;d++){var a=f.getAt(d).data;var l=false;if(a[g]!==&quot;&quot;){for(var b=0;b&lt;c.length&amp;&amp;e===null&amp;&amp;!l;b++){if(a[g]==c[b][1]){k[b]++;l=true;if(k[b]&gt;1){e=c[b][1]}}}}}return e},checkMapping:function(c,g,d){var f=0;var a=c.length-1;for(var b=0;b&lt;g.getCount()&amp;&amp;f&lt;a;b++){var e=g.getAt(b).data;if(!Ext.isEmpty(e[d])){f++}}return f==a}});Ext.reg(&quot;s-datasetsOpenSearch&quot;,sitools.admin.datasets.datasetsOpenSearch);sitools.admin.datasets.datasetsOpenSearch.relativeLink=Ext.extend(Ext.Window,{modal:true,width:200,initComponent:function(){this.title=i18n.get(&quot;label.detailColumnDefinition&quot;);this.formRelative=new Ext.form.FormPanel({padding:10,labelWidth:120,items:[{xtype:&quot;checkbox&quot;,name:&quot;relative&quot;,fieldLabel:i18n.get(&quot;label.isRelative&quot;),anchor:&quot;100%&quot;,maxLength:100}]});this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];this.items=[this.formRelative];sitools.admin.datasets.datasetsOpenSearch.relativeLink.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.datasets.datasetsOpenSearch.relativeLink.superclass.afterRender.apply(this,arguments);if(!Ext.isEmpty(this.selectedRecord)&amp;&amp;!Ext.isEmpty(this.selectedRecord.data)){var b={};var a=this.formRelative.getForm();b.relative=this.selectedRecord.data.linkFieldRelative;a.loadRecord(new Ext.data.Record(b))}},onValidate:function(){var a=this.formRelative.getForm();var b=a.findField(&quot;relative&quot;).getValue();this.selectedRecord.data.linkFieldRelative=b;this.close()}});Ext.namespace(&quot;sitools.component.dictionary&quot;);sitools.component.dictionary.dictionaryPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,templateLoaded:false,conceptTemplate:null,initComponent:function(){this.conceptTemplatesUrl=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_TEMPLATES_URL&quot;);if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyDictionary&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createDictionary&quot;)}this.gridTemplates=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridTemplates&quot;,title:i18n.get(&quot;title.conceptTemplates&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.conceptTemplatesUrl,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;properties&quot;}],autoLoad:true,listeners:{scope:this,load:function(){this.templateLoaded=true;if(this.action==&quot;modify&quot;){this.gridTemplates.fireEvent(&quot;conceptTemplateLoaded&quot;)}}}}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:300,sortable:true}]}),listeners:{scope:this,rowclick:this.onTemplateClick,conceptTemplateLoaded:function(){if(this.templateLoaded&amp;&amp;!Ext.isEmpty(this.conceptTemplate)&amp;&amp;this.action==&quot;modify&quot;&amp;&amp;!Ext.isEmpty(this.conceptTemplate.id)){var b=this.gridTemplates.getStore().indexOfId(this.conceptTemplate.id);if(b&gt;-1){this.gridTemplates.getSelectionModel().selectRow(b)}}}}});var a=new Ext.Panel({title:i18n.get(&quot;title.gridConcept&quot;),id:&quot;gridConceptsSelect&quot;,listeners:{scope:this,activate:this.onTemplateClick}});this.dictionaryFormPanel=new Ext.FormPanel({border:false,padding:10,id:&quot;dictionaryFormPanel&quot;,title:i18n.get(&quot;label.dictionaryInfo&quot;),height:400,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;}]});this.mainTabPanel=new Ext.TabPanel({xtype:&quot;tabpanel&quot;,height:450,activeTab:0,id:&quot;tabPanelDictionary&quot;,items:[this.gridTemplates,this.dictionaryFormPanel,a],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.mainTabPanel];this.listeners={scope:this,resize:function(e,d,b){var c=e.body.getSize();this.mainTabPanel.setSize(c)}};sitools.component.dictionary.dictionaryPropPanel.superclass.initComponent.call(this)},onUpload:function(){Ext.Msg.alert(&quot;upload non impl&amp;eacute;ment&amp;eacute;&quot;)},onCreateConcept:function(){var d;if(Ext.isEmpty(this.conceptTemplate)){d=this.gridTemplates.getSelectionModel().getSelected().data}else{d=this.conceptTemplate}var a={};for(var b=0;b&lt;d.properties.length;b++){var c=d.properties[b];a[c.name]=c.value}this.findById(&quot;gridConceptsSelect&quot;).getStore().add(new Ext.data.Record(a));if(this.findById(&quot;gridConceptsSelect&quot;).getStore().getCount()==1){this.gridTemplates.getEl().mask()}},onDeleteConcet:function(){var a=this.findById(&quot;gridConceptsSelect&quot;);var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}a.getStore().remove(b);if(this.findById(&quot;gridConceptsSelect&quot;).getStore().getCount()===0){this.gridTemplates.getEl().unmask()}},onValidate:function(){var c=this.gridTemplates.getSelectionModel().getSelected();var e;if(!c){e=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noTemplateselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}var k,m={},n,g;e=[];k=this.dictionaryFormPanel.getForm();if(!k.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}Ext.iterate(k.getFieldValues(),function(f,s){if(f==&quot;image&quot;){m.image={};m.image.url=s;m.image.type=&quot;Image&quot;;m.image.mediaType=&quot;Image&quot;}else{m[f]=s}},this);var q;if(Ext.isEmpty(this.conceptTemplate)){q=this.gridTemplates.getSelectionModel().getSelected().data}else{q=this.conceptTemplate}if(!Ext.isEmpty(q)){m.conceptTemplate=q;if(Ext.isEmpty(m.conceptTemplate.properties)){m.conceptTemplate.properties=[]}}var d=this.findById(&quot;gridConceptsSelect&quot;);if(!Ext.isEmpty(d)&amp;&amp;Ext.isFunction(d.getStore)){n=this.findById(&quot;gridConceptsSelect&quot;).getStore();if(n.getCount()&gt;0){m.concepts=[];for(g=0;g&lt;n.getCount();g++){var l=n.getAt(g).data;var b={id:l.id,name:l.name,description:l.description,properties:[]};for(var p in l){if(p!=&quot;id&quot;&amp;&amp;p!=&quot;name&quot;&amp;&amp;p!=&quot;description&quot;){b.properties.push({name:p,value:l[p]})}}m.concepts.push(b)}}}var a=(this.action==&quot;modify&quot;)?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:m,success:function(f){this.close();this.store.reload()},failure:alertFailure})},onRender:function(){sitools.component.dictionary.dictionaryPropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a;if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(l){var e=Ext.decode(l.responseText).dictionary;var k=this.findById(&quot;dictionaryFormPanel&quot;).getForm();var c={};c.id=e.id;c.name=e.name;c.description=e.description;var g=new Ext.data.Record(c);k.loadRecord(g);if(!Ext.isEmpty(e.conceptTemplate)){this.conceptTemplate=e.conceptTemplate}this.gridTemplates.fireEvent(&quot;conceptTemplateLoaded&quot;);this.createConceptGrid(e.conceptTemplate);if(!e.concepts){return}var n=this.findById(&quot;gridConceptsSelect&quot;).getStore();var m=0;for(a=0;a&lt;e.concepts.length;a++){m++;var q=e.concepts[a];var b={id:q.id,name:q.name,description:q.description};for(var d=0;d&lt;q.properties.length;d++){var p=q.properties[d];b[p.name]=p.value}c=new Ext.data.Record(b);n.add(c)}if(m&gt;0){this.gridTemplates.getEl().mask()}},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.errorMessage)}})}}},onTemplateClick:function(a,f,c){var d=this.gridTemplates.getSelectionModel().getSelected();if(!d){return false}var b=d.data.id;if(Ext.isEmpty(this.conceptTemplate)||this.conceptTemplate.id!=b){this.createConceptGrid(d.data);this.conceptTemplate=d.data}},createConceptGrid:function(b){var a=new sitools.component.dictionary.gridPanel({template:b,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),tbar:{xtype:&quot;sitools.widget.GridSorterToolbar&quot;,gridId:&quot;gridConceptsSelect&quot;,items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateConcept,scope:this},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteConcet,scope:this}]},id:&quot;gridConceptsSelect&quot;,title:i18n.get(&quot;title.gridConcept&quot;),editable:true});var c=this.get(&quot;tabPanelDictionary&quot;);c.remove(&quot;gridConceptsSelect&quot;);c.add(a);this.doLayout()},beforeTabChange:function(a,e,d){if(e.id==&quot;gridConceptsSelect&quot;||e.id==&quot;dictionaryFormPanel&quot;){var c=this.gridTemplates.getSelectionModel().getSelected();if(!c&amp;&amp;Ext.isEmpty(this.conceptTemplate)){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noTemplateselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}});Ext.reg(&quot;s-dictionaryprop&quot;,sitools.component.dictionary.dictionaryPropPanel);Ext.namespace(&quot;sitools.component.dictionary&quot;);sitools.component.dictionary.dictionaryCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;template&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.dictionary.dictionaryCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.dictionary.dictionaryCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.dictionary.dictionaryPropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.DICTIONARY)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.dictionary.dictionaryPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore()});a.show(ID.BOX.DICTIONARY)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;dictionaryCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-dictionary&quot;,sitools.component.dictionary.dictionaryCrudPanel);Ext.namespace(&quot;sitools.component.dictionary&quot;);sitools.component.dictionary.templatePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyTemplate&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createTemplate&quot;)}var b=new Ext.data.JsonStore({id:&quot;storePropertiesSelect&quot;,root:&quot;property&quot;,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;}]});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;headers.value&quot;),dataIndex:&quot;value&quot;,width:150,editor:new Ext.form.TextField({allowBlank:true})}],defaults:{sortable:true,width:100,editor:new Ext.form.TextField({allowBlank:false})}});var d=new Ext.grid.RowSelectionModel({singleSelect:true});var e={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateProperty},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteProperty}]};var c=new Ext.grid.EditorGridPanel({id:&quot;gridPropertySelect&quot;,title:i18n.get(&quot;title.gridProperty&quot;),store:b,tbar:e,cm:a,sm:d});this.items=[{xtype:&quot;tabpanel&quot;,height:450,activeTab:0,items:[{xtype:&quot;panel&quot;,height:400,title:i18n.get(&quot;label.templateInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;}]}]},c],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.component.dictionary.templatePropPanel.superclass.initComponent.call(this)},onUpload:function(){Ext.Msg.alert(&quot;upload non impl&amp;eacute;ment&amp;eacute;&quot;)},onCreateProperty:function(){this.findById(&quot;gridPropertySelect&quot;).getStore().add(new Ext.data.Record())},onDeleteProperty:function(){var a=this.findById(&quot;gridPropertySelect&quot;);var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}a.getStore().remove(b)},onValidate:function(){var d,e={},a,c=[],b;d=this.findByType(&quot;form&quot;)[0].getForm();if(!d.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}if(this.action==&quot;modify&quot;){Ext.iterate(d.getValues(),function(f,g){if(f==&quot;image&quot;){e.image={};e.image.url=g;e.image.type=&quot;Image&quot;;e.image.mediaType=&quot;Image&quot;}else{e[f]=g}},this);a=this.findById(&quot;gridPropertySelect&quot;).getStore();if(a.getCount()&gt;0){e.properties=[];for(b=0;b&lt;a.getCount();b++){e.properties.push(a.getAt(b).data)}}Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:e,success:function(f){this.close();this.store.reload()},failure:alertFailure})}if(this.action==&quot;create&quot;){Ext.iterate(d.getValues(),function(f,g){if(f==&quot;image&quot;){e.image={};e.image.url=g;e.image.type=&quot;Image&quot;;e.image.mediaType=&quot;Image&quot;}else{e[f]=g}},this);a=this.findById(&quot;gridPropertySelect&quot;).getStore();if(a.getCount()&gt;0){e.properties=[];for(b=0;b&lt;a.getCount();b++){e.properties.push(a.getAt(b).data)}}Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,jsonData:e,success:function(f){this.close();this.store.reload()},failure:alertFailure})}},onRender:function(){sitools.component.dictionary.templatePropPanel.superclass.onRender.apply(this,arguments);if(this.url){var a;if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(d){var k=this.findByType(&quot;form&quot;)[0].getForm();var c=this.findById(&quot;gridPropertySelect&quot;).getStore();var g=Ext.decode(d.responseText).template;var l={};l.id=g.id;l.name=g.name;l.description=g.description;var b=new Ext.data.Record(l);k.loadRecord(b);if(!g.properties){return}var e;if(typeof g.properties[0]&amp;&amp;g.properties[0] instanceof Array){e=g.properties[0]}else{e=g.properties}for(a=0;a&lt;e.length;a++){l=new Ext.data.Record(e[a]);c.add(l)}},failure:function(b){var c=Ext.decode(b.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.errorMessage)}})}}}});Ext.reg(&quot;s-templateprop&quot;,sitools.component.dictionary.templatePropPanel);Ext.namespace(&quot;sitools.component.dictionary&quot;);sitools.component.dictionary.templateCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_TEMPLATES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.dictionary.templateCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.dictionary.templateCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.component.dictionary.templatePropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.TEMPLATE)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.dictionary.templatePropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore()});a.show(ID.BOX.TEMPLATE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;templateCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-template&quot;,sitools.component.dictionary.templateCrudPanel);Ext.namespace(&quot;sitools.component.dictionary&quot;);sitools.component.dictionary.selectDictionary=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;title.selectDictionary&quot;);this.cmselectDictionary=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),sortable:true,dataIndex:&quot;name&quot;},{id:&quot;description&quot;,header:i18n.get(&quot;headers.description&quot;),sortable:false,dataIndex:&quot;description&quot;}]});this.smselectDictionary=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridselectDictionary=new Ext.grid.GridPanel({height:380,autoScroll:true,viewConfig:{forceFit:true},store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.url,restful:true,method:&quot;GET&quot;}),remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}],autoLoad:true}),cm:this.cmselectDictionary,sm:this.smselectDictionary});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[this.gridselectDictionary],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.component.dictionary.selectDictionary.superclass.initComponent.call(this)},onValidate:function(){var a=this.gridselectDictionary.getSelectionModel().getSelected();if(a!==null){this.record.data[this.field]=a.data.name;this.parentView.refresh();this.close()}else{new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document)}}});Ext.reg(&quot;s-selectDictionaryWin&quot;,sitools.component.dictionary.selectDictionary);Ext.namespace(&quot;sitools.admin.datasource&quot;);sitools.admin.datasource.DataBaseCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.DATABASE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASOURCES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:205,sortable:false},{header:i18n.get(&quot;label.url&quot;),dataIndex:&quot;url&quot;,width:350,sortable:false},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:90,sortable:true}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this._onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.testCnx&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_test_connection.png&quot;,handler:this._onTest,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.datasource.DataBaseCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.DataBaseCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.datasource.DataBasePropPanel({url:this.url,action:&quot;create&quot;,store:this.store});a.show(ID.BOX.DATABASE)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(b.data.status==i18n.get(&quot;status.active&quot;)){this._onView();return}var a=new sitools.admin.datasource.DataBasePropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.store});a.show(ID.BOX.DATABASE)},_onView:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.datasource.DataBasePropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;view&quot;,store:this.store});a.show()},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;databaseCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onTest:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.datasource.DataBaseTest({url:this.url+&quot;/&quot;+b.id+&quot;/test&quot;});a.show()}});Ext.reg(&quot;s-database&quot;,sitools.admin.datasource.DataBaseCrudPanel);Ext.namespace(&quot;sitools.admin.datasource&quot;);sitools.admin.datasource.DataBasePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.COMPONENT_SETUP.DATABASE,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createDatabase&quot;)}else{if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyDatabase&quot;)}else{if(this.action==&quot;view&quot;){this.title=i18n.get(&quot;label.viewDatabase&quot;)}}}this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,title:i18n.get(&quot;label.databaseInfo&quot;),items:[{xtype:&quot;form&quot;,formId:&quot;datasourceForm&quot;,border:false,labelWidth:150,padding:10,defaultType:&quot;textfield&quot;,defaults:{anchor:&quot;100%&quot;,allowBlank:false},items:[{name:&quot;id&quot;,hidden:true,allowBlank:true},{name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;)},{name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),allowBlank:true},{xtype:&quot;combo&quot;,id:&quot;driverDatasourceId&quot;,mode:&quot;local&quot;,triggerAction:&quot;all&quot;,editable:false,name:&quot;driverClass&quot;,fieldLabel:i18n.get(&quot;label.driver&quot;),width:100,store:new Ext.data.ArrayStore({fields:[{name:&quot;code&quot;},{name:&quot;label&quot;}],data:[[&quot;org.gjt.mm.mysql.Driver&quot;,&quot;MySQL&quot;],[&quot;org.postgresql.Driver&quot;,&quot;PostgreSQL&quot;]]}),valueField:&quot;code&quot;,displayField:&quot;label&quot;,anchor:&quot;50%&quot;},{name:&quot;url&quot;,fieldLabel:i18n.get(&quot;label.url&quot;),validator:function(b){var a=Ext.getCmp(&quot;driverDatasourceId&quot;).getValue();if(Ext.isEmpty(a)){return&quot;The Driver is empty&quot;}else{switch(a){case&quot;org.gjt.mm.mysql.Driver&quot;:if(b.match(&quot;mysql&quot;)){return true}else{return&quot;The driver doesn't match with this url&quot;}break;case&quot;org.postgresql.Driver&quot;:if(b.match(&quot;postgresql&quot;)){return true}else{return&quot;The driver doesn't match with this url&quot;}break}}return true}},{name:&quot;schemaOnConnection&quot;,fieldLabel:i18n.get(&quot;label.schemaOnConnection&quot;),allowBlank:true},{name:&quot;sitoolsAttachementForUsers&quot;,fieldLabel:i18n.get(&quot;label.userAttach&quot;),vtype:&quot;attachment&quot;},{name:&quot;userLogin&quot;,fieldLabel:i18n.get(&quot;label.userLogin&quot;),vtype:&quot;withoutSpace&quot;},{fieldLabel:i18n.get(&quot;label.userPassword&quot;),inputType:&quot;password&quot;,name:&quot;userPassword&quot;,vtype:&quot;withoutSpace&quot;},{xtype:&quot;spinnerfield&quot;,name:&quot;maxActive&quot;,id:&quot;maxActiveId&quot;,fieldLabel:i18n.get(&quot;label.maxActive&quot;),minValue:0,maxValue:20,allowDecimals:false,incrementValue:1,accelerate:true,anchor:&quot;50%&quot;,value:10,validator:function(a){var b=Ext.getCmp(&quot;initialSizeId&quot;).getValue();if(Ext.isEmpty(b)){b=0}if(Ext.isEmpty(a)){return i18n.get(&quot;label.nullValue&quot;)}if(b&gt;a){return String.format(i18n.get(&quot;label.dbMaxActiveError&quot;),a,b)}else{return true}}},{xtype:&quot;spinnerfield&quot;,name:&quot;initialSize&quot;,id:&quot;initialSizeId&quot;,fieldLabel:i18n.get(&quot;label.initialSize&quot;),minValue:0,maxValue:20,allowDecimals:false,incrementValue:1,accelerate:true,anchor:&quot;50%&quot;,value:5,validator:function(b){var a=Ext.getCmp(&quot;maxActiveId&quot;).getValue();if(Ext.isEmpty(a)){a=0}if(Ext.isEmpty(b)){return i18n.get(&quot;label.nullValue&quot;)}if(a&lt;b){return String.format(i18n.get(&quot;label.dbMaxActiveError&quot;),a,b)}else{return true}}}]}],buttons:[{text:i18n.get(&quot;label.testCnx&quot;),scope:this,handler:this._onTest},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];this.listeners={scope:this,resize:function(d,c,a){var b=d.body.getSize();this.findByType(&quot;panel&quot;)[0].setSize(b)}};sitools.admin.datasource.DataBasePropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.DataBasePropPanel.superclass.onRender.apply(this,arguments);Ext.each(this.findByType(&quot;form&quot;)[0].items.items,function(b){b.disable()},this);this.findByType(&quot;panel&quot;)[0].buttons[1].disable();this.findByType(&quot;panel&quot;)[0].buttons[0].disable();if(this.action==&quot;modify&quot;||this.action==&quot;view&quot;){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var d=Ext.decode(b.responseText);a.setValues(d.jdbcdatasource);var c=a.isValid()},failure:alertFailure})}if(this.action==&quot;modify&quot;||this.action==&quot;create&quot;){Ext.each(this.findByType(&quot;form&quot;)[0].items.items,function(b){b.enable()},this);this.findByType(&quot;panel&quot;)[0].buttons[1].enable();this.findByType(&quot;panel&quot;)[0].buttons[0].enable()}},_onValidate:function(){var b=this.findByType(&quot;form&quot;)[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var a=this.action==&quot;modify&quot;?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b.getFieldValues(),success:function(c){this.store.reload();this.close()},failure:alertFailure})},_onTest:function(){var b=this.findByType(&quot;form&quot;)[0].getForm();var a=b.getFieldValues();var c=new sitools.admin.datasource.DataBaseTest({url:this.url+&quot;/test&quot;,data:a});c.show()}});Ext.reg(&quot;s-databaseprop&quot;,sitools.admin.datasource.DataBasePropPanel);Ext.namespace(&quot;sitools.admin.datasource&quot;);sitools.admin.datasource.DataBaseTest=Ext.extend(Ext.Window,{width:400,height:210,modal:true,closable:false,layout:&quot;fit&quot;,buttonAlign:&quot;center&quot;,initComponent:function(){this.title=i18n.get(&quot;label.databaseInfo&quot;);this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbDBTest&quot;,iconCls:&quot;x-status-valid&quot;});this.items=[{xtype:&quot;panel&quot;,baseCls:&quot;x-plain&quot;,layout:&quot;fit&quot;,items:[{xtype:&quot;textarea&quot;,id:&quot;DBText&quot;}]}];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:function(){this.close()}}];sitools.admin.datasource.DataBaseTest.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasource.DataBaseTest.superclass.onRender.apply(this,arguments);Ext.getCmp(&quot;sbDBTest&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:this.data,success:function(b){var c=Ext.decode(b.responseText);var a=c.success?i18n.get(&quot;msg.success&quot;):i18n.get(&quot;msg.failure&quot;);var d=c.logs?c.logs.join(&quot;\n&quot;):c.message;Ext.getCmp(&quot;sbDBTest&quot;).setStatus({text:a,iconCls:c.success?&quot;x-status-valid&quot;:&quot;x-status-error&quot;});Ext.getCmp(&quot;DBText&quot;).setValue(d)},failure:function(a){var c=i18n.get(&quot;warning.serverError&quot;);try{c=Ext.decode(a.responseText).logs.join(&quot;\n&quot;)}catch(b){}Ext.getCmp(&quot;sbDBTest&quot;).setStatus({text:a.statusText,iconCls:&quot;x-status-error&quot;});Ext.getCmp(&quot;DBText&quot;).setValue(c)}})}});Ext.namespace(&quot;sitools.component.forms.componentsAdminDef&quot;);sitools.component.forms.componentsAdminDef.DatasetContext=function(){this.context=&quot;dataset&quot;;this.buildComboParam1=function(a){a.storeColumn=new Ext.data.JsonStore({root:&quot;ColumnModel&quot;,idProperty:&quot;header&quot;,remoteSort:false,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;dataIndex&quot;,type:&quot;string&quot;},{name:&quot;schema&quot;,type:&quot;string&quot;},{name:&quot;tableAlias&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;header&quot;,type:&quot;string&quot;},{name:&quot;toolTip&quot;,type:&quot;string&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;sortable&quot;,type:&quot;boolean&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;filter&quot;,type:&quot;boolean&quot;},{name:&quot;columnOrder&quot;,type:&quot;int&quot;},{name:&quot;columnType&quot;,type:&quot;string&quot;},{name:&quot;notion&quot;,type:&quot;string&quot;,mapping:&quot;notion.name&quot;},{name:&quot;notionUrl&quot;,type:&quot;string&quot;,mapping:&quot;notion.url&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unitName&quot;,type:&quot;string&quot;}]});Ext.each(a.datasetColumnModel,function(b){if(b.specificColumnType!=&quot;VIRTUAL&quot;){a.storeColumn.add(new Ext.data.Record(b))}},this);return new Ext.form.ComboBox({fieldLabel:i18n.get(&quot;label.column&quot;)+&quot;1&quot;,triggerAction:&quot;all&quot;,name:&quot;PARAM1&quot;,specificType:&quot;mapParam&quot;,columnIndex:1,lazyRender:true,mode:&quot;local&quot;,store:a.storeColumn,valueField:&quot;columnAlias&quot;,displayField:&quot;header&quot;,anchor:&quot;100%&quot;,allowBlank:false})};this.buildCombosConeSearch=function(b){var c=[&quot;X/RA&quot;,&quot;Y/DEC&quot;,&quot;Z/ID&quot;];for(var a=1;a&lt;=3;a++){b[&quot;mapParam&quot;+a]=new Ext.form.ComboBox({fieldLabel:c[a-1],triggerAction:&quot;all&quot;,name:&quot;PARAM&quot;+a,specificType:&quot;mapParam&quot;,columnIndex:a,lazyRender:true,mode:&quot;local&quot;,store:b.storeColumn,valueField:&quot;columnAlias&quot;,displayField:&quot;header&quot;,anchor:&quot;100%&quot;,allowBlank:false});if(b.action==&quot;modify&quot;){Ext.apply(b[&quot;mapParam&quot;+a],{value:b.selectedRecord.data.code[a-1]})}b.insert(a,b[&quot;mapParam&quot;+a])}};this.onChangeColumn=function(){var c=this.storeColumn;var a=this.mapParam1.getValue();if(Ext.isEmpty(a)){this.dimension.setValue(null);this.dimension.setDisabled(true);return}var b=c.getAt(c.find(&quot;columnAlias&quot;,a));if(Ext.isEmpty(b)){this.dimension.setValue(null);this.dimension.setDisabled(true);return}this.columnDimensionId=b.get(&quot;dimensionId&quot;);if(!Ext.isEmpty(this.columnDimensionId)){this.dimension.setValue(this.columnDimensionId);this.dimension.setDisabled(false)}else{this.dimension.setValue(null);this.dimension.setDisabled(true)}this.columnUnit=b.get(&quot;unit&quot;)};this.activeDimension=function(){var c=this.storeColumn;var a=this.mapParam1.getValue();if(!Ext.isEmpty(a)){var b=c.getAt(c.find(&quot;columnAlias&quot;,a));if(!Ext.isEmpty(b)){this.columnDimensionId=b.get(&quot;dimensionId&quot;);if(!Ext.isEmpty(this.columnDimensionId)){this.dimension.setDisabled(false)}}}};this.buildUnit=function(){return}};Ext.namespace(&quot;sitools.component.forms.componentsAdminDef&quot;);sitools.component.forms.componentsAdminDef.ProjectContext=function(){this.context=&quot;project&quot;;this.buildComboParam1=function(a){return new Ext.form.ComboBox({fieldLabel:i18n.get(&quot;label.concept&quot;),triggerAction:&quot;all&quot;,name:&quot;PARAM1&quot;,specificType:&quot;mapParam&quot;,columnIndex:1,lazyRender:false,mode:&quot;local&quot;,store:a.storeConcepts,valueField:&quot;name&quot;,displayField:&quot;name&quot;,anchor:&quot;100%&quot;,allowBlank:false})};this.buildCombosConeSearch=function(b){var c=[&quot;X/RA&quot;,&quot;Y/DEC&quot;,&quot;Z/ID&quot;];for(var a=1;a&lt;=3;a++){b[&quot;mapParam&quot;+a]=new Ext.form.ComboBox({fieldLabel:c[a-1],triggerAction:&quot;all&quot;,name:&quot;PARAM&quot;+a,specificType:&quot;mapParam&quot;,columnIndex:a,lazyRender:true,mode:&quot;local&quot;,store:b.storeConcepts,valueField:&quot;name&quot;,displayField:&quot;name&quot;,anchor:&quot;100%&quot;,allowBlank:false});if(b.action==&quot;modify&quot;){Ext.apply(b[&quot;mapParam&quot;+a],{value:b.selectedRecord.data.code[a-1]})}b.insert(a,b[&quot;mapParam&quot;+a])}};this.onChangeColumn=function(){return};this.activeDimension=function(){this.dimension.setDisabled(false);this.dimension.on(&quot;select&quot;,this.context.onChangeDimension,this)};this.onChangeDimension=function(){this.storeUnits.proxy.setUrl(loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension/&quot;+this.dimension.getValue());this.storeUnits.load()};this.buildUnit=function(){var a=new Ext.data.HttpProxy({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension/&quot;+this.dimensionId,restful:true});this.storeUnits=new Ext.data.JsonStore({root:&quot;dimension.sitoolsUnits&quot;,fields:[{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;unitName&quot;,type:&quot;string&quot;}],proxy:a,autoLoad:this.action==&quot;modify&quot;&amp;&amp;(!Ext.isEmpty(this.dimensionId)),listeners:{scope:this,load:this.context._onUnitLoad}});this.unitCombo=new Ext.form.ComboBox({fieldLabel:i18n.get(&quot;label.unit&quot;),store:this.storeUnits,displayField:&quot;label&quot;,mode:&quot;local&quot;,forceSelection:false,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectUnits&quot;),selectOnFocus:true,valueField:&quot;unitName&quot;,name:&quot;unit&quot;,anchor:&quot;100%&quot;});this.add(this.unitCombo);this.doLayout()};this._onUnitLoad=function(){if(this.dimensionId==this.dimension.getValue()){var a=Ext.isEmpty(this.selectedRecord)?null:this.selectedRecord.data.unit;this.unitCombo.setValue(a?a.unitName:null)}else{this.unitCombo.setValue(null)}}};Ext.namespace(&quot;sitools.component.forms.componentsAdminDef&quot;);sitools.component.forms.componentsAdminDef.ComponentFactory=function(a){if(a==&quot;dataset&quot;){return new sitools.component.forms.componentsAdminDef.DatasetContext()}if(a==&quot;project&quot;){return new sitools.component.forms.componentsAdminDef.ProjectContext()}};Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.FormGridComponents=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){var c=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;code&quot;,type:&quot;string&quot;},{name:&quot;values&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;height&quot;,type:&quot;int&quot;},{name:&quot;xpos&quot;,type:&quot;int&quot;},{name:&quot;ypos&quot;,type:&quot;int&quot;},{name:&quot;css&quot;,type:&quot;string&quot;},{name:&quot;jsAdminObject&quot;,type:&quot;string&quot;},{name:&quot;jsUserObject&quot;,type:&quot;string&quot;},{name:&quot;defaultValues&quot;},{name:&quot;valueSelection&quot;,type:&quot;string&quot;},{name:&quot;autoComplete&quot;,type:&quot;boolean&quot;},{name:&quot;parentParam&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;},{name:&quot;extraParams&quot;}],autoLoad:false});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.label&quot;),dataIndex:&quot;label&quot;},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;}],defaults:{sortable:true,width:100}});var d={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete}]};Ext.apply(this,{title:i18n.get(&quot;title.gridComponents&quot;),id:&quot;gridFormComponents&quot;,height:430,store:c,cm:a,sm:b,tbar:d,viewConfig:{forceFit:true},listeners:{scope:this,rowDblClick:this.onModify,dictionaryChanged:function(e){this.dictionaryId=e},collectionChanged:function(e){this.collectionId=e}}});sitools.admin.forms.FormGridComponents.superclass.initComponent.call(this)},onCreate:function(){var a=new sitools.admin.forms.componentsListPanel({datasetColumnModel:this.datasetColumnModel,gridFormComponents:this,action:&quot;create&quot;,context:this.context,storeConcepts:this.storeConcepts});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.forms.componentPropPanel({datasetColumnModel:this.datasetColumnModel,gridFormComponents:this,action:&quot;modify&quot;,urlFormulaire:this.urlFormulaire,context:this.context,storeConcepts:this.storeConcepts});a.show()},onDelete:function(){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var b=false,a=[];this.getStore().each(function(d){if(c.data.id==d.data.parentParam){b=true;a.push(d.data.label)}});if(a.length&gt;0){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.atLeastOneChildren&quot;)+a.join(&quot;, &quot;));return}this.getStore().remove(c)}});Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.ComponentsDisplayPanel=Ext.extend(Ext.Panel,{initComponent:function(){Ext.apply(this,{id:&quot;absoluteLayout&quot;,layout:&quot;absolute&quot;,title:i18n.get(&quot;label.disposition&quot;),autoScroll:true,height:this.formSize.height,width:this.formSize.width,tbar:new Ext.Toolbar({items:[{scope:this,text:i18n.get(&quot;label.changeFormSize&quot;),handler:this._sizeUp}]}),listeners:{scope:this,activate:this._activeDisposition,afterRender:function(){var a=new Ext.dd.DDTarget(&quot;ddTargetId&quot;,&quot;group&quot;)}}});sitools.admin.forms.ComponentsDisplayPanel.superclass.initComponent.call(this)},_sizeUp:function(){var a=new sitools.admin.forms.absoluteLayoutProp({absoluteLayout:this,tabPanel:this.ownerCt.ownerCt.ownerCt,win:this.ownerCt.ownerCt.ownerCt.ownerCt,formSize:this.formSize});a.show()},_activeDisposition:function(){this.body.addClass(Ext.getCmp(&quot;formMainFormId&quot;).find(&quot;name&quot;,&quot;css&quot;)[0].getValue());this.setSize(this.formSize);var c=0;var a=25;var b=&quot;&quot;;this.removeAll(true);this.formComponentsStore.each(function(e){c=Ext.isEmpty(e.data.ypos)?c+50:e.data.ypos;a=Ext.isEmpty(e.data.xpos)?a:e.data.xpos;var f=[sitools.common.forms.formParameterToComponent(e.data,null,null,this.datasetColumnModel,this.context).component];f[0].setDisabled(true);var d=new Ext.Container({width:parseInt(e.data.width,10),height:parseInt(e.data.height,10),bodyCssClass:&quot;noborder&quot;,cls:e.data.css,x:a,y:c,id:e.data.id,componentData:e.data,labelWidth:100,items:f,displayPanel:this,record:e,onEdit:function(){var k=this.record;if(!k){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var g=new sitools.admin.forms.componentPropPanel({datasetColumnModel:this.displayPanel.datasetColumnModel,action:&quot;modify&quot;,urlFormulaire:this.displayPanel.urlFormulaire,context:this.displayPanel.context,storeConcepts:this.displayPanel.storeConcepts,record:this.record,formComponentsStore:this.displayPanel.formComponentsStore,absoluteLayout:this.displayPanel});g.show()},onDelete:function(){var l=this.record;if(!l){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var k=false,g=[];this.displayPanel.formComponentsStore.each(function(m){if(l.data.id==m.data.parentParam){k=true;g.push(m.data.label)}});if(g.length&gt;0){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.atLeastOneChildren&quot;)+g.join(&quot;, &quot;));return}this.displayPanel.formComponentsStore.remove(l);this.displayPanel.fireEvent(&quot;activate&quot;)}});this.add(d)},this);this.doLayout();Ext.each(this.items.items,function(d){var e=new Ext.Resizable(d.getId(),{handles:&quot;s e&quot;,minWidth:150,maxWidth:1000,constrainTo:this.body,resizeChild:true,listeners:{scope:this,resize:function(l,m,g,p){var k=this.formComponentsStore;var q=k.getAt(k.find(&quot;id&quot;,d.getId()));var n=this.getEl().getAnchorXY();q.set(&quot;width&quot;,m);q.set(&quot;height&quot;,g);d.items.items[0].setSize(m-d.getEl().getPadding(&quot;l&quot;)-d.getEl().getPadding(&quot;r&quot;),g);if(q.data.type==&quot;LISTBOX&quot;||q.data.type==&quot;LISTBOXMULTIPLE&quot;){var f=d.findByType(&quot;multiselect&quot;)[0];f.view.container.setHeight(g-d.getEl().getPadding(&quot;b&quot;)-d.getEl().getPadding(&quot;t&quot;)-40)}}}})},this);Ext.each(this.items.items,function(e){e.getEl().on(&quot;contextmenu&quot;,this.onContextMenu,e);var d=new Ext.dd.DDProxy(e.getEl().dom.id,&quot;group&quot;,{isTarget:false});Ext.apply(d,{win:this,startDrag:function(g,l){var f=Ext.get(this.getDragEl());var k=Ext.get(this.getEl());f.applyStyles({border:&quot;&quot;,&quot;z-index&quot;:this.win.ownerCt.ownerCt.lastZIndex+1});f.update(k.dom.innerHTML);f.addClass(k.dom.className);this.constrainTo(this.win.body)},afterDrag:function(){var g=Ext.get(this.getDragEl());var k=Ext.get(this.getEl());var f=g.getX();var p=g.getY();var l=this.win.formComponentsStore;var n=l.getAt(l.find(&quot;id&quot;,k.id));var m=Ext.get(this.win.body).getAnchorXY();n.set(&quot;xpos&quot;,f-m[0]);n.set(&quot;ypos&quot;,p-m[1])}})},this)},onContextMenu:function(c,d,b){c.stopEvent();var a=new Ext.menu.Menu({items:[{text:i18n.get(&quot;label.edit&quot;),scope:this,handler:this.onEdit},{text:i18n.get(&quot;label.delete&quot;),scope:this,handler:this.onDelete}]});var e=c.getXY();a.showAt(e)}});Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.formsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FORMS,pageSize:10,urlFormulaires:&quot;/tmp&quot;,initComponent:function(){this.baseUrlFormulaires=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.urlDatasets=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.httpProxyForms=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:this.httpProxyForms,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;columnModel&quot;],url:this.urlDatasets,root:&quot;data&quot;,autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectDatasets&quot;),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.datasetColumnModel=d.data.columnModel;this.httpProxyForms.setUrl(this.baseUrlFormulaires+&quot;/&quot;+d.data.id+&quot;/forms&quot;,true);this.loadFormulaires(d.data.id)}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:400,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.forms.formsCrudPanel.superclass.initComponent.call(this)},loadFormulaires:function(a){this.urlFormulaires=this.baseUrlFormulaires+&quot;/&quot;+a+&quot;/forms&quot;;this.httpProxyForms.setUrl(this.urlFormulaires,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=new sitools.admin.forms.formPropPanel({urlFormulaire:this.urlFormulaires,action:&quot;create&quot;,store:this.getStore(),datasetColumnModel:this.datasetColumnModel});a.show(ID.BOX.FORMS)},onModify:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.forms.formPropPanel({urlFormulaire:this.baseUrlFormulaires+&quot;/&quot;+this.datasetId+&quot;/forms/&quot;+b.data.id,action:&quot;modify&quot;,store:this.getStore(),datasetColumnModel:this.datasetColumnModel});a.show(ID.BOX.FORMS.COMPONENTLIST)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;formsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.baseUrlFormulaires+&quot;/&quot;+this.datasetId+&quot;/forms/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-forms&quot;,sitools.admin.forms.formsCrudPanel);Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.componentPropPanel=Ext.extend(Ext.Window,{modal:true,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;label.componentProperties&quot;);var specificComponentString,config={},JsObj;if(this.action==&quot;modify&quot;){var rec=this.record;if(!rec){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}JsObj=eval(rec.data.jsAdminObject);config={datasetColumnModel:this.datasetColumnModel,winPropComponent:this,action:this.action,selectedRecord:rec,jsUserObject:rec.data.jsUserObject,ctype:rec.data.type,componentDefaultHeight:rec.data.height,componentDefaultWidth:rec.data.width,dimensionId:rec.data.dimensionId,unit:rec.data.unit,extraParams:rec.data.extraParams,context:this.context,storeConcepts:this.storeConcepts,formComponentsStore:this.formComponentsStore}}else{JsObj=eval(this.jsAdminObject);config={datasetColumnModel:this.datasetColumnModel,winPropComponent:this,action:this.action,ctype:this.ctype,jsAdminObject:this.jsAdminObject,jsUserObject:this.jsUserObject,componentDefaultHeight:this.componentDefaultHeight,componentDefaultWidth:this.componentDefaultWidth,extraParams:this.extraParams,context:this.context,storeConcepts:this.storeConcepts,formComponentsStore:this.formComponentsStore,xyOnCreate:this.xyOnCreate}}var specificComponent=new JsObj(config);this.componentPropPanel=new Ext.Panel({layout:&quot;fit&quot;,padding:10,autoScroll:true,items:[specificComponent],buttons:[{text:i18n.get(&quot;label.addColumn&quot;),hidden:!Ext.isFunction(specificComponent.addColumn),handler:function(){specificComponent.addColumn()}},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:this._close}]});this.items=[this.componentPropPanel];sitools.admin.forms.componentPropPanel.superclass.initComponent.call(this)},afterRender:function(){this.height=this.specificHeight;this.width=this.specificWidth;sitools.admin.forms.componentPropPanel.superclass.afterRender.call(this)},onValidate:function(){var a=this.findById(&quot;sitools.component.forms.definitionId&quot;);if(a._onValidate(this.action,this.formComponentsStore)){this.close()}this.absoluteLayout.fireEvent(&quot;activate&quot;)},_close:function(){this.close()}});Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.absoluteLayoutProp=Ext.extend(Ext.Window,{modal:true,initComponent:function(){var b=this.formSize.width;var a=this.formSize.height;var c=new Ext.form.FormPanel({labelWidth:75,padding:5,items:[{xtype:&quot;textfield&quot;,id:&quot;absolutePanelWidth&quot;,value:b,fieldLabel:i18n.get(&quot;label.width&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,id:&quot;absolutePanelHeight&quot;,value:a,fieldLabel:i18n.get(&quot;label.height&quot;),anchor:&quot;100%&quot;}],buttons:[{scope:this,text:i18n.get(&quot;label.ok&quot;),handler:this._onValidate},{scope:this,text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]});this.height=130;this.width=260;this.title=i18n.get(&quot;label.setSize&quot;);this.items=[c];sitools.admin.forms.absoluteLayoutProp.superclass.initComponent.call(this)},_onValidate:function(){var d=this.findByType(&quot;form&quot;)[0].getForm();var c=parseInt(d.findField(&quot;absolutePanelWidth&quot;).getValue(),10);var a=parseInt(d.findField(&quot;absolutePanelHeight&quot;).getValue(),10);var b={width:c,height:a};this.absoluteLayout.setSize(b);this.absoluteLayout.doLayout();this.absoluteLayout.formSize=b;this.win.formSize=b;this.win.doLayout();this.destroy()},_onCancel:function(){this.destroy()}});Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.componentsListPanel=Ext.extend(Ext.grid.GridPanel,{width:220,initComponent:function(){this.title=i18n.get(&quot;label.chooseComponent&quot;);var c=new Ext.data.JsonStore({root:&quot;data&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_FORMCOMPONENTS_URL&quot;),fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;componentDefaultHeight&quot;,type:&quot;string&quot;},{name:&quot;componentDefaultWidth&quot;,type:&quot;string&quot;},{name:&quot;jsAdminObject&quot;,type:&quot;string&quot;},{name:&quot;jsUserObject&quot;,type:&quot;string&quot;},{name:&quot;imageUrl&quot;,type:&quot;string&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;,type:&quot;string&quot;},{name:&quot;extraParams&quot;}],autoLoad:true,sortInfo:{field:&quot;type&quot;,direction:&quot;ASC&quot;}});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;,width:150},{header:i18n.get(&quot;headers.image&quot;),dataIndex:&quot;imageUrl&quot;,renderer:function(d){return&quot;&lt;a href='#' onClick='sitools.admin.forms.componentsListPanel.showPreview(\&quot;&quot;+d+&quot;\&quot;); return false;'&gt;&quot;+i18n.get(&quot;label.preview&quot;)+&quot;&lt;/a&gt;&quot;},width:70}],defaults:{sortable:true,width:100}});Ext.apply(this,{layout:&quot;fit&quot;,title:i18n.get(&quot;title.componentList&quot;),autoScroll:true,store:c,cm:a,sm:b,ddGroup:&quot;gridComponentsList&quot;,enableDragDrop:true,viewConfig:{forceFit:true}});sitools.admin.forms.componentsListPanel.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.componentsListPanel.superclass.afterRender.apply(this,arguments)},onClose:function(){this.close()}});sitools.admin.forms.componentsListPanel.showPreview=function(b){var a=new Ext.Window({title:i18n.get(&quot;label.showPreview&quot;),modal:true,html:&quot;&lt;img src ='&quot;+b+&quot;'&gt;&quot;,layout:&quot;fit&quot;,height:&quot;auto&quot;,width:&quot;auto&quot;,buttons:[{text:i18n.get(&quot;label.close&quot;),handler:function(){this.ownerCt.ownerCt.destroy()}}]});a.show()};Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.formPropPanel=Ext.extend(Ext.Window,{width:700,height:580,modal:true,pageSize:10,autoScroll:true,formSize:{width:500,height:500},initComponent:function(){if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyForm&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createForm&quot;)}this.formComponentsStore=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;code&quot;,type:&quot;string&quot;},{name:&quot;values&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;height&quot;,type:&quot;int&quot;},{name:&quot;xpos&quot;,type:&quot;int&quot;},{name:&quot;ypos&quot;,type:&quot;int&quot;},{name:&quot;css&quot;,type:&quot;string&quot;},{name:&quot;jsAdminObject&quot;,type:&quot;string&quot;},{name:&quot;jsUserObject&quot;,type:&quot;string&quot;},{name:&quot;defaultValues&quot;},{name:&quot;valueSelection&quot;,type:&quot;string&quot;},{name:&quot;autoComplete&quot;,type:&quot;boolean&quot;},{name:&quot;parentParam&quot;},{name:&quot;dimensionId&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;},{name:&quot;extraParams&quot;}],autoLoad:false});this.formulairePrincipal=new Ext.FormPanel({title:i18n.get(&quot;label.formInfo&quot;),id:&quot;formMainFormId&quot;,border:false,padding:10,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:50,vtype:&quot;name&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,maxLength:50},{xtype:&quot;textfield&quot;,name:&quot;css&quot;,fieldLabel:i18n.get(&quot;label.css&quot;),anchor:&quot;100%&quot;,maxLength:50}]});var e=new Ext.data.JsonStore({remoteSort:false,fields:[{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;filtrable&quot;}],autoLoad:false});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;label.tableName&quot;),dataIndex:&quot;tableName&quot;,type:&quot;string&quot;},{header:i18n.get(&quot;label.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;,type:&quot;string&quot;}]});this.gridColumns=new Ext.grid.GridPanel({store:e,cm:a,title:i18n.get(&quot;label.datasetColumns&quot;),flex:1,viewConfig:{forceFit:true}});Ext.each(this.datasetColumnModel,function(f){if(f.specificColumnType!=&quot;VIRTUAL&quot;){this.gridColumns.getStore().add(new Ext.data.Record(f))}},this);var d=new Ext.Panel({title:i18n.get(&quot;label.FormInfo&quot;),layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;},items:[this.formulairePrincipal,this.gridColumns],listeners:{collectionChanged:function(k,g,f){this.getBubbleTarget().fireEvent(&quot;collectionChanged&quot;,k,g,f)},dictionaryChanged:function(k,g,f){this.getBubbleTarget().fireEvent(&quot;dictionaryChanged&quot;,k,g,f)}}});this.absoluteLayout=new sitools.admin.forms.ComponentsDisplayPanel({formComponentsStore:this.formComponentsStore,datasetColumnModel:this.datasetColumnModel,context:&quot;dataset&quot;,formSize:this.formSize});var c=new Ext.Panel({flex:1,autoScroll:true,items:[this.absoluteLayout]});this.componentListPanel=new sitools.admin.forms.componentsListPanel({datasetColumnModel:this.datasetColumnModel,formComponentsStore:this.formComponentsStore,action:&quot;create&quot;,context:&quot;dataset&quot;,storeConcepts:this.storeConcepts});var b=new Ext.Panel({layout:&quot;hbox&quot;,title:i18n.get(&quot;label.disposition&quot;),layoutConfig:{align:&quot;stretch&quot;},items:[this.componentListPanel,c],listeners:{scope:this,activate:function(){this.absoluteLayout.fireEvent(&quot;activate&quot;);var m=this.absoluteLayout;var n=m.body.dom;var f=this.formComponentsStore;var k=this.datasetColumnModel;var g=this.storeConcepts;var l=new Ext.dd.DropTarget(n,{ddGroup:&quot;gridComponentsList&quot;,notifyDrop:function(v,u,t){var q=u.xy;var s=Ext.get(m.body).getXY();var p={x:q[0]-s[0],y:q[1]-s[1]};var z=v.dragData.selections[0];var A=new sitools.admin.forms.componentPropPanel({urlAdmin:z.data.jsonDefinitionAdmin,datasetColumnModel:k,ctype:z.data.type,action:&quot;create&quot;,componentDefaultHeight:z.data.componentDefaultHeight,componentDefaultWidth:z.data.componentDefaultWidth,dimensionId:z.data.dimensionId,unit:z.data.unit,extraParams:z.data.extraParams,jsAdminObject:z.data.jsAdminObject,jsUserObject:z.data.jsUserObject,context:&quot;dataset&quot;,xyOnCreate:p,storeConcepts:this.storeConcepts,absoluteLayout:m,record:z,formComponentsStore:f});A.show()}})}}});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:[d,b],listeners:{scope:this,afterrender:function(f){f.setSize(this.body.getSize())}}});this.items=[this.tabPanel];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];this.listeners={scope:this,resize:function(l,k,f){var g=l.body.getSize();this.tabPanel.setSize(g)}};sitools.admin.forms.formPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.forms.formPropPanel.superclass.onRender.apply(this,arguments);if(this.urlFormulaire){if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.urlFormulaire,method:&quot;GET&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(!b.success){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}var k=this.findByType(&quot;form&quot;)[0].getForm();var g=b.form;if(!Ext.isEmpty(g.width)){this.formSize.width=g.width}if(!Ext.isEmpty(g.height)){this.formSize.height=g.height}var l={};l.id=g.id;l.name=g.name;l.description=g.description;l.css=g.css;var a=new Ext.data.Record(l);k.loadRecord(a);if(g.parameters){var e=g.parameters;var d;for(d=0;d&lt;e.length;d++){this.formComponentsStore.add(new Ext.data.Record({type:e[d].type,code:e[d].code,label:e[d].label,values:e[d].values,width:e[d].width,height:e[d].height,xpos:e[d].xpos,ypos:e[d].ypos,id:e[d].id,css:e[d].css,jsAdminObject:e[d].jsAdminObject,jsUserObject:e[d].jsUserObject,defaultValues:e[d].defaultValues,valueSelection:e[d].valueSelection,autoComplete:e[d].autoComplete,parentParam:e[d].parentParam,dimensionId:e[d].dimensionId,unit:e[d].unit,extraParams:e[d].extraParams}))}}this.doLayout()},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}}},onValidate:function(){var d=this.findByType(&quot;form&quot;)[0].getForm();if(!d.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}var e={};Ext.iterate(d.getValues(),function(f,g){e[f]=g},this);var c=this.formSize.width;var a=this.formSize.height;e.width=c;e.height=a;var b=this.formComponentsStore;if(b.getCount()&gt;0){e.parameters=[]}b.each(function(f){e.parameters.push({type:f.data.type,code:f.data.code,label:f.data.label,values:f.data.values,width:f.data.width,height:f.data.height,xpos:f.data.xpos,ypos:f.data.ypos,id:f.data.id,css:f.data.css,jsAdminObject:f.data.jsAdminObject,jsUserObject:f.data.jsUserObject,defaultValues:f.data.defaultValues,valueSelection:f.data.valueSelection,autoComplete:f.data.autoComplete,parentParam:f.data.parentParam,dimensionId:f.data.dimensionId,unit:f.data.unit,extraParams:f.data.extraParams})});if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.urlFormulaire,method:&quot;PUT&quot;,scope:this,jsonData:e,success:function(g){var f=Ext.decode(g.responseText);if(!f.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),f.message);return}this.close();this.store.reload()},failure:alertFailure})}else{Ext.Ajax.request({url:this.urlFormulaire,method:&quot;POST&quot;,scope:this,jsonData:e,success:function(g){var f=Ext.decode(g.responseText);if(!f.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),f.message);return}this.close();this.store.reload()},failure:alertFailure})}}});Ext.namespace(&quot;sitools.admin.forms&quot;);sitools.admin.forms.parentParamWin=Ext.extend(Ext.Window,{modal:true,title:i18n.get(&quot;label.chooseParent&quot;),width:500,initComponent:function(){var c=this.store;var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.label&quot;),dataIndex:&quot;label&quot;},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;type&quot;}],defaults:{sortable:true,width:100}});this.gridFormComponents=new Ext.grid.GridPanel({title:i18n.get(&quot;title.gridComponents&quot;),layout:&quot;fit&quot;,id:&quot;gridFormParentComponents&quot;,height:430,store:c,cm:a,sm:b,viewConfig:{forceFit:true}});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[this.gridFormComponents],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.none&quot;),scope:this,handler:this._none},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:this._close}]}];sitools.admin.forms.parentParamWin.superclass.initComponent.call(this)},onRender:function(){sitools.admin.forms.parentParamWin.superclass.onRender.apply(this,arguments)},onValidate:function(){this.parentParamField.setValue(this.gridFormComponents.getSelectionModel().getSelected().data);this.parentParamFieldDisplay.setValue(this.gridFormComponents.getSelectionModel().getSelected().data.label);this.close()},_close:function(){this.close()},_none:function(){this.parentParamField.setValue(null);this.parentParamFieldDisplay.setValue(null);this.close()}});Ext.namespace(&quot;sitools.admin.forms.oneParam&quot;);sitools.admin.forms.oneParam.abstractForm=Ext.extend(Ext.form.FormPanel,{autoScroll:true,context:null,initComponent:function(){this.context=new sitools.component.forms.componentsAdminDef.ComponentFactory(this.context);this.buttonAdd=new Ext.Button({text:i18n.get(&quot;label.addColumn&quot;),scope:this,handler:function(a){this.addColumn(a)}});this.buttonDel=new Ext.Button({text:i18n.get(&quot;label.deleteColumn&quot;),scope:this,handler:function(a){this.deleteColumn(a)}});this.labelParam1=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.label&quot;),name:&quot;LABEL_PARAM1&quot;,anchor:&quot;100%&quot;,tooltip:i18n.get(&quot;label.formLabel&quot;)});this.mapParam1=this.context.buildComboParam1(this);this.css=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.css&quot;),name:&quot;CSS&quot;,anchor:&quot;100%&quot;});this.componentDefaultHeight=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.height&quot;),name:&quot;componentDefaultHeight&quot;,anchor:&quot;100%&quot;,value:this.componentDefaultHeight,allowBlank:false});this.componentDefaultWidth=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.width&quot;),name:&quot;componentDefaultWidth&quot;,anchor:&quot;100%&quot;,value:this.componentDefaultWidth,allowBlank:false});this.items=[this.labelParam1,this.mapParam1,this.css];if(this.action==&quot;create&quot;){this.items.push(this.componentDefaultHeight,this.componentDefaultWidth)}this.padding=10;sitools.admin.forms.oneParam.abstractForm.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.oneParam.abstractForm.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.labelParam1.setValue(this.selectedRecord.data.label);this.css.setValue(this.selectedRecord.data.css);var a=this.selectedRecord.data.code;this.mapParam1.setValue(this.selectedRecord.data.code[0])}},_onValidate:function(b,a){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;msg.OnvalidateNotDefined&quot;))}});Ext.namespace(&quot;sitools.admin.forms.oneParam&quot;);sitools.admin.forms.oneParam.abstractWithUnit=Ext.extend(sitools.admin.forms.oneParam.abstractForm,{initComponent:function(){sitools.admin.forms.oneParam.abstractWithUnit.superclass.initComponent.call(this);this.storeDimension=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;dimensionHelperName&quot;,type:&quot;string&quot;}],url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension&quot;,restful:true,autoLoad:false,listeners:{scope:this,load:this._onDimensionLoad}});this.on(&quot;beforerender&quot;,this.onBeforeRender,this);this.mapParam1.on(&quot;select&quot;,this.onChangeColumn,this)},onBeforeRender:function(){if(!this.loaded){this.storeDimension.load()}},_onDimensionLoad:function(){this.dimension=new Ext.form.ComboBox({fieldLabel:i18n.get(&quot;label.dimension&quot;),store:this.storeDimension,displayField:&quot;name&quot;,mode:&quot;local&quot;,forceSelection:false,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectDimension&quot;),selectOnFocus:true,valueField:&quot;id&quot;,name:&quot;dimensionId&quot;,anchor:&quot;100%&quot;,disabled:true,value:Ext.isEmpty(this.selectedRecord)?null:this.selectedRecord.data.dimensionId});this.context.activeDimension.call(this);this.add(this.dimension);this.doLayout();this.context.buildUnit.call(this)},onChangeColumn:function(){this.context.onChangeColumn.call(this)}});Ext.namespace(&quot;sitools.admin.forms.multiParam&quot;);sitools.admin.forms.multiParam.abstractForm=Ext.extend(Ext.form.FormPanel,{autoScroll:true,initComponent:function(){this.context=new sitools.component.forms.componentsAdminDef.ComponentFactory(this.context);this.storeColumn=new Ext.data.JsonStore({id:&quot;storeColumnSelect&quot;,root:&quot;ColumnModel&quot;,idProperty:&quot;header&quot;,remoteSort:false,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;dataIndex&quot;,type:&quot;string&quot;},{name:&quot;schema&quot;,type:&quot;string&quot;},{name:&quot;tableAlias&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;header&quot;,type:&quot;string&quot;},{name:&quot;toolTip&quot;,type:&quot;string&quot;},{name:&quot;width&quot;,type:&quot;int&quot;},{name:&quot;sortable&quot;,type:&quot;boolean&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;filter&quot;,type:&quot;boolean&quot;},{name:&quot;columnOrder&quot;,type:&quot;int&quot;},{name:&quot;columnType&quot;,type:&quot;string&quot;},{name:&quot;notion&quot;,type:&quot;string&quot;,mapping:&quot;notion.name&quot;},{name:&quot;notionUrl&quot;,type:&quot;string&quot;,mapping:&quot;notion.url&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;}]});Ext.each(this.datasetColumnModel,function(a){if(a.specificColumnType!=&quot;VIRTUAL&quot;){this.storeColumn.add(new Ext.data.Record(a))}},this);this.buttonAdd=new Ext.Button({text:i18n.get(&quot;label.addColumn&quot;),scope:this,handler:function(a){this.addColumn(a)}});this.buttonDel=new Ext.Button({text:i18n.get(&quot;label.deleteColumn&quot;),scope:this,handler:function(a){this.deleteColumn(a)}});this.labelParam1=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.label&quot;),name:&quot;LABEL_PARAM1&quot;,anchor:&quot;100%&quot;});this.css=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.css&quot;),name:&quot;CSS&quot;,anchor:&quot;100%&quot;});this.componentDefaultHeight=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.height&quot;),name:&quot;componentDefaultHeight&quot;,anchor:&quot;100%&quot;,value:this.componentDefaultHeight,allowBlank:false});this.componentDefaultWidth=new Ext.form.TextField({fieldLabel:i18n.get(&quot;label.width&quot;),name:&quot;componentDefaultWidth&quot;,anchor:&quot;100%&quot;,value:this.componentDefaultWidth,allowBlank:false});this.items=[this.labelParam1,this.css];if(this.action==&quot;create&quot;){this.items.push(this.componentDefaultHeight,this.componentDefaultWidth)}this.padding=10;sitools.admin.forms.multiParam.abstractForm.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.forms.multiParam.abstractForm.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.labelParam1.setValue(this.selectedRecord.data.label);this.css.setValue(this.selectedRecord.data.css)}},_onValidate:function(b,a){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;msg.OnvalidateNotDefined&quot;))}});Ext.namespace(&quot;sitools.admin.applications&quot;);sitools.admin.applications.applicationsRolePanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:&quot;&quot;,initComponent:function(){this.title=i18n.get(&quot;label.authorizations&quot;)+&quot; : &quot;+this.applicationRecord.data.name;var a=new Ext.data.JsonStore({id:&quot;storeAuthorizations&quot;,root:&quot;authorization.authorizations&quot;,url:this.urlAuthorizations,idProperty:&quot;role&quot;,fields:[{name:&quot;role&quot;,type:&quot;string&quot;},{name:&quot;allMethod&quot;,type:&quot;boolean&quot;},{name:&quot;postMethod&quot;,type:&quot;boolean&quot;},{name:&quot;getMethod&quot;,type:&quot;boolean&quot;},{name:&quot;putMethod&quot;,type:&quot;boolean&quot;},{name:&quot;deleteMethod&quot;,type:&quot;boolean&quot;},{name:&quot;headMethod&quot;,type:&quot;boolean&quot;},{name:&quot;optionsMethod&quot;,type:&quot;boolean&quot;}],autoLoad:true,listeners:{scope:this,update:function(e,d){var l=this.gridAuthorizations;var g=e.indexOf(d);var m=d.get(&quot;allMethod&quot;);for(var k=2;k&lt;8;k++){var f=l.getView().getCell(g,k).firstChild.firstChild.id;var n=Ext.getCmp(f);n.setEnabled(!m)}},load:function(e,d){var k=this.gridAuthorizations;var l,g,f,m;Ext.each(d,function(n){e.fireEvent(&quot;update&quot;,e,n)},this)}}});this.cbAll=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.all&quot;),dataIndex:&quot;allMethod&quot;,width:55});this.cbPost=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.post&quot;),dataIndex:&quot;postMethod&quot;,width:55});this.cbGet=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.get&quot;),dataIndex:&quot;getMethod&quot;,width:55});this.cbPut=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.put&quot;),dataIndex:&quot;putMethod&quot;,width:55});this.cbDelete=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.delete&quot;),dataIndex:&quot;deleteMethod&quot;,width:55});this.cbHead=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.head&quot;),dataIndex:&quot;headMethod&quot;,width:55});this.cbOptions=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.options&quot;),dataIndex:&quot;optionsMethod&quot;,width:55});var c=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.role&quot;),dataIndex:&quot;role&quot;,width:100},this.cbAll,this.cbGet,this.cbPost,this.cbPut,this.cbDelete,this.cbHead,this.cbOptions],defaults:{sortable:true,width:100}});var b=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridAuthorizations=new Ext.grid.EditorGridPanel({id:&quot;gridAuthorizations&quot;,height:450,store:a,tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreateRole},{text:i18n.get(&quot;label.remove&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDeleteRole}]},cm:c,sm:b,plugins:[this.cbAll,this.cbGet,this.cbPost,this.cbPut,this.cbDelete,this.cbHead,this.cbOptions],viewConfig:{forceFit:true}});this.items=[this.gridAuthorizations];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:function(){this._onValidate()}},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];sitools.admin.applications.applicationsRolePanel.superclass.initComponent.call(this)},_onCreateRole:function(){var a=new sitools.component.applications.rolesPanel({storeRolesApplication:this.gridAuthorizations.getStore()});a.show()},_onDeleteRole:function(){var a=this.gridAuthorizations.getSelectionModel().getSelections();if(a.length===0){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.gridAuthorizations.getStore().remove(a)},_onValidate:function(){var b={};b.id=this.applicationRecord.data.id;b.url=this.applicationRecord.data.url;b.name=this.applicationRecord.data.name;b.description=this.applicationRecord.data.description;var a=this.findById(&quot;gridAuthorizations&quot;).getStore();if(a.getCount()&gt;0){b.authorizations=[];a.each(function(c){var d={role:c.data.role,allMethod:c.data.allMethod,postMethod:c.data.postMethod,getMethod:c.data.getMethod,putMethod:c.data.putMethod,deleteMethod:c.data.deleteMethod,headMethod:c.data.headMethod,optionsMethod:c.data.optionsMethod};b.authorizations.push(d)})}Ext.Ajax.request({url:this.urlAuthorizations,method:&quot;PUT&quot;,scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.message);return}this.close()},failure:alertFailure})}});Ext.namespace(&quot;sitools.component.applications&quot;);sitools.component.applications.rolesPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;label.roleWin&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,idProperty:&quot;id&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ROLES_URL&quot;),fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;}]});this.items=[{xtype:&quot;panel&quot;,title:i18n.get(&quot;label.selectRoles&quot;),items:[this.grid],bbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]}}];sitools.component.applications.rolesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.applications.rolesPanel.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.loadError&quot;))}}})},_onOK:function(){Ext.each(this.grid.getSelectionModel().getSelections(),function(a){if(this.storeRolesApplication.find(&quot;role&quot;,a.data.name)==-1){this.storeRolesApplication.add(new Ext.data.Record({role:a.data.name}))}},this);this.close()},_onCancel:function(){this.destroy()}});Ext.namespace(&quot;sitools.admin.applications&quot;);sitools.admin.applications.applicationsPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:&quot;&quot;,initComponent:function(){this.title=i18n.get(&quot;label.details&quot;);this.items=[{xtype:&quot;panel&quot;,height:450,items:[{xtype:&quot;form&quot;,border:false,padding:10,defaults:{disabled:true},items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;,id:&quot;appFormIdId&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:30,id:&quot;appFormNameId&quot;},{xtype:&quot;textarea&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,id:&quot;appFormDescriptionId&quot;},{xtype:&quot;textfield&quot;,name:&quot;urn&quot;,fieldLabel:i18n.get(&quot;label.urn&quot;),anchor:&quot;100%&quot;,id:&quot;appFormUrnId&quot;},{xtype:&quot;textfield&quot;,name:&quot;type&quot;,fieldLabel:i18n.get(&quot;label.type&quot;),anchor:&quot;100%&quot;,id:&quot;appFormTypeId&quot;},{xtype:&quot;textfield&quot;,name:&quot;url&quot;,fieldLabel:i18n.get(&quot;label.url&quot;),anchor:&quot;100%&quot;,id:&quot;appFormUrlId&quot;},{xtype:&quot;textfield&quot;,name:&quot;author&quot;,fieldLabel:i18n.get(&quot;label.author&quot;),anchor:&quot;100%&quot;,id:&quot;appFormAuthotId&quot;},{xtype:&quot;textfield&quot;,name:&quot;owner&quot;,fieldLabel:i18n.get(&quot;label.owner&quot;),anchor:&quot;100%&quot;,id:&quot;appFormOwnerId&quot;},{xtype:&quot;textfield&quot;,name:&quot;lastUpdate&quot;,fieldLabel:i18n.get(&quot;label.lastUpdate&quot;),anchor:&quot;100%&quot;,id:&quot;appFormLastUpdateId&quot;},{xtype:&quot;textfield&quot;,name:&quot;status&quot;,fieldLabel:i18n.get(&quot;label.status&quot;),anchor:&quot;100%&quot;,id:&quot;appFormStatus&quot;}]}],buttons:[{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.applications.applicationsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.projects.ProjectsPropPanel.superclass.onRender.apply(this,arguments);if(this.applicationRecord){var a=this.findByType(&quot;form&quot;)[0].getForm();a.loadRecord(this.applicationRecord)}}});Ext.namespace(&quot;sitools.admin.applications&quot;);sitools.admin.applications.applicationsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_APPLICATIONS_URL&quot;);this.urlAuthorizations=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_AUTHORIZATIONS_URL&quot;);var a=new Ext.data.JsonReader({root:&quot;data&quot;,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;category&quot;,type:&quot;string&quot;},{name:&quot;urn&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;author&quot;,type:&quot;string&quot;},{name:&quot;owner&quot;,type:&quot;string&quot;},{name:&quot;lastUpdate&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;wadl&quot;,type:&quot;string&quot;,convert:function(d,c){}}]});this.store=new Ext.data.GroupingStore({reader:a,url:this.url,restful:true,remoteSort:false,sortInfo:{field:&quot;name&quot;,direction:&quot;ASC&quot;},groupField:&quot;category&quot;});var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get(&quot;label.category&quot;),dataIndex:&quot;category&quot;,width:150,hidden:true},{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:500},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:50,sortable:false},{header:&quot;&quot;,dataIndex:&quot;url&quot;,width:20,sortable:false,renderer:function(c){return String.format(&quot;&lt;a onClick='onClickOption(\&quot;{0}\&quot;); return false;' href=#&gt;{1}&lt;/a&gt;&quot;,c,String.format(&quot;&lt;img alt={0} src='&quot;+loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/wadl.gif'&gt;&quot;,i18n.get(&quot;label.wadl&quot;)))}}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.details&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_details.png&quot;,handler:this.onDetails,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.authorizations&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_autorizations.png&quot;,handler:this.onDefineRole,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store}]};this.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length &gt; 1 ? &quot;Items&quot; : &quot;Item&quot;]})'});this.plugins=b;sitools.admin.applications.applicationsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.applications.applicationsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load()},onDefineRole:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+&quot;/&quot;+b.data.id,applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}a.show(ID.BOX.APPLICATION)},onDetails:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsPropPanel({applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}a.show(ID.BOX.APPLICATION)},onDelete:function(){var b=this.getSelectionModel().getSelected(),a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;applicationsCrud.delete&quot;),scope:this,fn:function(c,d){if(c===&quot;yes&quot;){this.doDelete(b)}}});if(!b){return false}},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;?action=start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;?action=stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-applications&quot;,sitools.admin.applications.applicationsCrudPanel);Ext.namespace(&quot;sitools.admin.authorizations&quot;);sitools.admin.authorizations.authorizationsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_AUTHORIZATIONS_URL&quot;);this.urlAuthorizations=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_AUTHORIZATIONS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,baseParams:{type:&quot;class&quot;},fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;authorizations&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.id&quot;),dataIndex:&quot;id&quot;,width:100,hidden:true},{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:450,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.authorizations&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_autorizations.png&quot;,handler:this.onDefineRole,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.sm=new Ext.grid.RowSelectionModel();this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onDefineRole};sitools.admin.authorizations.authorizationsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.authorizations.authorizationsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onDefineRole:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+&quot;/&quot;+b.data.id,applicationRecord:b});a.show(ID.BOX.APPLICATION)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;applicationsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-authorizations&quot;,sitools.admin.authorizations.authorizationsCrudPanel);Ext.namespace(&quot;sitools.admin.userStorage&quot;);sitools.admin.userStorage.userStoragePropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:&quot;&quot;,initComponent:function(){if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyUserStorage&quot;)+&quot; : &quot;+this.userStorageRec.data.userId}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createUserStorage&quot;)}this.items=[{xtype:&quot;panel&quot;,height:450,items:[{xtype:&quot;panel&quot;,height:400,items:[{xtype:&quot;form&quot;,border:false,padding:10,defaults:[{readOnly:true}],items:[{xtype:&quot;hidden&quot;,name:&quot;userId&quot;,id:&quot;userValueFieldId&quot;},{xtype:&quot;textfield&quot;,name:&quot;displayUser&quot;,fieldLabel:i18n.get(&quot;label.user&quot;),anchor:&quot;100%&quot;,maxLength:100,allowBlank:false,blankText:&quot;The user field cannot be empty&quot;,listeners:{scope:this,focus:function(b){if(this.action==&quot;create&quot;){var a=new sitools.admin.usergroups.UsersPanel({mode:&quot;selectUnique&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/users&quot;,displayField:b,valueField:this.findByType(&quot;form&quot;)[0].getForm().findField(&quot;userValueFieldId&quot;)});a.show()}}}},{xtype:&quot;compositefield&quot;,fieldLabel:i18n.get(&quot;label.quota&quot;),anchor:&quot;100%&quot;,defaults:{flex:1},items:[{xtype:&quot;textfield&quot;,name:&quot;quota&quot;,fieldLabel:i18n.get(&quot;label.quota&quot;),anchor:&quot;75%&quot;},{xtype:&quot;label&quot;,text:i18n.get(&quot;label.quota.unit&quot;),width:50,flex:0}]},{xtype:&quot;textfield&quot;,name:&quot;userStoragePath&quot;,fieldLabel:i18n.get(&quot;label.userStoragePath&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true,disabled:true},{xtype:&quot;numberfield&quot;,name:&quot;freeUserSpace&quot;,fieldLabel:i18n.get(&quot;label.freeUserSpace&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true,disabled:true},{xtype:&quot;numberfield&quot;,name:&quot;busyUserSpace&quot;,fieldLabel:i18n.get(&quot;label.busyUserSpace&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true,disabled:true},{xtype:&quot;textfield&quot;,name:&quot;status&quot;,fieldLabel:i18n.get(&quot;label.status&quot;),anchor:&quot;100%&quot;,maxLength:30,readOnly:true,disabled:true}]}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.userStorage.userStoragePropPanel.superclass.initComponent.call(this)},onValidate:function(){var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var b={};b.userId=a.findField(&quot;userValueFieldId&quot;).getValue();b.storage={};b.storage.quota=a.findField(&quot;quota&quot;).getValue();if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(d.success===false){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(d.message))}else{this.close();this.store.reload()}},failure:alertFailure})}if(this.action==&quot;create&quot;){Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,jsonData:b,success:function(c){var d=Ext.decode(c.responseText);if(d.success===false){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(d.message))}else{this.close();this.store.reload()}},failure:alertFailure})}},afterRender:function(){sitools.admin.userStorage.userStoragePropPanel.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var a=this.findByType(&quot;form&quot;)[0].getForm();a.loadRecord(this.userStorageRec);a.findField(&quot;displayUser&quot;).destroy()}}});Ext.reg(&quot;s-userStoragesprop&quot;,sitools.admin.userStorage.userStoragePropPanel);Ext.namespace(&quot;sitools.admin.userStorage&quot;);sitools.admin.userStorage.userStorageCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_USERSTORAGE_URL&quot;)+&quot;/users&quot;;this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;userId&quot;,fields:[{name:&quot;userId&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;,mapping:&quot;status&quot;},{name:&quot;freeUserSpace&quot;,type:&quot;float&quot;,mapping:&quot;storage.freeUserSpace&quot;},{name:&quot;busyUserSpace&quot;,type:&quot;float&quot;,mapping:&quot;storage.busyUserSpace&quot;},{name:&quot;quota&quot;,type:&quot;float&quot;,mapping:&quot;storage.quota&quot;},{name:&quot;userStoragePath&quot;,type:&quot;string&quot;,mapping:&quot;storage.userStoragePath&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.userLogin&quot;),dataIndex:&quot;userId&quot;,width:100},{header:i18n.get(&quot;label.userStoragePath&quot;),dataIndex:&quot;userStoragePath&quot;,width:100},{header:i18n.get(&quot;label.freeUserSpace&quot;)+&quot; (&quot;+i18n.get(&quot;label.quota.unit&quot;)+&quot;)&quot;,dataIndex:&quot;freeUserSpace&quot;,width:100},{header:i18n.get(&quot;label.busyUserSpace&quot;)+&quot; (&quot;+i18n.get(&quot;label.quota.unit&quot;)+&quot;)&quot;,dataIndex:&quot;busyUserSpace&quot;,width:100},{header:i18n.get(&quot;label.quota&quot;)+&quot; (&quot;+i18n.get(&quot;label.quota.unit&quot;)+&quot;)&quot;,dataIndex:&quot;quota&quot;,width:100},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:100}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.clean&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_clean.png&quot;,handler:this._onClean,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.refresh&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_refresh.png&quot;,handler:this._onRefresh,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.notify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/notify.png&quot;,handler:this._onNotify,xtype:&quot;s-menuButton&quot;}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.userStorage.userStorageCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.userStorage.userStorageCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.userStorage.userStoragePropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show(ID.BOX.PROJECTS)},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.userStorage.userStoragePropPanel({url:this.url+&quot;/&quot;+b.id,userStorageRec:b,action:&quot;modify&quot;,store:this.getStore()});a.show(ID.BOX.USERSTORAGE)},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;userStorageCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onClean:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;userStorageCrud.clean&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doClean(b)}}})},doClean:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/clean&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onRefresh:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/refresh&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onNotify:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;/notify&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-userStorage&quot;,sitools.admin.userStorage.userStorageCrudPanel);Ext.namespace(&quot;sitools.component.order&quot;);sitools.component.order.orderPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:&quot;&quot;,layout:&quot;fit&quot;,initComponent:function(){this.title=i18n.get(&quot;label.details&quot;)+&quot; : &quot;;this.title+=this.orderRec.data.userId;this.title+=&quot; &quot;+i18n.get(&quot;label.the&quot;);this.title+=&quot; &quot;+this.orderRec.data.dateOrder;var d=new Ext.data.JsonStore({fields:[{name:&quot;eventDate&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;message&quot;,type:&quot;string&quot;}],data:this.orderRec.data.events});var f=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.date&quot;),dataIndex:&quot;eventDate&quot;,width:150},{header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:250},{header:i18n.get(&quot;headers.message&quot;),dataIndex:&quot;message&quot;,width:150}]});var b=new Ext.grid.GridPanel({layout:&quot;fit&quot;,flex:0.5,title:i18n.get(&quot;label.events&quot;),store:d,cm:f,rowSelectionModel:new Ext.grid.RowSelectionModel(),autoScroll:true,collapsible:false});var c=new Ext.data.JsonStore({fields:[{name:&quot;resourceCollection&quot;,type:&quot;string&quot;}]});if(!Ext.isEmpty(this.orderRec.data.resourceCollection)){Ext.each(this.orderRec.data.resourceCollection,function(g){var k=new c.recordType({resourceCollection:g});c.add(k)})}if(!Ext.isEmpty(this.orderRec.data.adminResourceCollection)){Ext.each(this.orderRec.data.adminResourceCollection,function(g){var k=new c.recordType({resourceCollection:g});c.add(k)})}var e=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.resource&quot;),dataIndex:&quot;resourceCollection&quot;,width:600}]});var a=new Ext.grid.GridPanel({layout:&quot;fit&quot;,flex:0.5,title:i18n.get(&quot;label.resourceCollection&quot;),store:c,cm:e,rowSelectionModel:new Ext.grid.RowSelectionModel(),autoScroll:true,collapsible:false});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[{xtype:&quot;panel&quot;,layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;,flex:&quot;ratio&quot;},items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;hidden&quot;,name:&quot;orderId&quot;,id:&quot;userValueFieldId&quot;},{xtype:&quot;textfield&quot;,name:&quot;userId&quot;,fieldLabel:i18n.get(&quot;label.userLogin&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true},{xtype:&quot;textfield&quot;,name:&quot;resourceDescriptor&quot;,fieldLabel:i18n.get(&quot;label.url&quot;),anchor:&quot;100%&quot;,maxLength:30,readOnly:true},{xtype:&quot;textfield&quot;,name:&quot;dateOrder&quot;,fieldLabel:i18n.get(&quot;label.dateOrder&quot;),anchor:&quot;100%&quot;,maxLength:100,readOnly:true}]},a,b]}],buttons:[{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}]}];sitools.component.order.orderPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.order.orderPropPanel.superclass.onRender.apply(this,arguments);var a=this.findByType(&quot;form&quot;)[0].getForm();a.loadRecord(this.orderRec)}});Ext.reg(&quot;s-orderprop&quot;,sitools.component.order.orderPropPanel);Ext.namespace(&quot;sitools.component.order&quot;);sitools.component.order.orderCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.GROUP,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ORDERS_ADMIN_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;userId&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;resourceCollection&quot;},{name:&quot;resourceDescriptor&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;dateOrder&quot;,type:&quot;string&quot;},{name:&quot;events&quot;},{name:&quot;adminResourceCollection&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.userLogin&quot;),dataIndex:&quot;userId&quot;,width:100},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:350},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:80},{header:i18n.get(&quot;label.dateOrder&quot;),dataIndex:&quot;dateOrder&quot;,width:150}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.details&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_details.png&quot;,handler:this._onDetail,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_beginning.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.done&quot;),icon:&quot;res/images/icons/icons_perso/toolbar_end.png&quot;,handler:this._onDone,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onDetail};sitools.component.order.orderCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.order.orderCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onDetail:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.order.orderPropPanel({url:this.url,action:&quot;detail&quot;,store:this.getStore(),orderRec:b});a.show(ID.BOX.ORDER)},_onActive:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.order.events({baseUrl:this.url+&quot;/&quot;+b.data.id,action:&quot;active&quot;,store:this.getStore(),orderRec:b});a.show()},_onDone:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.order.events({baseUrl:this.url+&quot;/&quot;+b.data.id,action:&quot;done&quot;,store:this.getStore(),orderRec:b});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;orderCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-order&quot;,sitools.component.order.orderCrudPanel);Ext.namespace(&quot;sitools.component.order&quot;);sitools.component.order.events=Ext.extend(Ext.Window,{width:350,height:230,modal:true,closable:true,baseUrl:this.baseUrl,initComponent:function(){this.title=i18n.get(&quot;label.orders&quot;);this.items=[{xtype:&quot;panel&quot;,height:200,items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;textarea&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textarea&quot;,name:&quot;message&quot;,fieldLabel:i18n.get(&quot;label.message&quot;),anchor:&quot;100%&quot;,maxLength:100}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.component.order.events.superclass.initComponent.call(this)},_onValidate:function(){var a=this.baseUrl+&quot;/&quot;+this.action;var b=this.findByType(&quot;form&quot;)[0].getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get(&quot;warning.invalidForm&quot;));return}var c={};Ext.iterate(b.getValues(),function(d,e){c[d]=e},this);Ext.Ajax.request({url:a,method:&quot;PUT&quot;,scope:this,jsonData:c,success:function(d){this.store.reload();this.close()},failure:alertFailure})}});Ext.namespace(&quot;sitools.component.graphs&quot;);sitools.component.graphs.graphsCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.GRAPHS,autoScroll:true,initComponent:function(){this.urlProjects=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;);this.storeProjects=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.urlProjects,root:&quot;data&quot;,autoLoad:true});this.comboProjects=new Ext.form.ComboBox({store:this.storeProjects,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectProject&quot;),selectOnFocus:true,listeners:{scope:this,select:function(b,c,a){this.loadGraph(c.data.id)}}});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.comboProjects,{text:i18n.get(&quot;label.save&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:this._onSave,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.reset&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_refresh.png&quot;,handler:this._onReset,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;}]};this.buttons=[{text:i18n.get(&quot;label.save&quot;),scope:this,handler:this._onSave},{text:i18n.get(&quot;label.reset&quot;),scope:this,handler:this._onReset},{text:i18n.get(&quot;label.delete&quot;),scope:this,handler:this._onDelete}];sitools.component.graphs.graphsCrudPanel.superclass.initComponent.call(this)},loadGraph:function(b){var c=this.storeProjects.find(&quot;id&quot;,b);var d=this.storeProjects.getAt(c);var a=d.data.name;this.removeAll();this.tree=new sitools.component.graphs.graphsCrudTreePanel({name:a,projectId:b});this.tree.getRootNode().expand(true);this.add(this.tree);this.doLayout()},_onSave:function(){var d=this.comboProjects.getValue();if(!Ext.isEmpty(d)){var b=this.tree.getRootNode();var a=[];var g=b.childNodes;var e;for(e=0;e&lt;g.length;e++){this.getAllNodes(g[e],a)}var c=this.tree.getIdGraph();var f={nodeList:a,id:c};var k=(!Ext.isEmpty(c))?&quot;PUT&quot;:&quot;POST&quot;;Ext.Ajax.request({url:this.urlProjects+&quot;/&quot;+d+&quot;/graph&quot;,method:k,scope:this,jsonData:f,success:function(l){var n=Ext.decode(l.responseText);if(!n.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),n.message);return false}else{var m=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.graphSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.loadGraph(d)}},failure:alertFailure})}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}},getAllNodes:function(a,c){var d={};if(Ext.isEmpty(a)){return}else{if(a.isLeaf()){d={text:a.text,datasetId:a.attributes.datasetId,visible:a.attributes.visible,status:a.attributes.status,nbRecord:a.attributes.nbRecord,imageDs:a.attributes.imageDs,readme:a.attributes.readme,url:a.attributes.url,leaf:true,type:a.attributes.type};c.push(d)}else{d={text:a.text,image:a.attributes.image,description:a.attributes.description,children:[],type:a.attributes.type,leaf:false};c.push(d);var e=a.childNodes;var b;for(b=0;b&lt;e.length;b++){this.getAllNodes(e[b],d.children)}}}},_onReset:function(){var a=this.comboProjects.getValue();if(!Ext.isEmpty(a)){var b=Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.graphs.reset&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doReset()}}})}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}},doReset:function(){if(!Ext.isEmpty(this.tree)){var a=this.tree.getRootNode();a.removeAll(true);this.tree.getLoader().load(a,function(){a.expand(true)},this)}},_onDelete:function(){var a=this.comboProjects.getValue();if(!Ext.isEmpty(a)){var b=Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.graphs.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(a)}}})}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}},doDelete:function(a){Ext.Ajax.request({url:this.urlProjects+&quot;/&quot;+a+&quot;/graph&quot;,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.loadGraph(a)}}})}});sitools.component.graphs.graphsCrudTreePanel=Ext.extend(Ext.tree.TreePanel,{idGraph:null,loader:null,projectId:null,constructor:function(a){this.loader=new sitools.component.graphs.graphTreeLoader({requestMethod:&quot;GET&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;)+&quot;/&quot;+a.projectId+&quot;/graph&quot;,root:&quot;graph.nodeList&quot;});this.projectId=a.projectId;a=Ext.apply({rootVisible:true,loader:this.loader,layout:&quot;fit&quot;,enableDD:true,root:{nodeType:&quot;async&quot;,text:a.name},contextMenuRoot:new Ext.menu.Menu({items:[{id:&quot;create-node&quot;,text:i18n.get(&quot;label.createNode&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_folder.png&quot;},{id:&quot;add-dataset&quot;,text:i18n.get(&quot;label.addDataset&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_datasets.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuNode:new Ext.menu.Menu({items:[{id:&quot;create-node&quot;,text:i18n.get(&quot;label.createNode&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_folder.png&quot;},{id:&quot;add-dataset&quot;,text:i18n.get(&quot;label.addDataset&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/add_datasets.png&quot;},{id:&quot;edit-node&quot;,text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;},{id:&quot;delete-node&quot;,text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_delete.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),contextMenuLeaf:new Ext.menu.Menu({items:[{id:&quot;edit-node&quot;,text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_edit.png&quot;},{id:&quot;delete-node&quot;,text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/toolbar_delete.png&quot;}],listeners:{scope:this,itemclick:this._cxtMenuHandler}}),listeners:{scope:this,contextmenu:function(b,d){b.select();var f;if(b.id==this.root.id){f=b.getOwnerTree().contextMenuRoot}else{if(b.isLeaf()){f=b.getOwnerTree().contextMenuLeaf}else{f=b.getOwnerTree().contextMenuNode}}f.contextNode=b;f.showAt(d.getXY())}}});sitools.component.graphs.graphsCrudTreePanel.superclass.constructor.call(this,a)},onRender:function(){sitools.component.graphs.graphsCrudTreePanel.superclass.onRender.apply(this,arguments)},_cxtMenuHandler:function(d){var c,a;switch(d.id){case&quot;delete-node&quot;:var b=Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.graphs.node.delete&quot;),scope:this,fn:function(e,f){if(e==&quot;yes&quot;){var g=d.parentMenu.contextNode;if(g.parentNode){g.remove()}}}});break;case&quot;add-dataset&quot;:c=d.parentMenu.contextNode;a=new sitools.component.graphs.graphsDatasetWin({node:c,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/projects/&quot;+this.projectId+&quot;?media=json&quot;,mode:&quot;create&quot;});a.show(this);break;case&quot;create-node&quot;:c=d.parentMenu.contextNode;a=new sitools.component.graphs.graphsNodeWin({node:c,mode:&quot;create&quot;});a.show(this);break;case&quot;edit-node&quot;:c=d.parentMenu.contextNode;if(c.isLeaf()){a=new sitools.component.graphs.graphsDatasetWin({node:c,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/projects/&quot;+this.projectId+&quot;?media=json&quot;,mode:&quot;edit&quot;})}else{a=new sitools.component.graphs.graphsNodeWin({node:c,mode:&quot;edit&quot;})}a.show(this);break}},getIdGraph:function(){return this.loader.getIdGraph()}});sitools.component.graphs.graphTreeLoader=Ext.extend(Ext.tree.TreeLoader,{idGraph:null,createNode:function(a){return Ext.tree.TreeLoader.prototype.createNode.call(this,a)},processResponse:function(c,b,l,m){var n=c.responseText,a,k,d=0,f;try{if(!(a=c.responseData)){a=Ext.decode(n);this.idGraph=a.graph.id;if(this.root){if(!this.getRoot){this.getRoot=Ext.data.JsonReader.prototype.createAccessor(this.root)}a=this.getRoot(a)}}b.beginUpdate();for(f=a.length;d&lt;f;d++){k=this.createNode(a[d]);if(k){b.appendChild(k)}}b.endUpdate();this.runCallback(l,m||b,[b])}catch(g){this.handleFailure(c)}},getIdGraph:function(){return this.idGraph}});Ext.reg(&quot;s-graphs&quot;,sitools.component.graphs.graphsCrudPanel);Ext.namespace(&quot;sitools.component.graphs&quot;);sitools.component.graphs.graphsDatasetWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;label.datasets&quot;);var a=this.projectId;this.store=new Ext.data.JsonStore({root:&quot;project.dataSets&quot;,restful:true,autoSave:false,idProperty:&quot;id&quot;,url:this.url,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;mediaType&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;properties&quot;}]});this.grid=new Ext.grid.GridPanel({sm:new Ext.grid.RowSelectionModel({singleSelect:true}),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;}],listeners:{scope:this,viewReady:function(){var c=this.node;if(this.mode==&quot;edit&quot;){var b=this.store.find(&quot;name&quot;,c.text);var d=this.grid.getSelectionModel();d.selectRow(b)}}}});this.items=[{xtype:&quot;panel&quot;,title:i18n.get(&quot;label.selectDataset&quot;),items:[this.grid],bbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]}}];sitools.component.graphs.graphsDatasetWin.superclass.initComponent.call(this)},onRender:function(){sitools.component.graphs.graphsDatasetWin.superclass.onRender.apply(this,arguments);this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.error.project.nodataset&quot;))}}})},_onOK:function(){var f=this.grid.getSelectionModel().getSelected();if(this.mode==&quot;edit&quot;){this.node.setText(f.data.name)}else{var d=f.data.properties;var b=0;var a;var e;if(!Ext.isEmpty(d)){Ext.each(d,function(g){if(g.name==&quot;nbRecord&quot;){b=g.value}if(g.name==&quot;imageUrl&quot;){a=g.value}if(g.name==&quot;descriptionHTML&quot;){e=g.value}})}var c={text:f.data.name,datasetId:f.data.id,visible:f.data.visible,status:f.data.status,nbRecord:b,leaf:true,type:&quot;dataset&quot;,imageDs:a,readme:e,url:f.data.url};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(c)}this.close()},_onCancel:function(){this.destroy()}});Ext.namespace(&quot;sitools.component.projects&quot;);sitools.component.graphs.graphsNodeWin=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,initComponent:function(){this.title=i18n.get(&quot;label.nodeDescription&quot;);this.itemsForm=[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;,allowBlank:false},{fieldLabel:i18n.get(&quot;label.description&quot;),name:&quot;description&quot;,anchor:&quot;100%&quot;},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;image&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,growMax:400}];this.bbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]};this.formPanel=new Ext.FormPanel({labelWidth:100,frame:true,defaultType:&quot;textfield&quot;,items:this.itemsForm});this.items=[this.formPanel];sitools.component.graphs.graphsNodeWin.superclass.initComponent.call(this)},onRender:function(){sitools.component.graphs.graphsNodeWin.superclass.onRender.apply(this,arguments)},afterRender:function(){sitools.component.graphs.graphsNodeWin.superclass.afterRender.apply(this,arguments);if(this.mode==&quot;edit&quot;){var c=this.node;var b=this.formPanel.getForm();var d={};d.name=c.text;d.image=c.attributes.image.url;d.description=c.attributes.description;var a=new Ext.data.Record(d);b.loadRecord(a)}},_onOK:function(){var c=this.formPanel.getForm();var a=c.getValues();var d={};if(!Ext.isEmpty(a.image)){d.url=a.image;d.type=&quot;Image&quot;;d.mediaType=&quot;Image&quot;}if(this.mode==&quot;edit&quot;){this.node.setText(a.name);this.node.attributes.description=a.description;this.node.attributes.image=d}else{var b={text:a.name,image:d,description:a.description,type:&quot;node&quot;,children:[]};if(!this.node.isExpanded()){this.node.expand()}this.node.appendChild(b)}this.close()},_onCancel:function(){this.destroy()},_onUpload:function(){Ext.msg.alert(&quot;Information&quot;,&quot;TODO&quot;)}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.selectColumn=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,initComponent:function(){this.title=i18n.get(&quot;title.selectColumn&quot;);this.cmSelectColumn=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),sortable:true,dataIndex:&quot;columnAlias&quot;}]});this.smSelectColumn=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridSelectColumn=new Ext.grid.GridPanel({height:380,autoScroll:true,store:new Ext.data.JsonStore({root:&quot;dataset.columnModel&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.url,restful:true,method:&quot;GET&quot;}),remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;schema&quot;,type:&quot;string&quot;},{name:&quot;tableName&quot;,type:&quot;string&quot;},{name:&quot;columnRenderer&quot;,type:&quot;string&quot;}],autoLoad:true,listeners:{scope:this,load:function(b,a,c){var d;for(d=0;d&lt;a.length;d++){if(a[d].data!==undefined&amp;&amp;!a[d].data.visible&amp;&amp;a[d].data.columnRenderer!=&quot;noClientAccess&quot;){b.remove(a[d])}}}}}),cm:this.cmSelectColumn,sm:this.smSelectColumn});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[this.gridSelectColumn],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasets.selectColumn.superclass.initComponent.call(this)},onValidate:function(){var a=this.gridSelectColumn.getSelectionModel().getSelected();if(a!==null){this.record.data[this.field]=a.data.columnAlias;this.parentView.refresh();this.close()}else{new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document)}}});Ext.reg(&quot;s-datasetscolumnwin&quot;,sitools.admin.datasets.selectColumn);Ext.namespace(&quot;sitools.admin.converters&quot;);sitools.admin.converters.convertersCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.CONVERTERS,pageSize:10,modify:false,urlGrid:null,converterChainedId:{},conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a=&quot;&quot;;var c=d.data;if(c.classVersion!==c.currentClassVersion&amp;&amp;c.currentClassVersion!==null&amp;&amp;c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert(&quot;warning.version.conflict&quot;,&quot;Converter &quot;+c.name+&quot; definition (v&quot;+c.classVersion+&quot;) may conflict with current class version : &quot;+c.currentClassVersion);this.conflictWarned=true}a=&quot;red-row&quot;}return a}},initComponent:function(){this.urlDatasets=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.converterUrlPart=loadUrl.get(&quot;APP_DATASETS_CONVERTERS_URL&quot;);this.httpProxyForms=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;converterChainedModel.converters&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;descriptionAction&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;currentClassVersion&quot;,type:&quot;string&quot;},{name:&quot;currentClassAuthor&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}],proxy:this.httpProxyForms});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.urlDatasets,root:&quot;data&quot;,autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectDatasets&quot;),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.httpProxyForms.setUrl(this.urlDatasets+&quot;/&quot;+this.datasetId+this.converterUrlPart,true);this.getStore().removeAll();this.getStore().load()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.descriptionAction&quot;),dataIndex:&quot;descriptionAction&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.classVersion&quot;),dataIndex:&quot;classVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.currentClassVersion&quot;),dataIndex:&quot;currentClassVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.classAuthor&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:false}]});this.tbar={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get(&quot;label.add&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&quot;,{text:i18n.get(&quot;label.deleteAll&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteAll,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.saveOrder&quot;),icon:&quot;/sitools/common/res/images/icons/save.png&quot;,handler:this.onSave,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:&quot;/sitools/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.converters.convertersCrudPanel.superclass.initComponent.call(this)},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=new sitools.admin.converters.convertersProp({action:&quot;create&quot;,parent:this,datasetId:this.datasetId,converterUrlPart:this.converterUrlPart,urlDatasets:this.urlDatasets});a.show()},onSave:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var d=this.comboDatasets.getValue(),c={};c.id=d;c.idOrder=[];for(var b=0;b&lt;this.store.getCount();b++){var e=this.store.getAt(b).data;c.idOrder.push(e.id)}var a=this.urlDatasets+&quot;/&quot;+d+this.converterUrlPart;Ext.Ajax.request({url:a,method:&quot;PUT&quot;,scope:this,jsonData:c,success:function(f){var k=Ext.decode(f.responseText);if(!k.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),k.message);return false}var g=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.converterSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededConv&quot;));this.getStore().reload()}})},onModify:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var c=this.getSelectionModel().getSelected();var b=this.getStore().indexOf(c);if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.converters.convertersProp({action:&quot;modify&quot;,parent:this,converter:c.data,index:b,datasetId:this.datasetId,converterUrlPart:this.converterUrlPart,urlDatasets:this.urlDatasets,converterChainedId:this.converterChainedId});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.convertersCrud.deleteConverter&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b.data.id)}}})},doDelete:function(b){var c=this.comboDatasets.getValue();var a=this.urlDatasets+&quot;/&quot;+c+this.converterUrlPart+&quot;/&quot;+b;Ext.Ajax.request({url:a,method:&quot;DELETE&quot;,scope:this,success:function(d){if(showResponse(d)){this.getStore().reload();Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededConvDelete&quot;))}}})},onDeleteAll:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.convertersCrud.delete.all&quot;),scope:this,fn:function(b,c){if(b==&quot;yes&quot;){this.doDeleteAll()}}})},doDeleteAll:function(){var b=this.comboDatasets.getValue();var a=this.urlDatasets+&quot;/&quot;+b+this.converterUrlPart;Ext.Ajax.request({url:a,method:&quot;DELETE&quot;,scope:this,success:function(c){if(showResponse(c)){this.getStore().removeAll();this.getStore().reload();Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededConvDelete&quot;))}}})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlDatasets+&quot;/&quot;+this.datasetId+this.converterUrlPart+&quot;/&quot;+a.data.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlDatasets+&quot;/&quot;+this.datasetId+this.converterUrlPart+&quot;/&quot;+a.data.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-converters&quot;,sitools.admin.converters.convertersCrudPanel);Ext.namespace(&quot;sitools.admin.converters&quot;);sitools.admin.converters.convertersProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,initComponent:function(){this.convertersPluginUrl=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_CONVERTERS_PLUGINS_URL&quot;);this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.createConverter&quot;):i18n.get(&quot;label.modifyConverter&quot;);var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridConverter=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridConverter&quot;,title:i18n.get(&quot;title.converterClass&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.convertersPluginUrl,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c=&quot;&quot;;var e=d.get(&quot;violation&quot;);if(!Ext.isEmpty(e)){if(e.level==&quot;CRITICAL&quot;){c=&quot;red-row&quot;}else{if(e.level==&quot;WARNING&quot;){c=&quot;orange-row&quot;}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get(&quot;violation&quot;);if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},layout:&quot;fit&quot;,region:&quot;center&quot;,store:new Ext.data.JsonStore({root:&quot;converter.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;parameterType&quot;,type:&quot;string&quot;},{name:&quot;attachedColumn&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;parameterType&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.attachedColumn&quot;),dataIndex:&quot;attachedColumn&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:80,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.converterErrorValidationNotification&quot;)}),listeners:{scope:this,celldblclick:function(c,m,d,k){var f=c.getStore().getAt(m);var l=f.data;if(d==3&amp;&amp;l.parameterType!=&quot;CONVERTER_PARAMETER_INTERN&quot;){var g=new sitools.admin.datasets.selectColumn({field:&quot;attachedColumn&quot;,record:f,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:this.urlDatasets+&quot;/&quot;+this.datasetId});g.show(ID.BOX.DATASETS)}else{if(d==4&amp;&amp;l.parameterType==&quot;CONVERTER_PARAMETER_INTERN&quot;){return true}else{return false}}}},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:40,frame:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.descriptionAction&quot;),name:&quot;descriptionAction&quot;,anchor:&quot;100%&quot;}],region:&quot;north&quot;});this.fieldMappingPanel=new Ext.Panel({layout:&quot;border&quot;,id:&quot;gridFieldMapping&quot;,title:i18n.get(&quot;title.fieldMapping&quot;),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridConverter,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.admin.converters.convertersProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;gridFieldMapping&quot;){var c=this.gridConverter.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action==&quot;create&quot;){var f=this.gridConverter.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;this.proxyFieldMapping.setUrl(this.convertersPluginUrl+&quot;/&quot;+c+&quot;/&quot;+this.datasetId);var a=this.gridFieldMapping.getStore();a.removeAll();a.load()}},afterRender:function(){sitools.admin.converters.convertersProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var d=this.fieldMappingFormPanel.getForm();var e={};e.descriptionAction=this.converter.descriptionAction;d.loadRecord(new Ext.data.Record(e));var c=this.converter.parameters;if(c!==null){var a=this.gridFieldMapping.getStore();for(var b=0;b&lt;c.length;b++){var f=new Ext.data.Record(c[b]);a.add(f)}this.gridFieldMapping.getView().refresh()}}},onValidate:function(){var e=this.gridConverter.getSelectionModel().getSelected();if(!e&amp;&amp;this.action==&quot;create&quot;){var f=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}var d={};var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}if(!Ext.isEmpty(c)){d.descriptionAction=c.findField(&quot;descriptionAction&quot;).getValue()}else{d.descriptionAction=undefined}var m=[];if(this.action==&quot;create&quot;){e=this.gridConverter.getSelectionModel().getSelected();var k=e.data;d.className=k.className;d.name=k.name;d.description=k.description;d.classVersion=k.classVersion;d.classAuthor=k.classAuthor;d.classOwner=k.classOwner}var n=this.gridFieldMapping.getStore();for(var g=0;g&lt;n.getCount();g++){var l=n.getAt(g).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlDatasets+&quot;/&quot;+this.datasetId+this.converterUrlPart;var a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+this.converter.id;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(q){var t=Ext.decode(q.responseText);if(!t.success){if(Ext.isEmpty(t.message)){var p=t.data;this.notifyViolations(p);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),t.message)}return false}var s=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.converterSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()}})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace(&quot;sitools.component.filters&quot;);sitools.component.filters.filtersCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILTERS,pageSize:10,modify:false,urlGrid:null,filterChainedId:{},conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a=&quot;&quot;;var c=d.data;if(c.classVersion!==c.currentClassVersion&amp;&amp;c.currentClassVersion!==null&amp;&amp;c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert(&quot;warning.version.conflict&quot;,&quot;Filter &quot;+c.name+&quot; definition (v&quot;+c.classVersion+&quot;) may conflict with current class version : &quot;+c.currentClassVersion);this.conflictWarned=true}a=&quot;red-row&quot;}return a}},initComponent:function(){this.urlDatasets=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;);this.filterUrlPart=loadUrl.get(&quot;APP_DATASETS_FILTERS_URL&quot;);this.httpFilterForms=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;filterChainedModel.filters&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;descriptionAction&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;currentClassVersion&quot;,type:&quot;string&quot;},{name:&quot;currentClassAuthor&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}],proxy:this.httpFilterForms});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.urlDatasets,root:&quot;data&quot;,autoLoad:true});this.comboDatasets=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectDatasets&quot;),selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.datasetId=d.data.id;this.httpFilterForms.setUrl(this.urlDatasets+&quot;/&quot;+this.datasetId+this.filterUrlPart,true);this.getStore().removeAll();this.getStore().load()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.descriptionAction&quot;),dataIndex:&quot;descriptionAction&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.classVersion&quot;),dataIndex:&quot;classVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.currentClassVersion&quot;),dataIndex:&quot;currentClassVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.classAuthor&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:false}]});this.tbar={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[this.comboDatasets,{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&quot;,{text:i18n.get(&quot;label.deleteAll&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteAll,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.saveOrder&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:this.onSave,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.filters.filtersCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.filters.filtersCrudPanel.superclass.onRender.apply(this,arguments)},onCreate:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=new sitools.component.filters.filtersProp({action:&quot;create&quot;,parent:this,datasetId:this.datasetId,urlDatasets:this.urlDatasets,filterUrlPart:this.filterUrlPart});a.show()},onSave:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var d=this.comboDatasets.getValue(),c={};c.id=d;c.idOrder=[];for(var b=0;b&lt;this.store.getCount();b++){var e=this.store.getAt(b).data;c.idOrder.push(e.id)}var a=this.urlDatasets+&quot;/&quot;+d+this.filterUrlPart;Ext.Ajax.request({url:a,method:&quot;PUT&quot;,scope:this,jsonData:c,success:function(f){var k=Ext.decode(f.responseText);if(!k.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),k.message);return false}var g=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.filtersSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededFilter&quot;));this.getStore().reload()}})},onModify:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var c=this.getSelectionModel().getSelected();var b=this.getStore().indexOf(c);if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.filters.filtersProp({action:&quot;modify&quot;,parent:this,filter:c.data,index:b,datasetId:this.datasetId,urlDatasets:this.urlDatasets,filterChainedId:this.filterChainedId,filterUrlPart:this.filterUrlPart});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(Ext.isEmpty(b)){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.filtersCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b.data.id)}}})},doDelete:function(a){var c=this.comboDatasets.getValue();var b=this.urlDatasets+&quot;/&quot;+c+this.filterUrlPart+&quot;/&quot;+a;Ext.Ajax.request({url:b,method:&quot;DELETE&quot;,scope:this,success:function(d){if(showResponse(d)){this.getStore().reload();Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededFilterDelete&quot;))}}})},onDeleteAll:function(){if(Ext.isEmpty(this.comboDatasets.getValue())){return}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;label.filtersCrud.delete.all&quot;),scope:this,fn:function(b,c){if(b==&quot;yes&quot;){this.doDeleteAll()}}})},doDeleteAll:function(){var b=this.comboDatasets.getValue();var a=this.urlDatasets+&quot;/&quot;+b+this.filterUrlPart;Ext.Ajax.request({url:a,method:&quot;DELETE&quot;,scope:this,success:function(c){if(showResponse(c)){this.getStore().removeAll();this.getStore().reload();Ext.Msg.alert(i18n.get(&quot;label.information&quot;),i18n.get(&quot;label.restartDsNeededFilterDelete&quot;))}}})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlDatasets+&quot;/&quot;+this.datasetId+this.filterUrlPart+&quot;/&quot;+a.data.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlDatasets+&quot;/&quot;+this.datasetId+this.filterUrlPart+&quot;/&quot;+a.data.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-filters&quot;,sitools.component.filters.filtersCrudPanel);Ext.namespace(&quot;sitools.component.filters&quot;);sitools.component.filters.filtersProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,initComponent:function(){this.filtersUrl=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_FILTERS_PLUGINS_URL&quot;);this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.createFilter&quot;):i18n.get(&quot;label.modifyFilter&quot;);var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridFilter=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridFilter&quot;,title:i18n.get(&quot;title.filterClass&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.filtersUrl,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c=&quot;&quot;;var e=d.get(&quot;violation&quot;);if(!Ext.isEmpty(e)){if(e.level==&quot;CRITICAL&quot;){c=&quot;red-row&quot;}else{if(e.level==&quot;WARNING&quot;){c=&quot;orange-row&quot;}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get(&quot;violation&quot;);if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},layout:&quot;fit&quot;,region:&quot;center&quot;,store:new Ext.data.JsonStore({root:&quot;filter.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;parameterType&quot;,type:&quot;string&quot;},{name:&quot;attachedColumn&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;parameterType&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.attachedColumn&quot;),dataIndex:&quot;attachedColumn&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:80,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.filterErrorValidationNotification&quot;)}),listeners:{scope:this,celldblclick:function(c,m,d,k){var f=c.getStore().getAt(m);var l=f.data;if(d==3&amp;&amp;l.parameterType!=&quot;PARAMETER_INTERN&quot;){var g=new sitools.admin.datasets.selectColumn({field:&quot;attachedColumn&quot;,record:f,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:this.urlDatasets+&quot;/&quot;+this.datasetId});g.show(ID.BOX.DATASETS)}else{if(d==4&amp;&amp;l.parameterType==&quot;PARAMETER_INTERN&quot;){return true}else{return false}}}},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:40,frame:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.descriptionAction&quot;),name:&quot;descriptionAction&quot;,anchor:&quot;100%&quot;}],region:&quot;north&quot;});this.fieldMappingPanel=new Ext.Panel({layout:&quot;border&quot;,id:&quot;gridFieldMapping&quot;,title:i18n.get(&quot;title.fieldMapping&quot;),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridFilter,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.component.filters.filtersProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;gridFieldMapping&quot;){var c=this.gridFilter.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action==&quot;create&quot;){var f=this.gridFilter.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;this.proxyFieldMapping.setUrl(this.filtersUrl+&quot;/&quot;+c+&quot;/&quot;+this.datasetId);var a=this.gridFieldMapping.getStore();a.removeAll();a.load()}},afterRender:function(){sitools.component.filters.filtersProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var d=this.fieldMappingFormPanel.getForm();var e={};e.descriptionAction=this.filter.descriptionAction;d.loadRecord(new Ext.data.Record(e));var c=this.filter.parameters;if(c!==null){var a=this.gridFieldMapping.getStore();var b;for(b=0;b&lt;c.length;b++){e=new Ext.data.Record(c[b]);a.add(e)}this.gridFieldMapping.getView().refresh()}}},onValidate:function(){var e=this.gridFilter.getSelectionModel().getSelected();if(!e&amp;&amp;this.action==&quot;create&quot;){var f=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}var d={};var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}if(!Ext.isEmpty(c)){d.descriptionAction=c.findField(&quot;descriptionAction&quot;).getValue()}else{d.descriptionAction=undefined}var m=[];if(this.action==&quot;create&quot;){e=this.gridFilter.getSelectionModel().getSelected();var k=e.data;d.className=k.className;d.name=k.name;d.description=k.description;d.classVersion=k.classVersion;d.classAuthor=k.classAuthor;d.classOwner=k.classOwner}var n=this.gridFieldMapping.getStore();for(var g=0;g&lt;n.getCount();g++){var l=n.getAt(g).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlDatasets+&quot;/&quot;+this.datasetId+this.filterUrlPart;var a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+this.filter.id;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(q){var t=Ext.decode(q.responseText);if(!t.success){if(Ext.isEmpty(t.message)){var p=t.data;this.notifyViolations(p);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),t.message)}return false}var s=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.filterSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()}})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace(&quot;sitools.component.formComponents&quot;);sitools.component.formComponents.FormComponentsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FORMCOMPONENTS,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_FORMCOMPONENTS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;componentDefaultHeight&quot;,type:&quot;string&quot;},{name:&quot;componentDefaultWidth&quot;,type:&quot;string&quot;},{name:&quot;jsAdminObject&quot;,type:&quot;string&quot;},{name:&quot;jsUserObject&quot;,type:&quot;string&quot;},{name:&quot;imageUrl&quot;,type:&quot;string&quot;},{name:&quot;priority&quot;,type:&quot;integer&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;type&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.jsAdminObject&quot;),dataIndex:&quot;jsAdminObject&quot;,width:350,sortable:false},{header:i18n.get(&quot;label.jsUserObject&quot;),dataIndex:&quot;jsUserObject&quot;,width:350,sortable:false},{header:i18n.get(&quot;label.priority&quot;),dataIndex:&quot;priority&quot;,width:50,sortable:true}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this._onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.component.formComponents.FormComponentsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.formComponents.FormComponentsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.component.formComponents.FormComponentsPropPanel({url:this.url,action:&quot;create&quot;,store:this.store});a.show(ID.BOX.FORMCOMPONENTS)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.formComponents.FormComponentsPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.store});a.show(ID.BOX.FORMCOMPONENTS)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;formComponentsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-formComponents&quot;,sitools.component.formComponents.FormComponentsCrudPanel);Ext.namespace(&quot;sitools.component.formComponents&quot;);sitools.component.formComponents.FormComponentsPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.COMPONENT_SETUP.FORMCOMPONENTS,layout:&quot;fit&quot;,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createFormComponents&quot;)}else{if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyFormComponents&quot;)}}this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,title:i18n.get(&quot;label.formComponentsInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,labelWidth:150,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;id&quot;,hidden:true},{xtype:&quot;textfield&quot;,name:&quot;type&quot;,fieldLabel:i18n.get(&quot;label.type&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;componentDefaultHeight&quot;,fieldLabel:i18n.get(&quot;label.defaultHeight&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;componentDefaultWidth&quot;,fieldLabel:i18n.get(&quot;label.defaultWidth&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;jsAdminObject&quot;,fieldLabel:i18n.get(&quot;label.jsAdminObject&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;jsUserObject&quot;,fieldLabel:i18n.get(&quot;label.jsUserObject&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;fileUrlUser&quot;,id:&quot;fileUrlUserId&quot;,fieldLabel:i18n.get(&quot;label.fileUrlUser&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,id:&quot;fileUrlAdminId&quot;,name:&quot;fileUrlAdmin&quot;,fieldLabel:i18n.get(&quot;label.fileUrlAdmin&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;imageUrl&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;spinnerfield&quot;,name:&quot;priority&quot;,id:&quot;priorityId&quot;,fieldLabel:i18n.get(&quot;label.priority&quot;),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:&quot;50%&quot;,allowBlank:false}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.component.formComponents.FormComponentsPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.component.formComponents.FormComponentsPropPanel.superclass.onRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);a.setValues(c.formComponent)},failure:alertFailure})}},_onValidate:function(){var c=this.findByType(&quot;form&quot;)[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}var a=this.action==&quot;modify&quot;?&quot;PUT&quot;:&quot;POST&quot;;var b=c.getFieldValues();Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){includeJs(c.items.get(&quot;fileUrlUserId&quot;).getValue());includeJs(c.items.get(&quot;fileUrlAdminId&quot;).getValue());this.store.reload();this.close()},failure:alertFailure})}});Ext.reg(&quot;s-formComponentsprop&quot;,sitools.component.formComponents.FormComponentsPropPanel);Ext.namespace(&quot;sitools.admin.datasetView&quot;);sitools.admin.datasetView.DatasetViewsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.DATASETVIEW,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_VIEWS_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;jsObject&quot;,type:&quot;string&quot;},{name:&quot;fileUrl&quot;,type:&quot;string&quot;},{name:&quot;imageUrl&quot;,type:&quot;string&quot;},{name:&quot;priority&quot;,type:&quot;integer&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:350,sortable:false},{header:i18n.get(&quot;label.jsObject&quot;),dataIndex:&quot;jsObject&quot;,width:350,sortable:false},{header:i18n.get(&quot;label.priority&quot;),dataIndex:&quot;priority&quot;,width:50,sortable:true}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this._onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.datasetView.DatasetViewsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasetView.DatasetViewsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.datasetView.DatasetViewPropPanel({url:this.url,action:&quot;create&quot;,store:this.store});a.show(ID.PROP.DATASETVIEW)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.datasetView.DatasetViewPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.store});a.show(ID.PROP.DATASETVIEW)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;datasetViewsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-datasetView&quot;,sitools.admin.datasetView.DatasetViewsCrudPanel);Ext.namespace(&quot;sitools.admin.datasetView&quot;);sitools.admin.datasetView.DatasetViewPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,id:ID.PROP.DATAVIEW,layout:&quot;fit&quot;,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createDatasetView&quot;)}else{if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyDatasetView&quot;)}}this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,title:i18n.get(&quot;label.datasetViewInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,labelWidth:150,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;id&quot;,hidden:true},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;jsObject&quot;,fieldLabel:i18n.get(&quot;label.jsObject&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;fileUrl&quot;,id:&quot;fileUrlId&quot;,fieldLabel:i18n.get(&quot;label.fileUrl&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;imageUrl&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,allowBlank:true},{xtype:&quot;spinnerfield&quot;,name:&quot;priority&quot;,id:&quot;priorityId&quot;,fieldLabel:i18n.get(&quot;label.priority&quot;),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:&quot;50%&quot;,allowBlank:false}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.datasetView.DatasetViewPropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.datasetView.DatasetViewPropPanel.superclass.onRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);a.setValues(c.datasetView)},failure:alertFailure})}},_onValidate:function(){var c=this.findByType(&quot;form&quot;)[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var a=this.action==&quot;modify&quot;?&quot;PUT&quot;:&quot;POST&quot;;var b=c.getFieldValues();Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){includeJs(c.items.get(&quot;fileUrlId&quot;).getValue());this.store.reload();this.close()},failure:alertFailure})}});Ext.reg(&quot;s-datasetViewprop&quot;,sitools.admin.datasetView.DatasetViewPropPanel);Ext.namespace(&quot;sitools.admin.rssFeed&quot;);sitools.admin.rssFeed.rssFeedCrud=Ext.extend(Ext.grid.GridPanel,{border:false,pageSize:10,modify:false,forceFit:&quot;true&quot;,initComponent:function(){this.httpProxyRss=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;data&quot;,proxy:this.httpProxyRss,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;title&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;link&quot;,type:&quot;string&quot;},{name:&quot;feedType&quot;,type:&quot;string&quot;},{name:&quot;feedSource&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;}]});var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;],url:this.url,root:&quot;data&quot;,autoLoad:true});this.combobox=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:this.label,selectOnFocus:true,listeners:{scope:this,select:function(c,d,b){this.dataId=d.data.id;this.getTopToolbar().findById(&quot;s-filter&quot;).enable();this.loadRss()}}});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100},{header:i18n.get(&quot;label.titleRss&quot;),dataIndex:&quot;title&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200},{header:i18n.get(&quot;label.linkTitle&quot;),dataIndex:&quot;link&quot;,width:200},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;feedType&quot;,width:50},{header:i18n.get(&quot;headers.feedSource&quot;),dataIndex:&quot;feedSource&quot;,width:100}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.combobox,{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize,disabled:true,id:&quot;s-filter&quot;}]};this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.rssFeed.rssFeedCrud.superclass.initComponent.call(this)},loadRss:function(){var a=this.url+&quot;/&quot;+this.dataId+this.urlRef;this.httpProxyRss.setUrl(a,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onCreate:function(){if(Ext.isEmpty(this.combobox.getValue())){return}var a=new sitools.admin.rssFeed.rssFeedProps({action:&quot;create&quot;,store:this.store,id:this.dataId,url:this.url,urlRef:this.urlRef});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.rssFeed.rssFeedProps({action:&quot;modify&quot;,store:this.store,id:this.dataId,url:this.url,urlRef:this.urlRef,idFeed:b.data.id});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;feedCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+this.dataId+this.urlRef+&quot;/&quot;+a.data.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-rssFeedCrud&quot;,sitools.admin.rssFeed.rssFeedCrud);Ext.namespace(&quot;sitools.admin.rssFeed&quot;);sitools.admin.rssFeed.rssFeedProps=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,stateful:false,urlValid:false,initComponent:function(){this.crudStore=this.store;this.buttonValidUrl=new Ext.Button({text:i18n.get(&quot;label.validateUrl&quot;),scope:this,handler:function(){this.validateUrl()},width:150,iconCls:&quot;img-help&quot;,iconAlign:&quot;left&quot;});this.boxComponent=new Ext.BoxComponent({hidden:true,labelSeparator:&quot;&quot;,fieldLabel:&quot; &quot;,id:&quot;boxComponentValid&quot;,cls:&quot;sitools-form-valid-msg&quot;,setHtml:function(c){var d=this.getEl();d.update(c)}});this.formPanel=new Ext.FormPanel({labelWidth:100,defaultType:&quot;textfield&quot;,padding:10,height:165,title:i18n.get(&quot;title.feedDetails&quot;),trackResetOnLoad:true,items:[{xtype:&quot;fieldset&quot;,title:i18n.get(&quot;title.feedDetailsCommon&quot;),autoHeight:true,defaultType:&quot;textfield&quot;,items:[{name:&quot;id&quot;,xtype:&quot;hidden&quot;},{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;,allowBlank:false},{fieldLabel:i18n.get(&quot;label.feedSource&quot;),name:&quot;feedSource&quot;,xtype:&quot;radiogroup&quot;,columns:1,items:[{boxLabel:&quot;CLASSIC&quot;,name:&quot;feedSource&quot;,inputValue:&quot;CLASSIC&quot;,checked:true},{boxLabel:&quot;EXTERNAL&quot;,name:&quot;feedSource&quot;,inputValue:&quot;EXTERNAL&quot;}],listeners:{scope:this,change:function(d,e){var c=e.getGroupValue();this.toogleSpecificForm(c);if(c==&quot;CLASSIC&quot;){this.gridPanel.setDisabled(false)}else{this.gridPanel.setDisabled(true)}this.doLayout()}}}]},{xtype:&quot;fieldset&quot;,title:i18n.get(&quot;title.feedDetailsSpecific&quot;),autoHeight:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.titleRss&quot;),name:&quot;title&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.description&quot;),name:&quot;description&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.linkTitle&quot;),name:&quot;link&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.authorName&quot;),name:&quot;authorName&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.authorEmail&quot;),name:&quot;authorEmail&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.feedType&quot;),name:&quot;feedType&quot;,xtype:&quot;radiogroup&quot;,columns:1,items:[{boxLabel:&quot;RSS&quot;,name:&quot;feedType&quot;,inputValue:&quot;rss_2.0&quot;,checked:true},{boxLabel:&quot;ATOM&quot;,name:&quot;feedType&quot;,inputValue:&quot;atom_1.0&quot;}]},{xtype:&quot;compositefield&quot;,anchor:&quot;100%&quot;,fieldLabel:i18n.get(&quot;label.url&quot;),msgTarget:&quot;under&quot;,hidden:true,id:&quot;compositeFieldExternalUrl&quot;,items:[{name:&quot;externalUrl&quot;,xtype:&quot;textfield&quot;,anchor:&quot;100%&quot;,flex:1,status:&quot;pending&quot;,allowBlank:&quot;false&quot;,vtype:&quot;uri&quot;,validator:function(d){var c=this.status;if(c==&quot;invalid&quot;){return this.invalidText}else{return true}},listeners:{scope:this,change:function(c,e,d){c.fireEvent(&quot;changeStatus&quot;,c,&quot;pending&quot;)},changeStatus:function(d,c,e){d.status=c;d.clearInvalid();var f;switch(c){case&quot;pending&quot;:f=&quot;img-help&quot;;this.boxComponent.setVisible(false);break;case&quot;valid&quot;:f=&quot;img-valid&quot;;break;case&quot;invalid&quot;:this.boxComponent.setVisible(false);f=&quot;img-error&quot;;if(Ext.isEmpty(e)){d.markInvalid()}else{d.markInvalid(e);d.invalidText=e}break;default:this.boxComponent.setVisible(false);f=&quot;img-error&quot;;break}this.buttonValidUrl.setIconClass(f)}}},this.buttonValidUrl]},this.boxComponent]}]});this.storeItem=new Ext.data.JsonStore({idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;title&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;link&quot;,type:&quot;string&quot;},{name:&quot;pubDate&quot;,type:&quot;date&quot;}]});var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.titleRss&quot;),dataIndex:&quot;title&quot;,width:150,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.linkTitle&quot;),dataIndex:&quot;link&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.updatedDate&quot;),dataIndex:&quot;updatedDate&quot;,width:100,sortable:true}]});var b={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;}]};this.gridPanel=new Ext.grid.GridPanel({viewConfig:{forceFit:true},layout:&quot;fit&quot;,title:i18n.get(&quot;title.feedItems&quot;),store:this.storeItem,cm:a,tbar:b});this.saveButton=new Ext.Button({text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:[this.formPanel,this.gridPanel],buttons:[this.saveButton,{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.rssFeed.rssFeedProps.superclass.initComponent.call(this)},onRender:function(){sitools.admin.rssFeed.rssFeedProps.superclass.onRender.apply(this,arguments);if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;title.createFeed&quot;)}else{this.title=i18n.get(&quot;title.editFeed&quot;);Ext.Ajax.request({url:this.url+&quot;/&quot;+this.id+this.urlRef+&quot;/&quot;+this.idFeed,method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return false}var d=b.FeedModel;this.populateForm(d);this.populateStore(d);if(d.feedSource==&quot;OPENSEARCH&quot;){this.gridPanel.setDisabled(true);var e=this.formPanel.getForm().findField(&quot;feedType&quot;);e.setDisabled(true)}else{if(d.feedSource==&quot;EXTERNAL&quot;){this.gridPanel.setDisabled(true);var c=this.formPanel.getForm().findField(&quot;externalUrl&quot;);if(!Ext.isEmpty(c.getValue())){c.fireEvent(&quot;changeStatus&quot;,c,&quot;valid&quot;)}}}},failure:alertFailure})}},populateForm:function(c){if(c!==undefined){var b=this.formPanel.getForm();var d={};d.id=c.id;d.name=c.name;d.feedType=c.feedType;d.feedSource=c.feedSource;if(c.feedSource==&quot;EXTERNAL&quot;){d.externalUrl=c.externalUrl}else{d.title=c.title;d.description=c.description;d.link=c.link;if(c.author!==undefined){d.authorName=c.author.name;d.authorEmail=c.author.email}}var a=new Ext.data.Record(d);b.loadRecord(a)}},populateStore:function(d){this.storeItem.removeAll();if(d!==undefined&amp;&amp;d.entries!==undefined){var b;for(b=0;b&lt;d.entries.length;b++){var c=d.entries[b];var a=new Date(c.updatedDate);c.updatedDate=a;var e=new Ext.data.Record(c);this.storeItem.add(e)}}},onValidate:function(){var d=this.formPanel.getForm();if(!d.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var a=d.findField(&quot;feedSource&quot;).getValue().inputValue;var c=d.findField(&quot;externalUrl&quot;);var b=c.status;if(a==&quot;EXTERNAL&quot;&amp;&amp;(&quot;pending&quot;==b)){this.validateUrl(this.onValidateModify)}else{if(a==&quot;EXTERNAL&quot;&amp;&amp;&quot;invalid&quot;==b){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}else{this.onValidateModify()}}},onValidateModify:function(){var c=this.formPanel.getForm();if(this.action==&quot;modify&quot;){var b=c.findField(&quot;name&quot;).getValue();var a=c.findField(&quot;name&quot;).originalValue;if(a!=b){Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;rssFeedProp.warning.feedName.changed&quot;),scope:this,fn:function(d,e){if(d==&quot;yes&quot;){this.onSaveFeed()}}})}else{this.onSaveFeed()}}else{this.onSaveFeed()}},onSaveFeed:function(){var e=this.formPanel.getForm();var d=e.findField(&quot;feedType&quot;);d.setDisabled(false);var l={};l.author={};Ext.iterate(e.getValues(),function(n,p){if(n==&quot;authorName&quot;){l.author.name=p}else{if(n==&quot;authorEmail&quot;){l.author.email=p}else{l[n]=p}}},this);l.entries=[];if(l.feedSource==&quot;CLASSIC&quot;){var k;for(k=0;k&lt;this.storeItem.getCount();k++){var g=this.storeItem.getAt(k).copy().data;var f=g.updatedDate;if(f!==null&amp;&amp;f!==undefined){var m=new Date(f);g.updatedDate=m.format(&quot;Y-m-d\\TH:i:s.u&quot;)+m.getGMTOffset()}f=g.publishedDate;if(f!==null&amp;&amp;f!==undefined){var b=new Date(f);g.publishedDate=b.format(&quot;Y-m-d\\TH:i:s.u&quot;)+b.getGMTOffset()}l.entries.push(g)}}var c=this.url+&quot;/&quot;+this.id+this.urlRef;var a;if(this.action==&quot;create&quot;){a=&quot;POST&quot;}else{a=&quot;PUT&quot;;c+=&quot;/&quot;+this.idFeed}Ext.Ajax.request({url:c,method:a,scope:this,jsonData:l,success:function(n){var p=Ext.decode(n.responseText);if(!p.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(p.message));return false}this.store.reload();this.close()},failure:alertFailure})},toogleSpecificForm:function(a){var c=(a==&quot;CLASSIC&quot;);var b=this.formPanel.getForm();b.findField(&quot;title&quot;).setDisabled(!c);b.findField(&quot;title&quot;).setVisible(c);b.findField(&quot;description&quot;).setDisabled(!c);b.findField(&quot;description&quot;).setVisible(c);b.findField(&quot;link&quot;).setDisabled(!c);b.findField(&quot;link&quot;).setVisible(c);b.findField(&quot;authorName&quot;).setDisabled(!c);b.findField(&quot;authorName&quot;).setVisible(c);b.findField(&quot;authorEmail&quot;).setDisabled(!c);b.findField(&quot;authorEmail&quot;).setVisible(c);b.findField(&quot;authorEmail&quot;).setDisabled(!c);b.findField(&quot;authorEmail&quot;).setVisible(c);b.findField(&quot;feedType&quot;).setVisible(c);Ext.getCmp(&quot;boxComponentValid&quot;).setDisabled(c);Ext.getCmp(&quot;boxComponentValid&quot;).setVisible(!c);Ext.getCmp(&quot;compositeFieldExternalUrl&quot;).setDisabled(c);Ext.getCmp(&quot;compositeFieldExternalUrl&quot;).setVisible(!c)},onCreate:function(){var a=new sitools.admin.rssFeed.rssFeedItemProps({store:this.storeItem,parent:this.gridPanel,action:&quot;create&quot;});a.show()},onModify:function(){var b=this.gridPanel.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.rssFeed.rssFeedItemProps({store:this.storeItem,parent:this.gridPanel,action:&quot;modify&quot;,rec:b});a.show()},onDelete:function(){var a=this.gridPanel.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.storeItem.remove(a)},validateUrl:function(a){var c=this.formPanel.getForm().findField(&quot;externalUrl&quot;);if(c.isValid()){var d=c.getValue();var b=&quot;/sitools/proxy&quot;;this.saveButton.disable();this.buttonValidUrl.disable();this.buttonValidUrl.setIconClass(&quot;img-loading&quot;);Ext.Ajax.request({url:b,method:&quot;GET&quot;,scope:this,doNotHandleRequestexception:true,params:{external_url:d},success:function(e){var m=e.responseXML;var g=false,l=false;if(!Ext.isEmpty(m)){g=!Ext.isEmpty(Ext.DomQuery.selectNode(&quot;rss&quot;,m));l=!Ext.isEmpty(Ext.DomQuery.selectNode(&quot;feed&quot;,m))}var k=this.formPanel.getForm().findField(&quot;feedType&quot;);var f=this.formPanel.getForm().findField(&quot;externalUrl&quot;);if(g){k.setValue(&quot;rss_2.0&quot;)}else{if(l){k.setValue(&quot;atom_1.0&quot;)}}if(g||l){this.boxComponent.setHtml(String.format(i18n.get(&quot;label.feedTypeDetected&quot;),k.getValue().inputValue));this.boxComponent.setVisible(true);f.fireEvent(&quot;changeStatus&quot;,f,&quot;valid&quot;);if(Ext.isFunction(a)){a.call(this)}}else{f.fireEvent(&quot;changeStatus&quot;,f,&quot;invalid&quot;,i18n.get(&quot;label.incompatible.feed.type&quot;))}},failure:function(e,f){this.urlValid=false;var g=this.formPanel.getForm().findField(&quot;externalUrl&quot;);g.fireEvent(&quot;changeStatus&quot;,g,&quot;invalid&quot;,i18n.get(&quot;label.urlInvalid&quot;))},callback:function(f,g,e){this.saveButton.enable();this.buttonValidUrl.enable()}})}}});Ext.namespace(&quot;sitools.admin.rssFeed&quot;);sitools.admin.rssFeed.rssFeedItemProps=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,layout:&quot;fit&quot;,initComponent:function(){this.title=i18n.get(&quot;title.feedItemDetails&quot;);var a=[{fieldLabel:i18n.get(&quot;label.titleRss&quot;),name:&quot;title&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.description&quot;),name:&quot;description&quot;,anchor:&quot;100%&quot;,xtype:&quot;textarea&quot;},{fieldLabel:i18n.get(&quot;label.linkTitle&quot;),name:&quot;link&quot;,anchor:&quot;100%&quot;},{xtype:&quot;sitoolsSelectImage&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),name:&quot;image&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.authorName&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.authorEmail&quot;),name:&quot;email&quot;,anchor:&quot;100%&quot;},{xtype:&quot;compositefield&quot;,fieldLabel:i18n.get(&quot;label.updatedDate&quot;),items:[{fieldLabel:i18n.get(&quot;label.day&quot;),name:&quot;date&quot;,xtype:&quot;datefield&quot;},{name:&quot;hours&quot;,xtype:&quot;numberfield&quot;,width:48,maxValue:23,minValue:0},{xtype:&quot;displayfield&quot;,value:i18n.get(&quot;label.hours&quot;)},{name:&quot;minutes&quot;,xtype:&quot;numberfield&quot;,width:48,maxValue:59,minValue:0},{xtype:&quot;displayfield&quot;,value:i18n.get(&quot;label.minutes&quot;)},{xtype:&quot;button&quot;,name:&quot;nowUpdated&quot;,text:i18n.get(&quot;label.now&quot;),width:50,flex:0,scope:this,handler:this.nowDate}]},{xtype:&quot;compositefield&quot;,fieldLabel:i18n.get(&quot;label.publishedDate&quot;),items:[{fieldLabel:i18n.get(&quot;label.day&quot;),name:&quot;datePub&quot;,xtype:&quot;datefield&quot;,allowBlank:false},{name:&quot;hoursPub&quot;,xtype:&quot;numberfield&quot;,width:48,maxValue:23,minValue:0,allowBlank:false},{xtype:&quot;displayfield&quot;,value:i18n.get(&quot;label.hours&quot;)},{name:&quot;minutesPub&quot;,xtype:&quot;numberfield&quot;,width:48,maxValue:59,minValue:0,allowBlank:false},{xtype:&quot;displayfield&quot;,value:i18n.get(&quot;label.minutes&quot;)},{xtype:&quot;button&quot;,name:&quot;nowPublished&quot;,text:i18n.get(&quot;label.now&quot;),width:50,flex:0,scope:this,handler:this.nowDate}]}];this.formPanel=new Ext.FormPanel({labelWidth:100,defaultType:&quot;textfield&quot;,items:a,border:false,padding:10});this.items=[this.formPanel];this.buttons=[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];sitools.admin.rssFeed.rssFeedItemProps.superclass.initComponent.call(this)},afterRender:function(){sitools.admin.rssFeed.rssFeedItemProps.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var f=this.formPanel.getForm();var a=this.rec.copy();Ext.data.Record.id(a);var b=this.rec.get(&quot;updatedDate&quot;);var c=new Date(b);a.set(&quot;date&quot;,c.format(&quot;m/d/Y&quot;));a.set(&quot;hours&quot;,c.format(&quot;H&quot;));a.set(&quot;minutes&quot;,c.format(&quot;i&quot;));var d=this.rec.get(&quot;publishedDate&quot;);var g=new Date(d);a.set(&quot;datePub&quot;,g.format(&quot;m/d/Y&quot;));a.set(&quot;hoursPub&quot;,g.format(&quot;H&quot;));a.set(&quot;minutesPub&quot;,g.format(&quot;i&quot;));var e=a.get(&quot;author&quot;);if(!Ext.isEmpty(e)){a.set(&quot;name&quot;,e.name);a.set(&quot;email&quot;,e.email)}if(!Ext.isEmpty(a.get(&quot;image&quot;))){a.set(&quot;image&quot;,a.get(&quot;image&quot;).url)}f.loadRecord(a)}},onValidate:function(){var l=this.findByType(&quot;form&quot;)[0].getForm();if(!l.isValid()){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var g;if(this.action==&quot;create&quot;){g=new Ext.data.Record()}else{g=this.rec}var b=this.formPanel.getForm();if(!b.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}var c=null;var m=null;var f=null;var d=null;var n=null;var a=null;var k={};g.set(&quot;author&quot;,k);Ext.iterate(b.getValues(),function(p,s){if(p==&quot;date&quot;){f=s}else{if(p==&quot;hours&quot;){m=s}else{if(p==&quot;minutes&quot;){c=s}else{if(p==&quot;datePub&quot;){a=s}else{if(p==&quot;hoursPub&quot;){n=s}else{if(p==&quot;minutesPub&quot;){d=s}else{if(p==&quot;name&quot;||p==&quot;email&quot;){k[p]=s}else{if(p==&quot;image&quot;){if(!Ext.isEmpty(s)){var q=this.getTypeFromUrl(s);g.set(p,{url:s,type:q})}}else{g.set(p,s)}}}}}}}}},this);var e;if(f!==null&amp;&amp;f!==&quot;&quot;){if(m!==null&amp;&amp;c!==null){f+=&quot; &quot;+m+&quot;:&quot;+c}e=new Date(f);g.set(&quot;updatedDate&quot;,e)}if(a!==null&amp;&amp;a!==&quot;&quot;){if(n!==null&amp;&amp;n!==&quot;&quot;&amp;&amp;d!==null&amp;&amp;d!==&quot;&quot;){a+=&quot; &quot;+n+&quot;:&quot;+d}e=new Date(a);g.set(&quot;publishedDate&quot;,e)}if(this.action==&quot;create&quot;){this.store.add(g)}this.parent.getView().refresh();this.close()},nowDate:function(c,f){var b=new Date(),d,a;if(c.name==&quot;nowUpdated&quot;){d=this.formPanel.getForm();a=new Ext.data.Record(d.getValues());a.set(&quot;date&quot;,b.format(&quot;m/d/Y&quot;));a.set(&quot;hours&quot;,b.format(&quot;H&quot;));a.set(&quot;minutes&quot;,b.format(&quot;i&quot;));d.loadRecord(a)}if(c.name==&quot;nowPublished&quot;){d=this.formPanel.getForm();a=new Ext.data.Record(d.getValues());a.set(&quot;datePub&quot;,b.format(&quot;m/d/Y&quot;));a.set(&quot;hoursPub&quot;,b.format(&quot;H&quot;));a.set(&quot;minutesPub&quot;,b.format(&quot;i&quot;));d.loadRecord(a)}},getTypeFromUrl:function(a){var b=a.split(&quot;.&quot;);var c=b[b.length-1];switch(c.toLowerCase()){case&quot;jpg&quot;:case&quot;jpeg&quot;:case&quot;jpe&quot;:c=&quot;image/jpeg&quot;;break;case&quot;gif&quot;:case&quot;man&quot;:c=&quot;image/gif&quot;;break;case&quot;png&quot;:c=&quot;image/png&quot;;break;case&quot;tif&quot;:case&quot;tiff&quot;:c=&quot;image/tiff&quot;;break;case&quot;pbm&quot;:c=&quot;image/x-portable-bitmap&quot;;break;case&quot;pgm&quot;:c=&quot;image/x-portable-graymap&quot;;break;case&quot;ppm&quot;:c=&quot;image/x-portable-pixmap&quot;;break;default:c=null}return c}});Ext.namespace(&quot;sitools.component.projects&quot;);sitools.component.projects.rssFeedProject=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.RSSPROJECT,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.admin.rssFeed.rssFeedCrud({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;),label:i18n.get(&quot;label.selectProject&quot;),urlRef:loadUrl.get(&quot;APP_FEEDS_URL&quot;)});this.items=[a];sitools.component.projects.rssFeedProject.superclass.initComponent.call(this)}});Ext.reg(&quot;s-rssFeedProjects&quot;,sitools.component.projects.rssFeedProject);Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.rssFeedDatasets=Ext.extend(Ext.Panel,{border:false,height:300,id:ID.BOX.RSSPROJECT,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.admin.rssFeed.rssFeedCrud({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;),label:i18n.get(&quot;label.selectDatasets&quot;),urlRef:loadUrl.get(&quot;APP_FEEDS_URL&quot;)});this.items=[a];sitools.admin.datasets.rssFeedDatasets.superclass.initComponent.call(this)}});Ext.reg(&quot;s-rssFeedDatasets&quot;,sitools.admin.datasets.rssFeedDatasets);Ext.namespace(&quot;sitools.component.portal&quot;);sitools.component.portal.rssFeedPortalCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.RSSPORTAL,pageSize:10,label:i18n.get(&quot;label.selectPortal&quot;),forceFit:&quot;true&quot;,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PORTAL_URL&quot;);this.urlRef=loadUrl.get(&quot;APP_FEEDS_URL&quot;);this.httpProxyRss=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;data&quot;,proxy:this.httpProxyRss,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;title&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;link&quot;,type:&quot;string&quot;},{name:&quot;feedType&quot;,type:&quot;string&quot;},{name:&quot;visible&quot;,type:&quot;boolean&quot;},{name:&quot;feedSource&quot;,type:&quot;string&quot;},{name:&quot;externalUrl&quot;,type:&quot;string&quot;}]});var a=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.visible&quot;),dataIndex:&quot;visible&quot;,width:80});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.titleRss&quot;),dataIndex:&quot;title&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:150},{header:i18n.get(&quot;label.url&quot;),dataIndex:&quot;externalUrl&quot;,width:150},{header:i18n.get(&quot;headers.type&quot;),dataIndex:&quot;feedType&quot;,width:50},a,{header:i18n.get(&quot;headers.feedSource&quot;),dataIndex:&quot;feedSource&quot;,width:100}]});this.plugins=[a];this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.save&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:this.onSave,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.dataId=&quot;idPortal&quot;;this.loadRss();sitools.component.portal.rssFeedPortalCrud.superclass.initComponent.call(this)},loadRss:function(){var a=this.url+&quot;/&quot;+this.dataId+this.urlRef;this.httpProxyRss.setUrl(a,true);this.getStore().load({scope:this,callback:function(){this.getView().refresh()}})},onSave:function(){var c={};c.feeds=[];var b;for(b=0;b&lt;this.store.getCount();b++){var d=this.store.getAt(b).data;c.feeds.push(d)}var a=this.url+&quot;/&quot;+this.dataId+this.urlRef;Ext.Ajax.request({url:a,method:&quot;PUT&quot;,scope:this,jsonData:c,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return false}var f=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.feedsSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.store.load()}})}});Ext.reg(&quot;s-rssFeedPortal&quot;,sitools.component.portal.rssFeedPortalCrud);Ext.namespace(&quot;sitools.admin.applications.plugins&quot;);sitools.admin.applications.plugins.ApplicationPluginCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.APPLICATIONPLUGIN,pageSize:10,modify:false,urlGrid:null,conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a=&quot;&quot;;var c=d.data;if(c.classVersion!==c.currentClassVersion&amp;&amp;c.currentClassVersion!==null&amp;&amp;c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert(&quot;warning.version.conflict&quot;,&quot;Application plugin &quot;+c.name+&quot;definition (v&quot;+c.classVersion+&quot;) may conflict with current class version : &quot;+c.currentClassVersion);this.conflictWarned=true}a=&quot;red-row&quot;}return a}},initComponent:function(){this.urlAdmin=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_APPLICATIONS_URL&quot;)+&quot;/instances&quot;;this.urlList=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_APPLICATIONS_URL&quot;)+&quot;/classes&quot;;this.httpProxyForms=new Ext.data.HttpProxy({url:this.urlAdmin,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;status&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;urlAttach&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;currentClassVersion&quot;,type:&quot;string&quot;},{name:&quot;currentClassAuthor&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}],proxy:this.httpProxyForms});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.label&quot;),dataIndex:&quot;label&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.urlAttach&quot;),dataIndex:&quot;urlAttach&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.classVersion&quot;),dataIndex:&quot;classVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.currentClassVersion&quot;),dataIndex:&quot;currentClassVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.classAuthor&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:false}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this._onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this._onDisactive,xtype:&quot;s-menuButton&quot;}]};this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.applications.plugins.ApplicationPluginCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.applications.plugins.ApplicationPluginCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.applications.plugins.applicationPluginProp({action:&quot;create&quot;,parent:this,urlList:this.urlList,urlAdmin:this.urlAdmin});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(&quot;ACTIVE&quot;===b.data.status){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.wrongStatus&quot;));return}var a=new sitools.admin.applications.plugins.applicationPluginProp({action:&quot;modify&quot;,record:b,parent:this,urlList:this.urlList,urlAdmin:this.urlAdmin});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;applicationPluginCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlAdmin+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},_onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlAdmin+&quot;/&quot;+a.id+&quot;/start&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})},_onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.urlAdmin+&quot;/&quot;+a.id+&quot;/stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-Application_plugins&quot;,sitools.admin.applications.plugins.ApplicationPluginCrudPanel);Ext.namespace(&quot;sitools.admin.applications.plugins&quot;);sitools.admin.applications.plugins.applicationPluginProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,classChosen:&quot;&quot;,applicationPluginId:null,initComponent:function(){this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.createApplicationPlugin&quot;):i18n.get(&quot;label.modifyApplicationPlugin&quot;);this.crudStore=this.store;var a=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),expandOnDblClick:true});this.gridapplicationPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridapplicationPlugin&quot;,title:i18n.get(&quot;title.applicationPluginClass&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.urlList,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.className&quot;),dataIndex:&quot;className&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.filterErrorValidationNotification&quot;)}),listeners:{scope:this,rowclick:this.onClassClick},plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({padding:10,id:&quot;fieldMappingFormPanel&quot;,defaultType:&quot;textfield&quot;,title:i18n.get(&quot;title.applicationPluginDetails&quot;),items:[{fieldLabel:i18n.get(&quot;label.label&quot;),name:&quot;label&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.userAttach&quot;),name:&quot;urlAttach&quot;,anchor:&quot;100%&quot;,vtype:&quot;attachment&quot;,allowBlank:false}]});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(c,f,g,e){var b=&quot;&quot;;var d=c.get(&quot;violation&quot;);if(!Ext.isEmpty(d)){if(d.level==&quot;CRITICAL&quot;){b=&quot;red-row&quot;}else{if(d.level==&quot;WARNING&quot;){b=&quot;orange-row&quot;}}}return b},listeners:{scope:this,refresh:function(b){var d=this.gridFieldMapping;var c=d.getStore();c.each(function(l){var m=l.get(&quot;violation&quot;);if(!Ext.isEmpty(m)){var n=c.indexOf(l);var g=b.getRow(n);var p=Ext.get(g);var k=(m.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var f={html:m.message,dismissDelay:0,target:p,cls:k};var e=new Ext.ToolTip(f)}})}}},id:&quot;gridFieldMapping&quot;,layout:&quot;fit&quot;,title:i18n.get(&quot;title.parametersMapping&quot;),store:new Ext.data.JsonStore({root:&quot;ApplicationPlugin.model.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.applicationPluginErrorValidationNotification&quot;)}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:100,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),listeners:{scope:this,celldblclick:function(b,n,g,f){var k=b.getStore().getAt(n);var d=k.data;if(b.getColumnModel().getColumnHeader(g)==&quot;Value&quot;){if(d.valueType==&quot;xs:dictionary&quot;){var m=new sitools.component.dictionary.selectDictionary({field:&quot;value&quot;,record:k,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;)});m.show(ID.BOX.DATASETS)}else{if(d.valueType==&quot;xs:boolean&quot;){var q=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({field:&quot;value&quot;,record:k,parentView:this.gridFieldMapping.getView(),type:d.name,enumeration:&quot;[true,false]&quot;,value:d.value});q.show(ID.BOX.DATASETS)}else{if(d.valueType==&quot;xs:image&quot;){var p=new ImageChooser({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_UPLOAD_URL&quot;)+&quot;/?media=json&quot;,width:515,height:450,field:&quot;value&quot;,parentView:this.gridFieldMapping.getView(),record:k});p.show(document,function(s,e){e.record.data[e.field]=s.url;e.parentView.refresh()})}else{if(d.valueType.indexOf(&quot;xs:enum&quot;)!=-1){var c;if(d.valueType.indexOf(&quot;xs:enum-editable-multiple&quot;)!=-1){c=&quot;EEM&quot;}else{if(d.valueType.indexOf(&quot;xs:enum-editable&quot;)!=-1){c=&quot;EE&quot;}else{if(d.valueType.indexOf(&quot;xs:enum-multiple&quot;)!=-1){c=&quot;EM&quot;}else{c=&quot;E&quot;}}}var l=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({enumType:c,field:&quot;value&quot;,fieldEnum:&quot;valueType&quot;,record:k,parentView:this.gridFieldMapping.getView(),type:d.name,enumeration:d.valueType,value:d.value});l.show(ID.BOX.DATASETS)}}}}}else{return false}}}});this.tabPanel=new Ext.TabPanel({activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridapplicationPlugin,this.fieldMappingFormPanel,this.gridFieldMapping]:[this.fieldMappingFormPanel,this.gridFieldMapping],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(e,d,b){var c=e.body.getSize();this.tabPanel.setSize(c)}};this.items=[this.tabPanel];sitools.admin.applications.plugins.applicationPluginProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;fieldMappingFormPanel&quot;||e.id==&quot;gridFieldMapping&quot;){var c=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,g,d){if(this.action==&quot;create&quot;){var f=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!f){return false}var c=f.data.className;if(c!=this.classChosen){this.proxyFieldMapping.setUrl(this.urlList+&quot;/&quot;+c);var a=this.gridFieldMapping.getStore();this.classChosen=c;a.removeAll();a.load()}}},afterRender:function(){sitools.admin.applications.plugins.applicationPluginProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.applicationPluginId=this.record.data.id;Ext.Ajax.request({url:this.urlAdmin+&quot;/&quot;+this.applicationPluginId,method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return false}this.fillFormAndGrid(b.ApplicationPluginModel)},failure:alertFailure})}},fillFormAndGrid:function(g){var d=this.fieldMappingFormPanel.getForm();if(!Ext.isEmpty(g)){var e={};e.label=g.label;e.urlAttach=g.urlAttach;d.loadRecord(new Ext.data.Record(e));var c=g.parameters;if(!Ext.isEmpty(c)){var a=this.gridFieldMapping.getStore();for(var b=0;b&lt;c.length;b++){var f=new Ext.data.Record(c[b]);a.add(f)}}}},onValidate:function(){var e;var d={};if(this.action==&quot;create&quot;){e=this.gridapplicationPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}d.name=e.data.name;d.description=e.data.description}var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){var n=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.invalidForm&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}Ext.iterate(c.getFieldValues(),function(q,s){d[q]=s});var m=[];var g;if(this.action==&quot;create&quot;){e=this.gridapplicationPlugin.getSelectionModel().getSelected();g=e.data}else{g=this.record.data;d.id=this.applicationPluginId}d.className=g.className;d.classVersion=g.classVersion;d.classAuthor=g.classAuthor;d.classOwner=g.classOwner;var p=this.gridFieldMapping.getStore();for(var f=0;f&lt;p.getCount();f++){var l=p.getAt(f).data;l.violation=undefined;m.push(l)}d.parameters=m;var b=this.urlAdmin,a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+this.applicationPluginId;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(s){var u=Ext.decode(s.responseText);if(!u.success){if(Ext.isEmpty(u.message)){var q=u.data;this.notifyViolations(q);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),u.message)}return false}var t=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.applicationPluginSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()}});Ext.namespace(&quot;sitools.admin.storages&quot;);sitools.admin.storages.storagesCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.STORAGES,sm:new Ext.grid.RowSelectionModel(),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASTORAGE_ADMIN_URL&quot;)+&quot;/directories&quot;;this.urlAuthorizations=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_AUTHORIZATIONS_URL&quot;);this.urlFilters=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_FILTERS_CLASSES_URL&quot;);this.urlParents=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_FILTERS_INSTANCES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,url:this.url,remoteSort:true,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;localPath&quot;,type:&quot;string&quot;},{name:&quot;publicUrl&quot;,type:&quot;string&quot;},{name:&quot;attachUrl&quot;,type:&quot;string&quot;},{name:&quot;deeplyAccessible&quot;,type:&quot;boolean&quot;},{name:&quot;listingAllowed&quot;,type:&quot;boolean&quot;},{name:&quot;modifiable&quot;,type:&quot;boolean&quot;},{name:&quot;status&quot;,type:&quot;string&quot;}]});var b=new Ext.grid.CheckColumn({header:i18n.get(&quot;label.deeplyAccessible&quot;),dataIndex:&quot;deeplyAccessible&quot;,width:80,tooltip:i18n.get(&quot;label.deeplyAccessible&quot;)});var c=new Ext.grid.CheckColumn({header:i18n.get(&quot;label.listingAllowed&quot;),dataIndex:&quot;listingAllowed&quot;,width:55,tooltip:i18n.get(&quot;label.listingAllowed&quot;)});var a=new Ext.grid.CheckColumn({header:i18n.get(&quot;label.modifiable&quot;),dataIndex:&quot;modifiable&quot;,width:55,tooltip:i18n.get(&quot;label.modifiable&quot;)});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:50,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:120},{header:i18n.get(&quot;label.localPath&quot;),dataIndex:&quot;localPath&quot;,width:150},{header:i18n.get(&quot;label.attachUrl&quot;),dataIndex:&quot;attachUrl&quot;,width:150},b,c,a,{header:i18n.get(&quot;label.status&quot;),dataIndex:&quot;status&quot;,width:50}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.authorizations&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_autorizations.png&quot;,handler:this.onDefineRole,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.customfilter&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/filters.png&quot;,xtype:&quot;s-menuButton&quot;,handler:this.onDefineFilter},{text:i18n.get(&quot;label.active&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_active.png&quot;,handler:this.onActive,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.disactive&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_disactive.png&quot;,handler:this.onDisactive,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.storages.storagesCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.storages.storagesCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onDefineRole:function(){var b=this.getSelectionModel().getSelected(),a=new sitools.admin.applications.applicationsRolePanel({urlAuthorizations:this.urlAuthorizations+&quot;/&quot;+b.data.id,applicationRecord:b});if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(b.data.status==&quot;STARTED&quot;){return Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.wrongStatus&quot;))}a.show(ID.BOX.APPLICATION)},onDefineFilter:function(a,b){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.noselection&quot;))}if(c.data.status==&quot;STARTED&quot;){return Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.wrongStatus&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+c.data.id+&quot;/filter&quot;,method:&quot;GET&quot;,scope:this,success:function(e){var g=Ext.decode(e.responseText),f;if(g.success){f=&quot;editDelete&quot;}else{f=&quot;create&quot;}var k=g.filterPlugin;var d=new sitools.component.filtersPlugins.filtersPluginsSingle({action:f,parentPanel:this,urlFilters:this.urlFilters,urlParent:this.urlParents+&quot;/&quot;+c.data.id,parentType:&quot;storage&quot;,filterPlugin:k});d.show()},failure:alertFailure})},onCreate:function(){var a=new sitools.admin.storages.storagesPropPanel({url:this.url,action:&quot;create&quot;,store:this.getStore()});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.storages.storagesPropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.getStore()});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;storageCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},onActive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;?action=start&quot;,method:&quot;PUT&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})},onDisactive:function(){var a=this.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id+&quot;?action=stop&quot;,method:&quot;PUT&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-storages&quot;,sitools.admin.storages.storagesCrudPanel);Ext.namespace(&quot;sitools.admin.storages&quot;);sitools.admin.storages.storagesPropPanel=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,dataSets:&quot;&quot;,id:ID.COMPONENT_SETUP.STORAGE,initComponent:function(){if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyStorage&quot;)}if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createStorage&quot;)}this.items=[{xtype:&quot;panel&quot;,height:450,items:[{xtype:&quot;panel&quot;,height:410,title:i18n.get(&quot;label.storageInfo&quot;),items:[{xtype:&quot;form&quot;,border:false,padding:10,items:[{xtype:&quot;hidden&quot;,name:&quot;id&quot;},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,maxLength:30,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,name:&quot;localPath&quot;,fieldLabel:i18n.get(&quot;label.localPath&quot;),anchor:&quot;100%&quot;,maxLength:100},{xtype:&quot;textfield&quot;,name:&quot;attachUrl&quot;,fieldLabel:i18n.get(&quot;label.attachUrl&quot;),anchor:&quot;100%&quot;,maxLength:100,vtype:&quot;attachment&quot;,allowBlank:false},{xtype:&quot;checkbox&quot;,fieldLabel:i18n.get(&quot;label.deeplyAccessible&quot;),name:&quot;deeplyAccessible&quot;},{xtype:&quot;checkbox&quot;,fieldLabel:i18n.get(&quot;label.listingAllowed&quot;),name:&quot;listingAllowed&quot;},{xtype:&quot;checkbox&quot;,fieldLabel:i18n.get(&quot;label.modifiable&quot;),name:&quot;modifiable&quot;}]}]}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.storages.storagesPropPanel.superclass.initComponent.call(this)},onValidate:function(){var a=this.findByType(&quot;form&quot;)[0].getForm();if(!a.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}var b={};Ext.iterate(a.getFieldValues(),function(c,d){b[c]=d},this);if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.close();this.store.reload()}},failure:alertFailure})}if(this.action==&quot;create&quot;){Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,jsonData:b,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.close();this.store.reload()}},failure:alertFailure})}},onRender:function(){sitools.admin.storages.storagesPropPanel.superclass.onRender.apply(this,arguments);if(this.url){if(this.action==&quot;modify&quot;){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var d=this.findByType(&quot;form&quot;)[0].getForm();var c=Ext.decode(b.responseText).directory;var a=new Ext.data.Record(c);d.loadRecord(a)},failure:function(a){var b=Ext.decode(a.responseText);Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.errorMessage)}})}}}});Ext.reg(&quot;s-storagesprop&quot;,sitools.admin.storages.storagesPropPanel);Ext.namespace(&quot;sitools.admin.resourcesPlugins&quot;);sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel=Ext.extend(Ext.grid.GridPanel,{urlParentsParams:&quot;&quot;,border:false,height:300,pageSize:10,modify:false,urlGrid:null,conflictWarned:false,viewConfig:{forceFit:true,autoFill:true,getRowClass:function(d,b){var a=&quot;&quot;;var c=d.data;if(c.classVersion!==c.currentClassVersion&amp;&amp;c.currentClassVersion!==null&amp;&amp;c.currentClassVersion!==undefined){if(!this.conflictWarned){Ext.Msg.alert(&quot;warning.version.conflict&quot;,&quot;Resources &quot;+c.name+&quot; definition (v&quot;+c.classVersion+&quot;) may conflict with current class version : &quot;+c.currentClassVersion);this.conflictWarned=true}a=&quot;red-row&quot;}return a}},initComponent:function(){var a=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;type&quot;],url:this.urlParents+this.urlParentsParams,root:&quot;data&quot;,autoLoad:true});this.comboParents=new Ext.form.ComboBox({store:a,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.select&quot;+this.parentType+&quot;s&quot;),selectOnFocus:true,listeners:{scope:this,select:function(d,e,c){this.parentId=e.data.id;if(!Ext.isEmpty(e.data.type)){this.appClassName=e.data.type}var b=this.urlParents+&quot;/&quot;+this.parentId+this.resourcesUrlPart+this.urlParentsParams;this.httpProxyResources.setUrl(b,true);this.getStore().load()}}});this.httpProxyResources=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;descriptionAction&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;currentClassVersion&quot;,type:&quot;string&quot;},{name:&quot;currentClassAuthor&quot;,type:&quot;string&quot;},{name:&quot;resourceClassName&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;parent&quot;,type:&quot;string&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;dataSetSelection&quot;,type:&quot;string&quot;},{name:&quot;behavior&quot;,type:&quot;string&quot;}],proxy:this.httpProxyResources});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.resourceClassName&quot;),dataIndex:&quot;resourceClassName&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.classVersion&quot;),dataIndex:&quot;classVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.currentClassVersion&quot;),dataIndex:&quot;currentClassVersion&quot;,width:50,sortable:false},{header:i18n.get(&quot;label.classAuthor&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.descriptionAction&quot;),dataIndex:&quot;descriptionAction&quot;,width:200,sortable:false}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[this.comboParents,{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;}]};this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel.superclass.onRender.apply(this,arguments)},onCreate:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var b=this.urlParents+&quot;/&quot;+c;var a=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:&quot;create&quot;,parentPanel:this,urlResources:this.urlResources,urlResourcesCRUD:this.httpProxyResources.url,urlParent:b,parentType:this.parentType,appClassName:this.appClassName,idParent:c});a.show()},onModify:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var d=this.comboParents.getValue();var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}if(&quot;ACTIVE&quot;===c.data.status){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.wrongStatus&quot;));return}var b=this.urlParents+&quot;/&quot;+d;var a=new sitools.admin.resourcesPlugins.resourcesPluginsProp({action:&quot;modify&quot;,record:c,parentPanel:this,urlResources:this.urlResources,urlResourcesCRUD:this.httpProxyResources.url,urlParent:b,appClassName:this.appClassName,idParent:d,parentType:this.parentType});a.show()},onDelete:function(){if(Ext.isEmpty(this.comboParents.getValue())){return}var c=this.comboParents.getValue();var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;resourcesPlugins&quot;+this.parentType+&quot;Crud.delete&quot;),scope:this,fn:function(d,e){if(d==&quot;yes&quot;){this.doDelete(b,c)}}})},doDelete:function(a,b){Ext.Ajax.request({url:this.urlParents+&quot;/&quot;+b+this.resourcesUrlPart+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(d){var c=Ext.decode(d.responseText);if(showResponse(d)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-plugins_resources&quot;,sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel);Ext.namespace(&quot;sitools.admin.resourcesPlugins&quot;);sitools.admin.resourcesPlugins.resourcesPluginsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:true,classChosen:&quot;&quot;,resourcePluginId:null,modelClassName:null,initComponent:function(){this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.create&quot;+this.parentType+&quot;Resource&quot;):i18n.get(&quot;label.modify&quot;+this.parentType+&quot;Resource&quot;);var d=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(e){return Ext.isEmpty(e)}}),expandOnDblClick:true});this.gridresourcePlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},layout:&quot;fit&quot;,id:&quot;gridresourcePlugin&quot;,title:i18n.get(&quot;title.resourcePlugin&quot;+this.parentType+&quot;Class&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.urlResources,restful:true,method:&quot;GET&quot;}),remoteSort:false,sortInfo:{field:&quot;name&quot;,direction:&quot;ASC&quot;},idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;resourceClassName&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;},{name:&quot;applicationClassName&quot;,type:&quot;string&quot;},{name:&quot;dataSetSelection&quot;,type:&quot;string&quot;}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[d,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.resourceClassName&quot;),dataIndex:&quot;className&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:d});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});var b=new Ext.grid.CheckColumn({header:i18n.get(&quot;headers.userUpdatable&quot;),dataIndex:&quot;userUpdatable&quot;,width:55});var c=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(e){return Ext.isEmpty(e)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(f,l,m,k){var e=&quot;&quot;;var g=f.get(&quot;violation&quot;);if(!Ext.isEmpty(g)){if(g.level==&quot;CRITICAL&quot;){e=&quot;red-row&quot;}else{if(g.level==&quot;WARNING&quot;){e=&quot;orange-row&quot;}}}return e},listeners:{scope:this,refresh:function(e){var g=this.gridFieldMapping;var f=g.getStore();f.each(function(p){var q=p.get(&quot;violation&quot;);if(!Ext.isEmpty(q)){var s=f.indexOf(p);var m=e.getRow(s);var t=Ext.get(m);var n=(q.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var l={html:q.message,dismissDelay:0,target:t,cls:n};var k=new Ext.ToolTip(l)}});this.showOptions(this.gridFieldMapping)},rowupdated:function(){this.showOptions(this.gridFieldMapping)}}},id:&quot;gridFieldMapping&quot;,layout:&quot;fit&quot;,region:&quot;center&quot;,title:i18n.get(&quot;title.parametersMapping&quot;),store:new Ext.data.JsonStore({root:&quot;resourcePlugin.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;},{name:&quot;userUpdatable&quot;,type:&quot;boolean&quot;}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.resourcesPluginErrorValidationNotification&quot;)}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[c,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;type&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:230,sortable:false,editable:true,editor:new Ext.form.TextField()},b]}),listeners:{scope:this,celldblclick:function(f,s,m,l){var n=f.getStore().getAt(s);var k=n.data;if(m==3){if(k.valueType==&quot;xs:dataset.columnAlias&quot;){var t=new sitools.admin.datasets.selectColumn({field:&quot;value&quot;,record:n,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;)+&quot;/&quot;+this.idParent});t.show(ID.BOX.DATASETS)}else{if(k.valueType==&quot;xs:dictionary&quot;){var q=new sitools.component.dictionary.selectDictionary({field:&quot;value&quot;,record:n,parentStore:this.gridFieldMapping.getStore(),parentView:this.gridFieldMapping.getView(),url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;)});q.show(ID.BOX.DATASETS)}else{if(k.valueType==&quot;xs:boolean&quot;){var v=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({field:&quot;value&quot;,record:n,parentView:this.gridFieldMapping.getView(),type:k.name,enumeration:&quot;[true,false]&quot;,value:k.value});v.show(ID.BOX.DATASETS)}else{if(k.valueType==&quot;xs:image&quot;){var u=new ImageChooser({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_UPLOAD_URL&quot;)+&quot;/?media=json&quot;,width:515,height:450,field:&quot;value&quot;,parentView:this.gridFieldMapping.getView(),record:n});u.show(document,function(z,e){e.record.data[e.field]=z.url;e.parentView.refresh()})}else{if(k.valueType.indexOf(&quot;xs:enum&quot;)!=-1){var g;if(k.valueType.indexOf(&quot;xs:enum-editable-multiple&quot;)!=-1){g=&quot;EEM&quot;}else{if(k.valueType.indexOf(&quot;xs:enum-editable&quot;)!=-1){g=&quot;EE&quot;}else{if(k.valueType.indexOf(&quot;xs:enum-multiple&quot;)!=-1){g=&quot;EM&quot;}else{g=&quot;E&quot;}}}var p=new sitools.admin.resourcesPlugins.enumerationValueTypeSelector({enumType:g,field:&quot;value&quot;,fieldEnum:&quot;valueType&quot;,record:n,parentView:this.gridFieldMapping.getView(),type:k.name,enumeration:k.valueType,value:k.value});p.show(ID.BOX.DATASETS)}}}}}}else{return false}},viewready:function(e){this.showOptions(e)}},plugins:[b,c]});var a=new Ext.form.ComboBox({typeAhead:false,fieldLabel:i18n.get(&quot;label.behavior&quot;),name:&quot;behavior&quot;,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,anchor:&quot;100%&quot;,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[&quot;DISPLAY_IN_NEW_TAB&quot;,i18n.get(&quot;DISPLAY_IN_NEW_TAB&quot;)],[&quot;DISPLAY_IN_DESKTOP&quot;,i18n.get(&quot;DISPLAY_IN_DESKTOP&quot;)]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;});this.fieldMappingFormPanel=new Ext.FormPanel({height:95,frame:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.descriptionAction&quot;),name:&quot;descriptionAction&quot;,anchor:&quot;100%&quot;},a],region:&quot;north&quot;});this.fieldMappingPanel=new Ext.Panel({layout:&quot;border&quot;,id:&quot;fieldMappingPanel&quot;,title:i18n.get(&quot;title.fieldMapping&quot;),items:[this.fieldMappingFormPanel,this.gridFieldMapping],listeners:{scope:this,activate:function(){this.showOptions(this.gridFieldMapping)}}});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridresourcePlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(k,g,e){var f=k.body.getSize();this.tabPanel.setSize(f)}};this.items=[this.tabPanel];sitools.admin.resourcesPlugins.resourcesPluginsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;gridFieldMapping&quot;){var c=this.gridresourcePlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(b,k,f){if(this.action==&quot;create&quot;){var g=this.gridresourcePlugin.getSelectionModel().getSelected();if(!g){return false}var d=g.data.className;if(d!=this.classChosen){var c=this.urlResources+&quot;/&quot;+d;var a=this.gridFieldMapping.getStore();a.removeAll();Ext.Ajax.request({url:c,method:&quot;GET&quot;,scope:this,params:{appClassName:this.appClassName,parent:this.idParent},success:function(l){var m=Ext.decode(l.responseText);if(!m.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),m.message);return false}var e=m.resourcePlugin;this.fillGridAndForm(e,this.action);this.classChosen=d}})}}},afterRender:function(){sitools.admin.resourcesPlugins.resourcesPluginsProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.fillGridAndForm(this.record.data,this.action)}else{this.gridresourcePlugin.getStore().load({params:{appClassName:this.appClassName,parent:this.idParent}})}},fillGridAndForm:function(a,f){if(!Ext.isEmpty(a)){var g={};var e=this.fieldMappingFormPanel.getForm();g.name=a.name;g.descriptionAction=a.descriptionAction;g.id=a.id;g.resourceClassName=a.resourceClassName;g.behavior=a.behavior;e.loadRecord(new Ext.data.Record(g));var d=a.parameters;var b=this.gridFieldMapping.getStore();b.removeAll();if(!Ext.isEmpty(d)){for(var c=0;c&lt;d.length;c++){var k=new Ext.data.Record(d[c]);if(f==&quot;create&quot;&amp;&amp;Ext.isEmpty(d[c].value)){k.set(&quot;value&quot;,&quot;&quot;)}b.add(k)}}b.sort(&quot;name&quot;,&quot;ASC&quot;)}},onValidate:function(){var e;var d={};var t=[];var p;if(this.action==&quot;create&quot;){e=this.gridresourcePlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.record.data;d.id=this.record.data.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.classOwner=p.classOwner;d.description=p.description;d.className=p.className;d.resourceClassName=p.resourceClassName;d.parent=p.parent;d.applicationClassName=p.applicationClassName;if(!Ext.isEmpty(p.dataSetSelection)){d.dataSetSelection=p.dataSetSelection}var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}Ext.iterate(c.getValues(),function(v,z){if(!Ext.isEmpty(z)){d[v]=z}});var u=this.gridFieldMapping.getStore();var m=new RegExp(&quot;^/.*$&quot;);var l=new RegExp(&quot;^.*//.*$&quot;);var g=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`|~]+.*$&quot;);for(var f=0;f&lt;u.getCount();f++){var s=u.getAt(f).data;s.violation=undefined;if(s.type==&quot;PARAMETER_ATTACHMENT&quot;){var n=s.value;var q=m.test(n)&amp;&amp;!l.test(n)&amp;&amp;!g.test(n);if(!q){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.invalidAttachment&quot;)+&quot; : &quot;+n)}}t.push(s)}d.parameters=t;var b=this.urlResourcesCRUD,a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+d.id;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(z){var B=Ext.decode(z.responseText);if(!B.success){if(Ext.isEmpty(B.message)){var v=B.data;this.notifyViolations(v);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),B.message)}return false}var A=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.resourcePlugin&quot;+this.parentType+&quot;Saved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()},onClose:function(){},showOptions:function(d){var a,f;var b=d.getColumnModel().findColumnIndex(&quot;userUpdatable&quot;);for(var c=0;c&lt;d.getStore().getCount();c++){f=d.getStore().getAt(c);a=f.get(&quot;type&quot;)==&quot;PARAMETER_USER_INPUT&quot;;if(!a){try{d.getView().getCell(c,b).innerHTML=&quot; &quot;}catch(e){return}}}}});Ext.namespace(&quot;sitools.admin.resourcesPlugins&quot;);sitools.admin.resourcesPlugins.enumerationValueTypeSelector=Ext.extend(Ext.Window,{width:700,height:480,modal:true,pageSize:10,editable:false,initComponent:function(){this.title=i18n.get(&quot;title.select&quot;+this.type);this.editable=this.enumType==&quot;EE&quot;||this.enumType==&quot;EEM&quot;;var b=this.enumeration.split(&quot;[&quot;);b=b[1].split(&quot;]&quot;);b=b[0].split(&quot;,&quot;);this.storeEnum=new Ext.data.ArrayStore({fields:[&quot;enumValue&quot;],idIndex:0});Ext.each(b,function(e,d){this.storeEnum.add(new Ext.data.Record({enumValue:e.trim()}))},this);var a={id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),sortable:true,dataIndex:&quot;enumValue&quot;,width:250};if(this.editable){Ext.apply(a,{editor:new Ext.form.TextField({disabled:!this.editable})})}this.cmSelectColumn=new Ext.grid.ColumnModel({columns:[a]});var c={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,hidden:!this.editable,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onAddValue,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModifyValue,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteValue,xtype:&quot;s-menuButton&quot;}]};this.smSelectColumn=new Ext.grid.RowSelectionModel({singleSelect:this.enumType==&quot;E&quot;||this.enumType==&quot;EE&quot;});this.gridSelect=new Ext.grid.EditorGridPanel({tbar:c,height:380,autoScroll:true,store:this.storeEnum,cm:this.cmSelectColumn,sm:this.smSelectColumn,listeners:{scope:this,viewready:this.showSelectedRecords}});this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[this.gridSelect],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}];sitools.admin.resourcesPlugins.enumerationValueTypeSelector.superclass.initComponent.call(this)},onValidate:function(){var b=this.gridSelect.getSelectionModel().getSelections();var a=[];Ext.each(b,function(c){a.push(c.data.enumValue)});this.record.data[this.field]=a.join(&quot;|&quot;);if(this.editable){a=[];this.gridSelect.getStore().each(function(c){a.push(c.data.enumValue)});this.record.data[this.fieldEnum]=&quot;xs:enum-editable&quot;;if(this.enumType==&quot;EEM&quot;){this.record.data[this.fieldEnum]+=&quot;-multiple&quot;}this.record.data[this.fieldEnum]+=&quot;[&quot;+a.join(&quot;,&quot;)+&quot;]&quot;}this.parentView.refresh();this.close()},showSelectedRecords:function(b){var c=this.record.get(this.field);if(Ext.isEmpty(c)){return}var a=c.split(&quot;|&quot;);if(Ext.isEmpty(a)){return}Ext.each(a,function(e){var d=b.getStore().find(&quot;enumValue&quot;,e);if(d!=-1){b.getSelectionModel().selectRow(d,true)}})},onAddValue:function(){this.gridSelect.getStore().add(new (this.gridSelect.getStore().recordType));this.gridSelect.getView().refresh()},onDeleteValue:function(){var a=this.gridSelect.getSelectionModel().getSelections();if(Ext.isEmpty(a)){return}Ext.each(a,function(b){this.gridSelect.getStore().remove(b)},this);this.gridSelect.getView().refresh()}});Ext.namespace(&quot;sitools.admin.projectResources&quot;);sitools.admin.projectResources.projectResourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_URL&quot;),resourcesUrlPart:loadUrl.get(&quot;APP_RESOURCES_URL&quot;),urlResources:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_RESOURCES_URL&quot;)+&quot;/classes&quot;,parentType:&quot;project&quot;,appClassName:&quot;fr.cnes.sitools.project.ProjectApplication&quot;});this.items=[a];sitools.admin.projectResources.projectResourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg(&quot;s-project_resources&quot;,sitools.admin.projectResources.projectResourcesCrudPanel);Ext.namespace(&quot;sitools.admin.datasets.plugins&quot;);sitools.admin.datasets.plugins.resourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_URL&quot;),resourcesUrlPart:loadUrl.get(&quot;APP_RESOURCES_URL&quot;),urlResources:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_RESOURCES_URL&quot;)+&quot;/classes&quot;,parentType:&quot;dataset&quot;,appClassName:&quot;fr.cnes.sitools.dataset.DataSetApplication&quot;});this.items=[a];sitools.admin.datasets.plugins.resourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg(&quot;s-dataset_resources&quot;,sitools.admin.datasets.plugins.resourcesCrudPanel);Ext.namespace(&quot;sitools.admin.applications.plugins&quot;);sitools.admin.applications.plugins.applicationResourcesCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.admin.resourcesPlugins.resourcesPluginsCrudPanel({urlParents:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_APPLICATIONS_URL&quot;),urlParentsParams:&quot;?customizable=true&quot;,resourcesUrlPart:loadUrl.get(&quot;APP_RESOURCES_URL&quot;),urlResources:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_RESOURCES_URL&quot;)+&quot;/classes&quot;,parentType:&quot;application&quot;});this.items=[a];sitools.admin.applications.plugins.applicationResourcesCrudPanel.superclass.initComponent.call(this)}});Ext.reg(&quot;s-application_resources&quot;,sitools.admin.applications.plugins.applicationResourcesCrudPanel);Ext.namespace(&quot;sitools.component.filtersPlugins&quot;);sitools.component.filtersPlugins.filtersPluginsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,classChosen:&quot;&quot;,filterPluginId:null,modelClassName:null,initComponent:function(){this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.create&quot;+this.parentType+&quot;Filter&quot;):i18n.get(&quot;label.modify&quot;+this.parentType+&quot;Filter&quot;);var a=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(b){return Ext.isEmpty(b)}}),expandOnDblClick:true});this.gridfilterPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridfilterPlugin&quot;,title:i18n.get(&quot;title.filterPlugin&quot;+this.parentType+&quot;Class&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.urlFilters,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;filterClassName&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;className&quot;,type:&quot;string&quot;}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.filterClassName&quot;),dataIndex:&quot;filterClassName&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:a});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(c,f,g,e){var b=&quot;&quot;;var d=c.get(&quot;violation&quot;);if(!Ext.isEmpty(d)){if(d.level==&quot;CRITICAL&quot;){b=&quot;red-row&quot;}else{if(d.level==&quot;WARNING&quot;){b=&quot;orange-row&quot;}}}return b},listeners:{scope:this,refresh:function(b){var d=this.gridFieldMapping;var c=d.getStore();c.each(function(l){var m=l.get(&quot;violation&quot;);if(!Ext.isEmpty(m)){var n=c.indexOf(l);var g=b.getRow(n);var p=Ext.get(g);var k=(m.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var f={html:m.message,dismissDelay:0,target:p,cls:k};var e=new Ext.ToolTip(f)}})}}},id:&quot;gridFieldMapping&quot;,layout:&quot;fit&quot;,region:&quot;center&quot;,title:i18n.get(&quot;title.parametersMapping&quot;),store:new Ext.data.JsonStore({root:&quot;filterPlugin.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.filtersPluginErrorValidationNotification&quot;)}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:100,sortable:false},{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;type&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:230,sortable:false,editable:true,editor:new Ext.form.TextField()}]})});this.fieldMappingFormPanel=new Ext.FormPanel({height:65,frame:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.descriptionAction&quot;),name:&quot;descriptionAction&quot;,anchor:&quot;100%&quot;}],region:&quot;north&quot;});this.fieldMappingPanel=new Ext.Panel({layout:&quot;border&quot;,id:&quot;fieldMappingPanel&quot;,title:i18n.get(&quot;title.fieldMapping&quot;),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridfilterPlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.tabPanel];sitools.component.filtersPlugins.filtersPluginsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;gridFieldMapping&quot;){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(a,d,b){if(this.action==&quot;create&quot;){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){return false}this.fillGridAndForm(c.data,this.action)}},afterRender:function(){sitools.component.filtersPlugins.filtersPluginsProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.fillGridAndForm(this.record.data,this.action)}else{this.gridfilterPlugin.getStore().load()}},fillGridAndForm:function(k,e){if(!Ext.isEmpty(k)){var f={};var d=this.fieldMappingFormPanel.getForm();f.name=k.name;f.descriptionAction=k.descriptionAction;f.id=k.id;f.filterClassName=k.filterClassName;d.loadRecord(new Ext.data.Record(f));var c=k.parameters;var a=this.gridFieldMapping.getStore();a.removeAll();if(!Ext.isEmpty(c)){for(var b=0;b&lt;c.length;b++){var g=new Ext.data.Record(c[b]);if(e==&quot;create&quot;&amp;&amp;Ext.isEmpty(c[b].value)){g.set(&quot;value&quot;,&quot;&quot;)}a.add(g)}}}},onValidate:function(){var e;var d={};var t=[];var p;if(this.action==&quot;create&quot;){e=this.gridfilterPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.record.data;d.id=this.record.data.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.description=p.description;d.filterClassName=p.filterClassName;d.parent=p.parent;d.className=p.className;var c=this.fieldMappingFormPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}Ext.iterate(c.getValues(),function(v,z){if(!Ext.isEmpty(z)){d[v]=z}});var u=this.gridFieldMapping.getStore();var m=new RegExp(&quot;^/.*$&quot;);var l=new RegExp(&quot;^.*//.*$&quot;);var g=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`{}|~]+.*$&quot;);for(var f=0;f&lt;u.getCount();f++){var s=u.getAt(f).data;s.violation=undefined;if(s.type==&quot;PARAMETER_ATTACHMENT&quot;){var n=s.value;var q=m.test(n)&amp;&amp;!l.test(n)&amp;&amp;!g.test(n);if(!q){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.invalidAttachment&quot;)+&quot; : &quot;+n)}}t.push(s)}d.parameters=t;var b=this.urlParent,a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+d.id;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(z){var B=Ext.decode(z.responseText);if(!B.success){if(Ext.isEmpty(B.message)){var v=B.data;this.notifyViolations(v);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),B.message)}return false}var A=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.filterPlugin&quot;+this.parentType+&quot;Saved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()},onClose:function(){}});Ext.namespace(&quot;sitools.component.filtersPlugins&quot;);sitools.component.filtersPlugins.filtersPluginsSingle=Ext.extend(Ext.Window,{width:700,height:500,modal:true,resizable:true,classChosen:&quot;&quot;,filterPluginId:null,modelClassName:null,initComponent:function(){this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.create&quot;+this.parentType+&quot;Filter&quot;):i18n.get(&quot;label.modify&quot;+this.parentType+&quot;Filter&quot;);var b=new Ext.ux.grid.RowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:true});this.gridfilterPlugin=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridfilterPlugin&quot;,title:i18n.get(&quot;title.filterPlugin&quot;+this.parentType+&quot;Class&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.urlFilters,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;filterClassName&quot;,type:&quot;string&quot;},{name:&quot;classAuthor&quot;,type:&quot;string&quot;},{name:&quot;classVersion&quot;,type:&quot;string&quot;},{name:&quot;parameters&quot;},{name:&quot;className&quot;,type:&quot;string&quot;},{name:&quot;classOwner&quot;,type:&quot;string&quot;}]}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[b,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.filterClassName&quot;),dataIndex:&quot;filterClassName&quot;,width:300,sortable:true},{header:i18n.get(&quot;label.author&quot;),dataIndex:&quot;classAuthor&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.version&quot;),dataIndex:&quot;classVersion&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.classOwner&quot;),dataIndex:&quot;classOwner&quot;,width:100,sortable:true}]}),listeners:{scope:this,rowclick:this.onClassClick},plugins:b});this.proxyFieldMapping=new Ext.data.HttpProxy({url:&quot;/tmp&quot;,restful:true,method:&quot;GET&quot;});var a=new sitools.widget.ViolationRowExpander({tpl:new Ext.XTemplate('&lt;tpl if=&quot;this.descEmpty(description)&quot; &gt;&lt;div&gt;&lt;/div&gt;&lt;/tpl&gt;','&lt;tpl if=&quot;this.descEmpty(description) == false&quot; &gt;&lt;div class=&quot;sitoolsDescription&quot;&gt;&lt;div class=&quot;sitoolsDescriptionHeader&quot;&gt;Description :&amp;nbsp;&lt;/div&gt;&lt;p class=&quot;sitoolsDescriptionText&quot;&gt; {description} &lt;/p&gt;&lt;/div&gt;&lt;/tpl&gt;',{compiled:true,descEmpty:function(c){return Ext.isEmpty(c)}}),expandOnDblClick:false});this.gridFieldMapping=new Ext.grid.EditorGridPanel({viewConfig:{forceFit:true,scope:this,getRowClass:function(d,g,k,f){var c=&quot;&quot;;var e=d.get(&quot;violation&quot;);if(!Ext.isEmpty(e)){if(e.level==&quot;CRITICAL&quot;){c=&quot;red-row&quot;}else{if(e.level==&quot;WARNING&quot;){c=&quot;orange-row&quot;}}}return c},listeners:{scope:this,refresh:function(c){var e=this.gridFieldMapping;var d=e.getStore();d.each(function(m){var n=m.get(&quot;violation&quot;);if(!Ext.isEmpty(n)){var p=d.indexOf(m);var k=c.getRow(p);var q=Ext.get(k);var l=(n.level==&quot;CRITICAL&quot;)?&quot;x-form-invalid-tip&quot;:&quot;x-form-invalid-tip x-form-warning-tip&quot;;var g={html:n.message,dismissDelay:0,target:q,cls:l};var f=new Ext.ToolTip(g)}})}}},id:&quot;gridFieldMapping&quot;,layout:&quot;fit&quot;,region:&quot;center&quot;,title:i18n.get(&quot;title.parametersMapping&quot;),store:new Ext.data.JsonStore({root:&quot;filterPlugin.parameters&quot;,proxy:this.proxyFieldMapping,restful:true,remoteSort:false,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;type&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;valueType&quot;,type:&quot;string&quot;},{name:&quot;violation&quot;}]}),bbar:new Ext.ux.StatusBar({id:&quot;statusBar&quot;,hidden:true,iconCls:&quot;x-status-error&quot;,text:i18n.get(&quot;label.filtersPluginErrorValidationNotification&quot;)}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[a,{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.type&quot;),dataIndex:&quot;type&quot;,width:150,sortable:false},{header:i18n.get(&quot;label.value&quot;),dataIndex:&quot;value&quot;,width:230,sortable:false,editable:true,editor:new Ext.form.TextField()}]}),plugins:a});this.fieldMappingFormPanel=new Ext.FormPanel({height:65,frame:true,defaultType:&quot;textfield&quot;,items:[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;},{fieldLabel:i18n.get(&quot;label.descriptionAction&quot;),name:&quot;descriptionAction&quot;,anchor:&quot;100%&quot;}],region:&quot;north&quot;});this.fieldMappingPanel=new Ext.Panel({layout:&quot;border&quot;,id:&quot;fieldMappingPanel&quot;,title:i18n.get(&quot;title.fieldMapping&quot;),items:[this.fieldMappingFormPanel,this.gridFieldMapping]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridfilterPlugin,this.fieldMappingPanel]:[this.fieldMappingPanel],buttons:[{text:this.action==&quot;editDelete&quot;?i18n.get(&quot;label.ok&quot;):i18n.get(&quot;label.add&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.delete&quot;),scope:this,handler:this.onDelete,hidden:this.action==&quot;create&quot;},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.listeners={scope:this,resize:function(f,e,c){var d=f.body.getSize();this.tabPanel.setSize(d)}};this.items=[this.tabPanel];sitools.component.filtersPlugins.filtersPluginsSingle.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;fieldMappingPanel&quot;){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},onClassClick:function(a,d,b){if(this.action==&quot;create&quot;){var c=this.gridfilterPlugin.getSelectionModel().getSelected();if(!c){return false}this.fillGridAndForm(c.data,this.action)}},afterRender:function(){sitools.component.filtersPlugins.filtersPluginsSingle.superclass.afterRender.apply(this,arguments);if(this.action==&quot;editDelete&quot;){this.fillGridAndForm(this.filterPlugin,this.action)}else{this.gridfilterPlugin.getStore().load()}this.tabPanel.setHeight(this.body.getHeight())},fillGridAndForm:function(k,e){if(!Ext.isEmpty(k)){var f={};var d=this.fieldMappingFormPanel.getForm();f.name=k.name;f.descriptionAction=k.descriptionAction;f.id=k.id;f.filterClassName=k.filterClassName;d.loadRecord(new Ext.data.Record(f));var c=k.parameters;var a=this.gridFieldMapping.getStore();a.removeAll();if(!Ext.isEmpty(c)){for(var b=0;b&lt;c.length;b++){var g=new Ext.data.Record(c[b]);if(e==&quot;editDelete&quot;&amp;&amp;Ext.isEmpty(c[b].value)){g.set(&quot;value&quot;,&quot;&quot;)}a.add(g)}}}},onValidate:function(){var e;var d={};var t=[];var p;if(this.action==&quot;create&quot;){e=this.gridfilterPlugin.getSelectionModel().getSelected();if(!e){var k=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}p=e.data}else{p=this.filterPlugin;d.id=this.filterPlugin.id}d.classVersion=p.classVersion;d.classAuthor=p.classAuthor;d.description=p.description;d.filterClassName=p.filterClassName;d.parent=p.parent;d.className=p.className;d.classOwner=p.classOwner;var c=this.fieldMappingFormPanel.getForm();Ext.iterate(c.getValues(),function(v,z){if(!Ext.isEmpty(z)){d[v]=z}});var u=this.gridFieldMapping.getStore();var m=new RegExp(&quot;^/.*$&quot;);var l=new RegExp(&quot;^.*//.*$&quot;);var g=new RegExp(&quot;^.*[!\&quot;#$%&amp;'()*+,:;&lt;=&gt;?@\\`{}|~]+.*$&quot;);for(var f=0;f&lt;u.getCount();f++){var s=u.getAt(f).data;s.violation=undefined;if(s.type==&quot;PARAMETER_ATTACHMENT&quot;){var n=s.value;var q=m.test(n)&amp;&amp;!l.test(n)&amp;&amp;!g.test(n);if(!q){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.invalidAttachment&quot;)+&quot; : &quot;+n)}}t.push(s)}d.parameters=t;var b=this.urlParent,a;if(this.action==&quot;editDelete&quot;){b+=&quot;/filter&quot;;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(z){var B=Ext.decode(z.responseText);if(!B.success){if(Ext.isEmpty(B.message)){var v=B.data;this.notifyViolations(v);Ext.getCmp(&quot;statusBar&quot;).show()}else{Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),B.message)}return false}var A=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.filterPlugin&quot;+this.parentType+&quot;Saved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parentPanel.getStore().reload();this.close()},failure:alertFailure})},notifyViolations:function(d){for(var e=0;e&lt;d.length;e++){var c=d[e];var b=this.gridFieldMapping.getStore();var a=b.findExact(&quot;name&quot;,c.valueName);var f=b.getAt(a);f.set(&quot;violation&quot;,c)}this.gridFieldMapping.getView().refresh()},onClose:function(){},onDelete:function(){var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;filtersPlugins&quot;+this.parentType+&quot;Crud.delete&quot;),scope:this,fn:function(b,c){if(b==&quot;yes&quot;){this.doDelete()}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlParent,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.close()}},failure:alertFailure})}});Ext.namespace(&quot;sitools.component.fileEditor&quot;);sitools.component.fileEditor.ftlEditorCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILEEDITORFTL,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:15,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ADMINISTRATOR_URL&quot;);this.iconCls=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;;this.store=new Ext.data.JsonStore({root:&quot;items&quot;,restful:true,remoteSort:false,url:this.url+&quot;/ftl&quot;,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;,mapping:&quot;name&quot;},{name:&quot;url&quot;,type:&quot;string&quot;,mapping:&quot;url&quot;},{name:&quot;lastModif&quot;,type:&quot;date&quot;,mapping:&quot;lastmod&quot;,dateFormat:&quot;timestamp&quot;},{name:&quot;size&quot;,type:&quot;int&quot;,mapping:&quot;size&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:500,sortable:true},{header:i18n.get(&quot;label.size&quot;),dataIndex:&quot;size&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.lastModif&quot;),dataIndex:&quot;lastModif&quot;,width:360,sortable:true}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.fileEditor.ftlEditorCrud.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.ftlEditorCrud.superclass.onRender.apply(this,arguments);this.store.load()},onModify:function(){var c=this.getSelectionModel().getSelected();if(!c){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=c.data.name.length;var d=a-3;var b;if(c.id.substring(d,a)==&quot;txt&quot;){b=new sitools.component.fileEditor.fileEditorProp({url:this.url+&quot;/ftl/&quot;+c.id,fileName:c.id,sourceEdit:false,modalType:false,mediaType:&quot;text/plain&quot;,editable:true});b.show()}else{b=new sitools.component.fileEditor.fileEditorProp({url:this.url+&quot;/ftl/&quot;+c.id,fileName:c.id,sourceEdit:true,modalType:true,mediaType:&quot;text/freemarker&quot;,editable:false});b.show()}}});Ext.reg(&quot;s-ftlEditor&quot;,sitools.component.fileEditor.ftlEditorCrud);Ext.namespace(&quot;sitools.component.fileEditor&quot;);sitools.component.fileEditor.cssEditorCrud=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.FILEEDITORCSS,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:15,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ADMINISTRATOR_URL&quot;);this.iconCls=loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;;this.store=new Ext.data.JsonStore({root:&quot;items&quot;,restful:true,remoteSort:false,url:this.url+&quot;/css&quot;,idProperty:&quot;name&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;,mapping:&quot;name&quot;},{name:&quot;url&quot;,type:&quot;string&quot;,mapping:&quot;url&quot;},{name:&quot;lastModif&quot;,type:&quot;date&quot;,mapping:&quot;lastmod&quot;,dateFormat:&quot;timestamp&quot;},{name:&quot;size&quot;,type:&quot;int&quot;,mapping:&quot;size&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:500,sortable:true},{header:i18n.get(&quot;label.size&quot;),dataIndex:&quot;size&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.lastModif&quot;),dataIndex:&quot;lastModif&quot;,width:360,sortable:true}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;}]};this.listeners={scope:this,rowDblClick:this.onModify};sitools.component.fileEditor.cssEditorCrud.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.cssEditorCrud.superclass.onRender.apply(this,arguments);this.store.load()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.component.fileEditor.fileEditorProp({url:this.url+&quot;/css/&quot;+b.id,fileName:b.id,sourceEdit:true,modalType:true,mediaType:&quot;text/css&quot;,editable:false});a.show()}});Ext.reg(&quot;s-cssEditor&quot;,sitools.component.fileEditor.cssEditorCrud);Ext.namespace(&quot;sitools.component.fileEditor&quot;);sitools.component.fileEditor.licenceEditorProp=Ext.extend(Ext.Panel,{border:false,height:480,id:ID.BOX.FILEEDITORLICENCE,width:700,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ADMINISTRATOR_URL&quot;);this.title=i18n.get(&quot;label.modifyLicence&quot;);this.layout=&quot;fit&quot;;var a=new Ext.Toolbar({items:[&quot;-&gt;&quot;,{xtype:&quot;button&quot;,text:i18n.get(&quot;label.save&quot;),scope:this,icon:&quot;/sitools/common/res/images/icons/save.png&quot;,handler:this.onValidate}]});this.bbar=a;this.items=[{xtype:&quot;htmleditor&quot;,id:&quot;fileEditor&quot;,autoScroll:true,listeners:{afterrender:function(){this.syncValue()}}}];this.listeners={scope:this,activate:function(){this.findByType(&quot;htmleditor&quot;)[0].syncValue()}};sitools.component.fileEditor.licenceEditorProp.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.licenceEditorProp.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url+&quot;/cgu.html&quot;,method:&quot;GET&quot;,scope:this,success:function(a){var b=a.responseText;this.findByType(&quot;htmleditor&quot;)[0].setValue(b)},failure:alertFailure})}},onValidate:function(){var a=this.findByType(&quot;htmleditor&quot;)[0].getValue();Ext.Ajax.request({url:this.url+&quot;/cgu.html&quot;,method:&quot;PUT&quot;,scope:this,headers:{&quot;Content-Type&quot;:&quot;text/html&quot;},jsonData:a,success:function(c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.changeSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document)},failure:alertFailure})}});Ext.reg(&quot;s-licenceEditor&quot;,sitools.component.fileEditor.licenceEditorProp);Ext.namespace(&quot;sitools.component.fileEditor&quot;);sitools.component.fileEditor.fileEditorProp=Ext.extend(Ext.Window,{width:700,height:480,mediaType:null,initComponent:function(){this.title=i18n.get(&quot;label.modifyFile&quot;)+this.fileName;this.layout=&quot;fit&quot;;this.modal=this.modalType;var a;if(this.modal===true){a=[[{text:i18n.get(&quot;label.save&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]]}else{a=[{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]}this.items=[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,items:[{xtype:&quot;htmleditor&quot;,id:&quot;fileEditor&quot;,readOnly:this.editable,autoScroll:true,listeners:{afterrender:function(){this.syncValue();this.toggleSourceEdit(true)}}}],buttons:a}];this.listeners={scope:this,activate:function(){this.findByType(&quot;htmleditor&quot;)[0].syncValue();this.findByType(&quot;htmleditor&quot;)[0].toggleSourceEdit(true)}};sitools.component.fileEditor.fileEditorProp.superclass.initComponent.call(this)},onRender:function(){sitools.component.fileEditor.fileEditorProp.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(a){var b=a.responseText;this.findByType(&quot;htmleditor&quot;)[0].setValue(b)},failure:alertFailure})}},onValidate:function(){var a=this.findByType(&quot;htmleditor&quot;)[0].getValue();Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,headers:{&quot;Content-Type&quot;:this.mediaType},jsonData:a,success:function(c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.changeSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.close()},failure:alertFailure})}});Ext.reg(&quot;s-fileEditorProp&quot;,sitools.component.fileEditor.fileEditorProp);Ext.namespace(&quot;sitools.component.logs&quot;);sitools.component.logs.analogProp=Ext.extend(Ext.Panel,{border:false,height:480,id:&quot;analogBoxId&quot;,width:700,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ADMINISTRATOR_URL&quot;)+&quot;/plugin/analog&quot;;this.layout=&quot;fit&quot;;this.tbar=new Ext.Toolbar({items:[{xtype:&quot;button&quot;,text:i18n.get(&quot;label.logGenerate&quot;),scope:this,icon:&quot;/sitools/common/res/images/icons/tree_application_plugin.png&quot;,handler:this.refresh}]});var a={defaultSrc:this.url+&quot;?_dc=&quot;+new Date().getTime(),id:&quot;log&quot;,layout:&quot;fit&quot;,padding:10};this.panLog=new Ext.ux.ManagedIFrame.Panel(a);this.items=[this.panLog];sitools.component.logs.analogProp.superclass.initComponent.call(this)},onGenerate:function(){Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,scope:this,success:function(b){var c=Ext.decode(b.responseText);if(!c.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),c.message);return}var a=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.logsChanged&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.panLog.setSrc(this.url+&quot;?_dc=&quot;+new Date().getTime())},failure:alertFailure,callback:function(){Ext.getCmp(&quot;analogBoxId&quot;).getEl().unmask()}})},refresh:function(){var a=new Ext.LoadMask(Ext.getCmp(&quot;analogBoxId&quot;).getEl(),{msg:&quot;Generating&quot;});a.show();this.onGenerate()}});Ext.reg(&quot;s-analog&quot;,sitools.component.logs.analogProp);Ext.namespace(&quot;sitools.component.storageFilters&quot;);sitools.component.storageFilters.storageFiltersCrudPanel=Ext.extend(Ext.Panel,{border:false,height:300,layout:&quot;fit&quot;,initComponent:function(){var a=new sitools.component.filtersPlugins.filtersPluginsCrudPanel({urlParents:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASTORAGE_ADMIN_URL&quot;)+&quot;/directories&quot;,filtersUrlPart:&quot;/filters&quot;,urlFilters:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PLUGINS_FILTERS_CLASSES_URL&quot;),parentType:&quot;storage&quot;});this.items=[a];sitools.component.storageFilters.storageFiltersCrudPanel.superclass.initComponent.call(this)}});Ext.reg(&quot;s-storage_filters&quot;,sitools.component.storageFilters.storageFiltersCrudPanel);Ext.namespace(&quot;sitools.admin.units&quot;);sitools.admin.units.unitsCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.UNITS,pageSize:10,initComponent:function(){this.urlAdmin=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;);this.httpProxy=new Ext.data.HttpProxy({url:this.urlAdmin+&quot;/dimension&quot;,restful:true,method:&quot;GET&quot;});this.store=new Ext.data.JsonStore({idProperty:&quot;id&quot;,root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;dimensionHelperName&quot;,type:&quot;string&quot;},{name:&quot;unitConverters&quot;},{name:&quot;unitNames&quot;},{name:&quot;isConsistent&quot;,type:&quot;boolean&quot;}],proxy:this.httpProxy});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:200,sortable:false},{header:i18n.get(&quot;label.dimensionHelperName&quot;),dataIndex:&quot;dimensionHelperName&quot;,width:300,sortable:false},{header:i18n.get(&quot;label.isConsistent&quot;),dataIndex:&quot;isConsistent&quot;,width:100,sortable:false}]});this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this.onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,xtype:&quot;s-menuButton&quot;}]};this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.listeners={scope:this,rowDblClick:this.onModify};sitools.admin.units.unitsCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.units.unitsCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},onCreate:function(){var a=new sitools.admin.units.unitsProp({action:&quot;create&quot;,parent:this,urlAdmin:this.urlAdmin});a.show()},onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.units.unitsProp({action:&quot;modify&quot;,record:b,parent:this,urlAdmin:this.urlAdmin});a.show()},onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;unitsCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.urlAdmin+&quot;/dimension/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(c){var b=Ext.decode(c.responseText);if(showResponse(c)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-units&quot;,sitools.admin.units.unitsCrudPanel);Ext.namespace(&quot;sitools.admin.units&quot;);sitools.admin.units.unitsProp=Ext.extend(Ext.Window,{width:700,height:480,modal:true,resizable:false,classChosen:&quot;&quot;,unitsId:null,helperName:null,initComponent:function(){this.title=this.action==&quot;create&quot;?i18n.get(&quot;label.createUnits&quot;):i18n.get(&quot;label.modifyUnits&quot;);this.gridHelper=new Ext.grid.GridPanel({viewConfig:{forceFit:true},id:&quot;gridHelper&quot;,title:i18n.get(&quot;title.unitsHelperClass&quot;),store:new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,proxy:new Ext.data.HttpProxy({url:this.urlAdmin+&quot;/unithelpers&quot;,restful:true,method:&quot;GET&quot;}),remoteSort:false,idProperty:&quot;id&quot;,fields:[{name:&quot;helperName&quot;,type:&quot;string&quot;}],autoLoad:true}),cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.helperName&quot;),dataIndex:&quot;helperName&quot;,width:100,sortable:true}]})});this.formPanel=new Ext.FormPanel({padding:10,id:&quot;formPanel&quot;,defaultType:&quot;textfield&quot;,title:i18n.get(&quot;title.unitsDetails&quot;),items:[{fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;name&quot;,anchor:&quot;100%&quot;,allowBlank:false},{fieldLabel:i18n.get(&quot;label.description&quot;),name:&quot;description&quot;,anchor:&quot;100%&quot;}]});this.storeConvertersFromHelper=new Ext.data.JsonStore({root:&quot;data.converters&quot;,fields:[{name:&quot;name&quot;,type:&quot;string&quot;}]});this.cmConvertersFromHelper=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),width:500,sortable:true,dataIndex:&quot;name&quot;}]});this.gridConvertersFromHelper=new Ext.grid.GridPanel({layout:&quot;fit&quot;,store:this.storeConvertersFromHelper,cm:this.cmConvertersFromHelper,sm:new Ext.grid.RowSelectionModel({}),enableDragDrop:true,stripeRows:true,title:i18n.get(&quot;title.convertersFromHelper&quot;)});var a=new Ext.grid.ColumnModel({columns:[{id:&quot;name&quot;,header:i18n.get(&quot;headers.name&quot;),width:500,sortable:true,dataIndex:&quot;name&quot;}]});this.storeConvertersForDimension=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;}]});this.gridConverters=new Ext.grid.EditorGridPanel({layout:&quot;fit&quot;,store:this.storeConvertersForDimension,cm:a,sm:new Ext.grid.RowSelectionModel({}),autoScroll:true,enableDragDrop:true,stripeRows:true,title:i18n.get(&quot;title.convertersForDimension&quot;)});var b=new sitools.component.datasets.selectItems({grid1:this.gridConvertersFromHelper,grid2:this.gridConverters,defaultRecord:{}});this.gridChooseConverters=new Ext.Panel({title:i18n.get(&quot;label.gridConverters&quot;),layout:&quot;fit&quot;,items:[b],listeners:{scope:this,activate:function(){this.loadConverters()}}});this.gridUnit=new Ext.grid.EditorGridPanel({id:&quot;gridUnit&quot;,title:i18n.get(&quot;title.gridUnit&quot;),store:new Ext.data.JsonStore({idProperty:&quot;name&quot;,fields:[{name:&quot;label&quot;,type:&quot;string&quot;},{name:&quot;unitName&quot;,type:&quot;string&quot;}]}),tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateUnit},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteUnit}]},cm:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;label&quot;,width:250,editor:new Ext.form.TextField({allowBlank:false})},{header:i18n.get(&quot;label.unit&quot;),dataIndex:&quot;unitName&quot;,width:250,editor:new Ext.form.TextField({allowBlank:false})}],autoLoad:false}),sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.tabPanel=new Ext.TabPanel({height:450,activeTab:0,items:(this.action==&quot;create&quot;)?[this.gridHelper,this.formPanel,this.gridChooseConverters,this.gridUnit]:[this.formPanel,this.gridChooseConverters,this.gridUnit],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}],listeners:{scope:this,beforetabchange:this.beforeTabChange}});this.items=[this.tabPanel];sitools.admin.units.unitsProp.superclass.initComponent.call(this)},beforeTabChange:function(a,e,d){if(this.action==&quot;create&quot;){if(e.id==&quot;fieldMappingFormPanel&quot;||e.id==&quot;gridFieldMapping&quot;){var c=this.gridHelper.getSelectionModel().getSelected();if(!c){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}}}},afterRender:function(){sitools.admin.units.unitsProp.superclass.afterRender.apply(this,arguments);if(this.action==&quot;modify&quot;){this.unitsId=this.record.data.id;Ext.Ajax.request({url:this.urlAdmin+&quot;/dimension/&quot;+this.unitsId,method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return false}this.fillFormAndGrids(b.dimension)},failure:alertFailure})}},fillFormAndGrids:function(m){var a=this.formPanel.getForm();if(!Ext.isEmpty(m)){this.helperName=m.dimensionHelperName;var d={};d.name=m.name;d.description=m.description;a.loadRecord(new Ext.data.Record(d));var n=m.unitConverters;if(!Ext.isEmpty(n)){var l=this.gridConverters.getStore();for(var g=0;g&lt;n.length;g++){var c={};c.name=n[g];l.add(new Ext.data.Record(c))}}var k=m.sitoolsUnits;if(!Ext.isEmpty(k)){var f=this.gridUnit.getStore();for(var e=0;e&lt;k.length;e++){var b={};b.label=k[e].label;b.unitName=k[e].unitName;f.add(new Ext.data.Record(b))}}}},loadConverters:function(){var d;if(this.action==&quot;create&quot;){var a=this.gridHelper.getSelectionModel().getSelected();if(!a){var c=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}d=a.data.helperName}else{d=this.helperName}var b=this.urlAdmin+&quot;/unithelpers/&quot;+d;this.gridConvertersFromHelper.getStore().removeAll();Ext.Ajax.request({url:b,method:&quot;GET&quot;,scope:this,success:function(f){var l=Ext.decode(f.responseText);if(!l.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),l.message);return false}var m=l.dimensionHelper.converters;if(!Ext.isEmpty(m)){var e=this.gridConvertersFromHelper.getStore();for(var g=0;g&lt;m.length;g++){var k={};k.name=m[g];e.add(new Ext.data.Record(k))}}},failure:alertFailure})},onValidate:function(){var f;var d={};if(this.action==&quot;create&quot;){f=this.gridHelper.getSelectionModel().getSelected();if(!f){var g=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;warning.noselection&quot;),autoDestroy:true,hideDelay:1000}).show(document);return false}d.dimensionHelperName=f.data.helperName}else{d.id=this.unitsId;d.dimensionHelperName=this.helperName}var c=this.formPanel.getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;warning.invalidForm&quot;));return false}Ext.iterate(c.getFieldValues(),function(p,q){d[p]=q});d.unitConverters=[];var e=this.gridConverters.getStore();for(var k=0;k&lt;e.getCount();k++){var n=e.getAt(k);d.unitConverters.push(n.data.name)}d.units=[];var l=this.gridUnit.getStore();for(k=0;k&lt;l.getCount();k++){var m=l.getAt(k).data;d.units.push(m)}var b=this.urlAdmin+&quot;/dimension&quot;,a;if(this.action==&quot;modify&quot;){b+=&quot;/&quot;+this.unitsId;a=&quot;PUT&quot;}else{a=&quot;POST&quot;}Ext.Ajax.request({url:b,method:a,scope:this,jsonData:d,success:function(p){var s=Ext.decode(p.responseText);if(!s.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),s.message);return false}var q=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.unitsSaved&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.parent.getStore().reload();this.close()},failure:alertFailure})},onClose:function(){},onCreateUnit:function(){this.gridUnit.getStore().add(new Ext.data.Record())},onDeleteUnit:function(){var a=this.gridUnit;var b=a.getSelectionModel().getSelected();if(!b){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}a.getStore().remove(b)}});Ext.namespace(&quot;sitools.admin.datasets&quot;);sitools.admin.datasets.DicoMapping=Ext.extend(Ext.Window,{width:800,height:680,modal:true,resizable:true,urlDataset:null,layout:&quot;vbox&quot;,dictionaryId:null,isModified:false,urlMappingPart:&quot;/mappings&quot;,layoutConfig:{align:&quot;stretch&quot;,pack:&quot;start&quot;},initComponent:function(){this.urlDictionaries=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DICTIONARIES_URL&quot;);this.title=i18n.get(&quot;title.dicoMapping&quot;);this.urlDataset=this.url;var b=new Ext.data.JsonStore({root:&quot;dataset.columnModel&quot;,idProperty:&quot;id&quot;,remoteSort:false,url:this.urlDataset,autoLoad:true,restful:true,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;columnAlias&quot;,type:&quot;string&quot;}]});var c=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get(&quot;label.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;,sortable:true}]});this.gridDatasetColumn=new Ext.grid.GridPanel({store:b,cm:c,flex:1,title:i18n.get(&quot;label.datasetColumn&quot;),viewConfig:{forceFit:true,autoFill:true},listeners:{scope:this,mappingsSelected:function(l,k){var g=l.getSelectionModel();g.clearSelections();var f=[];Ext.each(k,function(m){f.push(l.getStore().getById(m))});g.selectRecords(f)}}});var e=new Ext.data.JsonStore({fields:[&quot;id&quot;,&quot;name&quot;,&quot;conceptTemplate&quot;],url:this.urlDictionaries,root:&quot;data&quot;,autoLoad:true});this.comboDictionaries=new Ext.form.ComboBox({store:e,displayField:&quot;name&quot;,valueField:&quot;id&quot;,typeAhead:true,mode:&quot;local&quot;,forceSelection:true,triggerAction:&quot;all&quot;,emptyText:i18n.get(&quot;label.selectDictionary&quot;),selectOnFocus:true,listeners:{scope:this,select:function(g,k,f){this.isModified=false;this.createDictionaryConceptGrid(k)}}});this.gridDictionaryConcept=new Ext.Panel({id:&quot;gridDictionaryConcept&quot;,flex:2,title:i18n.get(&quot;label.dictionaryConcepts&quot;)});this.checkboxDefaultDictionary=new Ext.form.Checkbox({name:&quot;defaultDico&quot;,boxLabel:i18n.get(&quot;label.defaultDictionary&quot;),anchor:&quot;100%&quot;,maxLength:100,disabled:this.masked});this.choicePanel=new Ext.Panel({items:[this.gridDatasetColumn,this.gridDictionaryConcept],flex:1,layout:&quot;hbox&quot;,layoutConfig:{align:&quot;stretch&quot;,pack:&quot;start&quot;},tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this,xtype:&quot;s-menuButton&quot;},items:[this.comboDictionaries,&quot;-&quot;,{xtype:&quot;tbspacer&quot;,width:&quot;5&quot;},this.checkboxDefaultDictionary,&quot;-&quot;,{text:i18n.get(&quot;label.save&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/save.png&quot;,handler:function(){this.onValidate(false)},disabled:this.masked},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDelete,disabled:this.masked}]},listeners:{scope:this,afterrender:function(){if(this.masked){this.choicePanel.body.mask()}}}});var d=new Ext.data.JsonStore({root:&quot;ColumnModel&quot;,idProperty:&quot;concatColConcept&quot;,remoteSort:false,url:this.urlConcepts,restful:true,fields:[{name:&quot;concatColConcept&quot;,type:&quot;string&quot;},{name:&quot;columnId&quot;,type:&quot;string&quot;},{name:&quot;conceptsId&quot;},{name:&quot;conceptName&quot;}]});var a=new Ext.grid.ColumnModel({defaults:{sortable:false},columns:[{header:i18n.get(&quot;label.columnAlias&quot;),dataIndex:&quot;columnId&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.conceptName&quot;),dataIndex:&quot;conceptName&quot;,width:100,sortable:true}]});this.gridMapping=new Ext.Panel({flex:1,title:i18n.get(&quot;label.mappingConceptColumn&quot;),listeners:{scope:this,afterrender:function(){if(this.masked){this.gridMapping.getEl().mask()}}}});this.items=[this.choicePanel,this.gridMapping];this.buttons=[{text:i18n.get(&quot;label.saveAndClose&quot;),scope:this,handler:this.onValidateAndQuit,disabled:this.masked},{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}];sitools.admin.datasets.DicoMapping.superclass.initComponent.call(this)},createDictionaryConceptGrid:function(c){this.dictionaryId=c.data.id;var b=c.data.conceptTemplate;this.gridDictionaryConcept=new sitools.component.dictionary.gridPanel({template:b,editable:false,url:this.urlDictionaries+&quot;/&quot;+this.dictionaryId,id:&quot;gridDictionaryConcept&quot;,sm:new Ext.grid.RowSelectionModel(),flex:2,title:i18n.get(&quot;label.dictionaryConcepts&quot;),enableColumnResize:true,listeners:{scope:this,mappingsSelected:function(f,g){var e=f.getSelectionModel();e.clearSelections();var d=[];Ext.each(g,function(k){d.push(f.getStore().getById(k))});e.selectRecords(d)}}});this.choicePanel.remove(&quot;gridDictionaryConcept&quot;);this.choicePanel.add(this.gridDictionaryConcept);var a=this.gridDictionaryConcept.getStore();a.removeAll();a.on(&quot;load&quot;,function(){this.createMappingGrid();this.loadMapping();this.doLayout()},this);a.loadConcepts()},createMappingGrid:function(){var e=this.gridDictionaryConcept.getStore();var c=e.fields;var b=[];c.each(function(l){b.push({name:l.name,type:l.type.type})});b.push({name:&quot;columnAlias&quot;,type:&quot;string&quot;});b.push({name:&quot;columnId&quot;,type:&quot;string&quot;});b.push({name:&quot;idMapping&quot;,type:&quot;string&quot;});var a=new Ext.data.JsonReader({fields:b,idProperty:&quot;idMapping&quot;});var k=new Ext.data.GroupingStore({reader:a,remoteSort:false,fields:b,sortInfo:{field:&quot;columnAlias&quot;,direction:&quot;ASC&quot;},listeners:{scope:this,add:function(m,l,n){if(this.isModified&amp;&amp;!this.comboDictionaries.disabled){this.comboDictionaries.disable()}},remove:function(m,l,n){if(this.isModified&amp;&amp;!this.comboDictionaries.disabled){this.comboDictionaries.disable()}}},groupField:&quot;columnAlias&quot;});var g=this.gridDictionaryConcept.getColumnModel().config;var f=g.clone();f.push(new Ext.grid.Column({header:i18n.get(&quot;label.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;,width:100,sortable:true,hidden:true,resizable:true}));var d=new Ext.grid.ColumnModel(f);this.remove(this.gridMapping);this.gridMapping=new Ext.grid.GridPanel({store:k,cm:d,flex:1,title:i18n.get(&quot;label.mappingConceptColumn&quot;),tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this,xtype:&quot;s-menuButton&quot;},items:[{text:i18n.get(&quot;label.map&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onAddMapping},{text:i18n.get(&quot;label.unmap&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onRemoveMapping}]},view:new Ext.grid.GroupingView({groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length &gt; 1 ? &quot;Items&quot; : &quot;Item&quot;]})',autoFill:true}),listeners:{scope:this,afterrender:function(){if(this.masked){this.gridMapping.getEl().mask()}}},sm:new Ext.grid.RowSelectionModel({listeners:{scope:this,rowselect:this.gridMappingRowSelectionModelListener,rowdeselect:this.gridMappingRowSelectionModelListener}})});this.add(this.gridMapping)},gridMappingRowSelectionModelListener:function(f,e,a){var c=f.getSelections();var b=[];var d=[];Ext.each(c,function(g){b.push(g.get(&quot;columnId&quot;));d.push(g.get(&quot;id&quot;))});this.gridDatasetColumn.fireEvent(&quot;mappingsSelected&quot;,this.gridDatasetColumn,b);this.gridDictionaryConcept.fireEvent(&quot;mappingsSelected&quot;,this.gridDictionaryConcept,d)},onValidateAndQuit:function(){this.onValidate(true)},onValidate:function(a){var b={};if(Ext.isEmpty(this.dictionaryId)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noSelection.dicoMapping&quot;));return}b.dictionaryId=this.dictionaryId;b.defaultDico=this.checkboxDefaultDictionary.getValue();b.mapping=[];var c=this.gridMapping.getStore();c.each(function(d){var e={columnId:d.get(&quot;columnId&quot;),conceptId:d.get(&quot;id&quot;)};b.mapping.push(e)});Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+&quot;/&quot;+this.dictionaryId,method:&quot;PUT&quot;,jsonData:b,scope:this,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),e.message);return}this.loadMappingData(e.dictionaryMapping);new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;dictionary.mapping.saved&quot;),autoDestroy:true,hideDelay:1000}).show(document);if(a){this.close()}},failure:alertFailure})},onDelete:function(){if(Ext.isEmpty(this.dictionaryId)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;dictionaryMapping.delete&quot;),scope:this,fn:function(a,b){if(a==&quot;yes&quot;){this.doDelete()}}})},doDelete:function(){Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+&quot;/&quot;+this.dictionaryId,method:&quot;DELETE&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;dictionary.mapping.deleted&quot;),autoDestroy:true,hideDelay:1000}).show(document);this.loadMappingData()},failure:alertFailure})},loadMapping:function(){Ext.Ajax.request({url:this.urlDataset+this.urlMappingPart+&quot;/&quot;+this.dictionaryId,method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(b.success){var c=b.dictionaryMapping;this.loadMappingData(c)}else{this.checkboxDefaultDictionary.setValue(false);return}},failure:alertFailure})},loadMappingData:function(f){var d=(f.defaultDico===true)?true:false;this.checkboxDefaultDictionary.setValue(d);this.isModified=false;this.comboDictionaries.enable();var c=this.gridDatasetColumn.getStore();var a=this.gridDictionaryConcept.getStore();var b=this.gridMapping.getStore();b.removeAll();var e=f.mapping;if(Ext.isEmpty(e)){return}Ext.each(e,function(k){var l=c.getById(k.columnId);var m=a.getById(k.conceptId);var g=l.get(&quot;columnAlias&quot;)+m.get(&quot;id&quot;);var n={idMapping:g,columnAlias:l.get(&quot;columnAlias&quot;),columnId:l.get(&quot;id&quot;)};Ext.iterate(m.data,function(p,q){n[p]=q});b.add(new Ext.data.Record(n,n.idMapping))});b.sort()},onAddMapping:function(){var a=this.gridDatasetColumn.getSelectionModel().getSelections();var c=this.gridDictionaryConcept.getSelectionModel().getSelections();var b=this.gridMapping.getStore();Ext.each(a,function(d){Ext.each(c,function(f){var e=d.get(&quot;columnAlias&quot;)+f.get(&quot;id&quot;);if(Ext.isEmpty(b.getById(e))){var g={idMapping:e,columnAlias:d.get(&quot;columnAlias&quot;),columnId:d.get(&quot;id&quot;)};Ext.iterate(f.data,function(k,l){g[k]=l});this.isModified=true;b.add(new Ext.data.Record(g,g.idMapping))}},this)},this);if(this.isModified){b.sort()}},onRemoveMapping:function(){var a=this.gridMapping;var b=a.getSelectionModel().getSelections();if(b.length===0){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}this.isModified=true;a.getStore().remove(b);this.gridDatasetColumn.getSelectionModel().clearSelections();this.gridDictionaryConcept.getSelectionModel().clearSelections();a.getStore().sort()}});Ext.reg(&quot;s-DicoMapping&quot;,sitools.admin.datasets.DicoMapping);Ext.namespace(&quot;sitools.component.dictionary.gridPanel&quot;);sitools.component.dictionary.gridPanel=Ext.extend(Ext.grid.EditorGridPanel,{template:null,initComponent:function(){this.store=this.getStoreConcepts(this.template,this.url);this.cm=this.getColumnModelConcepts(this.template,this.editable);sitools.component.dictionary.gridPanel.superclass.initComponent.call(this)},getStoreConcepts:function(e,c){var a=[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}];for(var d=0;d&lt;e.properties.length;d++){var f=e.properties[d];a.push({name:f.name,type:&quot;string&quot;})}var b=new Ext.data.JsonStore({idProperty:&quot;id&quot;,fields:a,url:c,loadConcepts:function(g){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(m){var q=Ext.decode(m.responseText).dictionary;var t=0;if(!Ext.isEmpty(q.concepts)){for(d=0;d&lt;q.concepts.length;d++){t++;var k=q.concepts[d];var n={id:k.id,name:k.name,description:k.description};for(var l=0;l&lt;k.properties.length;l++){var p=k.properties[l];n[p.name]=p.value}var s=new Ext.data.Record(n,n.id);this.add(s)}}this.fireEvent(&quot;load&quot;,this)},failure:alertFailure})}});return b},getColumnModelConcepts:function(e,d){var c=[];c.push(this.createColumn(i18n.get(&quot;headers.name&quot;),&quot;name&quot;,100,d,false));c.push(this.createColumn(i18n.get(&quot;headers.description&quot;),&quot;description&quot;,120,d,true));for(var b=0;b&lt;e.properties.length;b++){var f=e.properties[b];c.push(this.createColumn(f.name,f.name,80,d,true))}var a=new Ext.grid.ColumnModel({columns:c,defaults:{sortable:true,width:100,editor:new Ext.form.TextField({allowBlank:false})}});return a},createColumn:function(f,c,e,b,a){var d={header:f,dataIndex:c,width:e,editor:(b===true)?(new Ext.form.TextField({allowBlank:a})):null};return d},getProxy:function(){return this.proxyGrid}});Ext.namespace(&quot;sitools.admin.projects.modules&quot;);sitools.admin.projects.modules.ProjectModulePropPanel=Ext.extend(Ext.Window,{width:700,height:540,modal:true,id:ID.PROP.PROJECTMODULE,layout:&quot;fit&quot;,initComponent:function(){if(this.action==&quot;create&quot;){this.title=i18n.get(&quot;label.createProjectModule&quot;)}else{if(this.action==&quot;modify&quot;){this.title=i18n.get(&quot;label.modifyProjectModule&quot;)}}var a=new Ext.data.JsonStore({fields:[{name:&quot;url&quot;,type:&quot;string&quot;}],autoLoad:false});var b={xtype:&quot;sitools.widget.GridSorterToolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this.onCreateDependencies},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this.onDeleteDependencies}]};this.gridDependencies=new Ext.grid.EditorGridPanel({title:i18n.get(&quot;title.dependencies&quot;),height:180,store:a,tbar:b,cm:new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;label.url&quot;),dataIndex:&quot;url&quot;,editor:new Ext.form.TextField({allowBlank:false})}]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true}});this.formPanel=new Ext.form.FormPanel({title:i18n.get(&quot;label.projectModuleInfo&quot;),border:false,labelWidth:150,padding:10,items:[{xtype:&quot;textfield&quot;,name:&quot;id&quot;,hidden:true},{xtype:&quot;textfield&quot;,name:&quot;name&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;description&quot;,fieldLabel:i18n.get(&quot;label.description&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;author&quot;,fieldLabel:i18n.get(&quot;label.author&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;textfield&quot;,name:&quot;version&quot;,fieldLabel:i18n.get(&quot;label.version&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;imagePath&quot;,fieldLabel:i18n.get(&quot;label.image&quot;),anchor:&quot;100%&quot;,allowBlank:true,vtype:&quot;image&quot;},{xtype:&quot;textfield&quot;,name:&quot;title&quot;,fieldLabel:i18n.get(&quot;label.form.title&quot;),anchor:&quot;100%&quot;,allowBlank:true},{xtype:&quot;numberfield&quot;,name:&quot;defaultWidth&quot;,fieldLabel:i18n.get(&quot;label.width&quot;),anchor:&quot;100%&quot;,allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:&quot;numberfield&quot;,name:&quot;defaultHeight&quot;,fieldLabel:i18n.get(&quot;label.height&quot;),anchor:&quot;100%&quot;,allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:&quot;sitoolsSelectImage&quot;,name:&quot;icon&quot;,fieldLabel:i18n.get(&quot;label.icon&quot;),anchor:&quot;100%&quot;,allowBlank:true},{xtype:&quot;textfield&quot;,name:&quot;specificType&quot;,fieldLabel:i18n.get(&quot;label.specificType&quot;),anchor:&quot;100%&quot;,allowBlank:true},{xtype:&quot;numberfield&quot;,name:&quot;x&quot;,fieldLabel:i18n.get(&quot;label.x&quot;),anchor:&quot;100%&quot;,allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:&quot;numberfield&quot;,name:&quot;y&quot;,fieldLabel:i18n.get(&quot;label.y&quot;),anchor:&quot;100%&quot;,allowBlank:false,allowDecimals:false,allowNegative:false},{xtype:&quot;textfield&quot;,name:&quot;xtype&quot;,fieldLabel:i18n.get(&quot;label.xtype&quot;),anchor:&quot;100%&quot;,allowBlank:false},{xtype:&quot;spinnerfield&quot;,name:&quot;priority&quot;,id:&quot;priorityId&quot;,fieldLabel:i18n.get(&quot;label.priority&quot;),minValue:0,maxValue:10,allowDecimals:false,incrementValue:1,accelerate:true,anchor:&quot;50%&quot;,allowBlank:false}]});this.tabPanel=new Ext.TabPanel({activeTab:0,items:[this.formPanel,this.gridDependencies],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this._onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});this.items=[this.tabPanel];sitools.admin.projects.modules.ProjectModulePropPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.modules.ProjectModulePropPanel.superclass.onRender.apply(this,arguments);if(this.action==&quot;modify&quot;){var a=this.findByType(&quot;form&quot;)[0].getForm();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(b){var e=Ext.decode(b.responseText);a.setValues(e.projectModule);var d=e.projectModule.dependencies;var c=this.gridDependencies.getStore();if(!Ext.isEmpty(d.js)){Ext.each(d.js,function(f){c.add(new Ext.data.Record(f))},this)}if(!Ext.isEmpty(d.css)){Ext.each(d.css,function(f){c.add(new Ext.data.Record(f))},this)}},failure:alertFailure})}},_onValidate:function(){var c=this.findByType(&quot;form&quot;)[0].getForm();if(!c.isValid()){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.invalidForm&quot;));return}var a=this.action==&quot;modify&quot;?&quot;PUT&quot;:&quot;POST&quot;;var b=c.getFieldValues();b.dependencies={};b.dependencies.js=[];b.dependencies.css=[];this.gridDependencies.getStore().each(function(d){if(!Ext.isEmpty(d.data.url)){if(d.data.url.indexOf(&quot;.css&quot;)!=-1){b.dependencies.css.push({url:d.data.url})}if(d.data.url.indexOf(&quot;.js&quot;)!=-1){b.dependencies.js.push({url:d.data.url})}}});Ext.Ajax.request({url:this.url,method:a,scope:this,jsonData:b,success:function(d){var e=Ext.decode(d.responseText);if(!e.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(e.message));return false}this.store.reload();this.close()},failure:alertFailure})},onCreateDependencies:function(){var a=new Ext.data.Record();this.gridDependencies.getStore().insert(this.gridDependencies.getStore().getCount(),a)},onDeleteDependencies:function(){var b=this.gridDependencies.getSelectionModel().getSelections();var a,c;for(a=0;b[a];a++){c=b[a];this.gridDependencies.getStore().remove(c)}}});Ext.reg(&quot;s-projectmoduleprop&quot;,sitools.admin.projects.modules.ProjectModulePropPanel);Ext.namespace(&quot;sitools.admin.projects.modules&quot;);sitools.admin.projects.modules.ProjectModulesCrudPanel=Ext.extend(Ext.grid.GridPanel,{border:false,height:300,id:ID.BOX.PROJECTMODULE,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),pageSize:10,initComponent:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PROJECTS_MODULES_URL&quot;);this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,remoteSort:true,autoSave:false,url:this.url,idProperty:&quot;id&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;author&quot;,type:&quot;string&quot;},{name:&quot;version&quot;,type:&quot;string&quot;},{name:&quot;url&quot;,type:&quot;string&quot;},{name:&quot;imagePath&quot;,type:&quot;string&quot;},{name:&quot;defaultWidth&quot;,type:&quot;string&quot;},{name:&quot;defaultHeight&quot;,type:&quot;string&quot;},{name:&quot;x&quot;,type:&quot;string&quot;},{name:&quot;y&quot;,type:&quot;string&quot;},{name:&quot;xtype&quot;,type:&quot;string&quot;},{name:&quot;specificType&quot;,type:&quot;string&quot;},{name:&quot;dependencies&quot;,type:&quot;string&quot;},{name:&quot;priority&quot;,type:&quot;integer&quot;}]});this.cm=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;,width:150,sortable:true},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;,width:300,sortable:false},{header:i18n.get(&quot;label.xtype&quot;),dataIndex:&quot;xtype&quot;,width:350,sortable:false}]});this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)};this.tbar={xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.create&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.modify&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_edit.png&quot;,handler:this._onModify,xtype:&quot;s-menuButton&quot;},{text:i18n.get(&quot;label.delete&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete,xtype:&quot;s-menuButton&quot;},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]};this.view=new Ext.grid.GridView({forceFit:true});this.listeners={scope:this,rowDblClick:this._onModify};sitools.admin.projects.modules.ProjectModulesCrudPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.projects.modules.ProjectModulesCrudPanel.superclass.onRender.apply(this,arguments);this.store.load({params:{start:0,limit:this.pageSize}})},_onCreate:function(){var a=new sitools.admin.projects.modules.ProjectModulePropPanel({url:this.url,action:&quot;create&quot;,store:this.store});a.show(ID.PROP.PROJECTMODULE)},_onModify:function(){var b=this.getSelectionModel().getSelected();if(!b){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}var a=new sitools.admin.projects.modules.ProjectModulePropPanel({url:this.url+&quot;/&quot;+b.id,action:&quot;modify&quot;,store:this.store});a.show(ID.PROP.PROJECTMODULE)},_onDelete:function(){var b=this.getSelectionModel().getSelected();if(!b){return false}var a=Ext.Msg.show({title:i18n.get(&quot;label.delete&quot;),buttons:Ext.Msg.YESNO,msg:i18n.get(&quot;projectModulesCrud.delete&quot;),scope:this,fn:function(c,d){if(c==&quot;yes&quot;){this.doDelete(b)}}})},doDelete:function(a){Ext.Ajax.request({url:this.url+&quot;/&quot;+a.id,method:&quot;DELETE&quot;,scope:this,success:function(b){if(showResponse(b)){this.store.reload()}},failure:alertFailure})}});Ext.reg(&quot;s-projectmodule&quot;,sitools.admin.projects.modules.ProjectModulesCrudPanel);Ext.namespace(&quot;sitools.admin.usergroups&quot;);sitools.admin.usergroups.RolesPanel=Ext.extend(Ext.Window,{width:350,modal:true,closable:false,pageSize:10,initComponent:function(){this.store=new Ext.data.JsonStore({root:&quot;data&quot;,restful:true,autoSave:false,idProperty:&quot;name&quot;,url:this.url,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;}]});this.grid=new Ext.grid.GridPanel({xtype:&quot;grid&quot;,sm:new Ext.grid.RowSelectionModel(),store:this.store,height:200,columns:[{header:i18n.get(&quot;label.name&quot;),dataIndex:&quot;name&quot;},{header:i18n.get(&quot;label.description&quot;),dataIndex:&quot;description&quot;}],bbar:{xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;)}});this.items=[{xtype:&quot;panel&quot;,title:this.mode==&quot;list&quot;?i18n.get(&quot;label.roles&quot;):i18n.get(&quot;label.selectRoles&quot;),items:[this.grid],tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[{text:i18n.get(&quot;label.add&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_create.png&quot;,handler:this._onCreate},{text:i18n.get(&quot;label.remove&quot;),hidden:this.mode==&quot;select&quot;,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_delete.png&quot;,handler:this._onDelete},&quot;-&gt;&quot;,{xtype:&quot;s-filter&quot;,hidden:this.mode==&quot;list&quot;,emptyText:i18n.get(&quot;label.search&quot;),store:this.store,pageSize:this.pageSize}]},bbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this},items:[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.add&quot;),handler:this._onAdd,hidden:this.mode==&quot;list&quot;},{text:i18n.get(&quot;label.ok&quot;),handler:this._onOK,hidden:this.mode==&quot;select&quot;},{text:i18n.get(&quot;label.cancel&quot;),handler:this._onCancel}]}}];sitools.admin.usergroups.RolesPanel.superclass.initComponent.call(this)},onRender:function(){sitools.admin.usergroups.RolesPanel.superclass.onRender.apply(this,arguments);if(this.mode==&quot;select&quot;){this.store.load({scope:this,params:{start:0,limit:this.pageSize},callback:function(b,a,c){if(!c){this.close();Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.loadError&quot;))}}})}else{Ext.each(this.rec.data.listRoles,function(b){var a=new Ext.data.Record(b);this.store.add(a)},this)}},_onCreate:function(){var a=new sitools.admin.usergroups.RolesPanel({mode:&quot;select&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_SECURITY_URL&quot;)+&quot;/roles?media=json&quot;,storeref:this.store});a.show(this)},_onDelete:function(){var a=this.grid.getSelectionModel().getSelected();if(!a){return Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;))}this.store.remove(a)},_onAdd:function(){var a=this.grid.getSelectionModel().getSelections();var b=[];Ext.each(a,function(c){b.push(new this.store.recordType({name:c.data.name,description:c.data.description}))});this.storeref.add(b);this.close()},_onOK:function(){var a=[];this.store.each(function(b){var c={id:b.data.id,name:b.data.name,description:b.data.description};a.push(c)});this.rec.set(&quot;listRoles&quot;,a);this.close()},_onCancel:function(){this.destroy()}});Ext.reg(&quot;s-roles&quot;,sitools.admin.usergroups.RolesPanel);</pre>
</body>
</html>
