<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.namespace(&quot;sitools.env&quot;);var userPreferences=null;var userLogin=null;var sql2ext={map:[],load:function(a){var b=this;Ext.Ajax.request({method:&quot;GET&quot;,url:a,success:function(d,e){ann(d.responseText,&quot;no response is sent&quot;);b.map=b.transformsPropertiesToMap(d.responseText)},failure:function(d,e){alert(&quot;Error! Can't read i18n file with url :&quot;+a)}})},transformsPropertiesToMap:function(l){var m=l.split(&quot;\n&quot;);var k=[];var e;for(e=0;e&lt;m.length;e++){var a=m[e];var d=a.indexOf(&quot;=&quot;);if(d&gt;=1){var b=a.substring(0,d).replace(&quot;\r&quot;,&quot;&quot;);var g=a.substring(d+1).replace(&quot;\r&quot;,&quot;&quot;);k[b]=g}}return k},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:&quot;auto&quot;}};var i18n={map:[],load:function(a,d){var b=this;Ext.Ajax.request({method:&quot;GET&quot;,url:a,success:function(e,g){ann(e.responseText,&quot;no response is sent&quot;);b.map=b.transformsPropertiesToMap(e.responseText);if(Ext.isFunction(d)){d()}},failure:function(e,g){alert(&quot;Error! Can't read i18n file with url :&quot;+a)}})},transformsPropertiesToMap:function(l){var m=l.split(&quot;\n&quot;);var k=[];var e;for(e=0;e&lt;m.length;e++){var a=m[e];var d=a.indexOf(&quot;=&quot;);if(d&gt;=1){var b=a.substring(0,d).replace(&quot;\r&quot;,&quot;&quot;);var g=a.substring(d+1).replace(&quot;\r&quot;,&quot;&quot;);k[b]=g}}return k},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:&quot;GET&quot;,url:b,success:function(d,e){a(Ext.decode(d.responseText))},failure:function(d,e){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+b)}});return this.ret}};var projectGlobal={projectId:null,projectName:null,preferences:null,userRoles:null,isAdmin:false,sitoolsAttachementForUsers:null,modules:null,callback:function(){},initProject:function(a){this.callback=a;this.projectName=this.getProjectName();this.getDataViewsDependencies()},getDataViewsDependencies:function(){Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DATASETS_VIEWS_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{var d=b.data;Ext.each(d,function(e){includeJs(e.fileUrl)})}},callback:function(){this.getFormDependencies()}})},getFormDependencies:function(){Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_FORMCOMPONENTS_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{var d=b.data;Ext.each(d,function(e){includeJs(e.fileUrlUser)})}},callback:function(){this.projectName=this.getProjectInfo()}})},getUserRoles:function(a){if(Ext.isEmpty(userLogin)){a.call()}else{Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_USER_ROLE_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{var b=g.user;this.userRoles=b.roles;for(var d=0;d&lt;this.userRoles.length;d++){var k=this.userRoles[d];if(k.name==&quot;Administrator&quot;){this.isAdmin=true}}}},callback:a})}},getProjectName:function(){if(this.projectName===null){var b=document.location.pathname;var g=b.split(&quot;/&quot;);var d=0,a;var e=false;while(d&lt;g.length&amp;&amp;!e){if(g[d]==&quot;project-index.html&quot;){e=true;a=d}d++}this.projectName=g[a-1];if(this.projectName===undefined||this.projectName===&quot;&quot;){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProject&quot;))}}return this.projectName},getProjectInfo:function(){Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PORTAL_URL&quot;)+&quot;/projects/&quot;+this.projectName,method:&quot;GET&quot;,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProjectName&quot;));return false}else{this.modules=b.project.modules;this.sitoolsAttachementForUsers=b.project.sitoolsAttachementForUsers;this.projectId=b.project.id;this.projectName=b.project.name}var d=Ext.get(&quot;toppanel&quot;);d.update(Ext.util.Format.htmlDecode(b.project.htmlHeader));this.getPreferences()},failure:function(){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noProject&quot;))}})},getPreferences:function(){if(!Ext.isEmpty(userLogin)){var a=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+a+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+this.projectName+&quot;/desktop?media=json&quot;,method:&quot;GET&quot;,scope:this,success:function(b){try{this.preferences=Ext.decode(b.responseText);this.callback.call()}catch(d){this.callback.call()}},failure:function(b){this.getPublicPreferences()}})}else{this.getPublicPreferences()}},getPublicPreferences:function(){var a=loadUrl.get(&quot;APP_PUBLIC_STORAGE_URL&quot;);Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+a+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+this.projectName+&quot;/desktop?media=json&quot;,method:&quot;GET&quot;,scope:this,success:function(b){try{this.preferences=Ext.decode(b.responseText)}catch(d){this.preferences=null}},callback:this.callback})}};userLogin=Ext.util.Cookies.get(&quot;userLogin&quot;);var userStorage={set:function(a,d,b,e){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,params:{filepath:d,filename:a},jsonData:b,success:function(k){var g=Ext.decode(k.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return}else{var l=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:g.message,autoDestroy:true,hideDelay:1000});l.show(document)}},failure:function(){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.warning.savepreference.error&quot;));return},callback:function(){if(!Ext.isEmpty(e)){e.call()}}})},get:function(a,b){Ext.Ajax.request({url:this.url+&quot;/?media=json&quot;,method:&quot;GET&quot;,scope:this,params:{filepath:b,filename:a},success:function(e){try{alert(&quot;success&quot;);var d=Ext.decode(e.responseText);return d}catch(g){alert(g)}},failure:function(d){return null}})}};var publicStorage={set:function(a,d,b,e){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PUBLIC_STORAGE_URL&quot;);Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,scope:this,params:{filepath:d,filename:a},jsonData:b,success:function(k){var g=Ext.decode(k.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return}else{var l=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:g.message,autoDestroy:true,hideDelay:1000});l.show(document)}},failure:function(){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.warning.savepreference.error&quot;));return},callback:function(){if(!Ext.isEmpty(e)){e.call()}}})},get:function(a,b){Ext.Ajax.request({url:this.url+&quot;/?media=json&quot;,method:&quot;GET&quot;,scope:this,params:{filepath:b,filename:a},success:function(e){try{var d=Ext.decode(e.responseText);return d}catch(g){alert(g)}},failure:function(d){return null}})},remove:function(){this.url=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PUBLIC_STORAGE_URL&quot;)+&quot;?recursive=true&quot;;Ext.Ajax.request({url:this.url,method:&quot;DELETE&quot;,scope:this,success:function(a){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.publicUserPrefDeleted&quot;),autoDestroy:true,hideDelay:1000});b.show(document)},failure:function(a){if(a.status==404){var b=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.publicUserPrefDeleted&quot;),autoDestroy:true,hideDelay:1000});b.show(document)}else{var d=new Ext.ux.Notification({iconCls:&quot;x-icon-error&quot;,title:i18n.get(&quot;label.error&quot;),html:a.responseText,autoDestroy:true,hideDelay:1000});d.show(document)}}})}};function showResponse(b,g){try{var a=Ext.decode(b.responseText);if(!a.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a.message);return false}if(g){var d=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:a.message,autoDestroy:true,hideDelay:1000});d.show(document)}return true}catch(e){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.javascriptError&quot;)+&quot; : &quot;+e);return false}}var commonTreeUtils={addShowData:function(a,b){a.appendChild({id:&quot;nodedata&quot;+b.id,text:i18n.get(&quot;label.dataTitle&quot;),winTitle:i18n.get(&quot;label.dataTitle&quot;)+&quot; : &quot;+b.name,leaf:true,type:&quot;data&quot;,datasetId:b.id,columnModel:b.columnModel,datasetName:b.name,datasetDescription:b.description,dataUrl:b.sitoolsAttachementForUsers,dictionaryMappings:b.dictionaryMappings,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_datasets.png&quot;,datasetView:b.datasetView,datasetViewConfig:b.datasetViewConfig})},addShowDefinition:function(a,b){a.appendChild({text:i18n.get(&quot;label.definitionTitle&quot;),winTitle:i18n.get(&quot;label.definitionTitle&quot;)+&quot; : &quot;+b.name,leaf:true,type:&quot;defi&quot;,datasetId:b.id,columnModel:b.columnModel,datasetName:b.name,dictionaryMappings:b.dictionaryMappings,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_dictionary.png&quot;})},addOpensearch:function(a,b){a.appendChild({text:i18n.get(&quot;label.opensearch&quot;),winTitle:i18n.get(&quot;label.opensearch&quot;)+&quot; : &quot;+b.name,leaf:true,type:&quot;openSearch&quot;,datasetId:b.id,columnModel:b.columnModel,datasetName:b.name,dataUrl:b.sitoolsAttachementForUsers,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_open_search.png&quot;})},addForm:function(a,b){a.appendChild({text:i18n.get(&quot;label.forms&quot;),leaf:false,children:[{leaf:true}],datasetId:b.id,columnModel:b.columnModel,datasetName:b.name,listeners:{scope:this,beforeexpand:function(e){var d=new Ext.data.Connection();d.request({url:b.sitoolsAttachementForUsers+&quot;/forms?media=json&quot;,success:function(k){e.removeAll(true);var g=Ext.decode(k.responseText);if(!g.success){Ext.msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return}Ext.each(g.data,function(l){e.appendChild({leaf:true,winTitle:i18n.get(&quot;label.forms&quot;)+&quot; : &quot;+b.name+&quot;.&quot;+l.name,datasetId:b.id,columnModel:b.columnModel,datasetName:b.name,dataUrl:b.sitoolsAttachementForUsers,type:&quot;form&quot;,text:l.name,formId:l.id,formName:l.name,formParameters:l.parameters,formWidth:l.width,formHeight:l.height,formCss:l.css,node:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_forms.png&quot;,datasetView:b.datasetView})})}})}}})},addFeeds:function(a,b){a.appendChild({text:i18n.get(&quot;label.feeds&quot;),leaf:false,children:[{leaf:true}],datasetId:b.id,datasetName:b.name,listeners:{scope:this,beforeexpand:function(e){var d=new Ext.data.Connection();d.request({url:b.sitoolsAttachementForUsers+&quot;/feeds?media=json&quot;,success:function(k){e.removeAll(true);var g=Ext.decode(k.responseText);if(!g.success){Ext.msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return}Ext.each(g.data,function(l){e.appendChild({leaf:true,winTitle:i18n.get(&quot;label.feeds&quot;)+&quot; : &quot;+b.name+&quot;.&quot;+l.title,type:&quot;feeds&quot;,text:l.name,datasetId:b.id,feedId:l.name,dataUrl:b.sitoolsAttachementForUsers,feedType:l.feedType,feedSource:l.feedSource,datasetName:b.name,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/rss.png&quot;})})}})}}})},treeAction:function(node){var desktop=getDesktop();var win=desktop.getWindow(&quot;wind&quot;+node.id);if(!win){var componentCfg,javascriptObject;var windowConfig={title:node.attributes.winTitle,datasetName:node.attributes.datasetName,datasetDescription:node.attributes.datasetDescription,type:node.attributes.type,saveToolbar:true,toolbarItems:[]};if(node.attributes.type==&quot;data&quot;){javascriptObject=eval(node.attributes.datasetView.jsObject);componentCfg={dataUrl:node.attributes.dataUrl,datasetId:node.attributes.datasetId,datasetCm:node.attributes.columnModel,datasetName:node.attributes.datasetName,dictionaryMappings:node.attributes.dictionaryMappings,datasetViewConfig:node.attributes.datasetViewConfig}}if(node.attributes.type==&quot;defi&quot;){javascriptObject=sitools.user.component.columnsDefinition;Ext.apply(windowConfig,{id:node.attributes.type+node.attributes.datasetId});componentCfg={datasetId:node.attributes.datasetId,datasetCm:node.attributes.columnModel,datasetName:node.attributes.datasetName,dictionaryMappings:node.attributes.dictionaryMappings}}if(node.attributes.type==&quot;openSearch&quot;){javascriptObject=sitools.user.component.datasetOpensearch;Ext.apply(windowConfig,{id:node.attributes.type+node.attributes.datasetId});componentCfg={datasetId:node.attributes.datasetId,dataUrl:node.attributes.dataUrl,datasetName:node.attributes.datasetName}}if(node.attributes.type==&quot;form&quot;){javascriptObject=sitools.user.component.forms;Ext.apply(windowConfig,{id:node.attributes.type+node.attributes.datasetId+node.attributes.formId});componentCfg={dataUrl:node.attributes.dataUrl,formId:node.attributes.formId,formName:node.attributes.formName,formParameters:node.attributes.formParameters,formWidth:node.attributes.formWidth,formHeight:node.attributes.formHeight,formCss:node.attributes.formCss}}if(node.attributes.type==&quot;feeds&quot;){javascriptObject=sitools.widget.FeedGridFlux;var url=node.attributes.dataUrl+&quot;/clientFeeds/&quot;+node.attributes.feedId;Ext.apply(windowConfig,{id:node.attributes.type+node.attributes.datasetId+node.attributes.feedId});componentCfg={datasetId:node.attributes.datasetId,urlFeed:url,feedType:node.attributes.feedType,datasetName:node.attributes.datasetName,feedSource:node.attributes.feedSource,autoLoad:true}}SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)}else{win.toFront()}}};
/*!
 * Ext JS Library 3.0+
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
var DEFAULT_NATIVEJSON=false;var DEFAULT_TIMEOUT=30000;var DEFAULT_TIMEBUF=10;var DEFAULT_NBRETRY=0;var SERVER_OK=200;var DEFAULT_WIN_HEIGHT=400;var DEFAULT_WIN_WIDTH=600;var DEFAULT_WINORDER_WIDTH=400;var DEFAULT_ORDER_FOLDER=&quot;dataSelection&quot;;var DEFAULT_PREFERENCES_FOLDER=&quot;preferences&quot;;var DEFAULT_LIVEGRID_BUFFER_SIZE=300;var URL_CGU=&quot;/sitools/res/licences/cgu.html&quot;;var COOKIE_DURATION=20;var MULTIDS_TIME_DELAY=2000;var DEFAULT_NEAR_LIMIT_SIZE=100;Ext.BLANK_IMAGE_URL=&quot;/sitools/cots/extjs/resources/images/default/s.gif&quot;;Ext.USE_NATIVE_JSON=DEFAULT_NATIVEJSON;Ext.Ajax.timeout=DEFAULT_TIMEOUT;var onBeforeRequest=function(l,e){var d=new Date();if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;scheme&quot;))){if(Ext.util.Cookies.get(&quot;scheme&quot;)==&quot;HTTP_Digest&quot;){var g=null;var m=&quot;GET&quot;;if(!Ext.isEmpty(e.method)){m=e.method}var b=e.url;if(Ext.isEmpty(e.url)&amp;&amp;!Ext.isEmpty(e.scope)){if(!Ext.isEmpty(e.scope.url)){b=e.scope.url}}var a=Ext.util.Cookies.get(&quot;A1&quot;);var k=new Digest({usr:Ext.util.Cookies.get(&quot;userLogin&quot;),algorithm:Ext.util.Cookies.get(&quot;algorithm&quot;),realm:Ext.util.Cookies.get(&quot;realm&quot;),url:b,nonce:Ext.util.Cookies.get(&quot;nonce&quot;),method:m,mode:&quot;digest&quot;,A1:a});Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:k.getDigestAuth()})}else{if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;hashCode&quot;))){Ext.util.Cookies.set(&quot;hashCode&quot;,Ext.util.Cookies.get(&quot;hashCode&quot;),d.add(Date.MINUTE,COOKIE_DURATION));Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get(&quot;hashCode&quot;)})}}}if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;userLogin&quot;))){Ext.util.Cookies.set(&quot;userLogin&quot;,Ext.util.Cookies.get(&quot;userLogin&quot;),d.add(Date.MINUTE,20))}};Ext.Ajax.on(&quot;beforerequest&quot;,onBeforeRequest,this);var LOCALE;var SITOOLS_DATE_FORMAT=&quot;Y-m-d\\TH:i:s.u&quot;;var SITOOLS_DEFAULT_IHM_DATE_FORMAT=&quot;Y-m-d H:i:s.u&quot;;if(Ext.isEmpty(Ext.util.Cookies.get(&quot;language&quot;))){LOCALE=&quot;en&quot;}else{LOCALE=Ext.util.Cookies.get(&quot;language&quot;)}var onRequestFeedException=function(e,g,k,d,a,b){if((a.status==403)&amp;&amp;!Ext.isEmpty(Ext.util.Cookies.get(&quot;hashCode&quot;))){Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get(&quot;label.session.expired&quot;),a.responseText)}else{Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get(&quot;label.error&quot;),a.responseText)}return false};var desktop;var projectGlobal;var projectId;function alertFailure(b,e){var a;if(b.status==SERVER_OK){var d=Ext.decode(b.responseText).message;a=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+d}else{a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+b.statusText}Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),a)}function extColModelToJsonColModel(a){var b=[];var d;if(!Ext.isEmpty(a.columns)){d=a.columns}else{d=a}Ext.each(d,function(e){b.push({columnAlias:e.columnAlias,dataIndex:e.dataIndexSitools,dataIndexSitools:e.dataIndexSitools,header:e.header,filter:e.filter,hidden:e.hidden,id:e.id,previewColumn:e.previewColumn,primaryKey:e.primaryKey,schema:e.schema,sortable:e.sortable,sqlColumnType:e.sqlColumnType,tableAlias:e.tableAlias,tableName:e.tableName,toolTip:e.tooltip,urlColumn:e.urlColumn,width:e.width,columnRenderer:e.columnRenderer,specificColumnType:e.specificColumnType,javaSqlColumnType:e.javaSqlColumnType,format:e.format})});return b}function extColModelToSrv(a){var b=[];var d;if(!Ext.isEmpty(a.columns)){d=a.columns}else{d=a}Ext.each(d,function(e){if(!e.hidden){b.push(e.columnAlias)}});return b.join(&quot;, &quot;)}function extColModelToStorage(a){var b=[];var d;if(!Ext.isEmpty(a.columns)){d=a.columns}else{d=a}Ext.each(d,function(e){if(!e.hidden){b.push({columnAlias:e.columnAlias,dataIndex:e.dataIndex,dataIndexSitools:e.dataIndexSitools,editor:e.editor,filter:e.filter,header:e.header,hidden:e.hidden,id:e.id,isColumn:e.isColumn,previewColumn:e.previewColumn,primaryKey:e.primaryKey,schema:e.schema,sortable:e.sortable,sqlColumnType:e.sqlColumnType,tableAlias:e.tableAlias,tableName:e.tableName,toolTip:e.tooltip,urlColumn:e.urlColumn,width:e.width,columnRenderer:e.columnRenderer,specificColumnType:e.specificColumnType,javaSqlColumnType:e.javaSqlColumnType,unit:e.unit,format:e.format})}});return b}function getDesktop(){if(Ext.isEmpty(this.SitoolsDesk)){return null}else{return this.SitoolsDesk.app.desktop}}function getApp(){if(Ext.isEmpty(SitoolsDesk)){return null}else{return SitoolsDesk.app}}Ext.override(Ext.Window,{initEvents:function(){Ext.Window.superclass.initEvents.call(this);if(this.animateTarget){this.setAnimateTarget(this.animateTarget)}if(this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||&quot;all&quot;,pinned:true,resizeElement:this.resizerAction,handleCls:&quot;x-window-handle&quot;});this.resizer.window=this;this.mon(this.resizer,&quot;beforeresize&quot;,this.beforeResize,this)}if(this.draggable){this.header.addClass(&quot;x-window-draggable&quot;)}this.mon(this.el,&quot;mousedown&quot;,this.toFront,this);var a=getDesktop();if(Ext.isEmpty(a)){this.manager=Ext.WindowMgr}else{this.manager=getDesktop().getManager()||Ext.WindowMgr}this.manager.register(this);if(this.maximized){this.maximized=false;this.maximize()}if(this.closable){var b=this.getKeyMap();b.on(27,this.onEsc,this);b.disable()}}});Ext.override(Ext.grid.GridPanel,{stripeRows:true});Ext.data.Types.DATEASSTRING={convert:function(a,b){return a},sortType:function(a){return a},type:&quot;dateAsString&quot;};function includeJs(b){if(Ext.isEmpty(b)){return}var d=document.getElementsByTagName(&quot;head&quot;)[0];var a=document.createElement(&quot;script&quot;);a.setAttribute(&quot;src&quot;,b);a.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);d.appendChild(a)}Ext.override(Ext.PagingToolbar,{initComponent:function(){var a=Ext.Toolbar;var d=[this.first=new a.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:&quot;x-tbar-page-first&quot;,disabled:true,handler:this.moveFirst,scope:this}),this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:&quot;x-tbar-page-prev&quot;,disabled:true,handler:this.movePrevious,scope:this}),&quot;-&quot;,this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:&quot;x-tbar-page-number&quot;,allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new a.TextItem({text:String.format(this.afterPageText,1)}),&quot;-&quot;,this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:&quot;x-tbar-page-next&quot;,disabled:true,handler:this.moveNext,scope:this}),this.last=new a.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:&quot;x-tbar-page-last&quot;,disabled:true,handler:this.moveLast,scope:this}),&quot;-&quot;];var b=this.items||this.buttons||[];if(this.prependButtons){this.items=b.concat(d)}else{this.items=d.concat(b)}delete this.buttons;if(this.displayInfo){this.items.push(&quot;-&gt;&quot;);this.items.push(this.displayItem=new a.TextItem({}))}Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents(&quot;change&quot;,&quot;beforechange&quot;);this.on(&quot;afterlayout&quot;,this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)},onFirstLayout:function(){this.refresh=new Ext.Toolbar.Button({tooltip:i18n.get(&quot;label.refreshText&quot;),overflowText:i18n.get(&quot;label.refreshText&quot;),iconCls:&quot;x-tbar-loading&quot;,handler:this.doRefresh,scope:this});this.insert(10,this.refresh);if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}}});function getColumnModel(e,g,b){var d=[];if(!Ext.isEmpty(e)){Ext.each(e,function(n,l,u){var t=&quot;&quot;;if(n.toolTip){t=n.toolTip}else{if(Ext.isArray(g)&amp;&amp;!Ext.isEmpty(g)){var m=g[0];var k=m.mapping||[];k.each(function(v){if(n.columnAlias==v.columnAlias){var z=v.concept||{};if(!Ext.isEmpty(z.description)){t+=z.description.replace('&quot;',&quot;''&quot;)+&quot;&lt;br&gt;&quot;}}})}}var q=sitools.user.component.dataviews.dataviewUtils.getRendererLiveGrid(n,b);var p;if(Ext.isEmpty(n.visible)){p=n.hidden}else{p=!n.visible}if(Ext.isEmpty(n.columnRenderer)||ColumnRendererEnum.NO_CLIENT_ACCESS!=n.columnRenderer.behavior){d.push(new Ext.grid.Column({columnAlias:n.columnAlias,dataIndexSitools:n.dataIndex,dataIndex:n.columnAlias,header:n.header,width:n.width,sortable:n.sortable,hidden:p,tooltip:t,renderer:q,schema:n.schema,tableName:n.tableName,tableAlias:n.tableAlias,id:n.id,primaryKey:n.primaryKey,previewColumn:n.previewColumn,filter:n.filter,sqlColumnType:n.sqlColumnType,columnRenderer:n.columnRenderer,specificColumnType:n.specificColumnType,format:n.format}))}},this)}var a=new Ext.grid.ColumnModel({columns:d});return a}Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on(&quot;beforeshow&quot;,this.onBeforeShow,this);if(this.strict==(Ext.isIE7&amp;&amp;Ext.isStrict)){this.on(&quot;show&quot;,this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.SitoolsDatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:&quot;x-menu-date-item&quot;,id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,[&quot;select&quot;]);this.on(&quot;show&quot;,this.picker.focus,this.picker);this.on(&quot;select&quot;,this.menuHide,this);if(this.handler){this.on(&quot;select&quot;,this.handler,this.scope||this)}}});Ext.override(Ext.form.DateField,{showTime:false,onTriggerClick:function(){if(this.disabled){return}if(Ext.isEmpty(this.menu)){this.menu=new Ext.menu.DateMenu({hideOnClick:false,showTime:this.showTime,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,&quot;tl-bl?&quot;);this.menuEvents(&quot;on&quot;)}});function viewFileContent(a,b){Ext.Ajax.request({url:a,method:&quot;HEAD&quot;,scope:this,success:function(e){try{var d=e.getResponseHeader(&quot;Content-Type&quot;).split(&quot;;&quot;)[0].split(&quot;/&quot;)[0];if(d==&quot;text&quot;||e.getResponseHeader(&quot;Content-Type&quot;).indexOf(&quot;application/json&quot;)&gt;=0){Ext.Ajax.request({url:a,method:&quot;GET&quot;,scope:this,success:function(m){var k={id:&quot;winPreferenceDetailId&quot;,title:b};var n=Ext.Panel;var l={layout:&quot;fit&quot;,autoScroll:true,html:m.responseText};SitoolsDesk.addDesktopWindow(k,l,n)}})}else{if(d==&quot;image&quot;){sitools.user.component.dataviews.dataviewUtils.showPreview(a,b)}else{sitools.user.component.dataviews.dataviewUtils.downloadFile(a)}}}catch(g){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),g)}},failure:function(d){return null}})}Ext.override(Ext.data.XmlReader,{buildExtractors:function(){if(this.ef){return}var p=this.meta,l=this.recordType,k=l.prototype.fields,n=k.items,m=k.length;if(p.totalProperty){this.getTotal=this.createAccessor(p.totalProperty)}if(p.successProperty){this.getSuccess=this.createAccessor(p.successProperty)}if(p.messageProperty){this.getMessage=this.createAccessor(p.messageProperty)}this.getRoot=function(g){return(!Ext.isEmpty(g[this.meta.record]))?g[this.meta.record]:g[this.meta.root]};if(p.idPath||p.idProperty){var e=this.createAccessor(p.idPath||p.idProperty);this.getId=function(g){var q=e(g)||g.id;return(q===undefined||q===&quot;&quot;)?null:q}}else{this.getId=function(){return null}}var d=[];for(var b=0;b&lt;m;b++){k=n[b];var a=(k.mapping!==undefined&amp;&amp;k.mapping!==null)?k.mapping:k.name;if(k.createAccessor!==undefined&amp;&amp;k.createAccessor!==null){d.push(k.createAccessor)}else{d.push(this.createAccessor(a))}}this.ef=d}});Ext.override(Ext.layout.BorderLayout.Region,{getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var b=new Ext.Template('&lt;span class=&quot;x-panel-collapsed-text&quot;&gt;{title}&lt;/span&gt;','&lt;div class=&quot;x-tool x-tool-{id}&quot;&gt;&amp;#160;&lt;/div&gt;');b.disableFormats=true;b.compile();Ext.layout.BorderLayout.Region.prototype.toolTemplate=b}this.collapsedEl=this.targetEl.createChild({cls:&quot;x-layout-collapsed x-layout-collapsed-&quot;+this.position,id:this.panel.id+&quot;-xcollapsed&quot;});this.collapsedEl.enableDisplayMode(&quot;block&quot;);if(this.collapseMode==&quot;mini&quot;){this.collapsedEl.addClass(&quot;x-layout-cmini-&quot;+this.position);this.miniCollapsedEl=this.collapsedEl.createChild({cls:&quot;x-layout-mini x-layout-mini-&quot;+this.position,html:&quot;&amp;#160;&quot;});this.miniCollapsedEl.addClassOnOver(&quot;x-layout-mini-over&quot;);this.collapsedEl.addClassOnOver(&quot;x-layout-collapsed-over&quot;);this.collapsedEl.on(&quot;click&quot;,this.onExpandClick,this,{stopEvent:true})}else{if(this.collapsible!==false&amp;&amp;!this.hideCollapseTool){var a=this.expandToolEl=this.toolTemplate.append(this.collapsedEl.dom,{id:&quot;expand-&quot;+this.position,title:this.panel.collapsedTitle},true);a.addClassOnOver(&quot;x-tool-expand-&quot;+this.position+&quot;-over&quot;);a.on(&quot;click&quot;,this.onExpandClick,this,{stopEvent:true})}if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver(&quot;x-layout-collapsed-over&quot;);this.collapsedEl.on(&quot;click&quot;,this[this.floatable?&quot;collapseClick&quot;:&quot;onExpandClick&quot;],this)}}}return this.collapsedEl}});Ext.ns(&quot;sitools.user&quot;);sitools.user.clickDatasetIcone=function(url,type,extraCmpConfig){Ext.Ajax.request({method:&quot;GET&quot;,url:url,success:function(ret){var Json=Ext.decode(ret.responseText);if(showResponse(ret)){var dataset=Json.dataset;var componentCfg,javascriptObject;var windowConfig={datasetName:dataset.name,type:type,saveToolbar:true,toolbarItems:[]};switch(type){case&quot;desc&quot;:Ext.apply(windowConfig,{title:i18n.get(&quot;label.description&quot;)+&quot; : &quot;+dataset.name,id:&quot;desc&quot;+dataset.id,saveToolbar:false});componentCfg={autoScroll:true,html:dataset.descriptionHTML};Ext.applyIf(componentCfg,extraCmpConfig);javascriptObject=Ext.Panel;SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;data&quot;:javascriptObject=eval(dataset.datasetView.jsObject);Ext.apply(windowConfig,{title:i18n.get(&quot;label.dataTitle&quot;)+&quot; : &quot;+dataset.name,id:type+dataset.id});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings,datasetViewConfig:dataset.datasetViewConfig};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;forms&quot;:var menuForms=new Ext.menu.Menu();Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/forms&quot;,success:function(ret){try{var Json=Ext.decode(ret.responseText);if(!Json.success){throw Json.message}if(Json.total===0){throw i18n.get(&quot;label.noForms&quot;)}javascriptObject=sitools.user.component.forms;if(Json.total==1){var form=Json.data[0];Ext.apply(windowConfig,{title:i18n.get(&quot;label.forms&quot;)+&quot; : &quot;+dataset.name+&quot;.&quot;+form.name});Ext.apply(windowConfig,{id:type+dataset.id+form.id});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,dataset:dataset,formId:form.id,formName:form.name,formParameters:form.parameters,formWidth:form.width,formHeight:form.height,formCss:form.css};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)}else{var handler=null;Ext.each(Json.data,function(form){handler=function(form,dataset){Ext.apply(windowConfig,{title:i18n.get(&quot;label.forms&quot;)+&quot; : &quot;+dataset.name+&quot;.&quot;+form.name});Ext.apply(windowConfig,{id:type+dataset.id+form.id});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,formId:form.id,formName:form.name,formParameters:form.parameters,formWidth:form.width,formHeight:form.height,formCss:form.css,dataset:dataset};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)};menuForms.addItem({text:form.name,handler:function(){handler(form,dataset)},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_forms.png&quot;})},this);menuForms.showAt(Ext.EventObject.xy)}}catch(err){var tmp=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(err),autoDestroy:true,hideDelay:1000}).show(document)}}});break;case&quot;feeds&quot;:var menuFeeds=new Ext.menu.Menu();Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/feeds&quot;,success:function(ret){try{var Json=Ext.decode(ret.responseText);if(!Json.success){throw Json.message}if(Json.total===0){throw i18n.get(&quot;label.noFeeds&quot;)}javascriptObject=sitools.widget.FeedGridFlux;if(Json.total==1){var feed=Json.data[0];Ext.apply(windowConfig,{title:i18n.get(&quot;label.feeds&quot;)+&quot; : &quot;+dataset.name+&quot;.&quot;+feed.title,id:type+dataset.id+feed.id});componentCfg={datasetId:dataset.id,urlFeed:dataset.sitoolsAttachementForUsers+&quot;/clientFeeds/&quot;+feed.name,feedType:feed.feedType,datasetName:dataset.name,feedSource:feed.feedSource,autoLoad:true};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)}else{var handler=null;Ext.each(Json.data,function(feed){handler=function(feed,dataset){Ext.apply(windowConfig,{title:i18n.get(&quot;label.feeds&quot;)+&quot; : &quot;+dataset.name+&quot;.&quot;+feed.title,id:type+dataset.id+feed.id});componentCfg={datasetId:dataset.id,urlFeed:dataset.sitoolsAttachementForUsers+&quot;/clientFeeds/&quot;+feed.name,feedType:feed.feedType,datasetName:dataset.name,feedSource:feed.feedSource,autoLoad:true};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)};menuFeeds.addItem({text:feed.name,handler:function(){handler(feed,dataset)},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/rss.png&quot;})},this);menuFeeds.showAt(Ext.EventObject.xy)}}catch(err){var tmp=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(err),autoDestroy:true,hideDelay:1000}).show(document)}}});break;case&quot;defi&quot;:Ext.apply(windowConfig,{title:i18n.get(&quot;label.definitionTitle&quot;)+&quot; : &quot;+dataset.name,id:type+dataset.id});javascriptObject=sitools.user.component.columnsDefinition;componentCfg={datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;openSearch&quot;:Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/opensearch.xml&quot;,success:function(ret){var xml=ret.responseXML;var dq=Ext.DomQuery;var success=dq.selectNode(&quot;OpenSearchDescription &quot;,xml);if(!success){var tmp=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.noOpenSearch&quot;),autoDestroy:true,hideDelay:1000}).show(document);return}Ext.apply(windowConfig,{title:i18n.get(&quot;label.opensearch&quot;)+&quot; : &quot;+dataset.name,id:type+dataset.id});javascriptObject=sitools.user.component.datasetOpensearch;componentCfg={datasetId:dataset.id,dataUrl:dataset.sitoolsAttachementForUsers,datasetName:dataset.name};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)}});break}}},failure:alertFailure})};Ext.override(Ext.form.Field,{tooltip:null,listeners:{render:function(){Ext.form.Field.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var a={};if(Ext.isString(this.tooltip)){a={html:this.tooltip,width:200,dismissDelay:5000}}else{if(Ext.isObject(this.tooltip)){a=this.tooltip}else{return}}Ext.apply(a,{target:this.el});this.tTip=new Ext.ToolTip(a)}}}});Ext.override(Ext.BoxComponent,{tooltip:null,listeners:{render:function(){Ext.BoxComponent.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var a={};if(Ext.isString(this.tooltip)){a={html:this.tooltip,width:200,dismissDelay:5000}}else{if(Ext.isObject(this.tooltip)){a=this.tooltip}else{return}}Ext.apply(a,{target:this.el});this.tTip=new Ext.ToolTip(a)}}}});
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
function initAppliDesktop(){return}var portal;var portalApp={projects:null,languages:null,preferences:null,autoChainAjaxRequest:true,initProjects:function(a){Ext.Ajax.request({scope:this,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PORTAL_URL&quot;)+&quot;/projects?media=json&quot;,method:&quot;GET&quot;,success:function(b){try{this.projects=b.responseJSON.data;if(this.autoChainAjaxRequest){this.initLanguages()}}catch(d){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),d)}},failure:function(b){Ext.Msg.alert(&quot;Status&quot;,i18n.get(&quot;warning.serverError&quot;))}})},initLanguages:function(){Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-user/tmp/langues.json&quot;,success:function(a){this.languages=a.responseJSON.data;if(this.autoChainAjaxRequest){this.initPreferences()}},failure:function(a){Ext.Msg.alert(&quot;Status&quot;,i18n.get(&quot;warning.serverError&quot;))}})},initPreferences:function(a){if(Ext.isEmpty(userLogin)){var e=this.projects;var g=this.languages;var b=this.preferences;var k;if(this.autoChainAjaxRequest){k=function(){portal=new sitools.Portal(e,g,b)}}else{k=a}i18n.load(loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k);return}var d=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);Ext.Ajax.request({scope:this,url:loadUrl.get(&quot;APP_URL&quot;)+d+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/portal/portal?media=json&quot;,method:&quot;GET&quot;,success:function(l){this.preferences=Ext.decode(l.responseText);if(!Ext.isEmpty(this.preferences.language)){LOCALE=this.preferences.language}},callback:function(){var m=this.projects;var n=this.languages;var l=this.preferences;i18n.load(loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,function(){portal=new sitools.Portal(m,n,l)})}})},initAppliPortal:function(b,d){if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;userLogin&quot;))){var a=Ext.util.Cookies.get(&quot;hashCode&quot;);Ext.Ajax.defaultHeaders={Authorization:a,Accept:&quot;application/json&quot;,&quot;User-Agent&quot;:&quot;Sitools&quot;}}else{Ext.Ajax.defaultHeaders={Accept:&quot;application/json&quot;,&quot;User-Agent&quot;:&quot;Sitools&quot;}}Ext.QuickTips.init();this.callSiteMapResource(b.siteMapRes,d)},callSiteMapResource:function(b,a){var d;if(this.autoChainAjaxRequest){d=this.initProjects}else{d=a}loadUrl.load(b+&quot;/siteMap&quot;,d,this)}};var ID={PANEL:{MENU:&quot;menuPanelId&quot;,TREE:&quot;treePanelId&quot;,MAIN:&quot;mainPanelId&quot;,HELP:&quot;helpPanelId&quot;},CMP:{TOOLBAR:&quot;toolbarId&quot;,MENU:&quot;menuId&quot;},WIN:{LOGIN:&quot;loginWinId&quot;,ORDER:&quot;orderWinId&quot;},BOX:{REG:&quot;regBoxId&quot;,USER:&quot;userBoxId&quot;,GROUP:&quot;groupBoxId&quot;,FIREWALL:&quot;firewallBoxId&quot;},PORTLET:{PROJET:&quot;portletProjectId&quot;,RECHERCHE:&quot;portletRecherceID&quot;,FEEDS:&quot;portletFeedsId&quot;},PORTALTREENAV:{PROJET:&quot;navProjectId&quot;,RECHERCHE:&quot;navRechercheId&quot;,FEEDS:&quot;navFeedsId&quot;}};Ext.ns(&quot;Ext.ux&quot;);Ext.ux.FisheyeMenu=Ext.extend(Ext.util.Observable,{items:[],renderTo:document.body,itemWidth:50,vicinity:35,hAlign:&quot;center&quot;,vAlign:&quot;bottom&quot;,showTitle:true,constructor:function(a){Ext.apply(this,a);Ext.ux.FisheyeMenu.superclass.constructor.call(this);this.addEvents(&quot;change&quot;);this.init()},init:function(){this.el=Ext.get(this.renderTo);this.initMarkup();this.initEvents()},initMarkup:function(){this.setClass();this.el.addClass(this.wrapCls);this.containerEl=this.el.createChild({tag:&quot;div&quot;,cls:&quot;ux-fisheye-menu-container &quot;+this.vAlignCls});var a=this.el.getAttribute(&quot;id&quot;)||Ext.id();Ext.each(this.items,function(e){var d=this.showTitle===true?(e.tip||e.text):&quot;&quot;;var b=[{tag:&quot;span&quot;,html:e.text},{tag:&quot;img&quot;,src:e.imagePath,alt:d}];if(this.vOrient==&quot;top&quot;){b=b.reverse()}this.containerEl.createChild({tag:&quot;a&quot;,id:a+&quot;-&quot;+e.id,cls:&quot;ux-fisheye-menu-item &quot;+this.vAlignCls,href:&quot;#&quot;,onClick:&quot;javascript : &quot;+e.fct||&quot;void(0);&quot;,title:d,children:b})},this);this.menuItems=this.containerEl.select(&quot;a.ux-fisheye-menu-item&quot;);this.itemCount=this.menuItems.getCount();this.onRender()},initEvents:function(){this.menuItems.on(&quot;mouseover&quot;,this.onItemHover,this);this.menuItems.on(&quot;mouseout&quot;,this.onItemOut,this);Ext.getBody().on(&quot;mousemove&quot;,this.onItemMove,this);Ext.EventManager.on(window,&quot;resize&quot;,this.onRender,this);this.containerEl.on(&quot;click&quot;,function(d,b){if(b.href.slice(-1)==&quot;#&quot;){d.preventDefault()}var a=parseInt(b.id.split(&quot;-&quot;).pop(),10);this.fireEvent(&quot;change&quot;,b,a)},this,{delegate:&quot;a&quot;})},setClass:function(){this.vOrient=this.vAlign.toLowerCase();this.wrapCls=&quot;menu-wrap-&quot;+this.vOrient;this.vAlignCls=&quot;menu-align-&quot;+this.vOrient},onItemMove:function(d,b){var e=d.getXY(),k,g,a=0;switch(this.hAlign.toLowerCase()){case&quot;left&quot;:k=e[0]-this.pos[0];break;case&quot;right&quot;:k=e[0]-this.pos[0]-this.el.getWidth()+this.itemWidth*this.itemCount;break;default:k=e[0]-this.pos[0]-(this.el.getWidth()-this.itemWidth*this.itemCount)/2-this.itemWidth/2;break}g=Math.pow(e[1]-this.pos[1]-this.el.getHeight()/2,2);this.menuItems.each(function(n,m,l){var q=Math.sqrt(Math.pow(k-l*this.itemWidth,2)+g);q-=this.itemWidth/2;q=q&lt;0?0:q;q=q&gt;this.vicinity?this.vicinity:q;q=this.vicinity-q;var p=this.itemWidth*q/this.vicinity;n.setStyle({left:(this.itemWidth+3)*l+a+&quot;px&quot;,width:this.itemWidth+p+&quot;px&quot;});a+=p},this);this.setPosContainer(a)},onItemHover:function(d,b){var e=Ext.get(b);e=e.is(&quot;img&quot;)?e.up(&quot;a&quot;):e;var a=e.child(&quot;span&quot;);if(a){a.show()}},onItemOut:function(d,b){var e=Ext.get(b);e=e.is(&quot;img&quot;)?e.up(&quot;a&quot;):e;var a=e.child(&quot;span&quot;);if(a){a.hide()}},onRender:function(){this.pos=this.el.getXY();this.setPosContainer(0);this.setPosMenuItems()},doAlignment:function(){var a=[&quot;menu-wrap-top&quot;,&quot;menu-wrap-bottom&quot;],b=[&quot;menu-align-top&quot;,&quot;menu-align-bottom&quot;];this.setClass();this.el.removeClass(a).addClass(this.wrapCls);this.containerEl.removeClass(b).addClass(this.vAlignCls);this.menuItems.each(function(l,g,e){var d=l.child(&quot;span&quot;);var k={tag:&quot;span&quot;,html:d.dom.innerHTML};l.removeClass(b).addClass(this.vAlignCls);if(this.vAlign.toLowerCase()==&quot;top&quot;){if(!l.last().is(&quot;span&quot;)){l.createChild(k);d.remove()}}else{if(!l.first().is(&quot;span&quot;)){l.insertFirst(k);d.remove()}}},this)},setAlign:function(a){var e=false;if(a.hAlign){var d=a.hAlign.toLowerCase();if(d!=this.hAlign.toLowerCase()){this.hAlign=d;e=true}}if(a.vAlign){var b=a.vAlign.toLowerCase();if(b!=this.vAlign.toLowerCase()){this.vAlign=b;e=true}}if(e){this.doAlignment();this.onRender()}},setPosContainer:function(a){var b;switch(this.hAlign.toLowerCase()){case&quot;left&quot;:b=-a/this.itemCount;break;case&quot;right&quot;:b=(this.el.getWidth()-this.itemWidth*this.itemCount)-a/2;break;default:b=(this.el.getWidth()-this.itemWidth*this.itemCount)/2-a/2;break}this.containerEl.setStyle({left:b+&quot;px&quot;,width:this.itemWidth*this.itemCount+a+&quot;px&quot;})},setPosMenuItems:function(){this.menuItems.each(function(d,b,a){d.setStyle({left:(this.itemWidth+3)*a+&quot;px&quot;,width:this.itemWidth+&quot;px&quot;})},this)}});Ext.ux.FisheyeMenuExtention=Ext.extend(Ext.ux.FisheyeMenu,{constructor:function(a){Ext.apply(this,a);Ext.ux.FisheyeMenuExtention.superclass.constructor.call(this)},addItem:function(e){var d=this.el.getAttribute(&quot;id&quot;)||Ext.id();var b=this.showTitle===true?(e.tip||e.text):&quot;&quot;;var a=[{tag:&quot;span&quot;,html:e.text},{tag:&quot;img&quot;,src:e.imagePath,alt:b}];if(this.vOrient==&quot;top&quot;){a=a.reverse()}this.containerEl.createChild({tag:&quot;a&quot;,id:d+&quot;-&quot;+e.id,cls:&quot;ux-fisheye-menu-item &quot;+this.vAlignCls,href:e.url||&quot;#&quot;,title:b,target:e.target||&quot;_blank&quot;,onClick:&quot;javascript : &quot;+e.fct,children:a});this.menuItems=this.containerEl.select(&quot;a.ux-fisheye-menu-item&quot;);this.itemCount=this.menuItems.getCount();this.onRender();this.menuItems.on(&quot;mouseover&quot;,this.onItemHover,this);this.menuItems.on(&quot;mouseout&quot;,this.onItemOut,this)},removeItem:function(b){var a=&quot;fisheye-menu-bottom-&quot;+b;menuItem=Ext.get(a);if(!menuItem){alert(&quot;cannot find the menu item!&quot;)}else{menuItem.remove();this.menuItems=this.containerEl.select(&quot;a.ux-fisheye-menu-item&quot;);this.itemCount=this.menuItems.getCount();this.onRender()}}});
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.namespace(&quot;Ext.ux&quot;);Ext.ux.StartMenu=Ext.extend(Ext.menu.Menu,{initComponent:function(a){Ext.ux.StartMenu.superclass.initComponent.call(this,a);var b=this.toolItems;this.toolItems=new Ext.util.MixedCollection();if(b){this.addTool.apply(this,b)}},onRender:function(m,l){Ext.ux.StartMenu.superclass.onRender.call(this,m,l);var a=this.el.addClass(&quot;ux-start-menu&quot;);var g=a.createChild({tag:&quot;div&quot;,cls:&quot;x-window-header x-unselectable x-panel-icon &quot;+this.iconCls});this.header=g;var k=g.createChild({tag:&quot;span&quot;,cls:&quot;x-window-header-text&quot;});var z=g.wrap({cls:&quot;ux-start-menu-tl&quot;});var q=g.wrap({cls:&quot;ux-start-menu-tr&quot;});var d=g.wrap({cls:&quot;ux-start-menu-tc&quot;});this.menuBWrap=a.createChild({tag:&quot;div&quot;,cls:&quot;x-window-body x-border-layout-ct ux-start-menu-body&quot;});var e=this.menuBWrap.wrap({cls:&quot;ux-start-menu-ml&quot;});var t=this.menuBWrap.wrap({cls:&quot;x-window-mc ux-start-menu-bwrap&quot;});this.menuPanel=this.menuBWrap.createChild({tag:&quot;div&quot;,cls:&quot;x-panel x-border-panel ux-start-menu-apps-panel&quot;});this.toolsPanel=this.menuBWrap.createChild({tag:&quot;div&quot;,cls:&quot;x-panel x-border-panel ux-start-menu-tools-panel&quot;});var p=e.wrap({cls:&quot;x-window-bwrap&quot;});var n=p.createChild({tag:&quot;div&quot;,cls:&quot;ux-start-menu-bc&quot;});var b=n.wrap({cls:&quot;ux-start-menu-bl x-panel-nofooter&quot;});var v=n.wrap({cls:&quot;ux-start-menu-br&quot;});this.ul.appendTo(this.menuPanel);var u=this.toolsPanel.createChild({tag:&quot;ul&quot;,cls:&quot;x-menu-list&quot;});this.mon(u,&quot;click&quot;,this.onClick,this);this.mon(u,&quot;mouseover&quot;,this.onMouseOver,this);this.mon(u,&quot;mouseout&quot;,this.onMouseOut,this);if(this.item){this.items.each(function(A){A.parentMenu=this},this)}this.toolItems.each(function(B){if(!Ext.isEmpty(B.text)){B.text=i18n.get(B.text)}var A=document.createElement(&quot;li&quot;);A.className=&quot;x-menu-list-item&quot;;u.dom.appendChild(A);B.render(A);B.parentMenu=this},this);this.toolsUl=u;this.menuBWrap.setStyle(&quot;position&quot;,&quot;relative&quot;);this.menuBWrap.setHeight(this.height-28);this.menuPanel.setStyle({padding:&quot;2px&quot;,position:&quot;absolute&quot;,overflow:&quot;auto&quot;});this.toolsPanel.setStyle({padding:&quot;2px 4px 2px 2px&quot;,position:&quot;absolute&quot;,overflow:&quot;auto&quot;});this.setTitle(this.title)},findTargetItem:function(b){var a=b.getTarget(&quot;.x-menu-list-item&quot;,this.ul,true);if(a&amp;&amp;a.menuItemId){if(this.items.get(a.menuItemId)){return this.items.get(a.menuItemId)}else{return this.toolItems.get(a.menuItemId)}}},show:function(b,g,a){this.parentMenu=a;if(!this.el){this.render()}this.fireEvent(&quot;beforeshow&quot;,this);this.showAt(this.el.getAlignToXY(b,g||this.defaultAlign),a,false);var e=100;var d=this.menuBWrap.getBox();this.menuPanel.setWidth(d.width-e);this.menuPanel.setHeight(d.height);this.toolsPanel.setWidth(e);this.toolsPanel.setX(d.x+d.width-e);this.toolsPanel.setHeight(d.height)},addTool:function(){var d=arguments,b=d.length,k;for(var e=0;e&lt;b;e++){var g=d[e];if(g.render){k=this.addToolItem(g)}else{if(typeof g==&quot;string&quot;){if(g==&quot;separator&quot;||g==&quot;-&quot;){k=this.addToolSeparator()}else{k=this.addText(g)}}else{if(g.tagName||g.el){k=this.addElement(g)}else{if(typeof g==&quot;object&quot;){k=this.addToolMenuItem(g)}}}}}return k},addToolSeparator:function(){return this.addToolItem(new Ext.menu.Separator({itemCls:&quot;ux-toolmenu-sep&quot;}))},addToolItem:function(b){b.text=i18n.get(b.text);this.toolItems.add(b);if(this.ul){var a=document.createElement(&quot;li&quot;);a.className=&quot;x-menu-list-item&quot;;this.ul.dom.appendChild(a);b.render(a,this);this.delayAutoWidth()}return b},addToolMenuItem:function(a){if(!(a instanceof Ext.menu.Item)){if(typeof a.checked==&quot;boolean&quot;){a=new Ext.menu.CheckItem(a)}else{a=new Ext.menu.Item(a)}}return this.addToolItem(a)},setTitle:function(b,a){this.title=b;this.header.child(&quot;span&quot;).update(b);return this}});
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.TaskBar=function(a){this.app=a;this.init()};Ext.extend(Ext.ux.TaskBar,Ext.util.Observable,{init:function(){this.startMenu=new Ext.ux.StartMenu(Ext.apply({iconCls:&quot;user&quot;,height:300,shadow:true,title:&quot;Jack Slocum&quot;,width:300},this.app.startConfig));this.startBtn=new Ext.Button({text:i18n.get(&quot;label.start&quot;),id:&quot;ux-startbutton&quot;,iconCls:&quot;start&quot;,menu:this.startMenu,menuAlign:&quot;bl-tl&quot;,renderTo:&quot;ux-taskbar-start&quot;,clickEvent:&quot;mousedown&quot;,template:new Ext.Template('&lt;table cellspacing=&quot;0&quot; class=&quot;x-btn&quot;&gt;&lt;tbody class=&quot;{1}&quot;&gt;&lt;tr&gt;','&lt;td class=&quot;ux-startbutton-left&quot;&gt;&lt;i&gt;&amp;#160;&lt;/i&gt;&lt;/td&gt;','&lt;td class=&quot;ux-startbutton-center&quot;&gt;&lt;em class=&quot;{2} unselectable=&quot;on&quot;&gt;','&lt;button class=&quot;x-btn-text&quot; type=&quot;{0}&quot; style=&quot;height:30px;&quot;&gt;&lt;/button&gt;',&quot;&lt;/em&gt;&lt;/td&gt;&quot;,'&lt;td class=&quot;ux-startbutton-right&quot;&gt;&lt;i&gt;&amp;#160;&lt;/i&gt;&lt;/td&gt;',&quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;)});var d=this.startBtn.getEl().getWidth()+10;var b=new Ext.BoxComponent({el:&quot;ux-taskbar-start&quot;,id:&quot;TaskBarStart&quot;,minWidth:d,region:&quot;west&quot;,split:true,width:d});this.tbPanel=new Ext.ux.TaskButtonsPanel({el:&quot;ux-taskbuttons-panel&quot;,id:&quot;TaskBarButtons&quot;,region:&quot;center&quot;,style:&quot;overflow:hidden !important&quot;});var a=new Ext.ux.TaskBarContainer({el:&quot;ux-taskbar&quot;,layout:&quot;border&quot;,items:[b,this.tbPanel]});return this},addTaskButton:function(a){return this.tbPanel.addButton(a,&quot;ux-taskbuttons-panel&quot;)},removeTaskButton:function(a){this.tbPanel.removeButton(a)},setActiveButton:function(a){this.tbPanel.setActiveButton(a)}});Ext.ux.TaskBarContainer=Ext.extend(Ext.Container,{initComponent:function(){Ext.ux.TaskBarContainer.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:&quot;hidden&quot;,margin:&quot;0&quot;,border:&quot;0 none&quot;});this.el.dom.scroll=&quot;no&quot;;this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el},fireResize:function(a,b){this.onResize(a,b,a,b);this.fireEvent(&quot;resize&quot;,this,a,b,a,b)}});Ext.ux.TaskButtonsPanel=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:true,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,resizeButtons:true,buttonWidth:168,minButtonWidth:118,buttonMargin:2,buttonWidthSet:false,initComponent:function(){Ext.ux.TaskButtonsPanel.superclass.initComponent.call(this);this.on(&quot;resize&quot;,this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:&quot;ux-taskbuttons-strip-wrap&quot;,cn:{tag:&quot;ul&quot;,cls:&quot;ux-taskbuttons-strip&quot;}});this.stripSpacer=Ext.get(this.el).createChild({cls:&quot;ux-taskbuttons-strip-spacer&quot;});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:&quot;li&quot;,cls:&quot;ux-taskbuttons-edge&quot;});this.strip.createChild({cls:&quot;x-clear&quot;})},addButton:function(d){var a=this.strip.createChild({tag:&quot;li&quot;},this.edge);var b=new Ext.ux.TaskBar.TaskButton(d,a);this.items.push(b);if(!this.buttonWidthSet){this.lastButtonWidth=b.container.getWidth()}this.setActiveButton(b);return b},removeButton:function(e){var b=document.getElementById(e.container.id);e.destroy();b.parentNode.removeChild(b);var g=[];for(var d=0,a=this.items.length;d&lt;a;d++){if(this.items[d]!=e){g.push(this.items[d])}}this.items=g;this.delegateUpdates()},setActiveButton:function(a){this.activeButton=a;this.delegateUpdates()},delegateUpdates:function(){if(this.resizeButtons&amp;&amp;this.rendered){this.autoSize()}if(this.enableScroll&amp;&amp;this.rendered){this.autoScroll()}},autoSize:function(){var m=this.items.length;var d=this.el.dom.offsetWidth;var a=this.el.dom.clientWidth;if(!this.resizeButtons||m&lt;1||!a){return}var p=Math.max(Math.min(Math.floor((a-4)/m)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var g=this.stripWrap.dom.getElementsByTagName(&quot;button&quot;);this.lastButtonWidth=Ext.get(g[0].id).findParent(&quot;li&quot;).offsetWidth;for(var k=0,n=g.length;k&lt;n;k++){var b=g[k];var l=Ext.get(g[k].id).findParent(&quot;li&quot;).offsetWidth;var e=b.offsetWidth;b.style.width=(p-(l-e))+&quot;px&quot;}},autoScroll:function(){var k=this.items.length;var e=this.el.dom.offsetWidth;var d=this.el.dom.clientWidth;var g=this.stripWrap;var b=g.dom.offsetWidth;var m=this.getScrollPos();var a=this.edge.getOffsetsTo(this.stripWrap)[0]+m;if(!this.enableScroll||k&lt;1||b&lt;20){return}g.setWidth(d);if(a&lt;=d){g.dom.scrollLeft=0;if(this.scrolling){this.scrolling=false;this.el.removeClass(&quot;x-taskbuttons-scrolling&quot;);this.scrollLeft.hide();this.scrollRight.hide()}}else{if(!this.scrolling){this.el.addClass(&quot;x-taskbuttons-scrolling&quot;)}d-=g.getMargins(&quot;lr&quot;);g.setWidth(d&gt;20?d:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()}else{this.scrollLeft.show();this.scrollRight.show()}}this.scrolling=true;if(m&gt;(a-d)){g.dom.scrollLeft=a-d}else{this.scrollToButton(this.activeButton,true)}this.updateScrollButtons()}},createScrollers:function(){var d=this.el.dom.offsetHeight;var a=this.el.insertFirst({cls:&quot;ux-taskbuttons-scroller-left&quot;});a.setHeight(d);a.addClassOnOver(&quot;ux-taskbuttons-scroller-left-over&quot;);this.leftRepeater=new Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=a;var b=this.el.insertFirst({cls:&quot;ux-taskbuttons-scroller-right&quot;});b.setHeight(d);b.addClassOnOver(&quot;ux-taskbuttons-scroller-right-over&quot;);this.rightRepeater=new Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=b},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2)},scrollToButton:function(g,a){g=g.el.dom.parentNode;if(!g){return}var d=g;var l=this.getScrollPos(),e=this.getScrollArea();var k=Ext.fly(d).getOffsetsTo(this.stripWrap)[0]+l;var b=k+d.offsetWidth;if(k&lt;l){this.scrollTo(k,a)}else{if(b&gt;(l+e)){this.scrollTo(b-e,a)}}},scrollTo:function(b,a){this.stripWrap.scrollTo(&quot;left&quot;,b,a?this.getScrollAnim():false);if(!a){this.updateScrollButtons()}},onScrollRight:function(){var a=this.getScrollWidth()-this.getScrollArea();var d=this.getScrollPos();var b=Math.min(a,d+this.getScrollIncrement());if(b!=d){this.scrollTo(b,this.animScroll)}},onScrollLeft:function(){var b=this.getScrollPos();var a=Math.max(0,b-this.getScrollIncrement());if(a!=b){this.scrollTo(a,this.animScroll)}},updateScrollButtons:function(){var a=this.getScrollPos();this.scrollLeft[a===0?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;ux-taskbuttons-scroller-left-disabled&quot;);this.scrollRight[a&gt;=(this.getScrollWidth()-this.getScrollArea())?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;ux-taskbuttons-scroller-right-disabled&quot;)}});Ext.ux.TaskBar.TaskButton=function(b,a){this.win=b;Ext.ux.TaskBar.TaskButton.superclass.constructor.call(this,{iconCls:b.iconCls,text:Ext.util.Format.ellipsis(b.title,12),renderTo:a,handler:function(){if(b.minimized||b.hidden){b.show()}else{if(b==b.manager.getActive()){b.minimize()}else{b.toFront()}}},clickEvent:&quot;mousedown&quot;,template:new Ext.Template('&lt;table cellspacing=&quot;0&quot; class=&quot;x-btn {3}&quot;&gt;&lt;tbody&gt;&lt;tr&gt;','&lt;td class=&quot;ux-taskbutton-left&quot;&gt;&lt;i&gt;&amp;#160;&lt;/i&gt;&lt;/td&gt;','&lt;td class=&quot;ux-taskbutton-center&quot;&gt;&lt;em class=&quot;{5} unselectable=&quot;on&quot;&gt;','&lt;button class=&quot;x-btn-text {2}&quot; type=&quot;{1}&quot; style=&quot;height:28px;&quot;&gt;{0}&lt;/button&gt;',&quot;&lt;/em&gt;&lt;/td&gt;&quot;,'&lt;td class=&quot;ux-taskbutton-right&quot;&gt;&lt;i&gt;&amp;#160;&lt;/i&gt;&lt;/td&gt;',&quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;)})};Ext.extend(Ext.ux.TaskBar.TaskButton,Ext.Button,{onRender:function(){Ext.ux.TaskBar.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{text:&quot;Restore&quot;,handler:function(){if(!this.win.isVisible()){this.win.show()}else{this.win.restore()}},scope:this},{text:&quot;Minimize&quot;,handler:this.win.minimize,scope:this.win},{text:&quot;Maximize&quot;,handler:this.win.maximize,scope:this.win},&quot;-&quot;,{text:&quot;Close&quot;,handler:this.closeWin.createDelegate(this,this.win,true),scope:this.win}]});this.cmenu.on(&quot;beforeshow&quot;,function(){var b=this.cmenu.items.items;var a=this.win;b[0].setDisabled(a.maximized!==true&amp;&amp;a.hidden!==true);b[1].setDisabled(a.minimized===true);b[2].setDisabled(a.maximized===true||a.hidden===true)},this);this.el.on(&quot;contextmenu&quot;,function(b){b.stopEvent();if(!this.cmenu.el){this.cmenu.render()}var a=b.getXY();a[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(a)},this)},closeWin:function(a,d,b){if(!b.isVisible()){b.show()}else{b.restore()}b.close()}});
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.Desktop=function(a){this.taskbar=new Ext.ux.TaskBar(a);this.xTickSize=this.yTickSize=1;var k=this.taskbar;var u=Ext.get(&quot;x-desktop&quot;);var m=Ext.get(&quot;bureau&quot;);var p=Ext.get(&quot;toppanel&quot;);var d=Ext.get(&quot;ux-taskbar&quot;);var n=Ext.get(&quot;x-shortcuts&quot;);var q=new Ext.WindowGroup();var g;function e(z){z.minimized=true;z.hide()}function t(z){if(g&amp;&amp;g!=z){v(g)}k.setActiveButton(z.taskButton);g=z;Ext.fly(z.taskButton.el).addClass(&quot;active-win&quot;);z.minimized=false}function v(z){if(z==g){g=null;Ext.fly(z.taskButton.el).removeClass(&quot;active-win&quot;)}}function l(){u.setHeight(Ext.lib.Dom.getViewHeight()-d.getHeight());m.setHeight(Ext.lib.Dom.getViewHeight()-d.getHeight()-p.getHeight())}function b(z){k.removeTaskButton(z.taskButton);l()}Ext.EventManager.onWindowResize(l);this.layout=l;this.createWindow=function(A,z){var B=new (z||Ext.ux.stateFullWindow)(Ext.applyIf(A||{},{renderTo:u,manager:q,minimizable:true,maximizable:true,listeners:{show:function(D){var C=D.getSize();C.width=C.width+1;D.setSize(C);D.doLayout()}},cfgWindow:A.cfgWindow}));B.dd.xTickSize=this.xTickSize;B.dd.yTickSize=this.yTickSize;B.resizer.widthIncrement=this.xTickSize;B.resizer.heightIncrement=this.yTickSize;B.render(u);B.taskButton=k.addTaskButton(B);B.cmenu=new Ext.menu.Menu({items:[]});B.animateTarget=B.taskButton.el;B.on({activate:{fn:t},beforeshow:{fn:t},deactivate:{fn:v},minimize:{fn:e},close:{fn:b}});l();return B};this.getManager=function(){return q};this.getWindow=function(z){return q.get(z)};this.getWinWidth=function(){var z=Ext.lib.Dom.getViewWidth();return z&lt;200?200:z};this.getWinHeight=function(){var z=(Ext.lib.Dom.getViewHeight()-d.getHeight());return z&lt;100?100:z};this.getWinX=function(z){return(Ext.lib.Dom.getViewWidth()-z)/2};this.getWinY=function(z){return(Ext.lib.Dom.getViewHeight()-d.getHeight()-z)/2};this.setTickSize=function(z,A){this.xTickSize=z;if(arguments.length==1){this.yTickSize=z}else{this.yTickSize=A}q.each(function(B){B.dd.xTickSize=this.xTickSize;B.dd.yTickSize=this.yTickSize;B.resizer.widthIncrement=this.xTickSize;B.resizer.heightIncrement=this.yTickSize},this)};this.cascade=function(){var z=0,A=0;q.each(function(B){if(B.isVisible()&amp;&amp;!B.maximized){B.setPosition(z,A);z+=20;A+=20}},this)};this.tile=function(){var C=u.getWidth(true);var z=this.xTickSize;var B=this.yTickSize;var A=B;q.each(function(E){if(E.isVisible()&amp;&amp;!E.maximized){var D=E.el.getWidth();if((z&gt;this.xTickSize)&amp;&amp;(z+D&gt;C)){z=this.xTickSize;B=A}E.setPosition(z,B);z+=D+this.xTickSize;A=Math.max(A,B+E.el.getHeight()+this.yTickSize)}},this)};this.contextMenu=new Ext.menu.Menu({items:[{text:&quot;Tile&quot;,handler:this.tile,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/presentation2.png&quot;},{text:&quot;Cascade&quot;,handler:this.cascade,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/icons/presentation1.png&quot;}]});u.on(&quot;contextmenu&quot;,function(z){if(z.target.className!=&quot;flotr-canvas&quot;&amp;&amp;z.target.className!=&quot;flotr-overlay&quot;){z.stopEvent();this.contextMenu.showAt(z.getXY())}},this);l();if(n){n.on(&quot;click&quot;,function(B,A){if(A=B.getTarget(&quot;dt&quot;,n)){B.stopEvent();var z=a.getModule(A.id.replace(&quot;-shortcut&quot;,&quot;&quot;));if(z){z.createWindow()}}})}this.getDesktopEl=function(){return Ext.get(&quot;x-desktop&quot;)}};
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.app.App=function(a){Ext.apply(this,a);this.addEvents({ready:true,beforeunload:true});var d=this;var b=function(){Ext.QuickTips.init();d.initApp()};var g=function(){projectGlobal.getUserRoles(b)};var k=function(){loadUrl.load(&quot;/sitools/client-user/siteMap&quot;,g)};if(!Ext.isEmpty(Ext.util.Cookies.get(&quot;userLogin&quot;))){var e=Ext.util.Cookies.get(&quot;hashCode&quot;);Ext.Ajax.defaultHeaders={Authorization:e,Accept:&quot;application/json&quot;,&quot;User-Agent&quot;:&quot;Sitools&quot;}}else{Ext.Ajax.defaultHeaders={Accept:&quot;application/json&quot;,&quot;User-Agent&quot;:&quot;Sitools&quot;}}if(!Ext.isEmpty(userLogin)){Ext.Ajax.request({url:&quot;/sitools/userstorage/&quot;+userLogin+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/portal/portal&quot;,method:&quot;GET&quot;,success:function(l){if(Ext.isEmpty(l.responseText)){i18n.load(&quot;/sitools/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k);return}try{var m=Ext.decode(l.responseText);if(Ext.isEmpty(m.language)){i18n.load(&quot;/sitools/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k)}else{i18n.load(&quot;/sitools/res/i18n/&quot;+m.language+&quot;/gui.properties&quot;,k)}}catch(n){i18n.load(&quot;/sitools/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k)}},failure:function(){i18n.load(&quot;/sitools/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k)}})}else{i18n.load(&quot;/sitools/res/i18n/&quot;+LOCALE+&quot;/gui.properties&quot;,k)}};Ext.extend(Ext.app.App,Ext.util.Observable,{isReady:false,modules:null,fisheye:null,getStartConfig:function(){},initApp:function(){this.startConfig=this.startConfig||this.getStartConfig();this.desktop=new Ext.Desktop(this);this.tabMenu=[];this.launcher=this.desktop.taskbar.startMenu;this.modules=this.getModules();if(this.modules){this.initModules(this.modules)}this.init();Ext.EventManager.on(window,&quot;beforeunload&quot;,this.onUnload,this);this.isReady=true},getModules:Ext.emptyFn,init:Ext.emptyFn,initModules:function(d){this.modules=d;for(var e=0,b=d.length;e&lt;b;e++){var a=d[e];this.launcher.add(a.launcher);this.tabMenu.push(a.fisheye);a.app=this}this.fisheye=new Ext.ux.FisheyeMenuExtention({renderTo:&quot;fisheye-menu-bottom&quot;,hAlign:&quot;center&quot;,vAlign:&quot;bottom&quot;,itemWidth:60,items:this.tabMenu});this.isReady=true},addModule:function(a){this.launcher.add(a.launcher);this.fisheye.addItem(a.fisheye);a.app=this},removeModule:function(a){this.launcher.remove(a.id);this.fisheye.removeItem(a.fisheye.id);this.modules.remove(a)},getModule:function(d){var b=this.modules;if(!Ext.isEmpty(b)){for(var e=0,a=b.length;e&lt;a;e++){if(b[e].id==d||b[e].appType==d){return b[e]}}}return&quot;&quot;},getDesktop:function(){return this.desktop},getFisheyeMenu:function(){return this.fisheye},onUnload:function(a){if(this.fireEvent(&quot;beforeunload&quot;,this)===false){a.stopEvent()}},showSpinner:function(){Ext.getBody().mask(&quot;loading...&quot;,&quot;x-mask-loading&quot;)},hideSpinner:function(){if(Ext.getBody().isMasked()){Ext.getBody().unmask()}}});
/*!
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.app.Module=function(a){Ext.apply(this,a);Ext.app.Module.superclass.constructor.call(this);this.init()};Ext.extend(Ext.app.Module,Ext.util.Observable,{init:Ext.emptyFn});Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.ux.grid.CheckColumn=Ext.extend(Ext.Component,{enabled:true,init:function(a){this.grid=a;this.grid.on(&quot;render&quot;,function(){var b=this.grid.getView();b.mainBody.on(&quot;mousedown&quot;,this.onMouseDown,this)},this)},onMouseDown:function(g,d){if(Ext.fly(d).hasClass(this.createId())&amp;&amp;Ext.fly(d).hasClass(&quot;x-grid3-check-col-enabled&quot;)){g.stopEvent();var b=this.grid.getView().findRowIndex(d);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,e,a){e.css+=&quot; x-grid3-check-col-td&quot;;var d=Ext.getCmp(this.id);if(d.enabled){return String.format('&lt;div id=&quot;{2}&quot; class=&quot;x-grid3-check-col{0} x-grid3-check-col-enabled {1}&quot;&gt;&amp;#160;&lt;/div&gt;',b?&quot;-on&quot;:&quot;&quot;,d.createId(),this.id)}else{return String.format('&lt;div id=&quot;{2}&quot; class=&quot;x-grid3-check-disabled-col{0} {1}&quot;&gt;&amp;#160;&lt;/div&gt;',b?&quot;-on&quot;:&quot;&quot;,d.createId(),this.id)}},createId:function(){return&quot;x-grid3-cc-&quot;+this.id},getEnabled:function(){return this.enabled},setEnabled:function(a){this.enabled=a}});Ext.preg(&quot;checkcolumn&quot;,Ext.ux.grid.CheckColumn);Ext.grid.CheckColumn=Ext.ux.grid.CheckColumn;Ext.namespace(&quot;sitools.siteMap&quot;);var loadUrl={map:[],load:function(a,e,b){var d=this;d.transformsPropertiesToMap(a,e,b)},transformsPropertiesToMap:function(b,g,d){var a=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:b,restful:true}),reader:new Ext.data.XmlReader({record:&quot;url&quot;},[{name:&quot;name&quot;,mapping:&quot;name&quot;},{name:&quot;loc&quot;,mapping:&quot;loc&quot;}])});var e=this.map;a.load({scope:d,callback:function(p,m,t){var n=0;while(n!=undefined){var q=p[n];if(q!=undefined){var l=q.data.loc;var k=q.data.name;e[k]=l;n++}else{n=undefined}}g.call(this)}})},get:function(a){return !Ext.isEmpty(this.map[a])?this.map[a]:a}};var componentManager={loadedComponents:[],load:function(a){}};var data={ret:null,get:function(b,a){Ext.Ajax.request({method:&quot;GET&quot;,url:b,success:function(d,e){a(Ext.decode(d.responseText))},failure:function(d,e){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+b)}});return this.ret}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this)}});Ext.ux.sitoolsGridView=Ext.extend(Ext.grid.GridView,{beforeColMenuShow:function(){var a=this.cm,d=a.getColumnCount();this.colMenu.removeAll();for(var b=0;b&lt;d;b++){if(a.config[b].hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:&quot;col-&quot;+a.getColumnId(b),text:a.getColumnHeader(b),checked:!a.isHidden(b),hideOnClick:false,disabled:a.config[b].hideable===false,listeners:{scope:this,checkchange:function(g,k){if(k){var e=extColModelToSrv(this.cm);this.grid.getStore().load({params:{colModel:Ext.util.JSON.encode(e)}})}}}}))}}},doRender:function(e,D,p,a,z,B){var g=this.templates,d=g.cell,K=g.row,t=z-1;var b=&quot;width:&quot;+this.getTotalWidth()+&quot;;&quot;;var m=[],n=[],q={tstyle:b},v={},l,k;for(var A=0,E=D.length;A&lt;E;A++){k=D[A];n=[];var u=A+a;for(var C=0;C&lt;z;C++){l=e[C];v.id=l.id;v.css=C===0?&quot;x-grid3-cell-first &quot;:(C==t?&quot;x-grid3-cell-last &quot;:&quot;&quot;);v.attr=v.cellAttr=&quot;&quot;;v.style=l.style;v.value=l.renderer.call(l.scope,k.data[l.name],v,k,u,C,p);if(Ext.isEmpty(v.value)){v.value=&quot;&amp;#160;&quot;}if(this.markDirty&amp;&amp;k.dirty&amp;&amp;Ext.isDefined(k.modified[l.name])){v.css+=&quot; x-grid3-dirty-cell&quot;}n[n.length]=d.apply(v)}var J=[];if(B&amp;&amp;((u+1)%2===0)){J[0]=&quot;x-grid3-row-alt&quot;}if(k.dirty){J[1]=&quot; x-grid3-dirty-row&quot;}q.cols=z;if(this.getRowClass){J[2]=this.getRowClass(k,u,q,p)}q.alt=J.join(&quot; &quot;);q.cells=n.join(&quot;&quot;);m[m.length]=K.apply(q)}if(D.length==0){var J=[];q.cols=z;q.cells=&quot; &quot;;m[0]=K.apply(q)}return m.join(&quot;&quot;)},renderRows:function(n,d){var e=this.grid,l=e.colModel,a=e.store,p=e.stripeRows;var m=l.getColumnCount();var k=this.getColumnData();n=n||0;d=!Ext.isDefined(d)?a.getCount()-1:d;var b=a.getRange(n,d);return this.doRender(k,b,a,n,m,p)}});var Base64={_keyStr:&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;,encode:function(d){var a=&quot;&quot;;var p,m,k,n,l,g,e;var b=0;d=Base64._utf8_encode(d);while(b&lt;d.length){p=d.charCodeAt(b++);m=d.charCodeAt(b++);k=d.charCodeAt(b++);n=p&gt;&gt;2;l=((p&amp;3)&lt;&lt;4)|(m&gt;&gt;4);g=((m&amp;15)&lt;&lt;2)|(k&gt;&gt;6);e=k&amp;63;if(isNaN(m)){g=e=64}else{if(isNaN(k)){e=64}}a=a+this._keyStr.charAt(n)+this._keyStr.charAt(l)+this._keyStr.charAt(g)+this._keyStr.charAt(e)}return a},decode:function(d){var a=&quot;&quot;;var p,m,k;var n,l,g,e;var b=0;d=d.replace(/[^A-Za-z0-9\+\/\=]/g,&quot;&quot;);while(b&lt;d.length){n=this._keyStr.indexOf(d.charAt(b++));l=this._keyStr.indexOf(d.charAt(b++));g=this._keyStr.indexOf(d.charAt(b++));e=this._keyStr.indexOf(d.charAt(b++));p=(n&lt;&lt;2)|(l&gt;&gt;4);m=((l&amp;15)&lt;&lt;4)|(g&gt;&gt;2);k=((g&amp;3)&lt;&lt;6)|e;a=a+String.fromCharCode(p);if(g!=64){a=a+String.fromCharCode(m)}if(e!=64){a=a+String.fromCharCode(k)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,&quot;\n&quot;);var a=&quot;&quot;;for(var e=0;e&lt;b.length;e++){var d=b.charCodeAt(e);if(d&lt;128){a+=String.fromCharCode(d)}else{if((d&gt;127)&amp;&amp;(d&lt;2048)){a+=String.fromCharCode((d&gt;&gt;6)|192);a+=String.fromCharCode((d&amp;63)|128)}else{a+=String.fromCharCode((d&gt;&gt;12)|224);a+=String.fromCharCode(((d&gt;&gt;6)&amp;63)|128);a+=String.fromCharCode((d&amp;63)|128)}}}return a},_utf8_decode:function(a){var b=&quot;&quot;;var d=0;var e=c1=c2=0;while(d&lt;a.length){e=a.charCodeAt(d);if(e&lt;128){b+=String.fromCharCode(e);d++}else{if((e&gt;191)&amp;&amp;(e&lt;224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&amp;31)&lt;&lt;6)|(c2&amp;63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&amp;15)&lt;&lt;12)|((c2&amp;63)&lt;&lt;6)|(c3&amp;63));d+=3}}}return b}};function array(a){for(i=0;i&lt;a;i++){this[i]=0}this.length=a}function integer(a){return a%(4294967295+1)}function shr(e,d){e=integer(e);d=integer(d);if(e-2147483648&gt;=0){e=e%2147483648;e&gt;&gt;=d;e+=1073741824&gt;&gt;(d-1)}else{e&gt;&gt;=d}return e}function shl1(b){b=b%2147483648;if(b&amp;1073741824==1073741824){b-=1073741824;b*=2;b+=2147483648}else{b*=2}return b}function shl(e,d){e=integer(e);d=integer(d);for(var g=0;g&lt;d;g++){e=shl1(e)}return e}function and(e,d){e=integer(e);d=integer(d);var k=(e-2147483648);var g=(d-2147483648);if(k&gt;=0){if(g&gt;=0){return((k&amp;g)+2147483648)}else{return(k&amp;d)}}else{if(g&gt;=0){return(e&amp;g)}else{return(e&amp;d)}}}function or(e,d){e=integer(e);d=integer(d);var k=(e-2147483648);var g=(d-2147483648);if(k&gt;=0){if(g&gt;=0){return((k|g)+2147483648)}else{return((k|d)+2147483648)}}else{if(g&gt;=0){return((e|g)+2147483648)}else{return(e|d)}}}function xor(e,d){e=integer(e);d=integer(d);var k=(e-2147483648);var g=(d-2147483648);if(k&gt;=0){if(g&gt;=0){return(k^g)}else{return((k^d)+2147483648)}}else{if(g&gt;=0){return((e^g)+2147483648)}else{return(e^d)}}}function not(b){b=integer(b);return(4294967295-b)}var state=new array(4);var count=new array(2);count[0]=0;count[1]=0;var buffer=new array(64);var transformBuffer=new array(16);var digestBits=new array(16);var S11=7;var S12=12;var S13=17;var S14=22;var S21=5;var S22=9;var S23=14;var S24=20;var S31=4;var S32=11;var S33=16;var S34=23;var S41=6;var S42=10;var S43=15;var S44=21;function F(a,d,b){return or(and(a,d),and(not(a),b))}function G(a,d,b){return or(and(a,b),and(d,not(b)))}function H(a,d,b){return xor(xor(a,d),b)}function I(a,d,b){return xor(d,or(a,not(b)))}function rotateLeft(b,d){return or(shl(b,d),(shr(b,(32-d))))}function FF(k,g,p,n,e,l,m){k=k+F(g,p,n)+e+m;k=rotateLeft(k,l);k=k+g;return k}function GG(k,g,p,n,e,l,m){k=k+G(g,p,n)+e+m;k=rotateLeft(k,l);k=k+g;return k}function HH(k,g,p,n,e,l,m){k=k+H(g,p,n)+e+m;k=rotateLeft(k,l);k=k+g;return k}function II(k,g,p,n,e,l,m){k=k+I(g,p,n)+e+m;k=rotateLeft(k,l);k=k+g;return k}function transform(l,n){var k=0,g=0,p=0,m=0;var e=transformBuffer;k=state[0];g=state[1];p=state[2];m=state[3];for(i=0;i&lt;16;i++){e[i]=and(l[i*4+n],255);for(j=1;j&lt;4;j++){e[i]+=shl(and(l[i*4+j+n],255),j*8)}}k=FF(k,g,p,m,e[0],S11,3614090360);m=FF(m,k,g,p,e[1],S12,3905402710);p=FF(p,m,k,g,e[2],S13,606105819);g=FF(g,p,m,k,e[3],S14,3250441966);k=FF(k,g,p,m,e[4],S11,4118548399);m=FF(m,k,g,p,e[5],S12,1200080426);p=FF(p,m,k,g,e[6],S13,2821735955);g=FF(g,p,m,k,e[7],S14,4249261313);k=FF(k,g,p,m,e[8],S11,1770035416);m=FF(m,k,g,p,e[9],S12,2336552879);p=FF(p,m,k,g,e[10],S13,4294925233);g=FF(g,p,m,k,e[11],S14,2304563134);k=FF(k,g,p,m,e[12],S11,1804603682);m=FF(m,k,g,p,e[13],S12,4254626195);p=FF(p,m,k,g,e[14],S13,2792965006);g=FF(g,p,m,k,e[15],S14,1236535329);k=GG(k,g,p,m,e[1],S21,4129170786);m=GG(m,k,g,p,e[6],S22,3225465664);p=GG(p,m,k,g,e[11],S23,643717713);g=GG(g,p,m,k,e[0],S24,3921069994);k=GG(k,g,p,m,e[5],S21,3593408605);m=GG(m,k,g,p,e[10],S22,38016083);p=GG(p,m,k,g,e[15],S23,3634488961);g=GG(g,p,m,k,e[4],S24,3889429448);k=GG(k,g,p,m,e[9],S21,568446438);m=GG(m,k,g,p,e[14],S22,3275163606);p=GG(p,m,k,g,e[3],S23,4107603335);g=GG(g,p,m,k,e[8],S24,1163531501);k=GG(k,g,p,m,e[13],S21,2850285829);m=GG(m,k,g,p,e[2],S22,4243563512);p=GG(p,m,k,g,e[7],S23,1735328473);g=GG(g,p,m,k,e[12],S24,2368359562);k=HH(k,g,p,m,e[5],S31,4294588738);m=HH(m,k,g,p,e[8],S32,2272392833);p=HH(p,m,k,g,e[11],S33,1839030562);g=HH(g,p,m,k,e[14],S34,4259657740);k=HH(k,g,p,m,e[1],S31,2763975236);m=HH(m,k,g,p,e[4],S32,1272893353);p=HH(p,m,k,g,e[7],S33,4139469664);g=HH(g,p,m,k,e[10],S34,3200236656);k=HH(k,g,p,m,e[13],S31,681279174);m=HH(m,k,g,p,e[0],S32,3936430074);p=HH(p,m,k,g,e[3],S33,3572445317);g=HH(g,p,m,k,e[6],S34,76029189);k=HH(k,g,p,m,e[9],S31,3654602809);m=HH(m,k,g,p,e[12],S32,3873151461);p=HH(p,m,k,g,e[15],S33,530742520);g=HH(g,p,m,k,e[2],S34,3299628645);k=II(k,g,p,m,e[0],S41,4096336452);m=II(m,k,g,p,e[7],S42,1126891415);p=II(p,m,k,g,e[14],S43,2878612391);g=II(g,p,m,k,e[5],S44,4237533241);k=II(k,g,p,m,e[12],S41,1700485571);m=II(m,k,g,p,e[3],S42,2399980690);p=II(p,m,k,g,e[10],S43,4293915773);g=II(g,p,m,k,e[1],S44,2240044497);k=II(k,g,p,m,e[8],S41,1873313359);m=II(m,k,g,p,e[15],S42,4264355552);p=II(p,m,k,g,e[6],S43,2734768916);g=II(g,p,m,k,e[13],S44,1309151649);k=II(k,g,p,m,e[4],S41,4149444226);m=II(m,k,g,p,e[11],S42,3174756917);p=II(p,m,k,g,e[2],S43,718787259);g=II(g,p,m,k,e[9],S44,3951481745);state[0]+=k;state[1]+=g;state[2]+=p;state[3]+=m}function init(){count[0]=count[1]=0;state[0]=1732584193;state[1]=4023233417;state[2]=2562383102;state[3]=271733878;for(i=0;i&lt;digestBits.length;i++){digestBits[i]=0}}function update(a){var d,e;d=and(shr(count[0],3),63);if(count[0]&lt;4294967295-7){count[0]+=8}else{count[1]++;count[0]-=4294967295+1;count[0]+=8}buffer[d]=and(a,255);if(d&gt;=63){transform(buffer,0)}}function finish(){var e=new array(8);var g;var d=0,b=0,a=0;for(d=0;d&lt;4;d++){e[d]=and(shr(count[0],(d*8)),255)}for(d=0;d&lt;4;d++){e[d+4]=and(shr(count[1],(d*8)),255)}b=and(shr(count[0],3),63);a=(b&lt;56)?(56-b):(120-b);g=new array(64);g[0]=128;for(d=0;d&lt;a;d++){update(g[d])}for(d=0;d&lt;8;d++){update(e[d])}for(d=0;d&lt;4;d++){for(j=0;j&lt;4;j++){digestBits[d*4+j]=and(shr(state[d],(j*8)),255)}}}function hexa(e){var d=&quot;0123456789abcdef&quot;;var a=&quot;&quot;;var b=e;for(hexa_i=0;hexa_i&lt;8;hexa_i++){a=d.charAt(Math.abs(b)%16)+a;b=Math.floor(b/16)}return a}var ascii=&quot;01234567890123456789012345678901 !\&quot;#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~&quot;;function MD5(p){var a,m,b,n,g,e,d;init();for(b=0;b&lt;p.length;b++){a=p.charAt(b);update(ascii.lastIndexOf(a))}finish();n=g=e=d=0;for(i=0;i&lt;4;i++){n+=shl(digestBits[15-i],(i*8))}for(i=4;i&lt;8;i++){g+=shl(digestBits[15-i],((i-4)*8))}for(i=8;i&lt;12;i++){e+=shl(digestBits[15-i],((i-8)*8))}for(i=12;i&lt;16;i++){d+=shl(digestBits[15-i],((i-12)*8))}m=hexa(d)+hexa(e)+hexa(g)+hexa(n);return m}function Digest(a){this.url=a.url;this.usr=a.usr;this.pwd=a.pwd;this.realm=a.realm;this.algorithm=a.algorithm;this.nonce=a.nonce;this.method=a.method;this.mode=a.mode;this.A1=a.A1;this.getDigestAuth=function(){this.resetHeaders();return this.buildAuthenticationRequest()};this.getA1=function(){this.resetHeaders();return this.digest(this.usr+&quot;:&quot;+this.realm+&quot;:&quot;+this.pwd)};this.resetHeaders=function(){if(typeof(this.headers)!=&quot;undefined&quot;){delete this.headers}this.headers={uri:this.url,username:this.usr,algorithm:this.algorithm,realm:this.realm,nonce:this.nonce}};this.digest=function(b){if(typeof(window[this.headers.algorithm])!=&quot;function&quot;){if(typeof(window.MD5)!=&quot;function&quot;){alert(&quot;Votre navigateur ne supporte pas l'authentification HTTP Digest !&quot;);return false}else{return MD5(b)}}return window[this.headers.algorithm](b)};this.buildResponseHash=function(){if(this.headers.salt){auth.secret=auth.secret+&quot;:&quot;+auth.headers.salt;delete auth.headers.salt}if(this.headers.migrate){auth.secret=this.digest(auth.secret)}var d;if(Ext.isEmpty(this.A1)){d=this.getA1()}else{d=this.A1}var b=this.digest(this.method+&quot;:&quot;+this.headers.uri);if(this.mode==&quot;digest&quot;){return this.digest(d+&quot;:&quot;+this.headers.nonce+&quot;:&quot;+b)}return null};this.buildAuthenticationRequest=function(){var e=&quot;Digest&quot;;var b=&quot; &quot;;for(name in this.headers){e+=b+name+'=&quot;'+this.headers[name]+'&quot;';b=&quot;,&quot;}if(typeof(this.headers.algorithm)==&quot;undefined&quot;){return e}var d=this.buildResponseHash();if(d){e+=', response=&quot;'+d+'&quot;';return e}return false}}function ann(b,a){if(b===true||b===false){return}if(b===undefined){cerr(&quot;Object is undefined - &quot;+a);ctrace();return}if(b===null){cerr(&quot;Object is null - &quot;+a);ctrace();return}if(b===&quot;&quot;){cerr(&quot;String seems empty - &quot;+a);ctrace();return}if(b==NaN){cerr(&quot;Object equals NaN - &quot;+a);ctrace();return}}function assert(b,a){if(!b){cerr(&quot;Condition is not valid : &quot;+a);ctrace();return}}function clog(a){if(isFirebugConsoleIsActive()){console.log(a)}}function cerr(a){if(isFirebugConsoleIsActive()){console.trace()}}function ctrace(){if(isFirebugConsoleIsActive()){console.trace()}}function cdir(a){if(isFirebugConsoleIsActive()){console.dir(a)}}function isFirebugConsoleIsActive(){try{if(console!==null&amp;&amp;console!==undefined){return true}else{return false}}catch(a){return false}}Ext.ns(&quot;sitools.common.utils&quot;);sitools.common.utils.Date={regToday:new RegExp(&quot;^{\\$TODAY} *(\\+ *[0-9]*|\\- *[0-9]*)?$&quot;),timeInterval:Date.DAY,stringWithTodayToDate:function(e){if(Ext.isDate(e)){return e}if(!this.regToday.test(e)){return null}var d=new RegExp(&quot;[0-9]+&quot;,&quot;g&quot;);var b=new RegExp(&quot;[+]|[-]&quot;);var k=parseFloat(d.exec(e));var g=b.exec(e);var a=new Date();if(Ext.isEmpty(k)&amp;&amp;!Ext.isEmpty(g)){return null}if(!Ext.isEmpty(k)&amp;&amp;!Ext.isEmpty(g)){if(g==&quot;-&quot;){k=k*-1}a=a.add(this.timeInterval,k)}return a},isValidDate:function(a){if(Object.prototype.toString.call(a)!==&quot;[object Date]&quot;){return false}return !isNaN(a.getTime())}};function URL(url){if(url.length==0){eval('throw &quot;Invalid URL ['+url+&quot;];&quot;)}this.url=url;this.port=-1;this.query=(this.url.indexOf(&quot;?&quot;)&gt;=0)?this.url.substring(this.url.indexOf(&quot;?&quot;)+1):&quot;&quot;;if(this.query.indexOf(&quot;#&quot;)&gt;=0){this.query=this.query.substring(0,this.query.indexOf(&quot;#&quot;))}this.protocol=&quot;&quot;;this.host=&quot;&quot;;var protocolSepIndex=this.url.indexOf(&quot;://&quot;);if(protocolSepIndex&gt;=0){this.protocol=this.url.substring(0,protocolSepIndex).toLowerCase();this.host=this.url.substring(protocolSepIndex+3);if(this.host.indexOf(&quot;/&quot;)&gt;=0){this.host=this.host.substring(0,this.host.indexOf(&quot;/&quot;))}var atIndex=this.host.indexOf(&quot;@&quot;);if(atIndex&gt;=0){var credentials=this.host.substring(0,atIndex);var colonIndex=credentials.indexOf(&quot;:&quot;);if(colonIndex&gt;=0){this.username=credentials.substring(0,colonIndex);this.password=credentials.substring(colonIndex)}else{this.username=credentials}this.host=this.host.substring(atIndex+1)}var portColonIndex=this.host.indexOf(&quot;:&quot;);if(portColonIndex&gt;=0){this.port=this.host.substring(portColonIndex);this.host=this.host.substring(0,portColonIndex)}this.file=this.url.substring(protocolSepIndex+3);this.file=this.file.substring(this.file.indexOf(&quot;/&quot;))}else{this.file=this.url}if(this.file.indexOf(&quot;?&quot;)&gt;=0){this.file=this.file.substring(0,this.file.indexOf(&quot;?&quot;))}var refSepIndex=url.indexOf(&quot;#&quot;);if(refSepIndex&gt;=0){this.file=this.file.substring(0,refSepIndex);this.reference=this.url.substring(this.url.indexOf(&quot;#&quot;))}else{this.reference=&quot;&quot;}this.path=this.file;if(this.query.length&gt;0){this.file+=&quot;?&quot;+this.query}if(this.reference.length&gt;0){this.file+=&quot;#&quot;+this.reference}this.getPort=getPort;this.getQuery=getQuery;this.getProtocol=getProtocol;this.getHost=getHost;this.getUserName=getUserName;this.getPassword=getPassword;this.getFile=getFile;this.getReference=getReference;this.getPath=getPath;this.getArgumentValue=getArgumentValue;this.getArgumentValues=getArgumentValues;this.toString=toString;function getPort(){return this.port}function getQuery(){return this.query}function getProtocol(){return this.protocol}function getHost(){return this.host}function getUserName(){return this.username}function getPassword(){return this.password}function getFile(){return this.file}function getReference(){return this.reference}function getPath(){return this.path}function getArgumentValue(key){var a=this.getArgumentValues();if(a.length&lt;1){return&quot;&quot;}for(var i=0;i&lt;a.length;i++){if(a[i][0]==key){return a[i][1]}}return&quot;&quot;}function getArgumentValues(){var a=new Array();var b=this.query.split(&quot;&amp;amp;&quot;);var c=&quot;&quot;;if(b.length&lt;1){return a}for(var i=0;i&lt;b.length;i++){c=b[i].split(&quot;=&quot;);a[i]=new Array(c[0],((c.length==1)?c[0]:c[1]))}return a}function toString(){return this.url}}Ext.ns(&quot;sitools.common.utils&quot;);sitools.common.utils.Utils={arrayProperties2Object:function(b){var a={};Ext.each(b,function(d){if(!Ext.isEmpty(d.name)&amp;&amp;!Ext.isEmpty(d.value)){a[d.name]=d.value}});return a}};sitoolsUtils=sitools.common.utils.Utils;Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:&quot;x-statusbar&quot;,busyIconCls:&quot;x-status-busy&quot;,busyText:&quot;Loading...&quot;,autoClear:5000,emptyText:&quot;&amp;nbsp;&quot;,activeThreadId:0,initComponent:function(){if(this.statusAlign==&quot;right&quot;){this.cls+=&quot; x-status-right&quot;}Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var a=this.statusAlign==&quot;right&quot;;this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:&quot;x-status-text &quot;+(this.currIconCls||&quot;&quot;),text:this.text||this.defaultText||&quot;&quot;});if(a){this.add(&quot;-&gt;&quot;);this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,&quot;-&gt;&quot;)}this.doLayout()},setStatus:function(d){d=d||{};if(typeof d==&quot;string&quot;){d={text:d}}if(d.text!==undefined){this.setText(d.text)}if(d.iconCls!==undefined){this.setIcon(d.iconCls)}if(d.clear){var e=d.clear,b=this.autoClear,a={useDefaults:true,anim:true};if(typeof e==&quot;object&quot;){e=Ext.applyIf(e,a);if(e.wait){b=e.wait}}else{if(typeof e==&quot;number&quot;){b=e;e=a}else{if(typeof e==&quot;boolean&quot;){e=a}}}e.threadId=this.activeThreadId;this.clearStatus.defer(b,this,[e])}return this},clearStatus:function(d){d=d||{};if(d.threadId&amp;&amp;d.threadId!==this.activeThreadId){return this}var b=d.useDefaults?this.defaultText:this.emptyText,a=d.useDefaults?(this.defaultIconCls?this.defaultIconCls:&quot;&quot;):&quot;&quot;;if(d.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:b,iconCls:a});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:b,iconCls:a});this.statusEl.show()}return this},setText:function(a){this.activeThreadId++;this.text=a||&quot;&quot;;if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(a){this.activeThreadId++;a=a||&quot;&quot;;if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(a.length&gt;0){this.statusEl.addClass(a);this.currIconCls=a}}else{this.currIconCls=a}return this},showBusy:function(a){if(typeof a==&quot;string&quot;){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.reg(&quot;statusbar&quot;,Ext.ux.StatusBar);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.Login=Ext.extend(Ext.Window,{id:&quot;winLogin&quot;,layout:&quot;hbox&quot;,width:392,height:200,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get(&quot;label.login&quot;);this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbWinLogin&quot;,iconCls:&quot;x-status-valid&quot;,items:[{text:i18n.get(&quot;label.passwordLost&quot;),hidden:!this.reset,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/wadl.gif&quot;,iconAlign:&quot;right&quot;,handler:function(){Ext.getCmp(&quot;winLogin&quot;).close();var a=new sitools.widget.resetPassword({closable:this.closable,url:this.reset,handler:this.handler});a.show()}}]});this.combo=new Ext.form.ComboBox({typeAhead:true,triggerAction:&quot;all&quot;,forceSelection:true,allowBlank:false,lazyRender:true,mode:&quot;local&quot;,store:new Ext.data.ArrayStore({id:0,fields:[&quot;myId&quot;,&quot;displayText&quot;],data:[[1,i18n.get(&quot;label.userPortal&quot;)],[2,i18n.get(&quot;label.administration&quot;)]]}),valueField:&quot;myId&quot;,displayField:&quot;displayText&quot;,anchor:&quot;80%&quot;,value:1,fieldLabel:i18n.get(&quot;label.target&quot;),hideLabel:true});if(this.chooseLocation){this.combo.setVisible(true);this.combo.hideLabel=false}else{this.combo.setVisible(false);this.setSize(392,160)}this.items=[{xtype:&quot;form&quot;,frame:false,border:false,buttonAlign:&quot;center&quot;,id:&quot;frmLogin&quot;,bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get(&quot;APP_URL&quot;)+'/common/res/images/ux/login-big.gif&quot;) no-repeat #dfe8f6;',width:392,labelWidth:100,items:[{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),name:&quot;login&quot;,id:&quot;logId&quot;,allowBlank:false,anchor:&quot;80%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),name:&quot;password&quot;,id:&quot;pwdId&quot;,allowBlank:false,inputType:&quot;password&quot;,anchor:&quot;80%&quot;,listeners:{scope:this,specialkey:function(b,a){if(a.getKey()==a.ENTER){this.getAuth()}}}},this.combo],buttons:[{text:i18n.get(&quot;label.login&quot;),handler:this.getAuth,scope:this},{text:i18n.get(&quot;label.reset&quot;),handler:function(){Ext.getCmp(&quot;frmLogin&quot;).getForm().reset();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:i18n.get(&quot;label.ready&quot;),iconCls:&quot;x-status-valid&quot;})}},{text:i18n.get(&quot;label.cancel&quot;),hidden:!this.defurl,scope:this,handler:function(){window.location.href=this.defurl}},{text:i18n.get(&quot;label.register&quot;),hidden:!this.register,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh.png&quot;,handler:function(){Ext.getCmp(&quot;winLogin&quot;).close();var a=new sitools.widget.Register({closable:this.closable,url:this.register,login:this.url,handler:this.handler});a.show()}}]}];sitools.widget.Login.superclass.initComponent.call(this)},getAuth:function(){Ext.util.Cookies.set(&quot;A1&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;algorithm&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;realm&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;nonce&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;);Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:&quot;&quot;});Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(k,a){var g=Ext.decode(k.responseText);var d=new Date();if(!Ext.isEmpty(g.data)){if(g.data.scheme==&quot;HTTP_Digest&quot;){var b=new Digest({usr:Ext.getCmp(&quot;logId&quot;).getValue(),pwd:Ext.getCmp(&quot;pwdId&quot;).getValue(),realm:g.data.realm});var e=b.getA1();Ext.util.Cookies.set(&quot;A1&quot;,e);Ext.util.Cookies.set(&quot;userLogin&quot;,b.usr,d.add(Date.MINUTE,1));Ext.util.Cookies.set(&quot;scheme&quot;,g.data.scheme);Ext.util.Cookies.set(&quot;algorithm&quot;,g.data.algorithm);Ext.util.Cookies.set(&quot;realm&quot;,b.realm);Ext.util.Cookies.set(&quot;nonce&quot;,g.data.nonce)}else{if(g.data.scheme==&quot;HTTP_Basic&quot;){var m=Ext.getCmp(&quot;logId&quot;).getValue();var n=Ext.getCmp(&quot;pwdId&quot;).getValue();var p=m+&quot;:&quot;+n;var l=Base64.encode(p);var b=&quot;Basic &quot;+l;Ext.util.Cookies.set(&quot;userLogin&quot;,m,d.add(Date.MINUTE,1));Ext.util.Cookies.set(&quot;scheme&quot;,g.data.scheme);Ext.util.Cookies.set(&quot;hashCode&quot;,b,d.add(Date.MINUTE,1))}}}this.login()},failure:alertFailure})},login:function(){if(!Ext.getCmp(&quot;frmLogin&quot;).getForm().isValid()){Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});return}Ext.getCmp(&quot;winLogin&quot;).body.mask();Ext.getCmp(&quot;sbWinLogin&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(d,g){try{var b=Ext.decode(d.responseText);if(b.success){Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get(&quot;hashCode&quot;)});Ext.getCmp(&quot;winLogin&quot;).close();if(this.chooseLocation){if(this.combo.getValue()==1){window.location.href=loadUrl.get(&quot;APP_URL&quot;)+&quot;/login-redirect?kwd=/client-user/index.html&quot;}else{Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/login-redirect?kwd=/client-admin&quot;,method:&quot;GET&quot;,success:function(k){Ext.Msg.alert(&quot;error login.js redirect with authorization&quot;)}})}}else{window.location.reload()}}else{Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+b.message;Ext.getCmp(&quot;winLogin&quot;).body.unmask();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:a,iconCls:&quot;x-status-error&quot;})}}catch(e){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),e)}},failure:function(b,e){Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;scheme&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var a;if(b.status==200){var d=Ext.decode(b.responseText).error;a=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+d}else{a=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+b.statusText}Ext.getCmp(&quot;winLogin&quot;).body.unmask();Ext.getCmp(&quot;sbWinLogin&quot;).setStatus({text:a,iconCls:&quot;x-status-error&quot;})}})}});Ext.reg(&quot;s-login&quot;,sitools.widget.Login);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.Register=Ext.extend(Ext.Window,{id:&quot;winRegister&quot;,layout:&quot;hbox&quot;,width:420,height:490,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get(&quot;label.register&quot;);this.captchaUrl=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_INSCRIPTIONS_USER_URL&quot;)+&quot;/captcha?width=300&amp;height=50&quot;;this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbWinRegister&quot;,iconCls:&quot;x-status-valid&quot;});this.captcha=new Ext.BoxComponent({id:&quot;captchaBox&quot;,autoEl:{tag:&quot;img&quot;,src:this.captchaUrl+&quot;&amp;_dc=&quot;+new Date().getTime()},fieldLabel:i18n.get(&quot;label.captcha&quot;),height:50,width:300,anchor:&quot;100%&quot;});this.items=[{xtype:&quot;form&quot;,frame:false,border:false,buttonAlign:&quot;center&quot;,id:&quot;frmRegister&quot;,bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get(&quot;APP_URL&quot;)+'/common/res/images/ux/register-big.gif&quot;) no-repeat #dfe8f6;',width:400,height:420,labelWidth:120,items:[{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),name:&quot;identifier&quot;,id:&quot;regLogin&quot;,allowBlank:false,vtype:&quot;uniquelogin&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.firstName&quot;),name:&quot;firstName&quot;,id:&quot;regFirstName&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.lastName&quot;),name:&quot;lastName&quot;,id:&quot;regLastName&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),name:&quot;password&quot;,allowBlank:false,inputType:&quot;password&quot;,vtype:&quot;passwordlength&quot;,id:&quot;pass1&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.confirmPassword&quot;),name:&quot;cpassword&quot;,submitValue:false,allowBlank:false,inputType:&quot;password&quot;,id:&quot;pass2&quot;,initialPassField:&quot;pass1&quot;,vtype:&quot;password&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.email&quot;),id:&quot;regEmail&quot;,name:&quot;email&quot;,vtype:&quot;uniqueemail&quot;,allowBlank:false,validationEvent:&quot;&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,name:&quot;organisation&quot;,fieldLabel:i18n.get(&quot;label.organisation&quot;),anchor:&quot;100%&quot;},{xtype:&quot;textarea&quot;,fieldLabel:i18n.get(&quot;label.comment&quot;),id:&quot;regComment&quot;,name:&quot;comment&quot;,validationEvent:&quot;&quot;,height:40,anchor:&quot;100%&quot;},this.captcha,{xtype:&quot;button&quot;,text:i18n.get(&quot;label.captchaReload&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh.png&quot;,x:150,arrowAlign:&quot;right&quot;,reloadUrl:this.captchaUrl,handler:function(){Ext.util.Cookies.clear(&quot;captcha&quot;);var a=Ext.get(&quot;captchaBox&quot;);a.dom.src=this.reloadUrl+&quot;&amp;_dc=&quot;+new Date().getTime();a.slideIn(&quot;l&quot;)}},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.fieldCaptcha&quot;),name:&quot;captcha&quot;,id:&quot;captcha&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;checkbox&quot;,fieldLabel:String.format(i18n.get(&quot;label.acceptCGU&quot;),URL_CGU),id:&quot;acceptCGU&quot;,name:&quot;acceptCGU&quot;,height:40,anchor:&quot;100%&quot;,submitValue:false}],buttons:[{text:i18n.get(&quot;label.register&quot;),handler:this.register,scope:this},{text:i18n.get(&quot;label.reset&quot;),reloadUrl:this.captchaUrl,handler:function(){Ext.getCmp(&quot;frmRegister&quot;).getForm().reset();Ext.getCmp(&quot;sbWinRegister&quot;).setStatus({text:i18n.get(&quot;label.ready&quot;),iconCls:&quot;x-status-valid&quot;});Ext.util.Cookies.clear(&quot;captcha&quot;);var a=Ext.get(&quot;captchaBox&quot;);a.dom.src=this.reloadUrl+&quot;&amp;_dc=&quot;+new Date().getTime();a.slideIn(&quot;l&quot;)}},{text:i18n.get(&quot;label.login&quot;),hidden:!this.register,scope:this,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/refresh.png&quot;,handler:function(){Ext.getCmp(&quot;winRegister&quot;).close();var a=new sitools.widget.Login({closable:this.closable,url:this.login,register:this.url,handler:this.handler});a.show()}}]}];sitools.widget.Register.superclass.initComponent.call(this)},register:function(){var d=Ext.getCmp(&quot;frmRegister&quot;).getForm();if(!d.findField(&quot;acceptCGU&quot;).getValue()){Ext.getCmp(&quot;sbWinRegister&quot;).setStatus({text:i18n.get(&quot;label.mustAcceptCGU&quot;),iconCls:&quot;x-status-error&quot;});return}if(!d.isValid()){Ext.getCmp(&quot;sbWinRegister&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});this.reloadCaptcha();return}var e=new Object();e.properties=[];Ext.iterate(d.getValues(),function(g,k){if(g==&quot;organisation&quot;){e.properties.push({name:&quot;organisation&quot;,value:k,scope:&quot;Editable&quot;})}else{if(g!=&quot;captcha&quot;){e[g]=k}}},this);var a=Ext.util.Cookies.get(&quot;captcha&quot;);var b=d.findField(&quot;captcha&quot;).getValue();Ext.getCmp(&quot;winRegister&quot;).body.mask();Ext.getCmp(&quot;sbWinRegister&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;POST&quot;,jsonData:e,params:{&quot;captcha.id&quot;:a,&quot;captcha.key&quot;:b},scope:this,success:function(g,l){var k=Ext.decode(g.responseText);if(k.success){new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.registerSent&quot;),autoDestroy:true,hideDelay:1000}).show(document);Ext.getCmp(&quot;winRegister&quot;).close()}else{Ext.getCmp(&quot;winRegister&quot;).body.unmask();Ext.getCmp(&quot;sbWinRegister&quot;).setStatus({text:k.message,iconCls:&quot;x-status-error&quot;})}if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this)}},failure:function(k,m){var g;if(k.status==200){var l=Ext.decode(k.responseText).message;g=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+l}else{if(k.status==403){g=i18n.get(&quot;msg.wrongCaptcha&quot;)}else{g=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+k.statusText}}Ext.getCmp(&quot;winRegister&quot;).body.unmask();Ext.getCmp(&quot;sbWinRegister&quot;).setStatus({text:g,iconCls:&quot;x-status-error&quot;});this.reloadCaptcha()}})},reloadCaptcha:function(){Ext.util.Cookies.clear(&quot;captcha&quot;);var b=Ext.get(&quot;captchaBox&quot;);b.dom.src=this.captchaUrl+&quot;&amp;_dc=&quot;+new Date().getTime();b.slideIn(&quot;l&quot;);var d=Ext.getCmp(&quot;frmRegister&quot;).getForm();var a=d.findField(&quot;captcha&quot;).setValue(&quot;&quot;)}});Ext.reg(&quot;s-register&quot;,sitools.widget.Register);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.resetPassword=Ext.extend(Ext.Window,{id:&quot;winPassword&quot;,layout:&quot;hbox&quot;,width:420,height:183,resizable:false,modal:true,initComponent:function(){this.title=i18n.get(&quot;label.resetPassword&quot;);this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbWinPassword&quot;,iconCls:&quot;x-status-valid&quot;});this.items=[{xtype:&quot;form&quot;,frame:false,border:false,buttonAlign:&quot;center&quot;,id:&quot;frmResetPassword&quot;,bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get(&quot;APP_URL&quot;)+'/common/res/images/ux/login-big.gif&quot;) no-repeat #dfe8f6;',width:400,labelWidth:120,items:[{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),name:&quot;identifier&quot;,id:&quot;regLogin&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.email&quot;),id:&quot;regEmail&quot;,name:&quot;email&quot;,vtype:&quot;uniqueemail&quot;,allowBlank:false,validationEvent:&quot;&quot;,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.emailConfirm&quot;),id:&quot;regEmailConfirm&quot;,name:&quot;emailConfirm&quot;,vtype:&quot;uniqueemail&quot;,allowBlank:false,validationEvent:&quot;&quot;,anchor:&quot;100%&quot;}],buttons:[{text:i18n.get(&quot;label.resetPassword&quot;),handler:this.reset,scope:this},{text:i18n.get(&quot;label.reset&quot;),handler:function(){Ext.getCmp(&quot;frmResetPassword&quot;).getForm().reset();Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:i18n.get(&quot;label.ready&quot;),iconCls:&quot;x-status-valid&quot;})}}]}];sitools.widget.Register.superclass.initComponent.call(this)},reset:function(){var a=Ext.getCmp(&quot;frmResetPassword&quot;).getForm();if(a.findField(&quot;email&quot;).getValue()!=a.findField(&quot;emailConfirm&quot;).getValue()){Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});return}if(!a.isValid()){Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});return}var b=new Object();Ext.iterate(a.getValues(),function(d,e){if(d!=&quot;emailConfirm&quot;){b[d]=e}},this);Ext.getCmp(&quot;winPassword&quot;).body.mask();Ext.getCmp(&quot;sbWinPassword&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,jsonData:b,scope:this,success:function(d,k){var g=Ext.decode(d.responseText);if(g.success){Ext.getCmp(&quot;winPassword&quot;).body.unmask();Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:g.message,iconCls:&quot;x-status-valid&quot;});Ext.getCmp(&quot;winPassword&quot;).close();var e=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:i18n.get(&quot;label.passwordSent&quot;)+g.message,autoDestroy:true,hideDelay:1300});e.show(document)}else{Ext.getCmp(&quot;winPassword&quot;).body.unmask();Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:g.message,iconCls:&quot;x-status-error&quot;})}if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this)}},failure:function(e,k){var d;if(e.status==200){var g=Ext.decode(e.responseText).message;d=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+g}else{d=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+e.statusText}Ext.getCmp(&quot;winPassword&quot;).body.unmask();Ext.getCmp(&quot;sbWinPassword&quot;).setStatus({text:d,iconCls:&quot;x-status-error&quot;})}})}});Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.editProfile=Ext.extend(Ext.Window,{id:&quot;winEditProfile&quot;,layout:&quot;hbox&quot;,width:420,height:410,resizable:false,closable:true,modal:true,initComponent:function(){this.title=i18n.get(&quot;label.editProfile&quot;);this.bbar=new Ext.ux.StatusBar({text:i18n.get(&quot;label.ready&quot;),id:&quot;sbWinEditProfile&quot;,iconCls:&quot;x-status-valid&quot;});var d=new Ext.data.JsonStore({fields:[{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;value&quot;,type:&quot;string&quot;},{name:&quot;scope&quot;,type:&quot;string&quot;}],autoLoad:false});var b=new Ext.grid.RowSelectionModel({singleSelect:true});var a=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,editor:new Ext.form.TextField({readOnly:true})},{header:i18n.get(&quot;headers.value&quot;),dataIndex:&quot;value&quot;,editor:new Ext.form.TextField({allowBlank:false})}],defaults:{sortable:false,width:100}});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get(&quot;title.properties&quot;),id:&quot;userGridProperties&quot;,height:130,autoScroll:true,clicksToEdit:1,store:d,cm:a,sm:b,viewConfig:{forceFit:true,getRowClass:function(k,e){var g=k.data;if(g.scope==&quot;ReadOnly&quot;){return&quot;row-grid-readOnly&quot;}}},listeners:{beforeedit:function(l){var k=l.record.data.scope;var g=l.field;if(k==&quot;ReadOnly&quot;||g==&quot;name&quot;){return false}}}});this.items=[{xtype:&quot;form&quot;,frame:false,border:false,buttonAlign:&quot;center&quot;,id:&quot;frmEditProfile&quot;,bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get(&quot;APP_URL&quot;)+'/common/res/images/ux/login-big.gif&quot;) no-repeat #dfe8f6;',width:400,labelWidth:120,items:[{xtype:&quot;textfield&quot;,name:&quot;identifier&quot;,fieldLabel:i18n.get(&quot;label.login&quot;),anchor:&quot;100%&quot;,allowBlank:false,readOnly:true,style:{color:&quot;#C0C0C0&quot;},id:&quot;nameField&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.firstName&quot;),name:&quot;firstName&quot;,id:&quot;regFirstName&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.lastName&quot;),name:&quot;lastName&quot;,id:&quot;regLastName&quot;,allowBlank:false,anchor:&quot;100%&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.password&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,name:&quot;secret&quot;,value:&quot;&quot;,id:&quot;passwordField&quot;,vtype:&quot;passwordlength&quot;},{id:&quot;confirmSecret&quot;,xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.confirmPassword&quot;),anchor:&quot;100%&quot;,inputType:&quot;password&quot;,initialPassField:&quot;passwordField&quot;,vtype:&quot;password&quot;,name:&quot;confirmSecret&quot;,submitValue:false,value:&quot;&quot;},{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.email&quot;),id:&quot;regEmail&quot;,name:&quot;email&quot;,vtype:&quot;uniqueemail&quot;,allowBlank:false,validationEvent:&quot;&quot;,anchor:&quot;100%&quot;},this.gridProperties],buttons:[{text:i18n.get(&quot;label.saveEdit&quot;),x:30,handler:this.saveEdit,scope:this}]}];sitools.widget.editProfile.superclass.initComponent.call(this)},saveEdit:function(){var a=Ext.getCmp(&quot;frmEditProfile&quot;).getForm();if(!a.isValid()){Ext.getCmp(&quot;sbWinEditProfile&quot;).setStatus({text:i18n.get(&quot;warning.checkForm&quot;),iconCls:&quot;x-status-error&quot;});return}var b=a.getValues();b.properties=[];this.gridProperties.getStore().each(function(d){b.properties.push({name:d.data.name,value:d.data.value,scope:d.data.scope})});Ext.getCmp(&quot;winEditProfile&quot;).body.mask();Ext.getCmp(&quot;sbWinEditProfile&quot;).showBusy();Ext.Ajax.request({url:this.url,method:&quot;PUT&quot;,jsonData:b,scope:this,success:function(d,k){var g=Ext.decode(d.responseText);if(g.success){Ext.getCmp(&quot;winEditProfile&quot;).close();var e=new Ext.ux.Notification({iconCls:&quot;x-icon-information&quot;,title:i18n.get(&quot;label.information&quot;),html:g.message,autoDestroy:true,hideDelay:1000});e.show(document)}else{Ext.getCmp(&quot;winEditProfile&quot;).body.unmask();Ext.getCmp(&quot;sbWinEditProfile&quot;).setStatus({text:g.message,iconCls:&quot;x-status-error&quot;})}if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this)}},failure:function(e,k){var d;if(e.status==200){var g=Ext.decode(e.responseText).message;d=i18n.get(&quot;msg.error&quot;)+&quot;: &quot;+g}else{d=i18n.get(&quot;warning.serverError&quot;)+&quot;: &quot;+e.statusText}Ext.getCmp(&quot;winEditProfile&quot;).body.unmask();Ext.getCmp(&quot;sbWinEditProfile&quot;).setStatus({text:d,iconCls:&quot;x-status-error&quot;})}})},onRender:function(){sitools.widget.editProfile.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(a){var d=this.findByType(&quot;form&quot;)[0].getForm();var b=Ext.decode(a.responseText);if(b.user!==undefined){d.setValues(b.user);d.findField(&quot;secret&quot;).setValue(&quot;&quot;);if(!Ext.isEmpty(b.user.properties)){Ext.each(b.user.properties,function(e){var g=new Ext.data.Record({name:e.name,value:e.value,scope:e.scope});this.gridProperties.getStore().add(g)},this)}}},failure:alertFailure})}}});var loginErrLength=&quot;Login minimum 4 character !&quot;;var loginErrUnique=&quot;Login already in use !&quot;;var loginSuccess=&quot;Login avaliable&quot;;var emailErrFormat=&quot;Email not valid !&quot;;var emailErrUnique=&quot;Email already in use !&quot;;var emailSuccess=&quot;Email valid &amp; avaliable&quot;;Ext.apply(Ext.form.VTypes,{uniqueloginMask:/[a-z0-9_\.\-@\+]/i,uniquelogin:function(a){if(a.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}},uniqueloginText:loginErrUnique,uniqueemailMask:/[a-z0-9_\.\-@\+]/i,uniqueemail:function(b){var a=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(a.test(b)){return true}else{return false}},uniqueemailText:emailErrFormat,password:function(d,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(d==a.getValue())}return true},passwordText:&quot;Passwords do not match&quot;,passwordlength:function(a){if(a.length&lt;6||a.length&gt;40){return false}else{return true}},passwordlengthText:&quot;Invalid Password Length. It must be between 6 and 40&quot;});function resetLoginValidator(a){Ext.apply(Ext.form.VTypes,{uniquelogin:function(b){if(b.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false}else{return true}}})}function resetEmailValidator(a){Ext.apply(Ext.form.VTypes,{uniqueemail:function(d){var b=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(b.test(d)){return true}else{return false}return(a)}})}Ext.namespace(&quot;Ext.ux&quot;);Ext.namespace(&quot;Ext.ux.Plugin&quot;);Ext.ux.Plugin.LiteRemoteComponent=function(a){var d=a.xtype||&quot;panel&quot;;var b=function(e){this.container.add(Ext.ComponentMgr.create(Ext.decode(e.responseText),d)).show();this.container.doLayout()};return{init:function(e){this.container=e;Ext.Ajax.request(Ext.apply(a,{success:b,scope:this}))}}};Ext.ux.Plugin.RemoteComponent=function(a){var e=a.xtype||&quot;panel&quot;;Ext.applyIf(a,{purgeSubscribers:true});this.initialConfig=a;Ext.apply(this,a);this.addEvents({beforeload:true,beforecreate:true,beforeadd:true,beforecomponshow:true,beforecontainshow:true,success:true});Ext.ux.Plugin.RemoteComponent.superclass.constructor.call(this,a);if(a.breakOn){this.on(a.breakOn,function(){return false})}var b=function(k){if(this.fireEvent(&quot;beforeadd&quot;,k,this)){var g=this.container.add(k);g.fireEvent(&quot;bodyResize&quot;,this);if(this.fireEvent(&quot;beforecomponshow&quot;,g,this)){return g}}}.createDelegate(this);var d=function(k){var l=Ext.decode(k.responseText);if(this.fireEvent(&quot;beforecreate&quot;,l,this)){var g=null;if(l instanceof Array){Ext.each(l,function(m,n){g=b(m).show()})}else{g=b(l).show()}if(this.fireEvent(&quot;beforecontainshow&quot;,g,this)){this.container.ownerCt.doLayout();this.fireEvent(&quot;success&quot;,g,this)}}if(this.purgeSubscribers){this.purgeListeners()}}.createDelegate(this);this.load=function(){if(this.fireEvent(&quot;beforeload&quot;,a,this)){if(a.mask){var g=new Ext.LoadMask(Ext.getDom(a.mask),Ext.apply({msg:&quot;loading components...&quot;},a.maskConfig||{}));g.show();this.on(&quot;success&quot;,g.hide,g)}Ext.Ajax.request(Ext.apply(a,{success:d,scope:this}))}};this.init=function(g){g.on(&quot;beforedestroy&quot;,function(){this.purgeListeners()},this);this.container=g;if(a.loadOn){if(a.loadOn instanceof Array){Ext.each(a.loadOn,function(n,p,m){var k=n.event||n.loadOn;var q=function(){this.load();Ext.each(m,function(l){(l.scope||g).un(k,q,this)}.createDelegate(this))}.createDelegate(this);(n.scope||g).on(k,q,this)}.createDelegate(this))}else{(a.loadOn.scope||g).on((a.loadOn.event||a.loadOn),this.load,this,{single:true})}}else{this.load()}}};Ext.extend(Ext.ux.Plugin.RemoteComponent,Ext.util.Observable);Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.MultiSelect=Ext.extend(Ext.form.Field,{ddReorder:false,appendOnly:false,width:100,height:100,displayField:0,valueField:1,allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minSelectionsText:&quot;Minimum {0} item(s) required&quot;,maxSelectionsText:&quot;Maximum {0} item(s) allowed&quot;,delimiter:&quot;,&quot;,defaultAutoCreate:{tag:&quot;div&quot;},initComponent:function(){Ext.ux.form.MultiSelect.superclass.initComponent.call(this);if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;text&quot;],data:this.store});this.valueField=&quot;value&quot;}else{this.store=new Ext.data.ArrayStore({fields:[&quot;text&quot;],data:this.store,expandData:true});this.valueField=&quot;text&quot;}this.displayField=&quot;text&quot;}else{this.store=Ext.StoreMgr.lookup(this.store);this.displayField=this.store.displayField;this.valueField=this.store.valueField}this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(d,b){Ext.ux.form.MultiSelect.superclass.onRender.call(this,d,b);var a=this.fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height-20,width:this.width,style:&quot;padding:0;&quot;,tbar:this.tbar});a.body.addClass(&quot;ux-mselect&quot;);this.view=new Ext.ListView({multiSelect:true,store:this.store,columns:[{header:&quot;Value&quot;,width:1,dataIndex:this.displayField}],hideHeaders:true});a.add(this.view);this.view.on(&quot;click&quot;,this.onViewClick,this);this.view.on(&quot;beforeclick&quot;,this.onViewBeforeClick,this);this.view.on(&quot;dblclick&quot;,this.onViewDblClick,this);this.hiddenName=this.name||Ext.id();var e={tag:&quot;input&quot;,type:&quot;hidden&quot;,value:&quot;&quot;,name:this.hiddenName};this.hiddenField=this.el.createChild(e);this.hiddenField.dom.disabled=this.hiddenName!=this.name;a.doLayout()},afterRender:function(){Ext.ux.form.MultiSelect.superclass.afterRender.call(this);if(this.ddReorder&amp;&amp;!this.dragGroup&amp;&amp;!this.dropGroup){this.dragGroup=this.dropGroup=&quot;MultiselectDD-&quot;+Ext.id()}if(this.draggable||this.dragGroup){this.dragZone=new Ext.ux.form.MultiSelect.DragZone(this,{ddGroup:this.dragGroup})}if(this.droppable||this.dropGroup){this.dropZone=new Ext.ux.form.MultiSelect.DropZone(this,{ddGroup:this.dropGroup})}if(this.values){this.setValue(this.values)}},onViewClick:function(d,a,b,g){this.fireEvent(&quot;change&quot;,this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent(&quot;click&quot;,this,g);this.validate()},onViewBeforeClick:function(d,a,b,g){if(this.disabled||this.readOnly){return false}},onViewDblClick:function(d,a,b,g){return this.fireEvent(&quot;dblclick&quot;,d,a,b,g)},getValue:function(a){var g=[];var e=this.view.getSelectedIndexes();if(e.length==0){return&quot;&quot;}for(var b=0;b&lt;e.length;b++){var d=this.store.getAt(e[b]).get((a!=null)?a:this.valueField);if(Ext.isString(d)){d=d}g.push(d)}return g.join(this.delimiter)},setValue:function(a){var b;var e=[];this.view.clearSelections();this.hiddenField.dom.value=&quot;&quot;;if(!a||(a==&quot;&quot;)){return}if(!Ext.isArray(a)){a=a.split(this.delimiter)}for(var d=0;d&lt;a.length;d++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp(&quot;^&quot;+a[d]+&quot;$&quot;,&quot;i&quot;)).itemAt(0));e.push(b)}this.view.select(e);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue(&quot;&quot;)},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length&lt;1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length&lt;this.minSelections){this.markInvalid(String.format(this.minSelectionsText,this.minSelections));return false}if(a.length&gt;this.maxSelections){this.markInvalid(String.format(this.maxSelectionsText,this.maxSelections));return false}return true},disable:function(){this.disabled=true;if(!Ext.isEmpty(this.hiddenField)){this.hiddenField.dom.disabled=true}if(!Ext.isEmpty(this.fs)){this.fs.disable()}},enable:function(){this.disabled=false;this.hiddenField.dom.disabled=false;this.fs.enable()},destroy:function(){Ext.destroy(this.fs,this.dragZone,this.dropZone);Ext.ux.form.MultiSelect.superclass.destroy.call(this)}});Ext.reg(&quot;multiselect&quot;,Ext.ux.form.MultiSelect);Ext.ux.Multiselect=Ext.ux.form.MultiSelect;Ext.ux.form.MultiSelect.DragZone=function(e,d){this.ms=e;this.view=e.view;var b=d.ddGroup||&quot;MultiselectDD&quot;;var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DragZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDraggable(b)};Ext.extend(Ext.ux.form.MultiSelect.DragZone,Ext.dd.DragZone,{onInitDrag:function(a,d){var b=Ext.get(this.dragData.ddel.cloneNode(true));this.proxy.update(b.dom);b.setWidth(b.child(&quot;em&quot;).getWidth());this.onStartDrag(a,d);return true},collectSelection:function(b){b.repairXY=Ext.fly(this.view.getSelectedNodes()[0]).getXY();var a=0;this.view.store.each(function(e){if(this.view.isSelected(a)){var g=this.view.getNode(a);var d=g.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.view.store.getAt(a));b.viewNodes.push(g)}a++},this)},onEndDrag:function(a,b){var g=Ext.get(this.dragData.ddel);if(g&amp;&amp;g.hasClass(&quot;multi-proxy&quot;)){g.remove()}},getDragData:function(g){var d=this.view.findItemFromChild(g.getTarget());if(d){if(!this.view.isSelected(d)&amp;&amp;!g.ctrlKey&amp;&amp;!g.shiftKey){this.view.select(d);this.ms.setValue(this.ms.getValue())}if(this.view.getSelectionCount()==0||g.ctrlKey||g.shiftKey){return false}var b={sourceView:this.view,viewNodes:[],records:[]};if(this.view.getSelectionCount()==1){var a=this.view.getSelectedIndexes()[0];var k=this.view.getNode(a);b.viewNodes.push(b.ddel=k);b.records.push(this.view.store.getAt(a));b.repairXY=Ext.fly(k).getXY()}else{b.ddel=document.createElement(&quot;div&quot;);b.ddel.className=&quot;multi-proxy&quot;;this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},setDraggable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDraggable,this);return}this.addToGroup(a)}});Ext.ux.form.MultiSelect.DropZone=function(e,d){this.ms=e;this.view=e.view;var b=d.ddGroup||&quot;MultiselectDD&quot;;var a;if(Ext.isArray(b)){a=b.shift()}else{a=b;b=null}Ext.ux.form.MultiSelect.DropZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:a});this.setDroppable(b)};Ext.extend(Ext.ux.form.MultiSelect.DropZone,Ext.dd.DropZone,{getTargetFromEvent:function(b){var a=b.getTarget();return a},getDropPoint:function(k,p,d){if(p==this.ms.fs.body.dom){return&quot;below&quot;}var g=Ext.lib.Dom.getY(p),a=g+p.offsetHeight;var m=g+(a-g)/2;var l=Ext.lib.Event.getPageY(k);if(l&lt;=m){return&quot;above&quot;}else{return&quot;below&quot;}},isValidDropPoint:function(b,g,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var e=a.viewNodes[0];if(e==g){return false}if((b==&quot;below&quot;)&amp;&amp;(g.nextSibling==e)){return false}if((b==&quot;above&quot;)&amp;&amp;(g.previousSibling==e)){return false}return true},onNodeEnter:function(g,a,d,b){return false},onNodeOver:function(m,a,l,g){var b=this.dropNotAllowed;var k=this.getDropPoint(l,m,a);if(this.isValidDropPoint(k,m,g)){if(this.ms.appendOnly){return&quot;x-tree-drop-ok-below&quot;}if(k){var d;if(k==&quot;above&quot;){b=m.previousSibling?&quot;x-tree-drop-ok-between&quot;:&quot;x-tree-drop-ok-above&quot;;d=&quot;x-view-drag-insert-above&quot;}else{b=m.nextSibling?&quot;x-tree-drop-ok-between&quot;:&quot;x-tree-drop-ok-below&quot;;d=&quot;x-view-drag-insert-below&quot;}if(this.lastInsertClass!=d){Ext.fly(m).replaceClass(this.lastInsertClass,d);this.lastInsertClass=d}}}return b},onNodeOut:function(g,a,d,b){this.removeDropIndicators(g)},onNodeDrop:function(b,p,m,k){if(this.ms.fireEvent(&quot;drop&quot;,this,b,p,m,k)===false){return false}var q=this.getDropPoint(m,b,p);if(b!=this.ms.fs.body.dom){b=this.view.findItemFromChild(b)}if(this.ms.appendOnly){insertAt=this.view.store.getCount()}else{insertAt=b==this.ms.fs.body.dom?this.view.store.getCount()-1:this.view.indexOf(b);if(q==&quot;below&quot;){insertAt++}}var d=false;if(k.sourceView==this.view){if(q==&quot;below&quot;){if(k.viewNodes[0]==b){k.viewNodes.shift()}}else{if(k.viewNodes[k.viewNodes.length-1]==b){k.viewNodes.pop()}}if(!k.viewNodes.length){return false}if(insertAt&gt;this.view.store.indexOf(k.records[0])){d=&quot;down&quot;;insertAt--}}for(var l=0;l&lt;k.records.length;l++){var a=k.records[l];if(k.sourceView){k.sourceView.store.remove(a)}this.view.store.insert(d==&quot;down&quot;?insertAt:insertAt++,a);var g=this.view.store.sortInfo;if(g){this.view.store.sort(g.field,g.direction)}}return true},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass([&quot;x-view-drag-insert-above&quot;,&quot;x-view-drag-insert-left&quot;,&quot;x-view-drag-insert-right&quot;,&quot;x-view-drag-insert-below&quot;]);this.lastInsertClass=&quot;_noclass&quot;}},setDroppable:function(a){if(!a){return}if(Ext.isArray(a)){Ext.each(a,this.setDroppable,this);return}this.addToGroup(a)}});Ext.ns(&quot;Ext.ux&quot;);Ext.ux.stateFullWindow=Ext.extend(Ext.Window,{saveSettings:function(g,l,d,b){if(Ext.isEmpty(userLogin)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;,&quot;label.needLogin&quot;));return}var a=Ext.encode(this.getPosition());var e=Ext.encode(this.getSize());var k={};k.componentSettings=d;k.windowSettings={};k.windowSettings.size=e;k.windowSettings.position=a;k.windowSettings.specificType=this.specificType;k.windowSettings.moduleId=this.getId();k.windowSettings.typeWindow=this.typeWindow;if(b){publicStorage.set(l,&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+g,k)}else{userStorage.set(l,&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+g,k)}return k}});Ext.reg(&quot;statewindow&quot;,Ext.ux.stateFullWindow);Ext.namespace(&quot;Ext.ux&quot;);Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||&quot;x-icon-information&quot;,cls:&quot;x-notification&quot;,width:200,autoHeight:true,plain:false,draggable:false,shadow:false,bodyStyle:&quot;text-align:center&quot;});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.apply(this)},setMessage:function(a){this.body.update(a)},setTitle:function(b,a){Ext.ux.Notification.superclass.setTitle.call(this,b,a||this.iconCls)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},cancelHiding:function(){this.addClass(&quot;fixed&quot;);if(this.autoDestroy){this.task.cancel()}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on(&quot;click&quot;,this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)&gt;-1){this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,&quot;br-br&quot;,[-20,-40-((this.getSize().height+10)*this.pos)]);this.el.slideIn(&quot;b&quot;,{duration:1,callback:this.afterShow,scope:this})},animHide:function(){this.el.ghost(&quot;b&quot;,{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy()}.createDelegate(this)})},focus:Ext.emptyFn});Ext.ns(&quot;sitools.widget&quot;);sitools.widget.Filter=Ext.extend(Ext.Container,{columnAlias:null,layout:&quot;vbox&quot;,layoutConfig:{align:&quot;left&quot;,pack:&quot;center&quot;},specificType:&quot;filter&quot;,constructor:function(a){Ext.apply(this,a);this.layout=&quot;hbox&quot;;this.columnAlias=a.columnAlias;this.specificType=&quot;filter&quot;;sitools.widget.Filter.superclass.constructor.call(this);this.init(a);if(a&amp;&amp;a.value){this.setValue(a.value);delete a.value}},init:Ext.emptyFn,getValue:Ext.emptyFn,setValue:Ext.emptyFn,validateRecord:function(){return true},_getHeight:Ext.emptyFn,getFilterData:function(){return this.getValue()}});Ext.ns(&quot;sitools.widget&quot;);sitools.widget.DateFilter=Ext.extend(sitools.widget.Filter,{iconCls:&quot;ux-gridfilter-text-icon&quot;,emptyText:&quot;Enter Filter Text...&quot;,selectOnFocus:true,flex:0.9,style:{&quot;padding-left&quot;:&quot;10px&quot;},height:60,init:function(b){b=b||{};this.inputFrom=new Ext.form.DateField({anchor:&quot;100%&quot;,fieldLabel:&quot;ux-rangemenu-gte&quot;,format:SITOOLS_DEFAULT_IHM_DATE_FORMAT,labelStyle:&quot;height: 10px&quot;,width:150});this.inputTo=new Ext.form.DateField({anchor:&quot;100%&quot;,fieldLabel:&quot;ux-rangemenu-lte&quot;,format:SITOOLS_DEFAULT_IHM_DATE_FORMAT,labelStyle:&quot;height: 10px&quot;,width:150});var a=new Ext.form.FormPanel({items:[this.inputFrom,this.inputTo],labelWidth:21,bodyBorder:false,border:false,layout:&quot;form&quot;,layoutConfig:{fieldTpl:new Ext.Template('&lt;div class=&quot;x-form-item {itemCls}&quot; tabIndex=&quot;-1&quot;&gt;','&lt;label for=&quot;{id}&quot; style=&quot;{labelStyle}&quot; class=&quot;x-form-item-label {label}&quot;&gt;&lt;/label&gt;','&lt;div class=&quot;x-form-element&quot; id=&quot;x-form-el-{id}&quot; style=&quot;{elementStyle}&quot;&gt;','&lt;/div&gt;&lt;div class=&quot;{clearCls}&quot;&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;)}});this.add(a)},getValue:function(){var a=[];if(!Ext.isEmpty(this.inputFrom.getValue())){a.push({columnAlias:this.columnAlias,data:{comparison:&quot;gte&quot;,value:this.inputFrom.getValue().format(SITOOLS_DATE_FORMAT),type:&quot;date&quot;}})}if(!Ext.isEmpty(this.inputTo.getValue())){a.push({columnAlias:this.columnAlias,data:{comparison:&quot;lte&quot;,value:this.inputTo.getValue().format(SITOOLS_DATE_FORMAT),type:&quot;date&quot;}})}return a},getConfig:function(){if(!Ext.isEmpty(this.inputFrom.getValue())||!Ext.isEmpty(this.inputTo.getValue())){return{columnAlias:this.columnAlias,value:{from:this.inputFrom.getValue(),to:this.inputTo.getValue()},type:&quot;date&quot;}}else{return null}},setValue:function(a){this.inputFrom.setValue(a.from);this.inputTo.setValue(a.to)},_getHeight:function(){return this.height}});Ext.ns(&quot;sitools.widget&quot;);sitools.widget.StringFilter=Ext.extend(sitools.widget.Filter,{iconCls:&quot;ux-gridfilter-text-icon&quot;,emptyText:&quot;Enter Filter Text...&quot;,selectOnFocus:true,flex:0.9,style:{&quot;padding-left&quot;:&quot;10px&quot;},height:30,init:function(b){b=b||{};this.inputItem=new Ext.form.TextField({anchor:&quot;100%&quot;,fieldLabel:&quot;ux-gridfilter-text-icon&quot;,labelStyle:&quot;height: 10px&quot;,width:150});var a=new Ext.form.FormPanel({items:[this.inputItem],labelWidth:21,bodyBorder:false,border:false,layout:&quot;form&quot;,layoutConfig:{fieldTpl:new Ext.Template('&lt;div class=&quot;x-form-item {itemCls}&quot; tabIndex=&quot;-1&quot;&gt;','&lt;label for=&quot;{id}&quot; style=&quot;{labelStyle}&quot; class=&quot;x-form-item-label {label}&quot;&gt;&lt;/label&gt;','&lt;div class=&quot;x-form-element&quot; id=&quot;x-form-el-{id}&quot; style=&quot;{elementStyle}&quot;&gt;','&lt;/div&gt;&lt;div class=&quot;{clearCls}&quot;&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;)}});this.add(a)},getValue:function(){if(!Ext.isEmpty(this.inputItem.getValue())){return[{columnAlias:this.columnAlias,data:{comparison:&quot;LIKE&quot;,value:this.inputItem.getValue(),type:&quot;string&quot;}}]}else{return[]}},getConfig:function(){if(!Ext.isEmpty(this.inputItem.getValue())){return{columnAlias:this.columnAlias,value:this.inputItem.getValue(),type:&quot;string&quot;}}else{return null}},setValue:function(a){this.inputItem.setValue(a)},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!=&quot;string&quot;){return(this.getValue().length===0)}return b.toLowerCase().indexOf(this.getValue().toLowerCase())&gt;-1},_getHeight:function(){return this.height}});Ext.ns(&quot;sitools.widget&quot;);sitools.widget.NumericFilter=Ext.extend(sitools.widget.Filter,{iconCls:&quot;ux-gridfilter-text-icon&quot;,emptyText:&quot;Enter Filter Text...&quot;,selectOnFocus:true,flex:0.9,style:{&quot;padding-left&quot;:&quot;10px&quot;},height:60,init:function(b){b=b||{};this.inputFrom=new Ext.form.NumberField({anchor:&quot;100%&quot;,fieldLabel:&quot;ux-rangemenu-gte&quot;,labelStyle:&quot;height: 10px&quot;,width:150});this.inputTo=new Ext.form.NumberField({anchor:&quot;100%&quot;,fieldLabel:&quot;ux-rangemenu-lte&quot;,labelStyle:&quot;height: 10px&quot;,width:150});var a=new Ext.form.FormPanel({items:[this.inputTo,this.inputFrom],labelWidth:21,bodyBorder:false,border:false,layoutConfig:{fieldTpl:new Ext.Template('&lt;div class=&quot;x-form-item {itemCls}&quot; tabIndex=&quot;-1&quot;&gt;','&lt;label for=&quot;{id}&quot; style=&quot;{labelStyle}&quot; class=&quot;x-form-item-label {label}&quot;&gt;&lt;/label&gt;','&lt;div class=&quot;x-form-element&quot; id=&quot;x-form-el-{id}&quot; style=&quot;{elementStyle}&quot;&gt;','&lt;/div&gt;&lt;div class=&quot;{clearCls}&quot;&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;)}});this.add(a)},getValue:function(){var a=[];if(!Ext.isEmpty(this.inputFrom.getValue())){a.push({columnAlias:this.columnAlias,data:{comparison:&quot;gte&quot;,value:this.inputFrom.getValue(),type:&quot;numeric&quot;}})}if(!Ext.isEmpty(this.inputTo.getValue())){a.push({columnAlias:this.columnAlias,data:{comparison:&quot;lte&quot;,value:this.inputTo.getValue(),type:&quot;numeric&quot;}})}return a},getConfig:function(){if(!Ext.isEmpty(this.inputFrom.getValue())||!Ext.isEmpty(this.inputTo.getValue())){return{columnAlias:this.columnAlias,value:{from:this.inputFrom.getValue(),to:this.inputTo.getValue()},type:&quot;numeric&quot;}}else{return null}},setValue:function(a){this.inputFrom.setValue(a.from);this.inputTo.setValue(a.to)},_getHeight:function(){return this.height}});Ext.ns(&quot;sitools.widget&quot;);sitools.widget.FiltersCollection=Ext.extend(Ext.util.MixedCollection,{constructor:function(a){sitools.widget.FiltersCollection.superclass.constructor.call(this);this.addAll(a.filters)},getFilterData:function(){var a=[];this.each(function(d,b,e){a.push(d)});return a}});Ext.ns(&quot;Ext.ux.grid&quot;);Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:&quot;&quot;,width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:&quot;&quot;,id:&quot;expander&quot;,lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl==&quot;string&quot;){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,g,e,d){e.cols=e.cols-1;var b=this.bodyContent[a.id];if(!b&amp;&amp;!this.lazyRender){b=this.getBodyContent(a,g)}if(b){e.body=b}return this.state[a.id]?&quot;x-grid3-row-expanded&quot;:&quot;x-grid3-row-collapsed&quot;},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on(&quot;render&quot;,this.onRender,this);b.on(&quot;destroy&quot;,this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on(&quot;mousedown&quot;,this.onMouseDown,this,{delegate:&quot;.x-grid3-row-expander&quot;});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on(&quot;rowdblclick&quot;,this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un(&quot;mousedown&quot;,this.onMouseDown,this)}},onRowDblClick:function(a,b,d){this.toggleRow(b)},onEnter:function(m){var l=this.grid;var n=l.getSelectionModel();var b=n.getSelections();for(var d=0,a=b.length;d&lt;a;d++){var k=l.getStore().indexOf(b[d]);this.toggleRow(k)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var d=this.bodyContent[a.id];if(!d){d=this.tpl.apply(a.data);this.bodyContent[a.id]=d}return d},onMouseDown:function(b,a){b.stopEvent();var d=b.getTarget(&quot;.x-grid3-row&quot;);this.toggleRow(d)},renderer:function(b,d,a){d.cellAttr='rowspan=&quot;2&quot;';return'&lt;div class=&quot;x-grid3-row-expander&quot;&gt;&amp;#160;&lt;/div&gt;'},beforeExpand:function(b,a,d){if(this.fireEvent(&quot;beforeexpand&quot;,this,b,a,d)!==false){if(this.tpl&amp;&amp;this.lazyRender){a.innerHTML=this.getBodyContent(b,d)}return true}else{return false}},toggleRow:function(a){if(typeof a==&quot;number&quot;){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass(&quot;x-grid3-row-collapsed&quot;)?&quot;expandRow&quot;:&quot;collapseRow&quot;](a)},expandRow:function(d){if(typeof d==&quot;number&quot;){d=this.grid.view.getRow(d)}var b=this.grid.store.getAt(d.rowIndex);var a=Ext.DomQuery.selectNode(&quot;tr:nth(2) div.x-grid3-row-body&quot;,d);if(this.beforeExpand(b,a,d.rowIndex)){this.state[b.id]=true;Ext.fly(d).replaceClass(&quot;x-grid3-row-collapsed&quot;,&quot;x-grid3-row-expanded&quot;);this.fireEvent(&quot;expand&quot;,this,b,a,d.rowIndex)}},collapseRow:function(d){if(typeof d==&quot;number&quot;){d=this.grid.view.getRow(d)}var b=this.grid.store.getAt(d.rowIndex);var a=Ext.fly(d).child(&quot;tr:nth(1) div.x-grid3-row-body&quot;,true);if(this.fireEvent(&quot;beforecollapse&quot;,this,b,a,d.rowIndex)!==false){this.state[b.id]=false;Ext.fly(d).replaceClass(&quot;x-grid3-row-expanded&quot;,&quot;x-grid3-row-collapsed&quot;);this.fireEvent(&quot;collapse&quot;,this,b,a,d.rowIndex)}}});Ext.preg(&quot;rowexpander&quot;,Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.Box=Ext.extend(Ext.Panel,{width:&quot;98%&quot;,frame:true,baseCls:&quot;x-box&quot;,cls:&quot;x-box-blue module-root centering&quot;,_title:&quot;&quot;,constructor:function(a){sitools.widget.Box.superclass.constructor.call(this,Ext.apply({_title:a.label,_idItem:a.idItem},a))},initComponent:function(){this.items.unshift({xtype:&quot;component&quot;,html:this._title,cls:&quot;subtitle icon-&quot;+this.idItem});sitools.widget.Box.superclass.initComponent.call(this)}});Ext.reg(&quot;s-box&quot;,sitools.widget.Box);sitools.widget.JsonStore=Ext.extend(Ext.data.JsonStore,{dirty:false,_setDirty:function(a){this.dirty=a},_getDirty:function(){return this.dirty},add:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.add.call(this,a)},remove:function(a){this.dirty=true;sitools.widget.JsonStore.superclass.remove.call(this,a)}});sitools.widget.menuButton=Ext.extend(Ext.Button,{constructor:function(a){a=Ext.apply({iconCls:&quot;menu-button&quot;},a);sitools.widget.menuButton.superclass.constructor.call(this,a)}});Ext.reg(&quot;s-menuButton&quot;,sitools.widget.menuButton);sitools.widget.templateTreeNode=function(a){var d;if(a.tpl===undefined){d=new Ext.Template(&quot;&lt;div &gt;{text}&lt;b&gt;{nbRecords} records&lt;/b&gt;&lt;img src='{urlImage}'&gt;&lt;/img&gt;&lt;a style='text-align:right' href='{urlReadme}'&gt;readme&lt;/a&gt;&lt;/div&gt;&quot;)}else{d=a.tpl}a.text=d.apply(a);a.leaf=false;var b=Ext.apply({children:[]},a);sitools.widget.templateTreeNode.superclass.constructor.call(this,b)};Ext.extend(sitools.widget.templateTreeNode,Ext.tree.AsyncTreeNode,{});Ext.tree.TreePanel.nodeTypes.templateTreeNode=sitools.widget.templateTreeNode;sitools.widget.sortersTool=Ext.extend(Ext.Window,{initComponent:function(){var k=[[&quot;&quot;,&quot;&quot;]];var d;if(!Ext.isEmpty(this.columnModel.columns)){var d=this.columnModel.columns}else{d=this.columnModel}Ext.each(d,function(l){k.push([l.columnAlias,l.header])});this.storeCombo=new Ext.data.ArrayStore({fields:[&quot;dataIndex&quot;,&quot;columnHeader&quot;],data:k});this.f=new Ext.form.FormPanel();var e=this.store.getSortState(),a;if(!Ext.isEmpty(e)){if(Ext.isArray(e.sorters)){this.sorters=e.sorters}else{this.sorters=[e]}a=this.sorters.length}else{this.sorter=[];a=3}for(var b=0;b&lt;a;b++){var g=this.buildCompositeField(b);this.f.add(g)}Ext.apply(this,{title:i18n.get(&quot;label.multiSort&quot;),autoScroll:true,width:400,modal:true,items:[this.f],buttons:[{text:i18n.get(&quot;label.add&quot;),scope:this,handler:this.onAdd},{text:i18n.get(&quot;label.remove&quot;),scope:this,handler:this.onRemove},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});sitools.widget.sortersTool.superclass.initComponent.call(this)},onValidate:function(){var a=[];Ext.each(this.f.items.items,function(b){if(!Ext.isEmpty(b.items.items[0].getValue())){a.push({field:b.items.items[0].getValue(),direction:b.items.items[1].getValue().getGroupValue()})}},this);if(a.length&lt;1){this.close();return}else{if(a.length==1){this.store.sort(a[0].field,a[0].direction)}else{this.store.sort(a)}}this.close()},buildCompositeField:function(a){var d=new Ext.form.ComboBox({typeAhead:true,name:&quot;field&quot;+1,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:this.storeCombo,valueField:&quot;dataIndex&quot;,displayField:&quot;columnHeader&quot;,flex:0.6});var b=new Ext.form.RadioGroup({fieldLabel:i18n.get(&quot;label.direction&quot;),flex:0.4,value:&quot;ASC&quot;,items:[{boxLabel:&quot;ASC&quot;,name:&quot;direction&quot;+a,inputValue:&quot;ASC&quot;},{boxLabel:&quot;DESC&quot;,name:&quot;direction&quot;+a,inputValue:&quot;DESC&quot;}]});var e=new Ext.form.CompositeField({labelWidth:100,anchor:&quot;100%&quot;,fieldLabel:i18n.get(&quot;label.order&quot;),items:[d,b]});return e},onAdd:function(){var a=this.f.items.length;var b=this.buildCompositeField(a);this.f.add(b);this.f.doLayout();this.doLayout()},onRemove:function(){var a=this.f.items.length-1;if(a&lt;0){return}this.f.remove(this.f.getComponent(a));this.f.doLayout();this.doLayout()},afterRender:function(){sitools.widget.sortersTool.superclass.afterRender.call(this);this.setPosition(this.pos);var a=0;Ext.each(this.sorters,function(d){var b=this.f.getComponent(a);b.items.items[0].setValue(d.field);b.items.items[1].setValue(d.direction);a++},this)}});Ext.reg(&quot;sitools.widget.sortersTool&quot;,sitools.widget.sortersTool);sitools.widget.filterTool=Ext.extend(Ext.Window,{paramPrefix:&quot;filter&quot;,initComponent:function(){var g=[[&quot;&quot;,&quot;&quot;]];var d;if(!Ext.isEmpty(this.columnModel.columns)){var d=this.columnModel.columns}else{d=this.columnModel}Ext.each(d,function(k){g.push({columnAlias:k.columnAlias,columnHeader:k.header,columnType:sql2ext.get(k.sqlColumnType)})});this.storeCombo=new Ext.data.JsonStore({fields:[&quot;columnAlias&quot;,&quot;columnHeader&quot;,&quot;columnType&quot;],data:g});this.f=new Ext.Panel();this.filters=this.store.filtersCfg;var a;if(!Ext.isEmpty(this.filters)){a=this.filters.length}else{this.filters=[];a=3}for(var b=0;b&lt;a;b++){var e=this.buildCompositeField(b);this.f.add(e)}Ext.apply(this,{title:i18n.get(&quot;label.filter&quot;),autoScroll:true,width:400,modal:true,items:[this.f],buttons:[{text:i18n.get(&quot;label.add&quot;),scope:this,handler:this.onAdd},{text:i18n.get(&quot;label.remove&quot;),scope:this,handler:this.onRemove},{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:this.onValidate},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}]});sitools.widget.sortersTool.superclass.initComponent.call(this)},getCompositeField:function(a){return this.f.items.items[a]},onValidate:function(){if(Ext.isEmpty(this.store.filters)){this.store.filters=new sitools.widget.FiltersCollection()}this.store.filters.clear();var e=[];var g=[];var d=0;var a=this.store;Ext.each(this.f.items.items,function(m){if(!Ext.isEmpty(m.items.items[0].getValue())){var l=m.findBy(function(p){return p.specificType==&quot;filter&quot;});var n;if(!Ext.isEmpty(l)&amp;&amp;!Ext.isEmpty(l[0])){var k=l[0];n=k.getValue();Ext.each(n,function(p){a.filters.add(d++,p);if(!Ext.isEmpty(p)){e.push(p)}});if(!Ext.isEmpty(k.getConfig())){g.push(k.getConfig())}}}},this);this.store.filtersCfg=g;var b=this.store.lastOptions||{};b.params=b.params||{};this.cleanParams(b.params);this.store.isNewFilter=true;this.store.load(b);this.close()},cleanParams:function(d){if(this.encode){delete d[this.paramPrefix]}else{var b,a;b=new RegExp(&quot;^&quot;+this.paramPrefix+&quot;[[0-9]+]&quot;);for(a in d){if(b.test(a)){delete d[a]}}}},buildCompositeField:function(a){var d=new Ext.form.ComboBox({index:a,typeAhead:true,name:&quot;field&quot;+1,triggerAction:&quot;all&quot;,lazyRender:true,mode:&quot;local&quot;,store:this.storeCombo,valueField:&quot;columnAlias&quot;,displayField:&quot;columnHeader&quot;,flex:0.4,listeners:{select:function(m,p,k){if(Ext.isEmpty(p.data.columnAlias)){return}var n=m.ownerCt;var g=n.items.items[1];g.removeAll();switch(p.data.columnType){case (&quot;numeric&quot;):var l=new sitools.widget.NumericFilter({columnAlias:p.data.columnAlias});g.add(l);n.setHeight(l._getHeight());g.setHeight(l._getHeight());break;case (&quot;string&quot;):var l=new sitools.widget.StringFilter({columnAlias:p.data.columnAlias});g.add(l);n.setHeight(l._getHeight());g.setHeight(l._getHeight());break;case (&quot;dateAsString&quot;):var l=new sitools.widget.DateFilter({columnAlias:p.data.columnAlias});g.add(l);n.setHeight(l._getHeight());g.setHeight(l._getHeight());break;default:var l=new sitools.widget.StringFilter({columnAlias:p.data.columnAlias});g.add(l);n.setHeight(l._getHeight());g.setHeight(l._getHeight());break}}}});var b=new Ext.Container({flex:0.6});var e=new Ext.Container({layout:&quot;hbox&quot;,items:[d,b],style:{padding:&quot;5px&quot;}});return e},onAdd:function(){var a=this.f.items.length;var b=this.buildCompositeField(a);this.f.add(b);this.f.doLayout();this.doLayout()},onRemove:function(){var a=this.f.items.length-1;if(a&lt;0){return}this.f.remove(this.f.getComponent(a));this.f.doLayout();this.doLayout()},afterRender:function(){sitools.widget.sortersTool.superclass.afterRender.call(this);this.setPosition(this.pos);var a=0;Ext.each(this.filters,function(b){var d=this.f.getComponent(a);this.updateFilterUI(d,b);a++},this)},updateFilterUI:function(a,e){var k=a.items.items[0];var b=k.getStore();var d=b.find(&quot;columnAlias&quot;,e.columnAlias);if(d){var l=b.getAt(d)}k.setValue(e.columnAlias);k.fireEvent(&quot;select&quot;,k,l,d);var g=a.findBy(function(m){return m.specificType==&quot;filter&quot;});g[0].setValue(e.value)}});Ext.reg(&quot;sitools.widget.sortersTool&quot;,sitools.widget.sortersTool);sitools.widget.GridSorterToolbar=Ext.extend(Ext.Toolbar,{initComponent:function(){sitools.widget.GridSorterToolbar.superclass.initComponent.call(this);this.add(&quot;-&gt;&quot;,new sitools.widget.GridTop({gridId:this.gridId}),new sitools.widget.GridUp({gridId:this.gridId}),new sitools.widget.GridDown({gridId:this.gridId}),new sitools.widget.GridBottom({gridId:this.gridId}))}});Ext.reg(&quot;sitools.widget.GridSorterToolbar&quot;,sitools.widget.GridSorterToolbar);sitools.widget.ViolationRowExpander=Ext.extend(Ext.ux.grid.RowExpander,{getRowClass:function(b,g,k,e){var a=sitools.widget.ViolationRowExpander.superclass.getRowClass.call(this,b,g,k,e);var d=b.get(&quot;violation&quot;);if(!Ext.isEmpty(d)){if(d.level==&quot;CRITICAL&quot;){a+=&quot; red-row&quot;}else{if(d.level==&quot;WARNING&quot;){a+=&quot; orange-row&quot;}}}return a}});Ext.reg(&quot;sitools.widget.ViolationRowExpander&quot;,sitools.widget.ViolationRowExpander);sitools.widget.colorField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(b){var a=new Ext.menu.ColorMenu({scope:this,handler:function(d,e){this.setValue(&quot;#&quot;+e);this.setFontColor(&quot;#&quot;+e)}});a.showAt(b.getXY())},setFontColor:function(b){var a=function(g){return parseInt(g,16)};var d=[a(b.slice(1,3)),a(b.slice(3,5)),a(b.slice(5))];var e=(d[0]+d[1]+d[2])/3;this.el.setStyle({color:(e&gt;128)?&quot;#000&quot;:&quot;#FFF&quot;,&quot;background-color&quot;:b,&quot;background-image&quot;:&quot;none&quot;})},listeners:{afterrender:function(a){a.setFontColor(a.getValue())}}});sitools.widget.DateFieldWithToday=Ext.extend(Ext.form.DateField,{regToday:new RegExp(&quot;^{\\$TODAY}&quot;),invalidTextWithToday:&quot;Impossible to make a date with {0}. A valid example is {$TODAY} + 1&quot;,parseDate:function(k){if(!k||Ext.isDate(k)){return k}if(this.regToday.test(k)){return k}var b=this.safeParse(k,this.format),d=this.altFormats,g=this.altFormatsArray;if(!b&amp;&amp;d){g=g||d.split(&quot;|&quot;);for(var e=0,a=g.length;e&lt;a&amp;&amp;!b;e++){b=this.safeParse(k,g[e])}}return b},getErrors:function(k){var m=Ext.form.DateField.superclass.getErrors.apply(this,arguments);k=this.formatDate(k||this.processValue(this.getRawValue()));if(k.length&lt;1){return m}var d=k;var l=false;if(this.regToday.test(k)){try{k=sitools.common.utils.Date.stringWithTodayToDate(k);if(!sitools.common.utils.Date.isValidDate(k)){throw&quot;&quot;}}catch(g){m.push(String.format(this.invalidTextWithToday,d));return m}}else{k=this.parseDate(k)}if(!k){m.push(String.format(this.invalidText,d,this.format));return m}l=k.getTime();if(this.minValue&amp;&amp;l&lt;this.minValue.clearTime().getTime()){m.push(String.format(this.minText,this.formatDate(this.minValue)))}if(this.maxValue&amp;&amp;l&gt;this.maxValue.clearTime().getTime()){m.push(String.format(this.maxText,this.formatDate(this.maxValue)))}if(this.disabledDays){var a=k.getDay();for(var b=0;b&lt;this.disabledDays.length;b++){if(a===this.disabledDays[b]){m.push(this.disabledDaysText);break}}}var e=this.formatDate(k);if(this.disabledDatesRE&amp;&amp;this.disabledDatesRE.test(e)){m.push(String.format(this.disabledDatesText,e))}return m},setValue:function(a){if(this.regToday.test(a)){return Ext.form.DateField.superclass.setValue.call(this,a)}else{return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))}}});Ext.ns(&quot;sitools.common.forms&quot;);sitools.common.forms.formParameterToComponent=function(parameter,dataUrl,formId,datasetCm,context){var valuesToSelect=null;this.component=null;var value,values,items,i,component,defaultValues,existsWidgetForParameterCode,selectedValue,minValue,maxValue,disabledDates;var constructor=eval(parameter.jsUserObject);component=new constructor({parameterId:parameter.id,values:Ext.isArray(parameter.values)?parameter.values:[],code:parameter.code,type:parameter.type,label:parameter.label,height:parameter.height,widthBox:parameter.width,valueSelection:parameter.valueSelection,parentParam:parameter.parentParam,dataUrl:dataUrl,autoComplete:parameter.autoComplete,formId:formId,dimensionId:parameter.dimensionId,unit:parameter.unit,css:parameter.css,defaultValues:parameter.defaultValues,extraParams:parameter.extraParams,datasetCm:datasetCm,context:context});return{parameter:parameter,component:component}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.DatasetContext=function(){this.context=&quot;dataset&quot;;this.getRefUnit=function(b){var d=b.code[0];if(Ext.isEmpty(b.datasetCm)){return}var a;Ext.each(b.datasetCm,function(e){if(e.columnAlias==d){a=e.unit}});return a}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.ProjectContext=function(){this.context=&quot;project&quot;;this.getRefUnit=function(a){return a.unit}};Ext.namespace(&quot;sitools.common.forms&quot;);sitools.common.forms.ComponentFactory=function(a){if(a==&quot;dataset&quot;){return new sitools.common.forms.DatasetContext()}if(a==&quot;project&quot;){return new sitools.common.forms.ProjectContext()}};Ext.ns(&quot;sitools.common.forms&quot;);sitools.common.forms.AbstractWithUnit=Ext.extend(Ext.Container,{dimensionId:null,userUnit:null,userDimension:null,initComponent:function(){this.userDimension=this.dimensionId;this.userUnit=this.unit;this.storeUnits=new Ext.data.JsonStore({id:&quot;storeUnitSelect&quot;,root:&quot;dimension.units&quot;,idProperty:&quot;id&quot;,fields:[{name:&quot;unitName&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;}]});sitools.common.forms.AbstractWithUnit.superclass.initComponent.call(this)},loadUnits:function(a){if(!this.unitsLoaded){this.storeUnits.removeAll();Ext.Ajax.request({method:&quot;GET&quot;,url:loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_DIMENSIONS_ADMIN_URL&quot;)+&quot;/dimension/&quot;+this.dimensionId,scope:this,success:function(e){var b=Ext.decode(e.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}var d=b.dimension.sitoolsUnits;this.dimensionName=b.dimension.name;for(var g=0;g&lt;d.length;g++){this.storeUnits.add(new Ext.data.Record(d[g]))}},failure:alertFailure,callback:function(){this.unitsLoaded=true;this.showWinUnits(a)}})}else{this.showWinUnits(a)}},showWinUnits:function(d){var b=new Ext.grid.ColumnModel({columns:[{header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;label&quot;,width:100}],defaults:{sortable:true,width:100}});var e=new Ext.grid.RowSelectionModel({singleSelect:true});this.gridUnits=new Ext.grid.GridPanel({autoScroll:true,store:this.storeUnits,cm:b,sm:e,layout:&quot;fit&quot;,listeners:{scope:this,rowClick:function(g,k){this.onValidateUnits()}}});var a=new Ext.Window({layout:&quot;fit&quot;,width:200,title:i18n.get(&quot;title.unitList&quot;),modal:true,height:300,items:[this.gridUnits],buttons:[{text:i18n.get(&quot;label.ok&quot;),handler:this.onValidateUnits,scope:this},{text:i18n.get(&quot;label.cancel&quot;),scope:a,handler:function(){this.ownerCt.ownerCt.close()}}]});a.show();a.setPosition(d.getXY()[0],d.getXY()[1])},onValidateUnits:function(){var b=this.gridUnits.getSelectionModel().getSelected();if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noSelection&quot;));return}this.userUnit=b.data;this.userDimension=this.dimensionName;var a=this.getEl().query(&quot;button&quot;)[0];if(!Ext.isEmpty(a)){this.getEl().query(&quot;button&quot;)[0].update(b.get(&quot;label&quot;))}this.gridUnits.ownerCt.close()},getUnitComponent:function(){var b=this.context.getRefUnit(this);if(!Ext.isEmpty(this.dimensionId)){var a=new Ext.Button({scope:this,text:Ext.isEmpty(b)?&quot;    &quot;:b.label,width:90,handler:function(d,g){this.loadUnits(g)}});unit=new Ext.Container({layout:&quot;hbox&quot;,layoutConfig:{pack:&quot;center&quot;,align:&quot;middle&quot;},margins:{top:0,right:0,bottom:0,left:10},width:100,items:[a]})}else{if(!Ext.isEmpty(b)){unit=new Ext.Container({html:b.label,margins:{top:0,right:0,bottom:0,left:10},flex:1})}else{unit=null}}return unit}});Ext.namespace(&quot;Ext.ux.plugin&quot;);Ext.onReady(function(){var a=Ext.util.CSS;if(a){a.getRule(&quot;.x-hide-nosize&quot;)||a.createStyleSheet(&quot;.x-hide-nosize{height:0px!important;width:0px!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;border:none!important;zoom:1;}&quot;);a.refreshCache()}});(function(){var l=Ext.Element,b=Ext.lib.Anim,a=l.prototype;var k=&quot;visibility&quot;,e=&quot;display&quot;,d=&quot;hidden&quot;,m=&quot;none&quot;;var g={};g.El={setDisplayed:function(p){var n=this;n.visibilityCls?(n[p!==false?&quot;removeClass&quot;:&quot;addClass&quot;](n.visibilityCls)):a.setDisplayed.call(n,p);return n},isDisplayed:function(){return !(this.hasClass(this.visibilityCls)||this.isStyle(e,m))},fixDisplay:function(){var n=this;a.fixDisplay.call(n);n.visibilityCls&amp;&amp;n.removeClass(n.visibilityCls)},isVisible:function(q){var t=this.visible||(!this.isStyle(k,d)&amp;&amp;(this.visibilityCls?!this.hasClass(this.visibilityCls):!this.isStyle(e,m)));if(q!==true||!t){return t}var u=this.dom.parentNode,n=/^body/i;while(u&amp;&amp;!n.test(u.tagName)){if(!Ext.fly(u,&quot;_isVisible&quot;).isVisible()){return false}u=u.parentNode}return true},isStyle:a.isStyle||function(n,p){return this.getStyle(n)==p}};Ext.override(l.Flyweight,g.El);Ext.ux.plugin.VisibilityMode=function(p){Ext.apply(this,p||{});var n=Ext.util.CSS;if(n&amp;&amp;!Ext.isIE&amp;&amp;this.fixMaximizedWindow!==false&amp;&amp;!Ext.ux.plugin.VisibilityMode.MaxWinFixed){n.updateRule(&quot;.x-window-maximized-ct&quot;,&quot;overflow&quot;,&quot;&quot;);Ext.ux.plugin.VisibilityMode.MaxWinFixed=true}};Ext.extend(Ext.ux.plugin.VisibilityMode,Object,{bubble:true,fixMaximizedWindow:true,elements:null,visibilityCls:&quot;x-hide-nosize&quot;,hideMode:&quot;nosize&quot;,ptype:&quot;uxvismode&quot;,init:function(u){var p=this.hideMode||u.hideMode,t=this,n=Ext.Container.prototype.bubble,q=function(){var z=[this.collapseEl,this.actionMode].concat(t.elements||[]);Ext.each(z,function(A){t.extend(this[A]||A)},this);var v={visFixed:true,animCollapse:false,animFloat:false,hideMode:p,defaults:this.defaults||{}};v.defaults.hideMode=p;Ext.apply(this,v);Ext.apply(this.initialConfig||{},v)};u.on(&quot;render&quot;,function(){if(t.bubble!==false&amp;&amp;this.ownerCt){n.call(this.ownerCt,function(){this.visFixed||this.on(&quot;afterlayout&quot;,q,this,{single:true})})}q.call(this)},u,{single:true})},extend:function(n,p){n&amp;&amp;Ext.each([].concat(n),function(q){if(q&amp;&amp;q.dom){if(&quot;visibilityCls&quot; in q){return}Ext.apply(q,g.El);q.visibilityCls=p||this.visibilityCls}},this);return this}});Ext.preg&amp;&amp;Ext.preg(&quot;uxvismode&quot;,Ext.ux.plugin.VisibilityMode);Ext.provide&amp;&amp;Ext.provide(&quot;uxvismode&quot;)})();(function(){var T=Ext.Element,v,K=Ext.lib.Dom,ay=Ext.lib.Anim,u=Ext.EventManager,aw=Ext.lib.Event,aA=document,J=function(){},aC=Object.prototype,aM=aC.toString,B=&quot;[object HTMLDocument]&quot;;if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,&quot;&quot;),10)&lt;311){alert(&quot;Ext Release &quot;+Ext.version+&quot; is not supported&quot;)}Ext._documents={};Ext._documents[Ext.id(document,&quot;_doc&quot;)]=Ext.elCache;var ad=K.resolveDocumentCache=function(E,aR){var aQ=g(E),aS=Ext.isDocument(aQ)?Ext.id(aQ):aR,A=Ext._documents[aS]||null;return A||(aS?Ext._documents[aS]={}:null)},aP=K.clearDocumentCache=function(A){delete Ext._documents[A]};T.addMethods||(T.addMethods=function(A){Ext.apply(T.prototype,A||{})});Ext.removeNode=function(aT){var aS=aT?aT.dom||aT:null,aQ,aR,A=ad(aS),E;if(aS&amp;&amp;(aR=A[aS.id])&amp;&amp;(aQ=aR.el)){if(aQ.dom){Ext.enableNestedListenerRemoval?u.purgeElement(aQ.dom,true):u.removeAll(aQ.dom)}delete A[aS.id];delete aQ.dom;delete aQ._context;aQ=null}if(aS&amp;&amp;!aS.navigator&amp;&amp;!Ext.isDocument(aS)&amp;&amp;aS.tagName!=&quot;BODY&quot;){(E=aS.parentElement||aS.parentNode)&amp;&amp;E.removeChild(aS)}aS=E=null};var k=function(aU,aS){var aT=typeof aU===&quot;function&quot;?aU:function aR(){};var aQ=aT._ovl;if(!aQ){aQ={base:aT};aQ[aT.length||0]=aT;aT=function aR(){var aX=arguments.callee._ovl;var aW=aX[arguments.length]||aX.base;return aW&amp;&amp;aW!=arguments.callee?aW.apply(this,arguments):undefined}}var aV=[].concat(aS);for(var E=0,A=aV.length;E&lt;A;++E){aQ[aV[E].length]=aV[E]}aT._ovl=aQ;var aR=null;return aT};Ext.applyIf(Ext,{overload:k(k,[function(A){return k(null,A)},function(aQ,E,A){return aQ[E]=k(aQ[E],A)}]),isArray:function(A){return !!A&amp;&amp;aM.apply(A)==&quot;[object Array]&quot;},isObject:function(A){return !!A&amp;&amp;typeof A==&quot;object&quot;},isDocument:function(E,A){var aS=E?E.dom||E:null;var aR=aS&amp;&amp;((aM.apply(aS)==B)||(aS&amp;&amp;aS.nodeType==9));if(aR&amp;&amp;A){try{aR=!!aS.location}catch(aQ){return false}}return aR},isWindow:function(A){var E=A?A.dom||A:null;return E?!!E.navigator||aM.apply(E)==&quot;[object Window]&quot;:false},isIterable:function(A){if(Ext.isArray(A)||A.callee){return true}if(/NodeList|HTMLCollection/.test(aM.call(A))){return true}return((typeof A.nextNode!=&quot;undefined&quot;||A.item)&amp;&amp;Ext.isNumber(A.length))},isElement:function(A){return A&amp;&amp;Ext.type(A)==&quot;element&quot;},isEvent:function(A){return aM.apply(A)==&quot;[object Event]&quot;||(Ext.isObject(A)&amp;&amp;!Ext.type(o.constructor)&amp;&amp;(window.event&amp;&amp;A.clientX&amp;&amp;A.clientX==window.event.clientX))},isFunction:function(A){return !!A&amp;&amp;typeof A==&quot;function&quot;},isEventSupported:function(aR,aS){var aQ={select:&quot;input&quot;,change:&quot;input&quot;,submit:&quot;form&quot;,reset:&quot;form&quot;,load:&quot;img&quot;,error:&quot;img&quot;,abort:&quot;img&quot;},A={},aT=/^on/i,E=function(aW,aV){var aU=Ext.getDom(aV);return(aU?(Ext.isElement(aU)||Ext.isDocument(aU)?aU.nodeName.toLowerCase():aV.self?&quot;#window&quot;:aV||&quot;#object&quot;):aV||&quot;div&quot;)+&quot;:&quot;+aW};return function(aY,a0){aY=(aY||&quot;&quot;).replace(aT,&quot;&quot;);var aZ,aX=false;var aV=&quot;on&quot;+aY;var aU=(a0?a0:aQ[aY])||&quot;div&quot;;var aW=E(aY,aU);if(aW in A){return A[aW]}aZ=Ext.isString(aU)?aA.createElement(aU):a0;aX=(!!aZ&amp;&amp;(aV in aZ));aX||(aX=window.Event&amp;&amp;!!(String(aY).toUpperCase() in window.Event));if(!aX&amp;&amp;aZ){aZ.setAttribute&amp;&amp;aZ.setAttribute(aV,&quot;return;&quot;);aX=Ext.isFunction(aZ[aV])}A[aW]=aX;aZ=null;return aX}}()});var aB=function(A){return T;return T[(A.tagName||&quot;-&quot;).toUpperCase()]||T};var R;function av(A,E){if(!R){R=new Ext.Element.Flyweight()}R.dom=Ext.getDom(A,null,E);return R}Ext.apply(Ext,{get:T.get=function(aR,aW){if(!aR){return null}var aV=Ext.isDocument(aR);Ext.isDocument(aW)||(aW=aA);var aU,aT,E,A=ad(aW);if(typeof aR==&quot;string&quot;){aT=Ext.getDom(aR,null,aW);if(!aT){return null}if(A[aR]&amp;&amp;A[aR].el){aU=A[aR].el;aU.dom=aT}else{aU=T.addToCache(new (aB(aT))(aT,null,aW))}return aU}else{if(aV){if(!Ext.isDocument(aR,true)){return false}A=ad(aR);if(A[Ext.id(aR)]&amp;&amp;A[aR.id].el){return A[aR.id].el}var aS=function(){};aS.prototype=T.prototype;var aQ=new aS();aQ.dom=aR;aQ.id=Ext.id(aR,&quot;_doc&quot;);aQ._isDoc=true;T.addToCache(aQ,null,A);return aQ}else{if(aR instanceof T){if(aR.dom){aR.id=Ext.id(aR.dom)}else{aR.dom=aR.id?Ext.getDom(aR.id,true):null}if(aR.dom){A=ad(aR);(A[aR.id]||(A[aR.id]={data:{},events:{}})).el=aR}return aR}else{if(aR.tagName||Ext.isWindow(aR)){A=ad(aR);E=Ext.id(aR);if(A[E]&amp;&amp;(aU=A[E].el)){aU.dom=aR}else{aU=T.addToCache(new (aB(aR))(aR,null,aW),null,A)}return aU}else{if(aR.isComposite){return aR}else{if(Ext.isArray(aR)){return Ext.get(aW,aW).select(aR)}}}}}}return null},getDom:function(E,A,aS){var aR=aS||aA;if(!E||!aR){return null}if(E.dom){return E.dom}else{if(Ext.isString(E)){var aQ=aR.getElementById(E);if(aQ&amp;&amp;Ext.isIE&amp;&amp;A){if(E==aQ.getAttribute(&quot;id&quot;)){return aQ}else{return null}}return aQ}else{return E}}},getBody:function(E){var A=K.getDocument(E)||aA;return Ext.get(A.body||A.documentElement)},getDoc:Ext.overload([Ext.getDoc,function(A){return Ext.get(A,A)}])});T.data=function(E,A,aQ){E=T.get(E);if(!E){return null}var aR=ad(E)[E.id].data;if(arguments.length==2){return aR[A]}else{return(aR[A]=aQ)}};T.addToCache=function(E,aS,A){aS=aS||Ext.id(E);var aR=A||ad(E);aR[aS]={el:E.dom?E:Ext.get(E),data:{},events:{}};var aQ=aR[aS].el.dom;(aQ.getElementById||aQ.navigator)&amp;&amp;(aR[aS].skipGC=true);return aR[aS].el};T.removeFromCache=function(E,A){if(E&amp;&amp;E.id){var aQ=A||ad(E);delete aQ[E.id]}};T.ASCLASS=3;T.visibilityCls=&quot;x-hide-nosize&quot;;var aE={},V=/(-[a-z])/gi,Q=function(A,E){return E.charAt(1).toUpperCase()},n=/alpha\(opacity=(.*)\)/i,t=/^\s+|\s+$/g,aK=/marginRight/,N=Ext.isIE?&quot;styleFloat&quot;:&quot;cssFloat&quot;,aF=aA.defaultView,am=&quot;visibilityMode&quot;,L=T.DISPLAY,m=T.VISIBILITY,at=T.ASCLASS,W=&quot;originalDisplay&quot;,an=&quot;padding&quot;,aa=&quot;margin&quot;,aI=&quot;border&quot;,d=&quot;-left&quot;,p=&quot;-right&quot;,z=&quot;-top&quot;,aG=&quot;-bottom&quot;,Z=&quot;-width&quot;,aL=Math,ai=&quot;opacity&quot;,ah=&quot;visibility&quot;,U=&quot;display&quot;,ar=&quot;offsets&quot;,aH=&quot;asclass&quot;,ao=&quot;hidden&quot;,aj=&quot;none&quot;,ag=&quot;isVisible&quot;,M=&quot;isClipped&quot;,e=&quot;overflow&quot;,ac=&quot;overflow-x&quot;,ab=&quot;overflow-y&quot;,O=&quot;originalClip&quot;,Y=&quot;x-masked&quot;,P=&quot;x-masked-relative&quot;,au={l:aI+d+Z,r:aI+p+Z,t:aI+z+Z,b:aI+aG+Z},az={l:an+d,r:an+p,t:an+z,b:an+aG},C={l:aa+d,r:aa+p,t:aa+z,b:aa+aG},S=T.data,aN=Ext.getDom,D=Ext.get,aq=Ext.DomHelper,ak=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,aO=Ext.util.CSS,ax=function(E){var A=S(E,W);if(A===undefined){S(E,W,A=&quot;&quot;)}return A},q=function(E){var A=S(E,am);if(A===undefined){S(E,am,A=T.prototype.visibilityMode)}return A};function aD(A){return aE[A]||(aE[A]=A==&quot;float&quot;?N:A.replace(V,Q))}T.addMethods({getDocument:function(){return this._context||(this._context=g(this))},remove:function(E,A){var aQ=this.dom;this.isMasked()&amp;&amp;this.unmask();if(aQ){Ext.removeNode(aQ);delete this._context;delete this.dom}},appendChild:function(A,E){return D(A,E||this.getDocument()).appendTo(this)},appendTo:function(A,E){aN(A,false,E||this.getDocument()).appendChild(this.dom);return this},insertBefore:function(A,E){(A=aN(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A);return this},insertAfter:function(A,E){(A=aN(A,false,E||this.getDocument())).parentNode.insertBefore(this.dom,A.nextSibling);return this},insertFirst:function(E,A){E=E||{};if(E.nodeType||E.dom||typeof E==&quot;string&quot;){E=aN(E);this.dom.insertBefore(E,this.dom.firstChild);return !A?D(E):E}else{return this.createChild(E,this.dom.firstChild,A)}},replace:function(A,E){A=D(A,E||this.getDocument());this.insertBefore(A);A.remove();return this},replaceWith:function(A,aQ){var E=this;if(A.nodeType||A.dom||typeof A==&quot;string&quot;){A=aN(A,false,aQ||E.getDocument());E.dom.parentNode.insertBefore(A,E.dom)}else{A=aq.insertBefore(E.dom,A)}var aR=ad(E);Ext.removeNode(E.dom);E.id=Ext.id(E.dom=A);T.addToCache(E.isFlyweight?new (aB(E.dom))(E.dom,null,aR):E);return E},insertHtml:function(E,aQ,A){var aR=aq.insertHtml(E,this.dom,aQ);return A?Ext.get(aR,g(aR)):aR},setVisibilityMode:function(A){S(this.dom,am,A);return this},isVisible:function(){return this.visible||Ext.value(S(this.dom,ag),!this.isStyle(ah,ao)&amp;&amp;!this.isStyle(U,aj))},setVisible:function(aS,A){var aU=this,aT=aU.dom,E,aW,aV,aR;if(typeof A==&quot;string&quot;){E=A==U;aW=A==ah;aV=A==ar;aR=A==aH;A=false}else{var aQ=q(aT);E=aQ==L;aW=aQ==m;aR=aQ==at}if(!A||!aU.anim){if(aR){aU[aS?&quot;removeClass&quot;:&quot;addClass&quot;](aU.visibilityCls||T.visibilityCls)}else{if(E){return aU.setDisplayed(aS)}else{if(aV){if(!aS){aU.hideModeStyles={position:aU.getStyle(&quot;position&quot;),top:aU.getStyle(&quot;top&quot;),left:aU.getStyle(&quot;left&quot;)};aU.applyStyles({position:&quot;absolute&quot;,top:&quot;-10000px&quot;,left:&quot;-10000px&quot;})}else{aU.applyStyles(aU.hideModeStyles||{position:&quot;&quot;,top:&quot;&quot;,left:&quot;&quot;});delete aU.hideModeStyles}}else{aU.fixDisplay();if(aT){aT.style.visibility=aS?&quot;visible&quot;:ao}}}}}else{if(aS){aU.setOpacity(0.01);aU.setVisible(true)}aU.anim({opacity:{to:(aS?1:0)}},aU.preanim(arguments,1),null,0.35,&quot;easeIn&quot;,function(){if(!aS){aR?aU.addClass(aU.visibilityCls||T.visibilityCls):aT.style[E?U:ah]=(E)?aj:ao;aU.setOpacity(1)}})}S(aT,ag,aS);return aU},setDisplayed:function(E){var aQ=this.dom,A=q(aQ);if(typeof E==&quot;boolean&quot;){if(A==T.ASCLASS){return this.setVisible(E,aH)}S(this.dom,ag,E);E=E?ax(aQ):aj}this.setStyle(U,E);return this},fixDisplay:function(){var A=this;if(A.isStyle(U,aj)){A.setStyle(ah,ao);A.setStyle(U,ax(A.dom));if(A.isStyle(U,aj)){A.setStyle(U,&quot;block&quot;)}}S(A.dom,ag)||A.removeClass(A.visibilityCls||T.visibilityCls)},enableDisplayMode:function(A){this.setVisibilityMode(T.DISPLAY);if(!Ext.isEmpty(A)){S(this.dom,W,A)}return this},scrollIntoView:function(aQ,aT){var aY=this.getDocument(),aZ=Ext.getDom(aQ,null,aY)||Ext.getBody(aY).dom,aS=this.dom,aR=this.getOffsetsTo(aZ),aV=aR[0]+aZ.scrollLeft,a2=aR[1]+aZ.scrollTop,a0=a2+aS.offsetHeight,E=aV+aS.offsetWidth,A=aZ.clientHeight,aW=parseInt(aZ.scrollTop,10),a1=parseInt(aZ.scrollLeft,10),aU=aW+A,aX=a1+aZ.clientWidth;if(aS.offsetHeight&gt;A||a2&lt;aW){aZ.scrollTop=a2}else{if(a0&gt;aU){aZ.scrollTop=a0-A}}aZ.scrollTop=aZ.scrollTop;if(aT!==false){if(aS.offsetWidth&gt;aZ.clientWidth||aV&lt;a1){aZ.scrollLeft=aV}else{if(E&gt;aX){aZ.scrollLeft=E-aZ.clientWidth}}aZ.scrollLeft=aZ.scrollLeft}return this},contains:function(A){try{return !A?false:K.isAncestor(this.dom,A.dom?A.dom:A)}catch(E){return false}},getScroll:function(){var aU=this.dom,aT=this.getDocument(),A=aT.body,aQ=aT.documentElement,E,aS,aR;if(Ext.isDocument(aU)||aU==A){if(Ext.isIE&amp;&amp;K.docIsStrict(aT)){E=aQ.scrollLeft;aS=aQ.scrollTop}else{E=window.pageXOffset;aS=window.pageYOffset}aR={left:E||(A?A.scrollLeft:0),top:aS||(A?A.scrollTop:0)}}else{aR={left:aU.scrollLeft,top:aU.scrollTop}}return aR},getStyle:function(){var A=aF&amp;&amp;aF.getComputedStyle?function E(aW){var aT=!this._isDoc?this.dom:null,aQ,aS,aR,aU,aV=Ext.isWebKit,aU;if(!aT||!aT.style){return null}aW=aD(aW);aR=(aQ=aT.style[aW])?aQ:(aS=aF.getComputedStyle(aT,&quot;&quot;))?aS[aW]:null;if(aV){if((aK.test(aW))&amp;&amp;aR!=&quot;0px&quot;){aU=this.getStyle(&quot;display&quot;);aT.style.display=&quot;inline-block&quot;;aR=aF.getComputedStyle(aT,&quot;&quot;);aT.style.display=aU}if(aR==&quot;rgba(0, 0, 0, 0)&quot;){aR=&quot;transparent&quot;}}return aR}:function E(aU){var aS=!this._isDoc?this.dom:null,aQ,aR;if(!aS||!aS.style){return null}if(aU==ai){if(aS.style.filter.match){if(aQ=aS.style.filter.match(n)){var aT=parseFloat(aQ[1]);if(!isNaN(aT)){return aT?aT/100:0}}}return 1}aU=aD(aU);return aS.style[aU]||((aR=aS.currentStyle)?aR[aU]:null)};var E=null;return A}(),setStyle:function(aS,aR){if(this._isDoc||Ext.isDocument(this.dom)){return this}var A,E;if(typeof aS!=&quot;object&quot;){A={};A[aS]=aR;aS=A}for(E in aS){aR=aS[E];if(E==ai){this.setOpacity(aR)}else{try{this.dom.style[aD(E)]=aR}catch(aQ){null}}}return this},center:function(A){return this.alignTo(A||this.getDocument(),&quot;c-c&quot;)},mask:function(E,aT){var aV=this,aR=aV.dom,aU=Ext.DomHelper,aS=&quot;ext-el-mask-msg&quot;,A,aW;if(aV.getStyle(&quot;position&quot;)==&quot;static&quot;){aV.addClass(P)}if((A=S(aR,&quot;maskMsg&quot;))){A.remove()}if((A=S(aR,&quot;mask&quot;))){A.remove()}aW=aU.append(aR,{cls:&quot;ext-el-mask&quot;},true);S(aR,&quot;mask&quot;,aW);aV.addClass(Y);aW.setDisplayed(true);if(typeof E==&quot;string&quot;){var aQ=aU.append(aR,{cls:aS,cn:{tag:&quot;div&quot;}},true);S(aR,&quot;maskMsg&quot;,aQ);aQ.dom.className=aT?aS+&quot; &quot;+aT:aS;aQ.dom.firstChild.innerHTML=E;aQ.setDisplayed(true);aQ.center(aV)}if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;aV.getStyle(&quot;height&quot;)==&quot;auto&quot;){aW.setSize(undefined,aV.getHeight())}return aW},unmask:function(){var aQ=this,aR=aQ.dom,A=S(aR,&quot;mask&quot;),E=S(aR,&quot;maskMsg&quot;);if(A){if(E){E.remove();S(aR,&quot;maskMsg&quot;,undefined)}A.remove();S(aR,&quot;mask&quot;,undefined)}aQ.removeClass([Y,P])},isMasked:function(){var A=S(this.dom,&quot;mask&quot;);return A&amp;&amp;A.isVisible()},getCenterXY:function(){return this.getAlignToXY(this.getDocument(),&quot;c-c&quot;)},getAnchorXY:function(aS,aX,a2){aS=(aS||&quot;tl&quot;).toLowerCase();a2=a2||{};var aW=this,aZ=this.getDocument(),E=aW.dom==aZ.body||aW.dom==aZ,a0=a2.width||E?K.getViewWidth(false,aZ):aW.getWidth(),aU=a2.height||E?K.getViewHeight(false,aZ):aW.getHeight(),a1,A=Math.round,aQ=aW.getXY(),aY=aW.getScroll(),aV=E?aY.left:!aX?aQ[0]:0,aT=E?aY.top:!aX?aQ[1]:0,aR={c:[A(a0*0.5),A(aU*0.5)],t:[A(a0*0.5),0],l:[0,A(aU*0.5)],r:[a0,A(aU*0.5)],b:[A(a0*0.5),aU],tl:[0,0],bl:[0,aU],br:[a0,aU],tr:[a0,0]};a1=aR[aS];return[a1[0]+aV,a1[1]+aT]},anchorTo:function(E,aT,aQ,A,aV,aW){var aU=this,aS=aU.dom;function aR(){av(aS).alignTo(E,aT,aQ,A);Ext.callback(aW,av(aS))}Ext.EventManager.onWindowResize(aR,aU);if(!Ext.isEmpty(aV)){Ext.EventManager.on(window,&quot;scroll&quot;,aR,aU,{buffer:!isNaN(aV)?aV:50})}aR.call(aU);return aU},getScroll:function(){var aU=this.dom,aT=this.getDocument(),A=aT.body,aQ=aT.documentElement,E,aS,aR;if(aU==aT||aU==A){if(Ext.isIE&amp;&amp;K.docIsStrict(aT)){E=aQ.scrollLeft;aS=aQ.scrollTop}else{E=window.pageXOffset;aS=window.pageYOffset}aR={left:E||(A?A.scrollLeft:0),top:aS||(A?A.scrollTop:0)}}else{aR={left:aU.scrollLeft,top:aU.scrollTop}}return aR},getAlignToXY:function(aR,a5,a6){var bi;aR=Ext.get(aR,bi=this.getDocument());if(!aR||!aR.dom){throw&quot;Element.getAlignToXY with an element that doesn't exist&quot;}a6=a6||[0,0];a5=(a5==&quot;?&quot;?&quot;tl-bl?&quot;:(!/-/.test(a5)&amp;&amp;a5!=&quot;&quot;?&quot;tl-&quot;+a5:a5||&quot;tl-bl&quot;)).toLowerCase();var bf=this,bc=bf.dom,bh,bg,aW,aV,aY,ba,a3,aZ=K.getViewWidth(false,bi)-10,bb=K.getViewHeight(false,bi)-10,E,aS,aT,aU,a0,a4,be=bi.documentElement,aX=bi.body,a9=(be.scrollLeft||aX.scrollLeft||0)+5,a8=(be.scrollTop||aX.scrollTop||0)+5,bd=false,aQ=&quot;&quot;,A=&quot;&quot;,a7=a5.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!a7){throw&quot;Element.getAlignToXY with an invalid alignment &quot;+a5}aQ=a7[1];A=a7[2];bd=!!a7[3];bh=bf.getAnchorXY(aQ,true);bg=aR.getAnchorXY(A,false);aW=bg[0]-bh[0]+a6[0];aV=bg[1]-bh[1]+a6[1];if(bd){aY=bf.getWidth();ba=bf.getHeight();a3=aR.getRegion();E=aQ.charAt(0);aS=aQ.charAt(aQ.length-1);aT=A.charAt(0);aU=A.charAt(A.length-1);a0=((E==&quot;t&quot;&amp;&amp;aT==&quot;b&quot;)||(E==&quot;b&quot;&amp;&amp;aT==&quot;t&quot;));a4=((aS==&quot;r&quot;&amp;&amp;aU==&quot;l&quot;)||(aS==&quot;l&quot;&amp;&amp;aU==&quot;r&quot;));if(aW+aY&gt;aZ+a9){aW=a4?a3.left-aY:aZ+a9-aY}if(aW&lt;a9){aW=a4?a3.right:a9}if(aV+ba&gt;bb+a8){aV=a0?a3.top-ba:bb+a8-ba}if(aV&lt;a8){aV=a0?a3.bottom:a8}}return[aW,aV]},adjustForConstraints:function(aQ,A,E){return this.getConstrainToXY(A||this.getDocument(),false,E,aQ)||aQ},getConstrainToXY:function(E,A,aQ,aS){var aR={top:0,left:0,bottom:0,right:0};return function(aU,a2,aV,aT){var a4=this.getDocument();aU=Ext.get(aU,a4);aV=aV?Ext.applyIf(aV,aR):aR;var a3,aW,a1=0,aZ=0;if(aU.dom==a4.body||aU.dom==a4){a3=K.getViewWidth(false,a4);aW=K.getViewHeight(false,a4)}else{a3=aU.dom.clientWidth;aW=aU.dom.clientHeight;if(!a2){var aX=aU.getXY();a1=aX[0];aZ=aX[1]}}var a7=aU.getScroll();a1+=aV.left+a7.left;aZ+=aV.top+a7.top;a3-=aV.right;aW-=aV.bottom;var a6=a1+a3,aY=aZ+aW,a5=aT||(!a2?this.getXY():[this.getLeft(true),this.getTop(true)]);x=a5[0],y=a5[1],offset=this.getConstrainOffset(),w=this.dom.offsetWidth+offset,h=this.dom.offsetHeight+offset;var a0=false;if((x+w)&gt;a6){x=a6-w;a0=true}if((y+h)&gt;aY){y=aY-h;a0=true}if(x&lt;a1){x=a1;a0=true}if(y&lt;aZ){y=aZ;a0=true}return a0?[x,y]:false}}(),getConstrainOffset:function(){return 0},getCenterXY:function(){return this.getAlignToXY(Ext.getBody(this.getDocument()),&quot;c-c&quot;)},center:function(A){return this.alignTo(A||Ext.getBody(this.getDocument()),&quot;c-c&quot;)},findParent:function(aV,aU,E){var aS=this.dom,aR=this.getDocument(),A=aR.body,aT=0,aQ;if(Ext.isGecko&amp;&amp;aM.call(aS)==&quot;[object XULElement]&quot;){return null}aU=aU||50;if(isNaN(aU)){aQ=Ext.getDom(aU,null,aR);aU=Number.MAX_VALUE}while(aS&amp;&amp;aS.nodeType==1&amp;&amp;aT&lt;aU&amp;&amp;aS!=A&amp;&amp;aS!=aQ){if(Ext.DomQuery.is(aS,aV)){return E?Ext.get(aS,aR):aS}aT++;aS=aS.parentNode}return null},clip:function(){var A=this,E=A.dom;if(!S(E,M)){S(E,M,true);S(E,O,{o:A.getStyle(e),x:A.getStyle(ac),y:A.getStyle(ab)});A.setStyle(e,ao);A.setStyle(ac,ao);A.setStyle(ab,ao)}return A},unclip:function(){var A=this,aQ=A.dom;if(S(aQ,M)){S(aQ,M,false);var E=S(aQ,O);if(E.o){A.setStyle(e,E.o)}if(E.x){A.setStyle(ac,E.x)}if(E.y){A.setStyle(ab,E.y)}}return A},getViewSize:function(){var aQ=this.getDocument(),aR=this.dom,A=(aR==aQ||aR==aQ.body);if(A){var E=Ext.lib.Dom;return{width:E.getViewWidth(),height:E.getViewHeight()}}else{return{width:aR.clientWidth,height:aR.clientHeight}}},getStyleSize:function(){var aS=this,A,aR,aU=this.getDocument(),aV=this.dom,E=(aV==aU||aV==aU.body),aQ=aV.style;if(E){var aT=Ext.lib.Dom;return{width:aT.getViewWidth(),height:aT.getViewHeight()}}if(aQ.width&amp;&amp;aQ.width!=&quot;auto&quot;){A=parseFloat(aQ.width);if(aS.isBorderBox()){A-=aS.getFrameWidth(&quot;lr&quot;)}}if(aQ.height&amp;&amp;aQ.height!=&quot;auto&quot;){aR=parseFloat(aQ.height);if(aS.isBorderBox()){aR-=aS.getFrameWidth(&quot;tb&quot;)}}return{width:A||aS.getWidth(true),height:aR||aS.getHeight(true)}}});Ext.isDefined(T.collectorThreadId)&amp;&amp;clearInterval(T.collectorThreadId);function ap(){if(!Ext.enableGarbageCollector){clearInterval(T.collectorThreadId)}else{var A,aR,aT,aS,aQ=Ext.elCache;for(A in aQ){aS=aQ[A];if(aS.skipGC){continue}aR=aS.el;aT=aR.dom;if(!aT||!aT.parentNode||(!aT.offsetParent&amp;&amp;!aA.getElementById(A))){if(Ext.enableListenerCollection){Ext.EventManager.removeAll(aT)}delete aQ[A]}}if(Ext.isIE){var E={};for(A in aQ){E[A]=aQ[A]}Ext.elCache=Ext._documents[Ext.id(document)]=E;E=null}}}if(Ext.enableGarbageCollector){T.collectorThreadId=setInterval(ap,30000)}Ext.apply(K,{getDocument:function(aQ,aR){var aS=null;try{aS=Ext.getDom(aQ,null,null)}catch(E){}var A=Ext.isDocument(aS);if(A){if(aR){return Ext.isDocument(aS,aR)?aS:null}return aS}return aS?aS.ownerDocument||aS.document:null},docIsStrict:function(A){return(Ext.isDocument(A)?A:this.getDocument(A)).compatMode==&quot;CSS1Compat&quot;},getViewWidth:Ext.overload([K.getViewWidth||function(A){},function(){return this.getViewWidth(false)},function(A,E){return A?this.getDocumentWidth(E):this.getViewportWidth(E)}]),getViewHeight:Ext.overload([K.getViewHeight||function(A){},function(){return this.getViewHeight(false)},function(A,E){return A?this.getDocumentHeight(E):this.getViewportHeight(E)}]),getDocumentHeight:Ext.overload([K.getDocumentHeight||J,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollHeight:A.documentElement.scrollHeight,this.getViewportHeight(A))}return undefined}]),getDocumentWidth:Ext.overload([K.getDocumentWidth||J,function(A){if(A=this.getDocument(A)){return Math.max(!this.docIsStrict(A)?A.body.scrollWidth:A.documentElement.scrollWidth,this.getViewportWidth(A))}return undefined}]),getViewportHeight:Ext.overload([K.getViewportHeight||J,function(A){if(A=this.getDocument(A)){if(Ext.isIE){return this.docIsStrict(A)?A.documentElement.clientHeight:A.body.clientHeight}else{return A.defaultView.innerHeight}}return undefined}]),getViewportWidth:Ext.overload([K.getViewportWidth||J,function(A){if(A=this.getDocument(A)){return !this.docIsStrict(A)&amp;&amp;!Ext.isOpera?A.body.clientWidth:Ext.isIE?A.documentElement.clientWidth:A.defaultView.innerWidth}return undefined}]),getXY:Ext.overload([K.getXY||J,function(A,aR){A=Ext.getDom(A,null,aR);var aQ=this.getDocument(A),E=aQ?(aQ.body||aQ.documentElement):null;if(!A||!E||A==E){return[0,0]}return this.getXY(A)}])});var g=K.getDocument,X=T._flyweights;Ext.fly=T.fly=function(aQ,A,aR){var E=null;A=A||&quot;_global&quot;;if(aQ=Ext.getDom(aQ,null,aR)){(E=X[A]=(X[A]||new T.Flyweight())).dom=aQ;Ext.isDocument(aQ)&amp;&amp;(E._isDoc=true)}return E};var aJ=function(){};aJ.prototype=T.prototype;T.Flyweight=function(A){this.dom=A};T.Flyweight.prototype=new aJ();T.Flyweight.prototype.isFlyweight=true;function b(aR,aT,aW,aS,aQ,aY){aR=Ext.getDom(aR);if(!aR){return}var E=Ext.id(aR),A=ad(aR);A[E]||T.addToCache(aR,E,A);var aX=A[E].events||{},aU;aU=aw.on(aR,aT,aQ);aX[aT]=aX[aT]||[];aX[aT].push([aW,aQ,aY,aU,aS]);if(aR.addEventListener&amp;&amp;aT==&quot;mousewheel&quot;){var aV=[&quot;DOMMouseScroll&quot;,aQ,false];aR.addEventListener.apply(aR,aV);Ext.EventManager.addListener(window,&quot;beforeunload&quot;,function(){aR.removeEventListener.apply(aR,aV)})}if(aT==&quot;mousedown&quot;&amp;&amp;aA==aR){Ext.EventManager.stoppedMouseDownEvent.addListener(aQ)}}function l(A,E){return function(){var aQ=Ext.toArray(arguments);if(E.target==Ext.EventObject.setEvent(aQ[0]).target){A.apply(this,aQ)}}}function al(E,aQ,A){return function(aR){A.delay(aQ.buffer,E,null,[new Ext.EventObjectImpl(aR)])}}function af(aS,aR,A,aQ,E){return function(aT){Ext.EventManager.removeListener(aR,A,aQ,E);aS(aT)}}function a(E,aQ,A){return function(aS){var aR=new Ext.util.DelayedTask(E);(A.tasks||(A.tasks=[])).push(aR);aR.delay(aQ.delay||10,E,null,[new Ext.EventObjectImpl(aS)])}}function ae(aT,aS,A,aV,aW){var E=!Ext.isObject(A)?{}:A,aQ=Ext.getDom(aT),aR;aV=aV||E.fn;aW=aW||E.scope;if(!aQ){throw'Error listening for &quot;'+aS+'&quot;. Element &quot;'+aT+&quot;\&quot; doesn't exist.&quot;}function aU(aY){if(!window.Ext){return}aY=Ext.EventObject.setEvent(aY);var aX;if(E.delegate){if(!(aX=aY.getTarget(E.delegate,aQ))){return}}else{aX=aY.target}if(E.stopEvent){aY.stopEvent()}if(E.preventDefault){aY.preventDefault()}if(E.stopPropagation){aY.stopPropagation()}if(E.normalized){aY=aY.browserEvent}aV.call(aW||aQ,aY,aX,E)}if(E.target){aU=l(aU,E)}if(E.delay){aU=a(aU,E,aV)}if(E.single){aU=af(aU,aQ,aS,aV,aW)}if(E.buffer){aR=new Ext.util.DelayedTask(aU);aU=al(aU,E,aR)}b(aQ,aS,aV,aR,aU,aW);return aU}Ext.apply(u,{addListener:u.on=function(aQ,A,aS,aR,E){if(typeof A==&quot;object&quot;){var aV=A,aT,aU;for(aT in aV){aU=aV[aT];if(!ak.test(aT)){if(Ext.isFunction(aU)){ae(aQ,aT,aV,aU,aV.scope)}else{ae(aQ,aT,aU)}}}}else{ae(aQ,A,E,aS,aR)}},removeListener:u.un=function(aT,aU,aY,a0){var E=Ext.getDom(aT);E&amp;&amp;Ext.get(E);var aZ=E?ad(E):{},aW=E&amp;&amp;((aZ[E.id]||{events:{}}).events)[aU]||[],A,aS,aQ,aR,aV,aX;for(aS=0,aV=aW.length;aS&lt;aV;aS++){if(Ext.isArray(aX=aW[aS])&amp;&amp;aX[0]==aY&amp;&amp;(!a0||aX[2]==a0)){aX[4]&amp;&amp;aX[4].cancel();aR=aY.tasks&amp;&amp;aY.tasks.length;if(aR){while(aR--){aY.tasks[aR].cancel()}delete aY.tasks}A=aX[1];aw.un(E,aU,aw.extAdapter?aX[3]:A);if(A&amp;&amp;aU==&quot;mousewheel&quot;&amp;&amp;E.addEventListener){E.removeEventListener(&quot;DOMMouseScroll&quot;,A,false)}if(A&amp;&amp;aU==&quot;mousedown&quot;&amp;&amp;aA==E){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}aW.splice(aS,1);if(aW.length===0){delete aZ[E.id].events[aU]}for(aR in aZ[E.id].events){return false}aZ[E.id].events={};return false}}},removeAll:function(aQ){if(!(aQ=Ext.getDom(aQ))){return}var E=aQ.id,aY=ad(aQ)||{},aZ=aY[E]||{},aX=aZ.events||{},aU,aT,aV,aR,aW,aS,A;for(aR in aX){if(aX.hasOwnProperty(aR)){aU=aX[aR];for(aT=0,aV=aU.length;aT&lt;aV;aT++){aW=aU[aT];aW[4]&amp;&amp;aW[4].cancel();if(aW[0].tasks&amp;&amp;(aS=aW[0].tasks.length)){while(aS--){aW[0].tasks[aS].cancel()}delete aW.tasks}A=aW[1];aw.un(aQ,aR,aw.extAdapter?aW[3]:A);if(A&amp;&amp;aQ.addEventListener&amp;&amp;aR==&quot;mousewheel&quot;){aQ.removeEventListener(&quot;DOMMouseScroll&quot;,A,false)}if(A&amp;&amp;aA==aQ&amp;&amp;aR==&quot;mousedown&quot;){Ext.EventManager.stoppedMouseDownEvent.removeListener(A)}}}}aY[E]&amp;&amp;(aY[E].events={})},getListeners:function(aQ,E){aQ=Ext.getDom(aQ);if(!aQ){return}var aS=(Ext.get(aQ)||{}).id,A=ad(aQ),aR=(A[aS]||{}).events||{};return aR[E]||null},purgeElement:function(aQ,A,aS){aQ=Ext.getDom(aQ);var E=Ext.id(aQ),aV=ad(aQ),aW=(aV[E]||{}).events||{},aR,aU,aT;if(aS){if(aW.hasOwnProperty(aS)){aU=aW[aS];for(aR=0,aT=aU.length;aR&lt;aT;aR++){u.removeListener(aQ,aS,aU[aR][0])}}}else{u.removeAll(aQ)}if(A&amp;&amp;aQ&amp;&amp;aQ.childNodes){for(aR=0,aT=aQ.childNodes.length;aR&lt;aT;aR++){u.purgeElement(aQ.childNodes[aR],A,aS)}}}});aw.getListeners=function(E,A){return Ext.EventManager.getListeners(E,A)};Ext.provide&amp;&amp;Ext.provide(&quot;multidom&quot;)})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,EMPTYFN=function(){},OP=Object.prototype,addListener=function(){var handler;if(window.addEventListener){handler=function F(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){handler=function F(el,eventName,fn,capture){el.attachEvent(&quot;on&quot;+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}(),removeListener=function(){var handler;if(window.removeEventListener){handler=function F(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){handler=function F(el,eventName,fn){el.detachEvent(&quot;on&quot;+eventName,fn)}}else{handler=function F(){}}}var F=null;return handler}();if(typeof ELD.getDocument!=&quot;function&quot;){alert(&quot;MIF 2.1 requires multidom support&quot;)}if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,&quot;&quot;),10)&lt;311){alert(&quot;Ext Release &quot;+Ext.version+&quot; is not supported&quot;)}Ext.ns(&quot;Ext.ux.ManagedIFrame&quot;,&quot;Ext.ux.plugin&quot;);var MIM,MIF=Ext.ux.ManagedIFrame,MIFC;var frameEvents=[&quot;documentloaded&quot;,&quot;domready&quot;,&quot;focus&quot;,&quot;blur&quot;,&quot;resize&quot;,&quot;scroll&quot;,&quot;unload&quot;,&quot;scroll&quot;,&quot;exception&quot;,&quot;message&quot;,&quot;reset&quot;];var reSynthEvents=new RegExp(&quot;^(&quot;+frameEvents.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;);Ext.ux.ManagedIFrame.Element=Ext.extend(Ext.Element,{constructor:function(element,forceNew,doc){var d=doc||document,elCache=ELD.resolveDocumentCache(d),dom=Ext.getDom(element,false,d);if(!dom||!(/^(iframe|frame)/i).test(dom.tagName)){return null}var id=Ext.id(dom);this.dom=dom;this.id=id;(elCache[id]||(elCache[id]={el:this,events:{},data:{}})).el=this;this.dom.name||(this.dom.name=this.id);if(Ext.isIE){document.frames&amp;&amp;(document.frames[this.dom.name]||(document.frames[this.dom.name]=this.dom))}this.dom.ownerCt=this;MIM.register(this);if(!this._observable){(this._observable=new Ext.util.Observable()).addEvents(&quot;documentloaded&quot;,&quot;domready&quot;,&quot;exception&quot;,&quot;resize&quot;,&quot;message&quot;,&quot;blur&quot;,&quot;focus&quot;,&quot;unload&quot;,&quot;scroll&quot;,&quot;reset&quot;);this._observable.addEvents(&quot;_docready&quot;,&quot;_docload&quot;)}var H=Ext.isIE?&quot;onreadystatechange&quot;:&quot;onload&quot;;this.dom[H]=this.loadHandler.createDelegate(this);this.dom.onerror=this.loadHandler.createDelegate(this)},destructor:function(){this.dom[Ext.isIE?&quot;onreadystatechange&quot;:&quot;onload&quot;]=this.dom.onerror=EMPTYFN;MIM.deRegister(this);this.removeAllListeners();Ext.destroy(this.frameShim,this.DDM);this.hideMask(true);delete this.loadMask;this.reset();this.manager=null;this.dom.ownerCt=null},cleanse:function(forceReclean,deep){if(this.isCleansed&amp;&amp;forceReclean!==true){return this}var d=this.dom,n=d.firstChild,nx;while(d&amp;&amp;n){nx=n.nextSibling;deep&amp;&amp;Ext.fly(n).cleanse(forceReclean,deep);Ext.removeNode(n);n=nx}this.isCleansed=true;return this},src:null,CSS:null,manager:null,disableMessaging:true,domReadyRetries:7500,focusOnLoad:Ext.isIE,eventsFollowFrameLinks:true,remove:function(){this.destructor.apply(this,arguments);ElFrame.superclass.remove.apply(this,arguments)},getDocument:function(){return this.dom?this.dom.ownerDocument:document},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=this.getDocument(),form=Ext.getDom(opt.form?opt.form.form||opt.form:null,false,D)||Ext.DomHelper.append(D.body,{tag:&quot;form&quot;,cls:&quot;x-hidden x-mif-form&quot;,encoding:&quot;multipart/form-data&quot;}),formFly=Ext.fly(form,&quot;_dynaForm&quot;),formState={target:form.target||&quot;&quot;,method:form.method||&quot;&quot;,encoding:form.encoding||&quot;&quot;,enctype:form.enctype||&quot;&quot;,action:form.action||&quot;&quot;},encoding=opt.encoding||form.encoding,method=opt.method||form.method||&quot;POST&quot;;formFly.set({target:this.dom.name,method:method,encoding:encoding,action:opt.url||opt.action||form.action});if(method==&quot;POST&quot;||!!opt.enctype){formFly.set({enctype:opt.enctype||form.enctype||encoding})}var hiddens,hd,ps;if(opt.params&amp;&amp;(ps=Ext.isFunction(opt.params)?opt.params():opt.params)){hiddens=[];Ext.iterate(ps=typeof ps==&quot;string&quot;?Ext.urlDecode(ps,false):ps,function(n,v){Ext.fly(hd=D.createElement(&quot;input&quot;)).set({type:&quot;hidden&quot;,name:n,value:v});form.appendChild(hd);hiddens.push(hd)})}opt.callback&amp;&amp;this._observable.addListener(&quot;_docready&quot;,opt.callback,opt.scope,{single:true});this._frameAction=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&amp;&amp;Ext.each(hiddens,Ext.removeNode,Ext);if(formFly.hasClass(&quot;x-mif-form&quot;)){formFly.remove()}else{formFly.set(formState)}delete El._flyweights._dynaForm;formFly=null;this.hideMask(true)}).defer(100,this);return this},resetUrl:(function(){return Ext.isIE&amp;&amp;Ext.isSecure?Ext.SSL_SECURE_URL:&quot;about:blank&quot;})(),setSrc:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this.showMask();(discardUrl!==true)&amp;&amp;(this.src=src);var s=this._targetURI=(Ext.isFunction(src)?src()||&quot;&quot;:src);try{this._frameAction=true;this.dom.src=s;this.checkDOM()}catch(ex){O.fireEvent.call(O,&quot;exception&quot;,this,ex)}return this},setLocation:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this.showMask();var s=this._targetURI=(Ext.isFunction(src)?src()||&quot;&quot;:src);if(discardUrl!==true){this.src=src}try{this._frameAction=true;this.getWindow().location.replace(s);this.checkDOM()}catch(ex){O.fireEvent.call(O,&quot;exception&quot;,this,ex)}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false,s=src,win=this.getWindow(),O=this._observable;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false}this.hideMask(true);if(win){this.isReset=true;var cb=callback;O.addListener(&quot;_docload&quot;,function(frame){if(this.loadMask){this.loadMask.disabled=loadMaskOff}Ext.isFunction(cb)&amp;&amp;(cb=cb.apply(scope||this,arguments));O.fireEvent(&quot;reset&quot;,this)},this,{single:true});Ext.isFunction(s)&amp;&amp;(s=src());s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;win.location?(win.location.href=s):O.fireEvent(&quot;_docload&quot;,this)}return this},scriptRE:/(?:&lt;script.*?&gt;)((\n|\r|.)*?)(?:&lt;\/script&gt;)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdater().loadScripts||false;content=Ext.DomHelper.markup(content||&quot;&quot;);content=loadScripts===true?content:content.replace(this.scriptRE,&quot;&quot;);var doc;if((doc=this.getFrameDocument())&amp;&amp;!!content.length){this._unHook();this.src=null;this.showMask();Ext.isFunction(callback)&amp;&amp;this._observable.addListener(&quot;_docload&quot;,callback,scope||this,{single:true});this._targetURI=location.href;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(true);Ext.isFunction(callback)&amp;&amp;callback.call(scope,this)}return this},execCommand:function(command,userInterface,value,validate){var doc,assert;if((doc=this.getFrameDocument())&amp;&amp;!!command){try{Ext.isIE&amp;&amp;this.getWindow().focus();assert=validate&amp;&amp;Ext.isFunction(doc.queryCommandEnabled)?doc.queryCommandEnabled(command):true;return assert&amp;&amp;doc.execCommand(command,!!userInterface,value)}catch(eex){return false}}return false},setDesignMode:function(active){var doc;(doc=this.getFrameDocument())&amp;&amp;(doc.designMode=(/on|true/i).test(String(active))?&quot;on&quot;:&quot;off&quot;)},getUpdater:function(){return this.updateManager||(this.updateManager=new MIF.Updater(this))},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){var doc=this.getFrameDocument();return doc?Ext.get(el,doc):doc=null},fly:function(el,named){var doc=this.getFrameDocument();return doc?Ext.fly(el,named,doc):null},getDom:function(el){var d;if(!el||!(d=this.getFrameDocument())){return(d=null)}return Ext.getDom(el,d)},select:function(selector,unique){var d;return(d=this.getFrameDocument())?Ext.Element.select(selector,unique,d):d=null},query:function(selector){var d;return(d=this.getFrameDocument())?Ext.DomQuery.select(selector,d):null},removeNode:Ext.removeNode,_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.document.getElementById(&quot;'+this.id+'&quot;).ownerCt)._windowContext='+(Ext.isIE?&quot;window&quot;:'{eval:function(s){return new Function(&quot;return (&quot;+s+&quot;)&quot;)();}}')+&quot;;})()&quot;)){var w,p=this._frameProxy,D=this.getFrameDocument();if(w=this.getWindow()){p||(p=this._frameProxy=this._eventProxy.createDelegate(this));addListener(w,&quot;focus&quot;,p);addListener(w,&quot;blur&quot;,p);addListener(w,&quot;resize&quot;,p);addListener(w,&quot;unload&quot;,p);D&amp;&amp;addListener(Ext.isIE?w:D,&quot;scroll&quot;,p)}D&amp;&amp;(this.CSS=new Ext.ux.ManagedIFrame.CSS(D))}}catch(ex){}return this.domWritable()},_unHook:function(){if(this._hooked){this._windowContext&amp;&amp;(this._windowContext.hostMIF=null);this._windowContext=null;var w,p=this._frameProxy;if(p&amp;&amp;this.domWritable()&amp;&amp;(w=this.getWindow())){removeListener(w,&quot;focus&quot;,p);removeListener(w,&quot;blur&quot;,p);removeListener(w,&quot;resize&quot;,p);removeListener(w,&quot;unload&quot;,p);removeListener(Ext.isIE?w:this.getFrameDocument(),&quot;scroll&quot;,p)}}ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);this.CSS=this.CSS?this.CSS.destroy():null;this.domFired=this._frameAction=this.domReady=this._hooked=false},_windowContext:null,getFrameDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&amp;&amp;win?win.document:null)||this.dom.contentDocument||window.frames[this.dom.name].document||null}catch(gdEx){ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);return false}doc=(doc&amp;&amp;Ext.isFunction(ELD.getDocument))?ELD.getDocument(doc,true):doc;return doc},getDoc:function(){var D=this.getFrameDocument();return Ext.get(D,D)},getBody:function(){var d;return(d=this.getFrameDocument())?this.get(d.body||d.documentElement):null},getDocumentURI:function(){var URI,d;try{URI=this.src&amp;&amp;(d=this.getFrameDocument())?d.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(Ext.isFunction(this.src)?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},scrollChildIntoView:function(child,container,hscroll){this.fly(child,&quot;_scrollChildIntoView&quot;).scrollIntoView(this.getDom(container)||this.getBody().dom,hscroll);return this},print:function(){try{var win;if(win=this.getWindow()){Ext.isIE&amp;&amp;win.focus();win.print()}}catch(ex){throw new MIF.Error(&quot;printexception&quot;,ex.description||ex.message||ex)}return this},domWritable:function(){return !!Ext.isDocument(this.getFrameDocument(),true)&amp;&amp;!!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw new MIF.Error(&quot;execscript-secure-context&quot;)}}catch(ex){this._observable.fireEvent.call(this._observable,&quot;exception&quot;,this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:&quot;text/javascript&quot;,text:block});try{var head,script,doc=this.getFrameDocument();if(doc&amp;&amp;typeof doc.getElementsByTagName!=&quot;undefined&quot;){if(!(head=doc.getElementsByTagName(&quot;head&quot;)[0])){head=doc.createElement(&quot;head&quot;);doc.getElementsByTagName(&quot;html&quot;)[0].appendChild(head)}if(head&amp;&amp;(script=doc.createElement(&quot;script&quot;))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&amp;&amp;attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this._observable.fireEvent.call(this._observable,&quot;exception&quot;,this,ex)}finally{script=head=null}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fnSrc=fn.fn||window[fn];name&amp;&amp;fnSrc&amp;&amp;this.execScript(name+&quot;=&quot;+fnSrc,useDOM);invokeIt&amp;&amp;this.execScript(name+&quot;()&quot;)},loadHandler:function(e,target){var rstatus=(this.dom||{}).readyState||(e||{}).type;if(this.eventsFollowFrameLinks||this._frameAction||this.isReset){switch(rstatus){case&quot;domready&quot;:case&quot;DOMFrameContentLoaded&quot;:case&quot;domfail&quot;:this._onDocReady(rstatus);break;case&quot;load&quot;:case&quot;complete&quot;:this._onDocLoaded(rstatus);break;case&quot;error&quot;:this._observable.fireEvent.apply(this._observable,[&quot;exception&quot;,this].concat(arguments));break;default:}this.frameState=rstatus}},_onDocReady:function(eventName){var w,obv=this._observable,D;if(!this.isReset&amp;&amp;this.focusOnLoad&amp;&amp;(w=this.getWindow())){w.focus()}obv.fireEvent(&quot;_docready&quot;,this);(D=this.getDoc())&amp;&amp;(D.isReady=true);if(!this.domFired&amp;&amp;(this._hooked=this._renderHook())){this.domFired=true;this.isReset||obv.fireEvent.call(obv,&quot;domready&quot;,this)}this.domReady=true;this.hideMask()},_onDocLoaded:function(eventName){var obv=this._observable,w;this.domReady||this._onDocReady(&quot;domready&quot;);obv.fireEvent(&quot;_docload&quot;,this);this.isReset||obv.fireEvent(&quot;documentloaded&quot;,this);this.hideMask(true);this._frameAction=this.isReset=false},checkDOM:function(win){if(Ext.isGecko){return}var n=0,frame=this,domReady=false,b,l,d,max=this.domReadyRetries||2500,polling=false,startLocation=(this.getFrameDocument()||{location:{}}).location.href;(function(){d=frame.getFrameDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===frame._targetURI);if(frame.domReady){return}domReady=polling&amp;&amp;((b=frame.getBody())&amp;&amp;!!(b.dom.innerHTML||&quot;&quot;).length)||false;if(d.location.href&amp;&amp;!domReady&amp;&amp;(++n&lt;max)){setTimeout(arguments.callee,2);return}frame.loadHandler({type:domReady?&quot;domready&quot;:&quot;domfail&quot;})})()},filterEventOptionsRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,addListener:function(eventName,fn,scope,options){if(typeof eventName==&quot;object&quot;){var o=eventName;for(var e in o){if(this.filterEventOptionsRe.test(e)){continue}if(typeof o[e]==&quot;function&quot;){this.addListener(e,o[e],o.scope,o)}else{this.addListener(e,o[e].fn,o[e].scope,o[e])}}return}if(reSynthEvents.test(eventName)){var O=this._observable;if(O){O.events[eventName]||(O.addEvents(eventName));O.addListener.call(O,eventName,fn,scope||this,options)}}else{ElFrame.superclass.addListener.call(this,eventName,fn,scope||this,options)}return this},removeListener:function(eventName,fn,scope){var O=this._observable;if(reSynthEvents.test(eventName)){O&amp;&amp;O.removeListener.call(O,eventName,fn,scope||this,options)}else{ElFrame.superclass.removeListener.call(this,eventName,fn,scope||this)}return this},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);var O=this._observable;O&amp;&amp;O.purgeListeners.call(this._observable);return this},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&amp;&amp;!lmask.disabled){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls,lmask.maskEl)}},hideMask:function(forced){var tlm=this.loadMask||{};if(forced||(tlm.hideOnReady&amp;&amp;this.domReady)){this.unmask()}},mask:function(msg,msgCls,maskCls,maskEl){this._mask&amp;&amp;this.unmask();var p=Ext.get(maskEl)||this.parent(&quot;.ux-mif-mask-target&quot;)||this.parent();if(p.getStyle(&quot;position&quot;)==&quot;static&quot;&amp;&amp;!p.select(&quot;iframe,frame,object,embed&quot;).elements.length){p.addClass(&quot;x-masked-relative&quot;)}p.addClass(&quot;x-masked&quot;);this._mask=Ext.DomHelper.append(p,{cls:maskCls||&quot;ux-mif-el-mask&quot;},true);this._mask.setDisplayed(true);this._mask._agent=p;if(typeof msg==&quot;string&quot;){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||&quot;ux-mif-el-mask-msg&quot;,style:{visibility:&quot;hidden&quot;},cn:{tag:&quot;div&quot;,html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY).center(p).setVisible(true)}if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;this.getStyle(&quot;height&quot;)==&quot;auto&quot;){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&amp;&amp;a.removeClass([&quot;x-masked-relative&quot;,&quot;x-masked&quot;]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},createFrameShim:function(imgUrl,shimCls){this.shimCls=shimCls||this.shimCls||&quot;ux-mif-shim&quot;;this.frameShim||(this.frameShim=this.next(&quot;.&quot;+this.shimCls)||Ext.DomHelper.append(this.dom.parentNode,{tag:&quot;img&quot;,src:imgUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:&quot;no&quot;},true));this.frameShim&amp;&amp;(this.frameShim.autoBoxAdjust=false);return this.frameShim},toggleShim:function(show){var shim=this.frameShim||this.createFrameShim();var cls=this.shimCls+&quot;-on&quot;;!show&amp;&amp;shim.removeClass(cls);show&amp;&amp;!shim.hasClass(cls)&amp;&amp;shim.addClass(cls)},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&amp;&amp;loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},_eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e,er,args=[e.type,this];if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){if(e.type==&quot;resize&quot;){var doc=this.getFrameDocument();doc&amp;&amp;(args.push({height:ELD.getDocumentHeight(doc),width:ELD.getDocumentWidth(doc)},{height:ELD.getViewportHeight(doc),width:ELD.getViewportWidth(doc)},{height:ELD.getViewHeight(false,doc),width:ELD.getViewWidth(false,doc)}))}er=this._observable?this._observable.fireEvent.apply(this._observable,args.concat(Array.prototype.slice.call(arguments,0))):null;(e.type==&quot;unload&quot;)&amp;&amp;this._unHook()}return er},sendMessage:function(message,tag,origin){},postMessage:function(message,origin){}});ElFrame=Ext.Element.IFRAME=Ext.Element.FRAME=Ext.ux.ManagedIFrame.Element;var fp=ElFrame.prototype;Ext.override(ElFrame,{on:fp.addListener,un:fp.removeListener,getUpdateManager:fp.getUpdater});Ext.ux.ManagedIFrame.ComponentAdapter=function(){};Ext.ux.ManagedIFrame.ComponentAdapter.prototype={version:2.12,defaultSrc:null,unsupportedText:&quot;Inline frames are NOT enabled/supported by your browser.&quot;,hideMode:!Ext.isIE&amp;&amp;!!Ext.ux.plugin.VisibilityMode?&quot;nosize&quot;:&quot;display&quot;,animCollapse:Ext.isIE,animFloat:Ext.isIE,disableMessaging:true,eventsFollowFrameLinks:true,frameConfig:null,focusOnLoad:Ext.isIE,frameEl:null,useShim:false,autoScroll:true,autoLoad:null,getId:function(){return this.id||(this.id=&quot;mif-comp-&quot;+(++Ext.Component.AUTO_ID))},stateEvents:[&quot;documentloaded&quot;],stateful:false,setAutoScroll:function(auto){var scroll=Ext.value(auto,this.autoScroll===true);this.rendered&amp;&amp;this.getFrame()&amp;&amp;this.frameEl.setOverflow((this.autoScroll=scroll)?&quot;auto&quot;:&quot;hidden&quot;);return this},getContentTarget:function(){return this.getFrame()},getFrame:function(){if(this.rendered){if(this.frameEl){return this.frameEl}var f=this.items&amp;&amp;this.items.first?this.items.first():null;f&amp;&amp;(this.frameEl=f.frameEl);return this.frameEl}return null},getFrameWindow:function(){return this.getFrame()?this.frameEl.getWindow():null},getFrameDocument:function(){return this.getFrame()?this.frameEl.getFrameDocument():null},getFrameDoc:function(){return this.getFrame()?this.frameEl.getDoc():null},getFrameBody:function(){return this.getFrame()?this.frameEl.getBody():null},resetFrame:function(){this.getFrame()&amp;&amp;this.frameEl.reset.apply(this.frameEl,arguments);return this},submitAsTarget:function(submitCfg){this.getFrame()&amp;&amp;this.frameEl.submitAsTarget.apply(this.frameEl,arguments);return this},load:function(loadCfg){if(loadCfg&amp;&amp;this.getFrame()){var args=arguments;this.resetFrame(null,function(){loadCfg.submitAsTarget?this.submitAsTarget.apply(this,args):this.frameEl.load.apply(this.frameEl,args)},this)}this.autoLoad=loadCfg;return this},doAutoLoad:function(){this.autoLoad&amp;&amp;this.load(typeof this.autoLoad==&quot;object&quot;?this.autoLoad:{url:this.autoLoad})},getUpdater:function(){return this.getFrame()?this.frameEl.getUpdater():null},setSrc:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setSrc.apply(this.frameEl,arguments);return this},setLocation:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setLocation.apply(this.frameEl,arguments);return this},getState:function(){var URI=this.getFrame()?this.frameEl.getDocumentURI()||null:null;var state=this.supr().getState.call(this);state=Ext.apply(state||{},{defaultSrc:Ext.isFunction(URI)?URI():URI,autoLoad:this.autoLoad});return state},setMIFEvents:function(){this.addEvents(&quot;documentloaded&quot;,&quot;domready&quot;,&quot;exception&quot;,&quot;message&quot;,&quot;blur&quot;,&quot;focus&quot;,&quot;scroll&quot;,&quot;resize&quot;,&quot;unload&quot;,&quot;reset&quot;)},sendMessage:function(message,tag,origin){},onAdd:function(C){C.relayTarget&amp;&amp;this.suspendEvents(true)},initRef:function(){if(this.ref){var t=this,levels=this.ref.split(&quot;/&quot;),l=levels.length,i;for(i=0;i&lt;l;i++){if(t.ownerCt){t=t.ownerCt}}this.refName=levels[--i];t[this.refName]||(t[this.refName]=this);this.refOwner=t}}};Ext.ux.ManagedIFrame.Component=Ext.extend(Ext.BoxComponent,{ctype:&quot;Ext.ux.ManagedIFrame.Component&quot;,initComponent:function(){var C={monitorResize:this.monitorResize||(this.monitorResize=!!this.fitToParent),plugins:(this.plugins||[]).concat(this.hideMode===&quot;nosize&quot;&amp;&amp;Ext.ux.plugin.VisibilityMode?[new Ext.ux.plugin.VisibilityMode({hideMode:&quot;nosize&quot;,elements:[&quot;bwrap&quot;]})]:[])};MIF.Component.superclass.initComponent.call(Ext.apply(this,Ext.apply(this.initialConfig,C)));this.setMIFEvents()},onRender:function(ct,position){var frCfg=this.frameCfg||this.frameConfig||(this.relayTarget?{name:this.relayTarget.id}:{})||{};var frDOM=frCfg.autoCreate||frCfg;frDOM=Ext.apply({tag:&quot;iframe&quot;,id:Ext.id()},frDOM);var el=Ext.getDom(this.el);(el&amp;&amp;el.tagName==&quot;iframe&quot;)||(this.autoEl=Ext.apply({name:frDOM.id,frameborder:0},frDOM));MIF.Component.superclass.onRender.apply(this,arguments);if(this.unsupportedText){ct.child(&quot;noframes&quot;)||ct.createChild({tag:&quot;noframes&quot;,html:this.unsupportedText||null})}var frame=this.el;var F;if(F=this.frameEl=(this.el?new MIF.Element(this.el.dom,true):null)){Ext.apply(F,{ownerCt:this.relayTarget||this,disableMessaging:Ext.value(this.disableMessaging,true),focusOnLoad:Ext.value(this.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(this.eventsFollowFrameLinks,true)});F.ownerCt.frameEl=F;F.addClass(&quot;ux-mif&quot;);if(this.loadMask){var mEl=this.loadMask.maskEl;F.loadMask=Ext.apply({disabled:false,hideOnReady:false,msgCls:&quot;ext-el-mask-msg x-mask-loading&quot;,maskCls:&quot;ext-el-mask&quot;},{maskEl:F.ownerCt[String(mEl)]||F.parent(&quot;.&quot;+String(mEl))||F.parent(&quot;.ux-mif-mask-target&quot;)||mEl},Ext.isString(this.loadMask)?{msg:this.loadMask}:this.loadMask);Ext.get(F.loadMask.maskEl)&amp;&amp;Ext.get(F.loadMask.maskEl).addClass(&quot;ux-mif-mask-target&quot;)}F._observable&amp;&amp;(this.relayTarget||this).relayEvents(F._observable,frameEvents.concat(this._msgTagHandlers||[]));delete this.contentEl}},afterRender:function(container){MIF.Component.superclass.afterRender.apply(this,arguments);if(this.fitToParent&amp;&amp;!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}this.getEl().setOverflow(&quot;hidden&quot;);this.setAutoScroll();var F;if(F=this.frameEl){var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on(&quot;afterlayout&quot;,function(container,layout){Ext.each([&quot;north&quot;,&quot;south&quot;,&quot;east&quot;,&quot;west&quot;],function(region){var reg;if((reg=layout[region])&amp;&amp;reg.split&amp;&amp;reg.split.dd&amp;&amp;!reg._splitTrapped){reg.split.dd.endDrag=reg.split.dd.endDrag.createSequence(MIM.hideShims,MIM);reg.split.on(&quot;beforeresize&quot;,MIM.showShims,MIM);reg._splitTrapped=MIM._splitTrapped=true}},this)},this,{single:true});ownerCt=ownerCt.ownerCt}if(!!this.ownerCt||this.useShim){this.frameShim=F.createFrameShim()}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var resumeEvents=this.relayTarget&amp;&amp;this.ownerCt?this.ownerCt.resumeEvents.createDelegate(this.ownerCt):null;if(this.autoload){this.doAutoLoad()}else{if(this.frameMarkup||this.html){F.update(this.frameMarkup||this.html,true,resumeEvents);delete this.html;delete this.frameMarkup;return}else{if(this.defaultSrc){F.setSrc(this.defaultSrc,false)}else{F.reset(null,resumeEvents);return}}}resumeEvents&amp;&amp;resumeEvents()}},beforeDestroy:function(){var F;if(F=this.getFrame()){F.remove();this.frameEl=this.frameShim=null}this.relayTarget&amp;&amp;(this.relayTarget.frameEl=null);MIF.Component.superclass.beforeDestroy.call(this)}});Ext.override(MIF.Component,MIF.ComponentAdapter.prototype);Ext.reg(&quot;mif&quot;,MIF.Component);function embed_MIF(config){config||(config={});config.layout=&quot;fit&quot;;config.items={xtype:&quot;mif&quot;,ref:&quot;mifChild&quot;,useShim:true,autoScroll:Ext.value(config.autoScroll,this.autoScroll),defaultSrc:Ext.value(config.defaultSrc,this.defaultSrc),frameMarkup:Ext.value(config.html,this.html),loadMask:Ext.value(config.loadMask,this.loadMask),disableMessaging:Ext.value(config.disableMessaging,this.disableMessaging),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,this.eventsFollowFrameLinks),focusOnLoad:Ext.value(config.focusOnLoad,this.focusOnLoad),frameConfig:Ext.value(config.frameConfig||config.frameCfg,this.frameConfig),relayTarget:this};delete config.html;this.setMIFEvents();return config}Ext.ux.ManagedIFrame.Panel=Ext.extend(Ext.Panel,{ctype:&quot;Ext.ux.ManagedIFrame.Panel&quot;,bodyCssClass:&quot;ux-mif-mask-target&quot;,constructor:function(config){MIF.Panel.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Panel,MIF.ComponentAdapter.prototype);Ext.reg(&quot;iframepanel&quot;,MIF.Panel);Ext.ux.ManagedIFrame.Portlet=Ext.extend(Ext.ux.ManagedIFrame.Panel,{ctype:&quot;Ext.ux.ManagedIFrame.Portlet&quot;,anchor:&quot;100%&quot;,frame:true,collapseEl:&quot;bwrap&quot;,collapsible:true,draggable:true,cls:&quot;x-portlet&quot;});Ext.reg(&quot;iframeportlet&quot;,MIF.Portlet);Ext.ux.ManagedIFrame.Window=Ext.extend(Ext.Window,{ctype:&quot;Ext.ux.ManagedIFrame.Window&quot;,bodyCssClass:&quot;ux-mif-mask-target&quot;,constructor:function(config){MIF.Window.superclass.constructor.call(this,embed_MIF.call(this,config))}});Ext.override(MIF.Window,MIF.ComponentAdapter.prototype);Ext.reg(&quot;iframewindow&quot;,MIF.Window);Ext.ux.ManagedIFrame.Updater=Ext.extend(Ext.Updater,{showLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.mask(this.indicatorText)},hideLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.unmask()},updateComplete:function(response){MIF.Updater.superclass.updateComplete.apply(this,arguments);this.hideLoading()},processFailure:function(response){MIF.Updater.superclass.processFailure.apply(this,arguments);this.hideLoading()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};Ext.ux.ManagedIFrame.CSS=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName(&quot;head&quot;)[0];var rules=doc.createElement(&quot;style&quot;);rules.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;rules.setAttribute(&quot;id&quot;,id);if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc||!id){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){if(!doc){return}this.removeStyleSheet(id);var ss=doc.createElement(&quot;link&quot;);ss.setAttribute(&quot;rel&quot;,&quot;stylesheet&quot;);ss.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;ss.setAttribute(&quot;id&quot;,id);ss.setAttribute(&quot;href&quot;,url);doc.getElementsByTagName(&quot;head&quot;)[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss,media){this.rules||(this.rules={});try{Ext.each(ss.cssRules||ss.rules||[],function(rule){this.hashRule(rule,ss,media)},this);Ext.each(ss.imports||[],function(sheet){sheet&amp;&amp;this.cacheStyleSheet(sheet,this.resolveMedia([sheet,sheet.parentStyleSheet]))},this)}catch(e){}},hashRule:function(rule,sheet,mediaOverride){var mediaSelector=mediaOverride||this.resolveMedia(rule);if(rule.cssRules||rule.rules){this.cacheStyleSheet(rule,this.resolveMedia([rule,rule.parentRule]))}if(rule.styleSheet){this.cacheStyleSheet(rule.styleSheet,this.resolveMedia([rule,rule.ownerRule,rule.parentStyleSheet]))}rule.selectorText&amp;&amp;Ext.each((mediaSelector||&quot;&quot;).split(&quot;,&quot;),function(media){this.rules[((media?media.trim()+&quot;:&quot;:&quot;&quot;)+rule.selectorText).toLowerCase()]=rule},this)},resolveMedia:function(rule){var media;Ext.each([].concat(rule),function(r){if(r&amp;&amp;r.media&amp;&amp;r.media.length){media=r.media;return false}});return media?(Ext.isIE?String(media):media.mediaText):&quot;&quot;},getRules:function(refreshCache){if(!this.rules||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i&lt;len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache,mediaSelector){var rs=this.getRules(refreshCache);if(Ext.type(mediaSelector)==&quot;string&quot;){mediaSelector=mediaSelector.trim()+&quot;:&quot;}else{mediaSelector=&quot;&quot;}if(!Ext.isArray(selector)){return rs[(mediaSelector+selector).toLowerCase()]}var select;for(var i=0;i&lt;selector.length;i++){select=(mediaSelector+selector[i]).toLowerCase();if(rs[select]){return rs[select]}}return null},updateRule:function(selector,property,value,mediaSelector){Ext.each((mediaSelector||&quot;&quot;).split(&quot;,&quot;),function(mediaSelect){if(!Ext.isArray(selector)){var rule=this.getRule(selector,false,mediaSelect);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true}}else{for(var i=0;i&lt;selector.length;i++){if(this.updateRule(selector[i],property,value,mediaSelect)){return true}}}return false},this)}}}};Ext.ux.ManagedIFrame.Manager=function(){var frames={};var implementation={_DOMFrameReadyHandler:function(e){try{var $frame;if($frame=e.target.ownerCt){$frame.loadHandler.call($frame,e)}}catch(rhEx){}},shimCls:&quot;ux-mif-shim&quot;,register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.name]={ref:frame};return frame},deRegister:function(frame){delete frames[frame.id];delete frames[frame.name]},hideShims:function(){var mm=MIF.Manager;mm.shimsApplied&amp;&amp;Ext.select(&quot;.&quot;+mm.shimCls,true).removeClass(mm.shimCls+&quot;-on&quot;);mm.shimsApplied=false},showShims:function(){var mm=MIF.Manager;!mm.shimsApplied&amp;&amp;Ext.select(&quot;.&quot;+mm.shimCls,true).addClass(mm.shimCls+&quot;-on&quot;);mm.shimsApplied=true},getFrameById:function(id){return typeof id==&quot;string&quot;?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frames[frame.id]||frames[frame.id]||null},destroy:function(){if(document.addEventListener&amp;&amp;!Ext.isOpera){window.removeEventListener(&quot;DOMFrameContentLoaded&quot;,this._DOMFrameReadyHandler,false)}}};document.addEventListener&amp;&amp;!Ext.isOpera&amp;&amp;window.addEventListener(&quot;DOMFrameContentLoaded&quot;,implementation._DOMFrameReadyHandler,false);Ext.EventManager.on(window,&quot;beforeunload&quot;,implementation.destroy,implementation);return implementation}();MIM=MIF.Manager;MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;var winDD=Ext.Window.DD;Ext.override(winDD,{startDrag:winDD.prototype.startDrag.createInterceptor(MIM.showShims),endDrag:winDD.prototype.endDrag.createInterceptor(MIM.hideShims)});Ext.ux.ManagedIFramePanel=MIF.Panel;Ext.ux.ManagedIFramePortlet=MIF.Portlet;Ext.ux.ManagedIframe=function(el,opt){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&amp;&amp;el.dom&amp;&amp;el.dom.tagName==&quot;IFRAME&quot;){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:&quot;iframe&quot;,frameborder:0,cls:&quot;x-mif&quot;,src:(Ext.isIE&amp;&amp;Ext.isSecure)?Ext.SSL_SECURE_URL:&quot;about:blank&quot;},config.autoCreate))):null;if(el&amp;&amp;config.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:&quot;noframes&quot;,html:config.unsupportedText})}}var mif=new MIF.Element(el,true);if(mif){Ext.apply(mif,{disableMessaging:Ext.value(config.disableMessaging,true),focusOnLoad:Ext.value(config.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,true),loadMask:!!config.loadMask?Ext.apply({msg:&quot;Loading..&quot;,msgCls:&quot;x-mask-loading&quot;,maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null});config.listeners&amp;&amp;mif.on(config.listeners);if(!!config.html){mif.update(config.html)}else{!!config.src&amp;&amp;mif.setSrc(config.src)}}return mif};Ext.ux.ManagedIFrame.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message)},name:&quot;Ext.ux.ManagedIFrame&quot;});Ext.apply(Ext.ux.ManagedIFrame.Error.prototype,{lang:{&quot;documentcontext-remove&quot;:&quot;An attempt was made to remove an Element from the wrong document context.&quot;,&quot;execscript-secure-context&quot;:&quot;An attempt was made at script execution within a document context with limited access permissions.&quot;,printexception:&quot;An Error was encountered attempting the print the frame contents (document access is likely restricted).&quot;}});Ext.onReady(function(){var CSS=new Ext.ux.ManagedIFrame.CSS(document),rules=[];CSS.getRule(&quot;.ux-mif-fill&quot;)||(rules.push(&quot;.ux-mif-fill{height:100%;width:100%;}&quot;));CSS.getRule(&quot;.ux-mif-mask-target&quot;)||(rules.push(&quot;.ux-mif-mask-target{position:relative;zoom:1;}&quot;));CSS.getRule(&quot;.ux-mif-el-mask&quot;)||(rules.push(&quot;.ux-mif-el-mask {z-index: 100;position: absolute;top:0;left:0;-moz-opacity: 0.5;opacity: .50;*filter: alpha(opacity=50);width: 100%;height: 100%;zoom: 1;} &quot;,&quot;.ux-mif-el-mask-msg {z-index: 1;position: absolute;top: 0;left: 0;border:1px solid;background:repeat-x 0 -16px;padding:2px;} &quot;,&quot;.ux-mif-el-mask-msg div {padding:5px 10px 5px 10px;border:1px solid;cursor:wait;} &quot;));if(!CSS.getRule(&quot;.ux-mif-shim&quot;)){rules.push(&quot;.ux-mif-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}&quot;);rules.push(&quot;.ux-mif-shim-on{width:100%;height:100%;display:block;zoom:1;}&quot;);rules.push(&quot;.ext-ie6 .ux-mif-shim{margin-left:5px;margin-top:3px;}&quot;)}if(!CSS.getRule(&quot;.x-hide-nosize&quot;)){rules.push(&quot;.x-hide-nosize{height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}&quot;)}!!rules.length&amp;&amp;CSS.createStyleSheet(rules.join(&quot; &quot;),&quot;mifCSS&quot;)});Ext.provide&amp;&amp;Ext.provide(&quot;mif&quot;)})();
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns(&quot;Ext.ux.tree&quot;);Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:[&quot;sort-asc&quot;,&quot;sort-desc&quot;],sortAscText:&quot;Sort Ascending&quot;,sortDescText:&quot;Sort Descending&quot;,constructor:function(a,b){if(!Ext.isObject(b)){b={property:a.columns[0].dataIndex||&quot;text&quot;,folderSort:true}}Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);this.tree=a;a.on(&quot;headerclick&quot;,this.onHeaderClick,this);a.ddAppendOnly=true;var d=this;this.defaultSortFn=function(q,p){var n=d.dir&amp;&amp;d.dir.toLowerCase()==&quot;desc&quot;,e=d.property||&quot;text&quot;,k=d.sortType,u=d.caseSensitive===true,g=d.leafAttr||&quot;leaf&quot;,v=q.attributes,t=p.attributes;if(d.folderSort){if(v[g]&amp;&amp;!t[g]){return 1}if(!v[g]&amp;&amp;t[g]){return -1}}var m=v[e],l=t[e],z=k?k(m):(u?m:m.toUpperCase());v2=k?k(l):(u?l:l.toUpperCase());if(z&lt;v2){return n?+1:-1}else{if(z&gt;v2){return n?-1:+1}else{return 0}}};a.on(&quot;afterrender&quot;,this.onAfterTreeRender,this,{single:true});a.on(&quot;headermenuclick&quot;,this.onHeaderMenuClick,this)},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:&quot;asc&quot;,text:this.sortAscText,cls:&quot;xg-hmenu-sort-asc&quot;},{itemId:&quot;desc&quot;,text:this.sortDescText,cls:&quot;xg-hmenu-sort-desc&quot;})}this.updateSortIcon(0,&quot;asc&quot;)},onHeaderMenuClick:function(d,b,a){if(b===&quot;asc&quot;||b===&quot;desc&quot;){this.onHeaderClick(d,null,a);return false}},onHeaderClick:function(e,b,a){if(e&amp;&amp;!this.tree.headersDisabled){var d=this;d.property=e.dataIndex;d.dir=e.dir=(e.dir===&quot;desc&quot;?&quot;asc&quot;:&quot;desc&quot;);d.sortType=e.sortType;d.caseSensitive===Ext.isBoolean(e.caseSensitive)?e.caseSensitive:this.caseSensitive;d.sortFn=e.sortFn||this.defaultSortFn;this.tree.root.cascade(function(g){if(!g.isLeaf()){d.updateSort(d.tree,g)}});this.updateSortIcon(a,e.dir)}},updateSortIcon:function(b,a){var e=this.sortClasses,d=this.tree.innerHd.select(&quot;td&quot;).removeClass(e);d.item(b).addClass(e[a==&quot;desc&quot;?1:0])}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.tree.ColumnResizer=Ext.extend(Ext.util.Observable,{minWidth:14,constructor:function(a){Ext.apply(this,a);Ext.tree.ColumnResizer.superclass.constructor.call(this)},init:function(a){this.tree=a;a.on(&quot;render&quot;,this.initEvents,this)},initEvents:function(a){a.mon(a.innerHd,&quot;mousemove&quot;,this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(a.innerHd);a.on(&quot;beforedestroy&quot;,this.tracker.destroy,this.tracker)},handleHdMove:function(k,p){var l=5,n=k.getPageX(),g=k.getTarget(&quot;.x-treegrid-hd&quot;,3,true);if(g){var b=g.getRegion(),q=g.dom.style,d=g.dom.parentNode;if(n-b.left&lt;=l&amp;&amp;g.dom!==d.firstChild){var a=g.dom.previousSibling;while(a&amp;&amp;Ext.fly(a).hasClass(&quot;x-treegrid-hd-hidden&quot;)){a=a.previousSibling}if(a){this.activeHd=Ext.get(a);q.cursor=Ext.isWebKit?&quot;e-resize&quot;:&quot;col-resize&quot;}}else{if(b.right-n&lt;=l){var m=g.dom;while(m&amp;&amp;Ext.fly(m).hasClass(&quot;x-treegrid-hd-hidden&quot;)){m=m.previousSibling}if(m){this.activeHd=Ext.get(m);q.cursor=Ext.isWebKit?&quot;w-resize&quot;:&quot;col-resize&quot;}}else{delete this.activeHd;q.cursor=&quot;&quot;}}}},onBeforeStart:function(a){this.dragHd=this.activeHd;return !!this.dragHd},onStart:function(b){this.dragHeadersDisabled=this.tree.headersDisabled;this.tree.headersDisabled=true;this.proxy=this.tree.body.createChild({cls:&quot;x-treegrid-resizer&quot;});this.proxy.setHeight(this.tree.body.getHeight());var a=this.tracker.getXY()[0];this.hdX=this.dragHd.getX();this.hdIndex=this.tree.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(a-this.hdX);this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left},onDrag:function(b){var a=this.tracker.getXY()[0];this.proxy.setWidth((a-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(g){var b=this.proxy.getWidth(),a=this.tree,d=this.dragHeadersDisabled;this.proxy.remove();delete this.dragHd;a.columns[this.hdIndex].width=b;a.updateColumnWidths();setTimeout(function(){a.headersDisabled=d},100)}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGridNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(d,q,l,u){var v=d.getOwnerTree(),p=v.columns,m=p[0],e,b,k;this.indentMarkup=d.parentNode?d.parentNode.ui.getChildIndent():&quot;&quot;;b=['&lt;tbody class=&quot;x-tree-node&quot;&gt;','&lt;tr ext:tree-node-id=&quot;',d.id,'&quot; class=&quot;x-tree-node-el x-tree-node-leaf ',q.cls,'&quot;&gt;','&lt;td class=&quot;x-treegrid-col&quot;&gt;','&lt;span class=&quot;x-tree-node-indent&quot;&gt;',this.indentMarkup,&quot;&lt;/span&gt;&quot;,'&lt;img src=&quot;',this.emptyIcon,'&quot; class=&quot;x-tree-ec-icon x-tree-elbow&quot; /&gt;','&lt;img src=&quot;',q.icon||this.emptyIcon,'&quot; class=&quot;x-tree-node-icon',(q.icon?&quot; x-tree-node-inline-icon&quot;:&quot;&quot;),(q.iconCls?&quot; &quot;+q.iconCls:&quot;&quot;),'&quot; unselectable=&quot;on&quot; /&gt;','&lt;a hidefocus=&quot;on&quot; class=&quot;x-tree-node-anchor&quot; href=&quot;',q.href?q.href:&quot;#&quot;,'&quot; tabIndex=&quot;1&quot; ',q.hrefTarget?' target=&quot;'+q.hrefTarget+'&quot;':&quot;&quot;,&quot;&gt;&quot;,'&lt;span unselectable=&quot;on&quot;&gt;',(m.tpl?m.tpl.apply(q):q[m.dataIndex]||m.text),&quot;&lt;/span&gt;&lt;/a&gt;&quot;,&quot;&lt;/td&gt;&quot;];for(e=1,k=p.length;e&lt;k;e++){m=p[e];b.push('&lt;td class=&quot;x-treegrid-col ',(m.cls?m.cls:&quot;&quot;),'&quot;&gt;','&lt;div unselectable=&quot;on&quot; class=&quot;x-treegrid-text&quot;',(m.align?' style=&quot;text-align: '+m.align+';&quot;':&quot;&quot;),&quot;&gt;&quot;,(m.tpl?m.tpl.apply(q):q[m.dataIndex]),&quot;&lt;/div&gt;&quot;,&quot;&lt;/td&gt;&quot;)}b.push('&lt;/tr&gt;&lt;tr class=&quot;x-tree-node-ct&quot;&gt;&lt;td colspan=&quot;',p.length,'&quot;&gt;','&lt;table class=&quot;x-treegrid-node-ct-table&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;table-layout: fixed; display: none; width: ',v.innerCt.getWidth(),'px;&quot;&gt;&lt;colgroup&gt;');for(e=0,k=p.length;e&lt;k;e++){b.push('&lt;col style=&quot;width: ',(p[e].hidden?0:p[e].width),'px;&quot; /&gt;')}b.push(&quot;&lt;/colgroup&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&quot;);if(u!==true&amp;&amp;d.nextSibling&amp;&amp;d.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,d.nextSibling.ui.getEl(),b.join(&quot;&quot;))}else{this.wrap=Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,l,b.join(&quot;&quot;))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;var g=this.elNode.firstChild.childNodes;this.indentNode=g[0];this.ecNode=g[1];this.iconNode=g[2];this.anchor=g[3];this.textNode=g[3].firstChild},animExpand:function(a){this.ctNode.style.display=&quot;&quot;;Ext.ux.tree.TreeGridNodeUI.superclass.animExpand.call(this,a)}});Ext.ux.tree.TreeGridRootNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true}if(Ext.isWebKit){var a=this.ctNode;a.style.tableLayout=null;(function(){a.style.tableLayout=&quot;fixed&quot;}).defer(1)}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id)}delete this.node},collapse:Ext.emptyFn,expand:Ext.emptyFn});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGridLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(a){if(!a.uiProvider){a.uiProvider=Ext.ux.tree.TreeGridNodeUI}return Ext.tree.TreeLoader.prototype.createNode.call(this,a)},processResponse:function(d,b,n,p){var q=d.responseText,a,m,g=0,k;try{if(!(a=d.responseData)){a=Ext.decode(q);if(this.root){if(!this.getRoot){this.getRoot=Ext.data.JsonReader.prototype.createAccessor(this.root)}a=this.getRoot(a)}}b.beginUpdate();for(k=a.length;g&lt;k;g++){if(m=this.createNode(a[g])){b.appendChild(m)}}b.endUpdate();this.runCallback(n,p||b,[b])}catch(l){this.handleFailure(d)}}});
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
(function(){Ext.override(Ext.list.Column,{init:function(){var b=Ext.data.Types,a=this.sortType;if(this.type){if(Ext.isString(this.type)){this.type=Ext.data.Types[this.type.toUpperCase()]||b.AUTO}}else{this.type=b.AUTO}if(Ext.isString(a)){this.sortType=Ext.data.SortTypes[a]}else{if(Ext.isEmpty(a)){this.sortType=this.type.sortType}}}});Ext.tree.Column=Ext.extend(Ext.list.Column,{});Ext.tree.NumberColumn=Ext.extend(Ext.list.NumberColumn,{});Ext.tree.DateColumn=Ext.extend(Ext.list.DateColumn,{});Ext.tree.BooleanColumn=Ext.extend(Ext.list.BooleanColumn,{});Ext.reg(&quot;tgcolumn&quot;,Ext.tree.Column);Ext.reg(&quot;tgnumbercolumn&quot;,Ext.tree.NumberColumn);Ext.reg(&quot;tgdatecolumn&quot;,Ext.tree.DateColumn);Ext.reg(&quot;tgbooleancolumn&quot;,Ext.tree.BooleanColumn)})();
/*!
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.tree.TreeGrid=Ext.extend(Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:Ext.isBorderBox?0:2,cls:&quot;x-treegrid&quot;,columnResize:true,enableSort:(this.enableSort!=undefined)?true:this.enableSort,reserveScrollOffset:true,enableHdMenu:(this.enableHdMenu!=undefined)?true:this.enableHdMenu,columnsText:&quot;Columns&quot;,initComponent:function(){if(!this.root){this.root=new Ext.tree.AsyncTreeNode({text:&quot;Root&quot;})}var a=this.loader;if(!a){a=new Ext.ux.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store})}else{if(Ext.isObject(a)&amp;&amp;!a.load){a=new Ext.ux.tree.TreeGridLoader(a)}}this.loader=a;Ext.ux.tree.TreeGrid.superclass.initComponent.call(this);this.initColumns();if(this.enableSort){this.treeGridSorter=new Ext.ux.tree.TreeGridSorter(this,this.enableSort)}if(this.columnResize){this.colResizer=new Ext.tree.ColumnResizer(this.columnResize);this.colResizer.init(this)}var b=this.columns;if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('&lt;div class=&quot;x-grid3-header&quot;&gt;','&lt;div class=&quot;x-treegrid-header-inner&quot;&gt;','&lt;div class=&quot;x-grid3-header-offset&quot;&gt;','&lt;table style=&quot;table-layout: fixed;&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;&lt;colgroup&gt;&lt;tpl for=&quot;columns&quot;&gt;&lt;col /&gt;&lt;/tpl&gt;&lt;/colgroup&gt;','&lt;thead&gt;&lt;tr class=&quot;x-grid3-hd-row&quot;&gt;','&lt;tpl for=&quot;columns&quot;&gt;','&lt;td class=&quot;x-grid3-hd x-grid3-cell x-treegrid-hd&quot; style=&quot;text-align: {align};&quot; id=&quot;',this.id,'-xlhd-{#}&quot;&gt;','&lt;div class=&quot;x-grid3-hd-inner x-treegrid-hd-inner&quot; unselectable=&quot;on&quot;&gt;',this.enableHdMenu?'&lt;a class=&quot;x-grid3-hd-btn&quot; href=&quot;#&quot;&gt;&lt;/a&gt;':&quot;&quot;,'{header}&lt;img class=&quot;x-grid3-sort-icon&quot; src=&quot;',Ext.BLANK_IMAGE_URL,'&quot; /&gt;',&quot;&lt;/div&gt;&quot;,&quot;&lt;/td&gt;&lt;/tpl&gt;&quot;,&quot;&lt;/tr&gt;&lt;/thead&gt;&quot;,&quot;&lt;/table&gt;&quot;,&quot;&lt;/div&gt;&lt;/div&gt;&quot;,&quot;&lt;/div&gt;&quot;,'&lt;div class=&quot;x-treegrid-root-node&quot;&gt;','&lt;table class=&quot;x-treegrid-root-table&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;table-layout: fixed;&quot;&gt;&lt;/table&gt;',&quot;&lt;/div&gt;&quot;)}if(!this.colgroupTpl){this.colgroupTpl=new Ext.XTemplate('&lt;colgroup&gt;&lt;tpl for=&quot;columns&quot;&gt;&lt;col style=&quot;width: {width}px&quot;/&gt;&lt;/tpl&gt;&lt;/colgroup&gt;')}},initColumns:function(){var e=this.columns,a=e.length,d=[],b,g;for(b=0;b&lt;a;b++){g=e[b];if(!g.isColumn){g.xtype=g.xtype?(/^tg/.test(g.xtype)?g.xtype:&quot;tg&quot;+g.xtype):&quot;tgcolumn&quot;;g=Ext.create(g)}g.init(this);d.push(g);if(this.enableSort!==false&amp;&amp;g.sortable!==false){g.sortable=true;this.enableSort=true}}this.columns=d},onRender:function(){Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);this.el.addClass(&quot;x-treegrid&quot;);this.outerCt=this.body.createChild({cls:&quot;x-tree-root-ct x-treegrid-ct &quot;+(this.useArrows?&quot;x-tree-arrows&quot;:this.lines?&quot;x-tree-lines&quot;:&quot;x-tree-no-lines&quot;)});this.internalTpl.overwrite(this.outerCt,{columns:this.columns});this.mainHd=Ext.get(this.outerCt.dom.firstChild);this.innerHd=Ext.get(this.mainHd.dom.firstChild);this.innerBody=Ext.get(this.outerCt.dom.lastChild);this.innerCt=Ext.get(this.innerBody.dom.firstChild);this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});if(this.hideHeaders){this.el.child(&quot;.x-grid3-header&quot;).setDisplayed(&quot;none&quot;)}else{if(this.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:this.id+&quot;-hctx&quot;});if(this.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:this.id+&quot;-hcols-menu&quot;});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add({itemId:&quot;columns&quot;,hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:&quot;x-cols-icon&quot;})}this.hmenu.on(&quot;itemclick&quot;,this.handleHdMenuClick,this)}}},setRootNode:function(a){a.attributes.uiProvider=Ext.ux.tree.TreeGridRootNodeUI;a=Ext.ux.tree.TreeGrid.superclass.setRootNode.call(this,a);if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns})}return a},clearInnerCt:function(){if(Ext.isIE){var a=this.innerCt.dom;while(a.firstChild){a.removeChild(a.firstChild)}}else{Ext.ux.tree.TreeGrid.superclass.clearInnerCt.call(this)}},initEvents:function(){Ext.ux.tree.TreeGrid.superclass.initEvents.apply(this,arguments);this.mon(this.innerBody,&quot;scroll&quot;,this.syncScroll,this);this.mon(this.innerHd,&quot;click&quot;,this.handleHdDown,this);this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})},onResize:function(b,d){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var g=this.innerBody.dom;var k=this.innerHd.dom;if(!g){return}if(Ext.isNumber(d)){g.style.height=this.body.getHeight(true)-k.offsetHeight+&quot;px&quot;}if(Ext.isNumber(b)){var a=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((g.offsetWidth-g.clientWidth)&gt;10)){this.setScrollOffset(a)}else{var e=this;setTimeout(function(){e.setScrollOffset(g.offsetWidth-g.clientWidth&gt;10?a:0)},10)}}},updateColumnWidths:function(){var m=this.columns,p=m.length,a=this.outerCt.query(&quot;colgroup&quot;),n=a.length,l,e,d,b;for(d=0;d&lt;p;d++){l=m[d];for(b=0;b&lt;n;b++){e=a[b];e.childNodes[d].style.width=(l.hidden?0:l.width)+&quot;px&quot;}}for(d=0,a=this.innerHd.query(&quot;td&quot;),len=a.length;d&lt;len;d++){l=Ext.fly(a[d]);if(m[d]&amp;&amp;m[d].hidden){l.addClass(&quot;x-treegrid-hd-hidden&quot;)}else{l.removeClass(&quot;x-treegrid-hd-hidden&quot;)}}var k=this.getTotalColumnWidth();Ext.fly(this.innerHd.dom.firstChild).setWidth(k+(this.scrollOffset||0));this.outerCt.select(&quot;table&quot;).setWidth(k);this.syncHeaderScroll()},getVisibleColumns:function(){var d=[],e=this.columns,a=e.length,b;for(b=0;b&lt;a;b++){if(!e[b].hidden){d.push(e[b])}}return d},getTotalColumnWidth:function(){var e=0;for(var b=0,d=this.getVisibleColumns(),a=d.length;b&lt;a;b++){e+=d[b].width}return e},setScrollOffset:function(a){this.scrollOffset=a;this.updateColumnWidths()},handleHdDown:function(m,g){var l=m.getTarget(&quot;.x-treegrid-hd&quot;);if(l&amp;&amp;Ext.fly(g).hasClass(&quot;x-grid3-hd-btn&quot;)){var b=this.hmenu.items,k=this.columns,a=this.findHeaderIndex(l),n=k[a],d=n.sortable;m.stopEvent();Ext.fly(l).addClass(&quot;x-grid3-hd-menu-open&quot;);this.hdCtxIndex=a;this.fireEvent(&quot;headerbuttonclick&quot;,b,n,l,a);this.hmenu.on(&quot;hide&quot;,function(){Ext.fly(l).removeClass(&quot;x-grid3-hd-menu-open&quot;)},this,{single:true});this.hmenu.show(g,&quot;tl-bl?&quot;)}else{if(l){var a=this.findHeaderIndex(l);this.fireEvent(&quot;headerclick&quot;,this.columns[a],l,a)}}},handleHdOver:function(g,a){var d=g.getTarget(&quot;.x-treegrid-hd&quot;);if(d&amp;&amp;!this.headersDisabled){index=this.findHeaderIndex(d);this.activeHdRef=a;this.activeHdIndex=index;var b=Ext.get(d);this.activeHdRegion=b.getRegion();b.addClass(&quot;x-grid3-hd-over&quot;);this.activeHdBtn=b.child(&quot;.x-grid3-hd-btn&quot;);if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(d.firstChild.offsetHeight-1)+&quot;px&quot;}}},handleHdOut:function(d,a){var b=d.getTarget(&quot;.x-treegrid-hd&quot;);if(b&amp;&amp;(!Ext.isIE||!d.within(b,true))){this.activeHdRef=null;Ext.fly(b).removeClass(&quot;x-grid3-hd-over&quot;);b.style.cursor=&quot;&quot;}},findHeaderIndex:function(d){d=d.dom||d;var b=d.parentNode.childNodes;for(var a=0,e;e=b[a];a++){if(e==d){return a}}return -1},beforeColMenuShow:function(){var d=this.columns,b=d.length,a,e;this.colMenu.removeAll();for(a=1;a&lt;b;a++){e=d[a];if(e.hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:&quot;col-&quot;+a,text:e.header,checked:!e.hidden,hideOnClick:false,disabled:e.hideable===false}))}}},handleHdMenuClick:function(b){var a=this.hdCtxIndex,d=b.getItemId();if(this.fireEvent(&quot;headermenuclick&quot;,this.columns[a],d,a)!==false){a=d.substr(4);if(a&gt;0&amp;&amp;this.columns[a]){this.setColumnVisible(a,!b.checked)}}return true},setColumnVisible:function(a,b){this.columns[a].hidden=!b;this.updateColumnWidths()},scrollToTop:function(){this.innerBody.dom.scrollTop=0;this.innerBody.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var a=this.innerBody.dom;this.fireEvent(&quot;bodyscroll&quot;,a.scrollLeft,a.scrollTop)},syncHeaderScroll:function(){var a=this.innerBody.dom;this.innerHd.dom.scrollLeft=a.scrollLeft;this.innerHd.dom.scrollLeft=a.scrollLeft},registerNode:function(a){Ext.ux.tree.TreeGrid.superclass.registerNode.call(this,a);if(!a.uiProvider&amp;&amp;!a.isRoot&amp;&amp;!a.ui.isTreeGridNodeUI){a.ui=new Ext.ux.tree.TreeGridNodeUI(a)}}});Ext.reg(&quot;treegrid&quot;,Ext.ux.tree.TreeGrid);function utils_logout(){Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;);Ext.Ajax.defaultHeaders.Authorization=&quot;&quot;;window.location.reload()}Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.FeedGridFlux=function(a){this.datasetName=a.datasetName;function d(u,q,p){p.stopEvent();var m=u.store.getAt(q);if(Ext.isEmpty(m)){return}if(Ext.isEmpty(window)||Ext.isEmpty(window.SitoolsDesk)){var t=new sitools.widget.feedItemDetails({record:m});var n=new Ext.Window({stateful:false,title:i18n.get(&quot;label.viewFeedDetail&quot;),width:400,height:600,shim:false,animCollapse:false,constrainHeader:true,layout:&quot;fit&quot;});n.add(t);n.show()}else{var k={record:m};var g=sitools.widget.feedItemDetails;var l={id:&quot;viewFeedDetail&quot;,title:i18n.get(&quot;label.viewFeedDetail&quot;),saveToolbar:false};SitoolsDesk.addDesktopWindow(l,k,g,true)}}Ext.apply(this);this.layout=&quot;fit&quot;;var b;if(a.feedSource!==undefined&amp;&amp;a.feedSource===&quot;OPENSEARCH&quot;){b=new sitools.user.component.openSearchResultFeed(a)}else{a.listeners={rowdblclick:d};if(a.feedType!==undefined&amp;&amp;a.feedType===&quot;atom_1.0&quot;){b=new sitools.widget.atom1FeedReader(a)}else{b=new sitools.widget.rss2FeedReader(a)}}this.items=[b];sitools.widget.FeedGridFlux.superclass.constructor.call(this)};Ext.extend(sitools.widget.FeedGridFlux,Ext.Panel,{componentType:&quot;feeds&quot;,_getSettings:function(){return(null)},border:false});Ext.reg(&quot;appfeedgridflux&quot;,sitools.widget.FeedGridFlux);Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.rss2FeedReader=function(b){Ext.apply(this);this.layout=&quot;fit&quot;;var a=new Ext.data.Store({autoLoad:true,sortInfo:{field:&quot;pubDate&quot;,direction:&quot;DESC&quot;},proxy:new Ext.data.HttpProxy({url:b.urlFeed,restful:true,listeners:{scope:this,exception:onRequestFeedException}}),reader:new Ext.data.XmlReader({record:&quot;item&quot;},[&quot;title&quot;,&quot;author&quot;,{name:&quot;pubDate&quot;,type:&quot;date&quot;},&quot;link&quot;,&quot;description&quot;,&quot;content&quot;,&quot;guid&quot;,{name:&quot;imageUrl&quot;,mapping:&quot;enclosure@url&quot;},{name:&quot;imageType&quot;,mapping:&quot;enclosure@type&quot;}])});var d=[{id:&quot;image&quot;,header:&quot;Image&quot;,dataIndex:&quot;imageUrl&quot;,sortable:false,width:50,renderer:this.imageRenderer},{id:&quot;title&quot;,header:&quot;Title&quot;,dataIndex:&quot;title&quot;,sortable:true,width:420,renderer:this.formatTitle},{header:&quot;Author&quot;,dataIndex:&quot;author&quot;,width:100,hidden:true,sortable:true},{id:&quot;last&quot;,header:&quot;Date&quot;,dataIndex:&quot;pubDate&quot;,width:150,renderer:this.formatDate,sortable:true}];sitools.widget.rss2FeedReader.superclass.constructor.call(this,{columns:d,store:a,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:&quot;title&quot;,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},tbar:[{pressed:true,enableToggle:true,text:i18n.get(&quot;label.feedsSummary&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/summary_RSS.png&quot;,scope:this,toggleHandler:function(e,g){this.togglePreview(g)}}],listeners:b.listeners})};Ext.extend(sitools.widget.rss2FeedReader,Ext.grid.GridPanel,{loadData:function(){this.loadFeed(&quot;http://feeds.feedburner.com/extblog&quot;);this.doLayout()},loadFeed:function(a){this.store.baseParams={feed:a};this.store.load()},togglePreview:function(a){this.view.showPreview=a;this.view.refresh()},applyRowClass:function(a,g,e,d){if(this.showPreview){var b=Ext.util.Format;e.body=&quot;&lt;p class=sous-titre-flux&gt;&quot;+b.ellipsis(b.stripTags(a.data.description),200)+&quot;&lt;/p&gt;&quot;;return&quot;x-grid3-row-expanded&quot;}return&quot;x-grid3-row-collapsed&quot;},formatDate:function(b){if(!b){return&quot;&quot;}var a=new Date();var g=a.clearTime(true);var e=b.clearTime(true).getTime();if(e==g.getTime()){return&quot;Today &quot;+b.dateFormat(&quot;g:i a&quot;)}g=g.add(&quot;d&quot;,-6);if(g.getTime()&lt;=e){return b.dateFormat(&quot;D g:i a&quot;)}return b.dateFormat(&quot;n/j g:i a&quot;)},formatTitle:function(e,g,a){var d=a.data.link;var b=(Ext.isEmpty(a.data.author))?&quot;&quot;:a.data.author;if(d!==undefined&amp;&amp;d!==&quot;&quot;){return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0}&quot; target=&quot;_blank&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{1}&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{2}&lt;/span&gt;&lt;/div&gt;',d,e,b)}else{return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{1}&lt;/span&gt;&lt;/div&gt;',e,b)}},imageRenderer:function(b,d,a){if(Ext.isEmpty(b)||Ext.isEmpty(a.data.imageType)){return&quot;&quot;}if(a.data.imageType.substr(0,5)!=&quot;image&quot;){return&quot;&quot;}return String.format('&lt;img src=&quot;{0}&quot; width=&quot;50px&quot;&gt;',b)}});Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.atom1FeedReader=function(b){Ext.apply(this);this.layout=&quot;fit&quot;;var a=new Ext.data.Store({autoLoad:true,sortInfo:{field:&quot;published&quot;,direction:&quot;DESC&quot;},proxy:new Ext.data.HttpProxy({url:b.urlFeed,restful:true,listeners:{scope:this,exception:onRequestFeedException}}),reader:new Ext.data.XmlReader({record:&quot;entry&quot;},[&quot;title&quot;,{name:&quot;author&quot;,mapping:&quot;author.name&quot;},{name:&quot;published&quot;,type:&quot;date&quot;},{name:&quot;link&quot;,mapping:&quot;link@href&quot;},&quot;summary&quot;,&quot;content&quot;,{name:&quot;image&quot;,createAccessor:function(l,m){var k=Ext.DomQuery;var g=k.selectNode(&quot;link[type^=image]&quot;,l);var e={};if(Ext.isEmpty(g)){return e}Ext.each(g.attributes,function(n){e[n.name]=n.value});return e}}])});var d=[{id:&quot;image&quot;,header:&quot;Image&quot;,dataIndex:&quot;image&quot;,sortable:false,width:50,renderer:this.imageRenderer},{id:&quot;title&quot;,header:&quot;Title&quot;,dataIndex:&quot;title&quot;,sortable:true,width:420,renderer:this.formatTitle},{header:&quot;Author&quot;,dataIndex:&quot;author&quot;,width:100,hidden:true,sortable:false},{id:&quot;last&quot;,header:&quot;Date&quot;,dataIndex:&quot;published&quot;,width:150,renderer:this.formatDate,sortable:true}];sitools.widget.atom1FeedReader.superclass.constructor.call(this,{columns:d,store:a,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:&quot;title&quot;,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},tbar:[{pressed:true,enableToggle:true,text:i18n.get(&quot;label.feedsSummary&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/summary_RSS.png&quot;,scope:this,toggleHandler:function(e,g){this.togglePreview(g)}}],listeners:b.listeners})};Ext.extend(sitools.widget.atom1FeedReader,Ext.grid.GridPanel,{loadFeed:function(a){this.store.baseParams={feed:a};this.store.load()},togglePreview:function(a){this.view.showPreview=a;this.view.refresh()},applyRowClass:function(a,g,e,d){if(this.showPreview){var b=Ext.util.Format;e.body=&quot;&lt;p class=sous-titre-flux&gt;&quot;+b.ellipsis(b.stripTags(a.data.summary),200)+&quot;&lt;/p&gt;&quot;;return&quot;x-grid3-row-expanded&quot;}return&quot;x-grid3-row-collapsed&quot;},formatDate:function(b){if(!b){return&quot;&quot;}var a=new Date();var g=a.clearTime(true);var e=b.clearTime(true).getTime();if(e==g.getTime()){return&quot;Today &quot;+b.dateFormat(&quot;g:i a&quot;)}g=g.add(&quot;d&quot;,-6);if(g.getTime()&lt;=e){return b.dateFormat(&quot;D g:i a&quot;)}return b.dateFormat(&quot;n/j g:i a&quot;)},formatTitle:function(g,k,a){var d=(a.data.author.name!==undefined)?a.data.author.name:&quot;&quot;;var e=a.data.link;var d=(a.data.author.name!==undefined)?a.data.author.name:&quot;&quot;;var b=(a.data.author.email!==undefined)?a.data.author.email:&quot;&quot;;if(e!==undefined&amp;&amp;e!==&quot;&quot;){return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0} target=&quot;_blank&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{1}&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{2}&lt;/span&gt;&lt;/div&gt;',e,g,d)}else{return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{1}&lt;/span&gt;&lt;/div&gt;',g,d)}},imageRenderer:function(b,d,a){if(Ext.isEmpty(b)||Ext.isEmpty(b.href)){return&quot;&quot;}if(b.type.substr(0,5)!=&quot;image&quot;){return&quot;&quot;}return String.format('&lt;img src=&quot;{0}&quot; width=&quot;50px&quot;&gt;',b.href)}});Ext.namespace(&quot;sitools.widget&quot;);sitools.widget.feedItemDetails=Ext.extend(Ext.Panel,{initComponent:function(){this.layout=&quot;fit&quot;;var a=this.record;if(!Ext.isEmpty(a)){this.formPanel=new Ext.FormPanel({frame:true,autoScroll:true,labelAlign:&quot;top&quot;});var b=[];Ext.iterate(a.data,function(d,g){var e;if(g!==null&amp;&amp;g.length&gt;100){e=new Ext.form.TextArea({fieldLabel:d,value:g,anchor:&quot;90%&quot;,readOnly:true})}else{e=new Ext.form.TextField({fieldLabel:d,value:g,anchor:&quot;90%&quot;,readOnly:true});if(d==&quot;link&quot;){Ext.apply(e,{overCls:&quot;x-mouse-link&quot;});e.addListener(&quot;render&quot;,function(k){k.getEl().on(&quot;click&quot;,function(){window.open(k.value)})})}}b.push(e)});this.formPanel.removeAll();this.formPanel.add(b);this.formPanel.doLayout();this.componentType=&quot;feedDetails&quot;;this.items=[this.formPanel]}sitools.widget.feedItemDetails.superclass.initComponent.call(this)}});function utils_logout(){Ext.util.Cookies.set(&quot;userLogin&quot;,&quot;&quot;);Ext.util.Cookies.set(&quot;hashCode&quot;,&quot;&quot;);Ext.Ajax.defaultHeaders.Authorization=&quot;&quot;;window.location.reload()}Ext.namespace(&quot;Ext.ux&quot;,&quot;sitools.user.desktop&quot;);sitools.user.desktop.App=function(){function callbackRESTCreateProject(){var modules=[];var isAuthorized=false;Ext.Ajax.request({scope:this,url:projectGlobal.sitoolsAttachementForUsers,method:&quot;GET&quot;,success:function(response){if(response.status==200){var data=Ext.decode(response.responseText);isAuthorized=true;if(data.project.maintenance){desktopReady.call(this);Ext.get(&quot;ux-taskbar&quot;).mask();var alertWindow=new Ext.Window({title:i18n.get(&quot;label.maintenance&quot;),width:600,height:400,autoScroll:true,closable:false,items:[{xtype:&quot;panel&quot;,layout:&quot;fit&quot;,autoScroll:true,html:data.project.maintenanceText,padding:&quot;5&quot;}],modal:true});alertWindow.show();return}projectGlobal.modules=data.project.modules;Ext.each(projectGlobal.modules,function(config){if(projectGlobal.preferences===null||Ext.isEmpty(projectGlobal.preferences.projectSettings)){if(config.visible){var module=createModule(config,this);SitoolsDesk.modulesACharger++;modules.push(module)}}else{Ext.each(projectGlobal.preferences.projectSettings,function(pref){if(pref==config.id){var module=createModule(config,this);modules.push(module);SitoolsDesk.modulesACharger++}})}},this);if(SitoolsDesk.modulesACharger===0){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.noModules&quot;));SitoolsDesk.fireEvent(&quot;allJsIncludesDone&quot;,this)}SitoolsDesk.app.initModules(modules)}},failure:function(response){if(response.status==403){Ext.get(&quot;ux-taskbar&quot;).mask();Ext.Msg.alert(&quot;Status&quot;,i18n.get(&quot;warning.not.authorized&quot;),function(){window.location=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_CLIENT_USER_URL&quot;)});return}}})}function initProject(){SitoolsDesk.app.addListener(&quot;allJsIncludesDone&quot;,loadPreferences);SitoolsDesk.app.addListener(&quot;ready&quot;,desktopReady);sql2ext.load(loadUrl.get(&quot;APP_URL&quot;)+&quot;/client-user/conf/sql2ext.properties&quot;);projectGlobal.initProject(callbackRESTCreateProject);Ext.apply(Ext.QuickTips.getQuickTip(),{maxWidth:200,minWidth:100,showDelay:50,trackMouse:true})}function deletePublicPref(){publicStorage.remove()}function saveWindowSettings(forPublicUser){var desktopSettings=[];getDesktop().getManager().each(function(window){var urlSaveSettings,AppUserStorage;if(forPublicUser){AppUserStorage=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin)}else{AppUserStorage=loadUrl.get(&quot;APP_PUBLIC_STORAGE_URL&quot;)}if(!Ext.isEmpty(window.specificType)&amp;&amp;window.specificType==&quot;componentWindow&quot;){var component=window.get(0);urlSaveSettings=loadUrl.get(&quot;APP_URL&quot;)+AppUserStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER;var fileName=&quot;&quot;;var title=window.title;if(component.componentType==&quot;form&quot;){fileName=component.componentType+component.formName}else{if(component.componentType==&quot;formProject&quot;){fileName=&quot;formProject&quot;;component.datasetName=component.formName}else{fileName=component.componentType}}var componentSettings=component._getSettings();if(Ext.isFunction(window.saveSettings)){desktopSettings.push(window.saveSettings(component.datasetName,fileName,componentSettings,forPublicUser))}}else{if(Ext.isFunction(window.saveSettings)){desktopSettings.push(window.saveSettings(window.getId(),window.getId(),null,forPublicUser))}}});userPreferences={};userPreferences.windowSettings=desktopSettings;var projectSettings=[];Ext.each(this.SitoolsDesk.app.getModules(),function(module){projectSettings.push(module.id)});userPreferences.projectSettings=projectSettings;if(forPublicUser){publicStorage.set(&quot;desktop&quot;,&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName,userPreferences)}else{userStorage.set(&quot;desktop&quot;,&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName,userPreferences)}}function _onLogin(){var tmp=new sitools.widget.Login({closable:true,url:loadUrl.get(&quot;APP_URL&quot;)+&quot;/login&quot;,register:loadUrl.get(&quot;APP_URL&quot;)+&quot;/inscriptions/user&quot;,reset:loadUrl.get(&quot;APP_URL&quot;)+&quot;/resetPassword&quot;}).show()}function _onLogout(){utils_logout()}function addWinData(windowSettings,componentCfg,JsObj,reloadComp){var desktop=getDesktop();var win=desktop.getWindow(windowSettings.id);if(win){if(reloadComp){win.removeAll();win.add(new JsObj(componentCfg));win.doLayout()}if(win.minimized){win.show()}win.toFront();return}try{var component=new JsObj(componentCfg);var newwin;var winHeight=windowSettings.winHeight||DEFAULT_WIN_HEIGHT;var winWidth=windowSettings.winWidth||DEFAULT_WIN_WIDTH;var tbar;if(!Ext.isEmpty(windowSettings.toolbarItems)){tbar=new Ext.Toolbar({xtype:&quot;toolbar&quot;,items:windowSettings.toolbarItems})}var fileName=&quot;&quot;;var title=windowSettings.title;if(windowSettings.type==&quot;form&quot;){fileName=windowSettings.type+componentCfg.formName}else{if(windowSettings.type==&quot;data&quot;&amp;&amp;Ext.isDefined(component.getWindowTitle)){title=component.getWindowTitle(windowSettings.datasetDescription,windowSettings.datasetName)}else{fileName=windowSettings.type}}newwin=desktop.createWindow({id:windowSettings.id,stateful:false,title:title,width:winWidth,height:winHeight,shim:false,tbar:tbar,animCollapse:false,constrainHeader:true,layout:&quot;fit&quot;,specificType:&quot;componentWindow&quot;,datasetName:windowSettings.datasetName,datasetDescription:windowSettings.datasetDescription,fileName:fileName,component:component,autoscroll:true,typeWindow:windowSettings.type,tools:[{id:&quot;save&quot;,scope:this,qtip:i18n.get(&quot;label.saveSettings&quot;),handler:function(event,toolEl,window){if(projectGlobal.isAdmin){var ctxMenu=new Ext.menu.Menu({items:['&lt;b class=&quot;menu-title&quot;&gt;'+i18n.get(&quot;label.chooseSave&quot;)+&quot;&lt;/b&gt;&quot;,{text:i18n.get(&quot;label.myself&quot;),handler:function(){window.saveSettings(window.datasetName,window.fileName,window.component._getSettings(),false)}},{text:i18n.get(&quot;label.publicUser&quot;),handler:function(){window.saveSettings(window.datasetName,window.fileName,window.component._getSettings(),true)}}]});ctxMenu.showAt(event.getXY())}else{window.saveSettings(window.datasetName,window.fileName,window.component._getSettings())}},hidden:Ext.isEmpty(userLogin)||!windowSettings.saveToolbar}]});var pos,size;pos=windowSettings.position;size=windowSettings.size;if(size!==null){size=Ext.decode(size);newwin.setSize(size)}else{size=newwin.getSize();size.width=size.width+1;newwin.setSize(size)}newwin.show();newwin.add(component);if(!Ext.isEmpty(pos)){pos=Ext.decode(pos);newwin.setPosition(pos)}newwin.doLayout()}catch(r){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.nocomponentfound&quot;));throw (r)}}function loadPreferences(){if(!Ext.isEmpty(projectGlobal.preferences)){Ext.each(projectGlobal.preferences.windowSettings,function(pref){if(Ext.isEmpty(pref.windowSettings.typeWindow)){var moduleId=pref.windowSettings.moduleId;var module=SitoolsDesk.app.getModule(moduleId);if(!Ext.isEmpty(module)){var win=module.createWindow();var pos=pref.windowSettings.position;var size=pref.windowSettings.size;if(pos!==null&amp;&amp;size!==null){pos=Ext.decode(pos);size=Ext.decode(size);win.setPosition(pos[0],pos[1]);win.setSize(size)}}}else{var type=pref.windowSettings.typeWindow;var componentCfg,jsObj,windowSettings;if(type==&quot;data&quot;){var datasetUrl=pref.componentSettings.datasetUrl;Ext.Ajax.request({method:&quot;GET&quot;,url:datasetUrl,success:function(ret){var Json=Ext.decode(ret.responseText);if(showResponse(ret)){var dataset=Json.dataset;var componentCfg,javascriptObject;var windowConfig={datasetName:dataset.name,datasetDescription:dataset.description,type:type,saveToolbar:true,toolbarItems:[]};switch(type){case&quot;data&quot;:javascriptObject=eval(dataset.datasetView.jsObject);Ext.apply(windowConfig,{id:type+dataset.id});if(dataset.description!==&quot;&quot;){windowConfig.title=dataset.description}else{windowConfig.title=&quot;Diplay data :&quot;+dataset.name}componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,datasetViewConfig:dataset.datasetViewConfig};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break}}},failure:alertFailure})}if(type==&quot;formProject&quot;){jsObj=sitools.user.component.forms.projectForm;componentCfg={formId:pref.componentSettings.formId,formName:pref.componentSettings.formName,formParameters:pref.componentSettings.formParameters,formWidth:pref.componentSettings.formWidth,formHeight:pref.componentSettings.formHeight,formCss:pref.componentSettings.formCss,properties:pref.componentSettings.properties,urlServicePropertiesSearch:pref.componentSettings.urlServicePropertiesSearch,urlServiceDatasetSearch:pref.componentSettings.urlServiceDatasetSearch,dictionaryName:pref.componentSettings.dictionaryName};windowSettings={type:&quot;formProject&quot;,title:i18n.get(&quot;label.forms&quot;)+&quot; : &quot;+pref.componentSettings.formName,id:&quot;formProject&quot;+pref.componentSettings.formId,saveToolbar:true,datasetName:pref.componentSettings.formName,winWidth:600,winHeight:600};SitoolsDesk.addDesktopWindow(windowSettings,componentCfg,jsObj)}if(type==&quot;form&quot;){jsObj=sitools.user.component.forms;componentCfg={dataUrl:pref.componentSettings.dataUrl,formId:pref.componentSettings.formId,formName:pref.componentSettings.formName,formParameters:pref.componentSettings.formParameters,formWidth:pref.componentSettings.formWidth,formHeight:pref.componentSettings.formHeight,formCss:pref.componentSettings.formCss};windowSettings={datasetName:pref.componentSettings.datasetName,type:&quot;form&quot;,title:i18n.get(&quot;label.forms&quot;)+&quot; : &quot;+pref.componentSettings.datasetName+&quot;.&quot;+pref.componentSettings.formName,id:&quot;form&quot;+pref.componentSettings.datasetId+pref.componentSettings.formId,saveToolbar:true};SitoolsDesk.addDesktopWindow(windowSettings,componentCfg,jsObj)}}},this)}else{Ext.each(projectGlobal.modules,function(moduleData){if(moduleData.publicOpened){var module=SitoolsDesk.app.getModule(moduleData.id);var win=module.createWindow()}})}this.fireEvent(&quot;ready&quot;)}function desktopReady(){if(Ext.get(&quot;x-desktop&quot;).isMasked()){Ext.get(&quot;x-desktop&quot;).unmask()}if(Ext.get(&quot;ux-taskbar&quot;).isMasked()){Ext.get(&quot;ux-taskbar&quot;).unmask()}}function maskDesktop(){Ext.get(&quot;x-desktop&quot;).mask(i18n.get(&quot;label.loadingSitools&quot;));Ext.get(&quot;ux-taskbar&quot;).mask()}var app=new Ext.app.App({init:function(){Ext.QuickTips.init();Ext.state.Manager.setProvider(new Ext.state.CookieProvider());if(Ext.isIE){Ext.Msg.confirm(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;label.IEWarning&quot;),function(buttonId){if(buttonId==&quot;yes&quot;){maskDesktop();initProject()}else{window.location.replace(&quot;https://www.google.com/chrome/index.html&quot;)}})}else{maskDesktop();initProject()}},getModules:function(){return this.modules},findModule:function(moduleId){var result;Ext.each(this.modules,function(module){if(module.id==moduleId){result=module}});return result},saveWindowSettings:function(){var desktopSettings=[];getDesktop().getManager().each(function(window){var urlSaveSettings;if(!Ext.isEmpty(window.specificType)&amp;&amp;window.specificType==&quot;componentWindow&quot;){var component=window.get(0);var AppUserStorage=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);urlSaveSettings=loadUrl.get(&quot;APP_URL&quot;)+AppUserStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER;var componentSettings=component._getSettings();if(Ext.isFunction(window.saveSettings)){desktopSettings.push(window.saveSettings(component.datasetName,component.componentType,componentSettings,urlSaveSettings))}}else{if(Ext.isFunction(window.saveSettings)){desktopSettings.push(window.saveSettings(window.getId(),window.getId(),null,urlSaveSettings))}}});userPreferences={};userPreferences.windowSettings=desktopSettings;var projectSettings=[];Ext.each(SitoolsDesk.app.getModules(),function(module){projectSettings.push(module.id)});userPreferences.projectSettings=projectSettings;userStorage.set(&quot;desktop&quot;,&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName,userPreferences)},getStartConfig:function(){var title;var login;if(Ext.isEmpty(Ext.util.Cookies.get(&quot;userLogin&quot;))){title=i18n.get(&quot;label.guest&quot;);login=false}else{title=Ext.util.Cookies.get(&quot;userLogin&quot;);login=true}var toolItems=[{text:login?&quot;label.logout&quot;:&quot;label.login&quot;,iconCls:login?&quot;logout&quot;:&quot;login&quot;,scope:this,handler:login?_onLogout:_onLogin},&quot;-&quot;,{text:&quot;label.version&quot;,iconCls:&quot;version&quot;,scope:this,handler:function(){showVersion()}}];if(!Ext.isEmpty(userLogin)){toolItems.push(&quot;-&quot;);toolItems.push({text:&quot;label.save&quot;,iconCls:&quot;settings&quot;,handler:function(){saveWindowSettings()},scope:this})}if(!Ext.isEmpty(userLogin)&amp;&amp;projectGlobal&amp;&amp;projectGlobal.isAdmin){toolItems.push(&quot;-&quot;);toolItems.push({text:&quot;label.saveAsPublic&quot;,iconCls:&quot;settings&quot;,handler:function(){saveWindowSettings(true)},scope:this});toolItems.push(&quot;-&quot;);toolItems.push({text:&quot;label.deletePublicPref&quot;,iconCls:&quot;settings&quot;,handler:function(){deletePublicPref()},scope:this})}if(!Ext.isEmpty(userLogin)){toolItems.push(&quot;-&quot;);toolItems.push({text:i18n.get(&quot;label.editProfile&quot;),itemId:&quot;menu_editProfile&quot;,icon:&quot;/sitools/common/res/images/icons/tree_userman.png&quot;,identifier:userLogin,labelSeparator:&quot;|&quot;,edit:&quot;/sitools/editProfile/&quot;+userLogin,handler:function(){var edit=new sitools.widget.editProfile({closable:true,identifier:userLogin,url:this.edit,handler:this.onRender});edit.show()}})}return{title:title,iconCls:&quot;user&quot;,toolItems:toolItems}}});function createModule(config){function includeCss(url){var headID=document.getElementsByTagName(&quot;head&quot;)[0];var newCss=document.createElement(&quot;link&quot;);newCss.type=&quot;text/css&quot;;newCss.rel=&quot;stylesheet&quot;;newCss.href=url;newCss.media=&quot;screen&quot;;headID.appendChild(newCss)}function includeJs(ConfUrls,indexAInclure){if(indexAInclure&lt;ConfUrls.length){var DSLScript=document.createElement(&quot;script&quot;);DSLScript.type=&quot;text/javascript&quot;;DSLScript.onload=includeJs.createDelegate(this,[ConfUrls,indexAInclure+1]);DSLScript.onreadystatechange=includeJs.createDelegate(this,[ConfUrls,indexAInclure+1]);DSLScript.src=ConfUrls[indexAInclure].url;var headID=document.getElementsByTagName(&quot;head&quot;)[0];headID.appendChild(DSLScript)}else{SitoolsDesk.modulesCharges++;if(SitoolsDesk.modulesCharges==SitoolsDesk.modulesACharger){SitoolsDesk.app.fireEvent(&quot;allJsIncludesDone&quot;,this)}}}var module=new Ext.app.Module({id:config.id,name:config.name,author:config.author,description:config.description,url:config.url,properties:config.properties,init:function(){this.launcher={text:i18n.get(config.title),iconCls:config.icon,handler:this.createWindow,scope:this};this.fisheye={id:config.id,text:i18n.get(config.title),imagePath:config.imagePath,fct:&quot;SitoolsDesk.app.getModule('&quot;+config.id+&quot;').createWindow();&quot;};if(config.dependencies){if(config.dependencies.css){Ext.each(config.dependencies.css,function(dependenceCss){includeCss(dependenceCss.url)})}if(config.dependencies.js){includeJs(config.dependencies.js,0)}}else{SitoolsDesk.app.modulesCharges++}},getWindow:function(){return getDesktop().getWindow(config.id)},createWindow:function(cfgCmp){var desktop=getDesktop();var win=desktop.getWindow(config.id);if(!win){win=desktop.createWindow({id:config.id,stateful:false,title:i18n.get(config.title),width:config.defaultWidth,height:config.defaultHeight,iconCls:config.icon,x:config.x,y:config.y,shim:false,animCollapse:false,constrainHeader:true,layout:&quot;fit&quot;,specificType:config.specificType,items:[{layout:&quot;fit&quot;,xtype:config.xtype,cfgCmp:cfgCmp,moduleProperties:config.properties}]});if(!Ext.isEmpty(projectGlobal.preferences)){Ext.each(projectGlobal.preferences.windowSettings,function(preference){if(preference.windowSettings.moduleId==config.id){var pos=preference.windowSettings.position;var size=preference.windowSettings.size;if(pos!==null&amp;&amp;size!==null){pos=Ext.decode(pos);size=Ext.decode(size);win.setPosition(pos);win.setSize(size)}}})}}else{desktop.getManager().bringToFront(win)}win.show();return win}});return module}return{modulesCharges:0,modulesACharger:0,app:app,addApplication:function(composant){modulesExistants=SitoolsDesk.app.getModules();if(!modulesExistants){modulesExistants=[]}var nouveauModule=createModule(composant,this);modulesExistants.push(nouveauModule);SitoolsDesk.app.addModule(nouveauModule)},removeApplication:function(idApplication){var moduleToRemove=SitoolsDesk.app.getModule(idApplication);modulesExistants=SitoolsDesk.app.getModules();SitoolsDesk.app.removeModule(moduleToRemove)},addDesktopWindow:function(windowSettings,component,JsObj,reloadComp){if(Ext.isEmpty(windowSettings.saveToolbar)){windowSettings.saveToolbar=false}if(Ext.isEmpty(windowSettings.title)){throw (&quot;NoWinTitle&quot;)}if(windowSettings.saveToolbar!==false&amp;&amp;Ext.isEmpty(windowSettings.type)){throw (&quot;NoWinType&quot;)}if(windowSettings.saveToolbar!==false&amp;&amp;Ext.isEmpty(windowSettings.datasetName)){throw (&quot;NoWinDatasetName&quot;)}if(Ext.isEmpty(reloadComp)){reloadComp=false}if(windowSettings.saveToolbar===false){addWinData(windowSettings,component,JsObj,reloadComp);return}var fileName=&quot;&quot;;if(windowSettings.type==&quot;form&quot;){fileName=windowSettings.type+component.formName}else{fileName=windowSettings.type}var AppUserStorage=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var urlPreferences=loadUrl.get(&quot;APP_URL&quot;)+AppUserStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+windowSettings.datasetName+&quot;/&quot;+fileName;var urlPublicPreferences=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_PUBLIC_STORAGE_URL&quot;)+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+windowSettings.datasetName+&quot;/&quot;+fileName;var addWinPublic=function(windowSettings,component,JsObj,reloadComp){Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:urlPublicPreferences,success:function(response,opts){try{var json=Ext.decode(response.responseText);Ext.apply(windowSettings,json.windowSettings);Ext.apply(component,{userPreference:json.componentSettings});addWinData(windowSettings,component,JsObj,reloadComp)}catch(err){addWinData(windowSettings,component,JsObj,reloadComp)}},failure:function(response,opts){addWinData(windowSettings,component,JsObj,reloadComp)}})};if(Ext.isEmpty(userLogin)){addWinPublic(windowSettings,component,JsObj,reloadComp)}else{Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:urlPreferences,success:function(response,opts){try{var json=Ext.decode(response.responseText);Ext.apply(windowSettings,json.windowSettings);Ext.apply(component,{userPreference:json.componentSettings});addWinData(windowSettings,component,JsObj,reloadComp)}catch(err){addWinPublic(windowSettings,component,JsObj,reloadComp)}},failure:function(response,opts){addWinPublic(windowSettings,component,JsObj,reloadComp)}})}},getDesktop:function(){return this.app.desktop}}};
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.namespace(&quot;Ext.ux.grid.filter&quot;);Ext.ux.grid.filter.Filter=Ext.extend(Ext.util.Observable,{active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents(&quot;activate&quot;,&quot;deactivate&quot;,&quot;serialize&quot;,&quot;update&quot;);Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=new Ext.menu.Menu();this.init(a);if(a&amp;&amp;a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}},destroy:function(){if(this.menu){this.menu.destroy()}this.purgeListeners()},init:Ext.emptyFn,getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true},serialize:function(){var a=this.getSerialArgs();this.fireEvent(&quot;serialize&quot;,a,this);return a},fireUpdate:function(){if(this.active){this.fireEvent(&quot;update&quot;,this)}this.setActive(this.isActivatable())},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?&quot;activate&quot;:&quot;deactivate&quot;,this)}}}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.grid.filter.StringFilter=Ext.extend(Ext.ux.grid.filter.Filter,{iconCls:&quot;ux-gridfilter-text-icon&quot;,emptyText:&quot;Enter Filter Text...&quot;,selectOnFocus:true,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:true,iconCls:this.iconCls,listeners:{scope:this,keyup:this.onInputKeyUp}});this.inputItem=new Ext.form.TextField(a);this.menu.add(this.inputItem);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent(&quot;update&quot;,this)},isActivatable:function(){return this.inputItem.getValue().length&gt;0},getSerialArgs:function(){return{type:&quot;string&quot;,value:this.getValue()}},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!=&quot;string&quot;){return(this.getValue().length===0)}return b.toLowerCase().indexOf(this.getValue().toLowerCase())&gt;-1},onInputKeyUp:function(d,b){var a=b.getKey();if(a==b.RETURN&amp;&amp;d.isValid()){b.stopEvent();this.menu.hide(true);return}this.updateTask.delay(this.updateBuffer)}});Ext.override(Ext.ux.grid.filter.StringFilter,{getSerialArgs:function(){return{type:&quot;string&quot;,value:this.getValue(),comparison:&quot;LIKE&quot;}}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.grid.filter.DateFilter=Ext.extend(Ext.ux.grid.filter.Filter,{afterText:&quot;After&quot;,beforeText:&quot;Before&quot;,compareMap:{before:&quot;lt&quot;,after:&quot;gt&quot;,on:&quot;eq&quot;},dateFormat:SITOOLS_DATE_FORMAT,menuItems:[&quot;before&quot;,&quot;after&quot;,&quot;-&quot;,&quot;on&quot;],menuItemCfgs:{selectOnFocus:true,width:125},onText:&quot;On&quot;,pickerOpts:{showTime:true},init:function(d){var l,e,a,g,b,k;l=Ext.apply(this.pickerOpts,{minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat,listeners:{scope:this,select:this.onMenuSelect}});this.fields={};for(e=0,a=this.menuItems.length;e&lt;a;e++){g=this.menuItems[e];if(g!==&quot;-&quot;){b={itemId:&quot;range-&quot;+g,text:this[g+&quot;Text&quot;],menu:new Ext.menu.DateMenu(Ext.apply(l,{itemId:g})),listeners:{scope:this,checkchange:this.onCheckChange}};k=Ext.menu.CheckItem;g=this.fields[g]=new k(b)}this.menu.add(g)}},onCheckChange:function(){this.setActive(this.isActivatable());this.fireEvent(&quot;update&quot;,this)},onInputKeyUp:function(d,b){var a=b.getKey();if(a==b.RETURN&amp;&amp;d.isValid()){b.stopEvent();this.menu.hide(true);return}},onMenuSelect:function(d,e,b){var a=this.fields,g=this.fields[d.itemId];g.setChecked(true);if(g==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(g==a.after&amp;&amp;a.before.menu.picker.value&lt;e){a.before.setChecked(false,true)}else{if(g==a.before&amp;&amp;a.after.menu.picker.value&gt;e){a.after.setChecked(false,true)}}}this.fireEvent(&quot;update&quot;,this)},getValue:function(){var b,a={};for(b in this.fields){if(this.fields[b].checked){a[b]=this.fields[b].menu.picker.getValue()}}return a},setValue:function(d,b){var a;for(a in this.fields){if(d[a]){this.fields[a].menu.picker.setValue(d[a]);this.fields[a].setChecked(true)}else{if(!b){this.fields[a].setChecked(false)}}}this.fireEvent(&quot;update&quot;,this)},isActivatable:function(){var a;for(a in this.fields){if(this.fields[a].checked){return true}}return false},getSerialArgs:function(){var a=[];for(var b in this.fields){if(this.fields[b].checked){a.push({type:&quot;date&quot;,comparison:this.compareMap[b],value:this.getFieldValue(b).format(this.dateFormat)})}}return a},getFieldValue:function(a){return this.fields[a].menu.picker.getValue()},getPicker:function(a){return this.fields[a].menu.picker},validateRecord:function(a){var b,e,d=a.get(this.dataIndex);if(!Ext.isDate(d)){return false}d=d.clearTime(true).getTime();for(b in this.fields){if(this.fields[b].checked){e=this.getFieldValue(b).clearTime(true).getTime();if(b==&quot;before&quot;&amp;&amp;e&lt;=d){return false}if(b==&quot;after&quot;&amp;&amp;e&gt;=d){return false}if(b==&quot;on&quot;&amp;&amp;e!=d){return false}}}return true}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.grid.filter.ListFilter=Ext.extend(Ext.ux.grid.filter.Filter,{phpMode:false,init:function(a){this.dt=new Ext.util.DelayedTask(this.fireUpdate,this);if(this.menu){this.menu.destroy()}this.menu=new Ext.ux.menu.ListMenu(a);this.menu.on(&quot;checkchange&quot;,this.onCheckChange,this)},getValue:function(){return this.menu.getSelected()},setValue:function(a){this.menu.setSelected(a);this.fireEvent(&quot;update&quot;,this)},isActivatable:function(){return this.getValue().length&gt;0},getSerialArgs:function(){var a={type:&quot;list&quot;,value:this.phpMode?this.getValue().join(&quot;,&quot;):this.getValue()};return a},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(a){return this.getValue().indexOf(a.get(this.dataIndex))&gt;-1}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.grid.filter.NumericFilter=Ext.extend(Ext.ux.grid.filter.Filter,{fieldCls:Ext.form.NumberField,iconCls:{gte:&quot;ux-rangemenu-gte&quot;,lte:&quot;ux-rangemenu-lte&quot;,eq:&quot;ux-rangemenu-eq&quot;,gt:&quot;ux-rangemenu-gt&quot;,lt:&quot;ux-rangemenu-lt&quot;},menuItemCfgs:{emptyText:&quot;Enter Filter Text...&quot;,selectOnFocus:true,width:125,decimalPrecision:20},menuItems:[&quot;lte&quot;,&quot;gte&quot;,&quot;-&quot;,&quot;eq&quot;,&quot;-&quot;,&quot;lt&quot;,&quot;gt&quot;],init:function(a){if(this.menu){this.menu.destroy()}this.menu=new Ext.ux.menu.RangeMenu(Ext.apply(a,{fieldCfg:this.fieldCfg||{},fieldCls:this.fieldCls,fields:this.fields||{},iconCls:this.iconCls,menuItemCfgs:this.menuItemCfgs,menuItems:this.menuItems,updateBuffer:this.updateBuffer}));this.menu.on(&quot;update&quot;,this.fireUpdate,this)},getValue:function(){return this.menu.getValue()},setValue:function(a){this.menu.setValue(a)},isActivatable:function(){var a=this.getValue();for(key in a){if(a[key]!==undefined){return true}}return false},getSerialArgs:function(){var d,b=[],a=this.menu.getValue();for(d in a){b.push({type:&quot;numeric&quot;,comparison:d,value:a[d]})}return b},validateRecord:function(a){var d=a.get(this.dataIndex),b=this.getValue();if(b.eq!==undefined&amp;&amp;d!=b.eq){return false}if(b.lt!==undefined&amp;&amp;d&gt;=b.lt){return false}if(b.gt!==undefined&amp;&amp;d&lt;=b.gt){return false}return true}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.grid.filter.BooleanFilter=Ext.extend(Ext.ux.grid.filter.Filter,{defaultValue:false,yesText:&quot;yes&quot;,noText:&quot;no&quot;,comparison:&quot;eq&quot;,init:function(a){this.yesText=i18n.get(&quot;label.true&quot;);this.noText=i18n.get(&quot;label.false&quot;);var d=Ext.id();this.options=[new Ext.menu.CheckItem({text:this.yesText,group:d,checked:this.defaultValue===true}),new Ext.menu.CheckItem({text:this.noText,group:d,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var b=0;b&lt;this.options.length;b++){this.options[b].on(&quot;click&quot;,this.fireUpdate,this);this.options[b].on(&quot;checkchange&quot;,this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(a){this.options[a?0:1].setChecked(true)},getSerialArgs:function(){var a={type:&quot;boolean&quot;,comparison:this.comparison,value:this.getValue()};return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns(&quot;Ext.ux.menu&quot;);Ext.ux.menu.RangeMenu=Ext.extend(Ext.menu.Menu,{constructor:function(d){Ext.ux.menu.RangeMenu.superclass.constructor.call(this,d);this.addEvents(&quot;update&quot;);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var e,a,g,b,k;for(e=0,a=this.menuItems.length;e&lt;a;e++){g=this.menuItems[e];if(g!==&quot;-&quot;){b={itemId:&quot;range-&quot;+g,enableKeyEvents:true,iconCls:this.iconCls[g]||&quot;no-icon&quot;,listeners:{scope:this,keyup:this.onInputKeyUp}};Ext.apply(b,Ext.applyIf(this.fields[g]||{},this.fieldCfg[g]),this.menuItemCfgs);k=b.fieldCls||this.fieldCls;g=this.fields[g]=new k(b)}this.add(g)}},fireUpdate:function(){this.fireEvent(&quot;update&quot;,this)},getValue:function(){var a={},b,d;for(b in this.fields){d=this.fields[b];if(d.isValid()&amp;&amp;String(d.getValue()).length&gt;0){a[b]=d.getValue()}}return a},setValue:function(b){var a;for(a in this.fields){this.fields[a].setValue(b[a]!==undefined?b[a]:&quot;&quot;)}this.fireEvent(&quot;update&quot;,this)},onInputKeyUp:function(d,b){var a=b.getKey();if(a==b.RETURN&amp;&amp;d.isValid()){b.stopEvent();this.hide(true);return}if(d==this.fields.eq){if(this.fields.gt){this.fields.gt.setValue(null)}if(this.fields.lt){this.fields.lt.setValue(null)}}else{this.fields.eq.setValue(null)}this.updateTask.delay(this.updateBuffer)}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.namespace(&quot;Ext.ux.menu&quot;);Ext.ux.menu.ListMenu=Ext.extend(Ext.menu.Menu,{labelField:&quot;text&quot;,loadingText:&quot;Loading...&quot;,loadOnShow:true,single:false,constructor:function(b){this.selected=[];this.addEvents(&quot;checkchange&quot;);Ext.ux.menu.ListMenu.superclass.constructor.call(this,b=b||{});if(!b.store&amp;&amp;b.options){var d=[];for(var e=0,a=b.options.length;e&lt;a;e++){var g=b.options[e];switch(Ext.type(g)){case&quot;array&quot;:d.push(g);break;case&quot;object&quot;:d.push([g.id,g[this.labelField]]);break;case&quot;string&quot;:d.push([g,g]);break}}this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},[&quot;id&quot;,this.labelField]),data:d,listeners:{load:this.onLoad,scope:this}});this.loaded=true}else{this.add({text:this.loadingText,iconCls:&quot;loading-indicator&quot;});this.store.on(&quot;load&quot;,this.onLoad,this)}},destroy:function(){if(this.store){this.store.destroy()}Ext.ux.menu.ListMenu.superclass.destroy.call(this)},show:function(){var a=null;return function(){if(arguments.length===0){Ext.ux.menu.ListMenu.superclass.show.apply(this,a)}else{a=arguments;if(this.loadOnShow&amp;&amp;!this.loaded){this.store.load()}Ext.ux.menu.ListMenu.superclass.show.apply(this,arguments)}}}(),onLoad:function(d,b){var l=this.isVisible();this.hide(false);this.removeAll(true);var g=this.single?Ext.id():null;for(var e=0,a=b.length;e&lt;a;e++){var k=new Ext.menu.CheckItem({text:b[e].get(this.labelField),group:g,checked:this.selected.indexOf(b[e].id)&gt;-1,hideOnClick:false});k.itemId=b[e].id;k.on(&quot;checkchange&quot;,this.checkChange,this);this.add(k)}this.loaded=true;if(l){this.show()}this.fireEvent(&quot;load&quot;,this,b)},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(e){e.setChecked(false,true);for(var d=0,b=a.length;d&lt;b;d++){if(e.itemId==a[d]){e.setChecked(true,true)}}},this)}},checkChange:function(b,a){var d=[];this.items.each(function(e){if(e.checked){d.push(e.itemId)}},this);this.selected=d;this.fireEvent(&quot;checkchange&quot;,b,a)}});
/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.namespace(&quot;Ext.ux.grid&quot;);Ext.ux.grid.GridFilters=Ext.extend(Ext.util.Observable,{autoReload:true,filterCls:&quot;ux-filtered-column&quot;,local:false,menuFilterText:&quot;Filters&quot;,paramPrefix:&quot;filter&quot;,showMenu:true,stateId:undefined,updateBuffer:500,constructor:function(a){a=a||{};this.deferredUpdate=new Ext.util.DelayedTask(this.reload,this);this.filters=new Ext.util.MixedCollection();this.filters.getKey=function(b){return b?b.dataIndex:null};this.addFilters(a.filters);delete a.filters;Ext.apply(this,a)},init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.bindStore(this.grid.getStore(),true);this.grid.filters=this;this.grid.addEvents({filterupdate:true});a.on({scope:this,beforestaterestore:this.applyState,beforestatesave:this.saveState,beforedestroy:this.destroy,reconfigure:this.onReconfigure});if(a.rendered){this.onRender()}else{a.on({scope:this,single:true,render:this.onRender})}}else{if(a instanceof Ext.PagingToolbar){this.toolbar=a}}},applyState:function(b,e){var a,d;this.applyingState=true;this.clearFilters();if(e.filters){for(a in e.filters){d=this.filters.get(a);if(d){d.setValue(e.filters[a]);d.setActive(true)}}}this.deferredUpdate.cancel();if(this.local){this.reload()}delete this.applyingState},saveState:function(a,d){var b={};this.filters.each(function(e){if(e.active){b[e.dataIndex]=e.getValue()}});return(d.filters=b)},onRender:function(){this.grid.getView().on(&quot;refresh&quot;,this.onRefresh,this);this.createMenu()},destroy:function(){this.removeAll();this.purgeListeners();if(this.filterMenu){Ext.menu.MenuMgr.unregister(this.filterMenu);this.filterMenu.destroy();this.filterMenu=this.menu.menu=null}},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(a,b){if(!b&amp;&amp;this.store){if(this.local){a.un(&quot;load&quot;,this.onLoad,this)}else{a.un(&quot;beforeload&quot;,this.onBeforeLoad,this)}}if(a){if(this.local){a.on(&quot;load&quot;,this.onLoad,this)}else{a.on(&quot;beforeload&quot;,this.onBeforeLoad,this)}}this.store=a},onReconfigure:function(){this.bindStore(this.grid.getStore());this.store.clearFilter();this.removeAll();this.addFilters(this.grid.getColumnModel());this.updateColumnHeadings()},createMenu:function(){var a=this.grid.getView(),b=a.hmenu;if(this.showMenu&amp;&amp;b){this.sep=b.addSeparator();this.filterMenu=new Ext.menu.Menu({id:this.grid.id+&quot;-filters-menu&quot;});this.menu=b.add({checked:false,itemId:&quot;filters&quot;,text:this.menuFilterText,menu:this.filterMenu});this.menu.on({scope:this,checkchange:this.onCheckChange,beforecheckchange:this.onBeforeCheck});b.on(&quot;beforeshow&quot;,this.onMenu,this)}this.updateColumnHeadings()},getMenuFilter:function(){var a=this.grid.getView();if(!a||a.hdCtxIndex===undefined){return null}return this.filters.get(a.cm.config[a.hdCtxIndex].dataIndex)},onMenu:function(b){var a=this.getMenuFilter();if(a){this.menu.menu=a.menu;this.menu.setChecked(a.active,false);this.menu.setDisabled(a.disabled===true)}this.menu.setVisible(a!==undefined);this.sep.setVisible(a!==undefined)},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(b,a){if(b===&quot;serialize&quot;){return}if(a==this.getMenuFilter()){this.menu.setChecked(a.active,false)}if((this.autoReload||this.local)&amp;&amp;!this.applyingState){this.deferredUpdate.delay(this.updateBuffer)}this.updateColumnHeadings();if(!this.applyingState){this.grid.saveState()}this.grid.fireEvent(&quot;filterupdate&quot;,this,a)},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var d=this.buildQuery(this.getFilterData());Ext.apply(b.params,d);a.storeOptions(b)},onLoad:function(a,b){a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var b=this.grid.getView(),d,a,e;if(b.mainHd){for(d=0,a=b.cm.config.length;d&lt;a;d++){e=this.getFilter(b.cm.config[d].dataIndex);Ext.fly(b.getHeaderCell(d))[e&amp;&amp;e.active?&quot;addClass&quot;:&quot;removeClass&quot;](this.filterCls)}}},reload:function(){if(this.local){this.grid.store.clearFilter(true);this.grid.store.filterBy(this.getRecordFilter())}else{var b,a=this.grid.store;this.deferredUpdate.cancel();if(this.toolbar){b=a.paramNames.start;if(a.lastOptions&amp;&amp;a.lastOptions.params&amp;&amp;a.lastOptions.params[b]){a.lastOptions.params[b]=0}}a.isNewFilter=true;a.reload()}},getRecordFilter:function(){var d=[],a,b;this.filters.each(function(e){if(e.active){d.push(e)}});a=d.length;return function(e){for(b=0;b&lt;a;b++){if(!d[b].validateRecord(e)){return false}}return true}},addFilter:function(a){var d=this.getFilterClass(a.type),b=a.menu?a:(new d(a));this.filters.add(b);Ext.util.Observable.capture(b,this.onStateChange,this);return b},addFilters:function(k){if(k){var d,b,g,a=false,e;if(k instanceof Ext.grid.ColumnModel){k=k.config;a=true}for(d=0,b=k.length;d&lt;b;d++){g=false;if(a){e=k[d].dataIndex;cA=k[d].columnAlias;g=k[d].filter||k[d].filterable;if(g){g=(g===true)?{}:g;Ext.apply(g,{dataIndex:e,columnAlias:cA});g.type=g.type||this.store.fields.get(e).type.type}}else{g=k[d]}if(g){this.addFilter(g)}}}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterData:function(){var d=[],b,a;this.filters.each(function(e){if(e.active){var g=[].concat(e.serialize());for(b=0,a=g.length;b&lt;a;b++){d.push({field:e.dataIndex,data:g[b]})}}});return d},buildQuery:function(b){var a={},d,l,m,g,n,e,k=b.length;if(!this.encode){for(d=0;d&lt;k;d++){l=b[d];m=[this.paramPrefix,&quot;[&quot;,d,&quot;]&quot;].join(&quot;&quot;);a[m+&quot;[field]&quot;]=l.field;g=m+&quot;[data]&quot;;for(n in l.data){a[[g,&quot;[&quot;,n,&quot;]&quot;].join(&quot;&quot;)]=l.data[n]}}}else{e=[];for(d=0;d&lt;k;d++){l=b[d];e.push(Ext.apply({},{field:l.field},l.data))}if(e.length&gt;0){a[this.paramPrefix]=Ext.util.JSON.encode(e)}}return a},cleanParams:function(d){if(this.encode){delete d[this.paramPrefix]}else{var b,a;b=new RegExp(&quot;^&quot;+this.paramPrefix+&quot;[[0-9]+]&quot;);for(a in d){if(b.test(a)){delete d[a]}}}},getFilterClass:function(a){switch(a){case&quot;auto&quot;:case&quot;string&quot;:a=&quot;string&quot;;break;case&quot;int&quot;:case&quot;float&quot;:a=&quot;numeric&quot;;break;case&quot;date&quot;:case&quot;dateAsString&quot;:a=&quot;date&quot;;break}return Ext.ux.grid.filter[a.substr(0,1).toUpperCase()+a.substr(1)+&quot;Filter&quot;]}});Ext.preg(&quot;gridfilters&quot;,Ext.ux.grid.GridFilters);Ext.ux.grid.GridFiltersSpe=Ext.extend(Ext.ux.grid.GridFilters,{getFilterData:function(){var d=[],b,a;this.filters.each(function(e){if(e.active){var g=[].concat(e.serialize());for(b=0,a=g.length;b&lt;a;b++){d.push({columnAlias:e.columnAlias,data:g[b]})}}});return d},buildQuery:function(b){var a={},d,l,m,g,n,e,k=b.length;if(!this.encode){for(d=0;d&lt;k;d++){l=b[d];m=[this.paramPrefix,&quot;[&quot;,d,&quot;]&quot;].join(&quot;&quot;);a[m+&quot;[columnAlias]&quot;]=l.columnAlias;g=m+&quot;[data]&quot;;for(n in l.data){a[[g,&quot;[&quot;,n,&quot;]&quot;].join(&quot;&quot;)]=l.data[n]}}}else{e=[];for(d=0;d&lt;k;d++){l=b[d];e.push(Ext.apply({},{columnAlias:l.columnAlias},l.data))}if(e.length&gt;0){a[this.paramPrefix]=Ext.util.JSON.encode(e)}}return a}});Ext.preg(&quot;gridfiltersspe&quot;,Ext.ux.grid.GridFiltersSpe);Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.GridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(this.cls){this.cls+=&quot; ext-ux-livegrid&quot;}else{this.cls=&quot;ext-ux-livegrid&quot;}Ext.ux.grid.livegrid.GridPanel.superclass.initComponent.call(this)},onRender:function(b,a){Ext.ux.grid.livegrid.GridPanel.superclass.onRender.call(this,b,a);var d=this.getStore();if(d._autoLoad===true){delete d._autoLoad;d.load()}},walkCells:function(m,d,k,g,e){var l=this.store;var a=l.getCount;l.getCount=l.getTotalCount;var b=Ext.ux.grid.livegrid.GridPanel.superclass.walkCells.call(this,m,d,k,g,e);l.getCount=a;return b}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.GridView=function(a){this.addEvents({beforebuffer:true,buffer:true,bufferfailure:true,cursormove:true,abortrequest:true});this.horizontalScrollOffset=17;this._checkEmptyBody=true;Ext.apply(this,a);this.templates={};this.templates.master=new Ext.Template('&lt;div class=&quot;x-grid3&quot; hidefocus=&quot;true&quot;&gt;&lt;div class=&quot;liveScroller&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-viewport&quot;&quot;&gt;','&lt;div class=&quot;x-grid3-header&quot;&gt;&lt;div class=&quot;x-grid3-header-inner&quot;&gt;&lt;div class=&quot;x-grid3-header-offset&quot; style=&quot;{ostyle}&quot;&gt;{header}&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;x-clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;','&lt;div class=&quot;x-grid3-scroller&quot; style=&quot;overflow-y:hidden !important;&quot;&gt;&lt;div class=&quot;x-grid3-body&quot; style=&quot;{bstyle}&quot;&gt;{body}&lt;/div&gt;&lt;a href=&quot;#&quot; class=&quot;x-grid3-focus&quot; tabIndex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;,'&lt;div class=&quot;x-grid3-resize-marker&quot;&gt;&amp;#160;&lt;/div&gt;','&lt;div class=&quot;x-grid3-resize-proxy&quot;&gt;&amp;#160;&lt;/div&gt;',&quot;&lt;/div&gt;&quot;);this._gridViewSuperclass=Ext.ux.grid.livegrid.GridView.superclass;this._gridViewSuperclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.GridView,Ext.ux.sitoolsGridView,{hdHeight:0,rowClipped:0,liveScroller:null,liveScrollerInsets:null,rowHeight:-1,visibleRows:1,lastIndex:-1,lastRowIndex:0,lastScrollPos:0,rowIndex:0,isBuffering:false,requestQueue:-1,loadMask:false,loadMaskDisplayed:false,isPrebuffering:false,_loadMaskAnchor:null,_displayWarningTooManyRows:true,reset:function(e){if(e===false){this.ds.modified=[];this.rowIndex=0;this.lastScrollPos=0;this.lastRowIndex=0;this.lastIndex=0;this.adjustVisibleRows();this.adjustScrollerPos(-this.liveScroller.dom.scrollTop,true);this.showLoadMask(false);var b=this.processRows;this.processRows=Ext.emptyFn;this.refresh(true);this.processRows=b;this.processRows(0);this.fireEvent(&quot;cursormove&quot;,this,0,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return false}else{var d={colModel:Ext.util.JSON.encode(extColModelToSrv(this.cm))};var a=this.ds.sortInfo;if(a){Ext.apply(d,{dir:a.direction,sort:a.field})}return this.ds.load({params:d})}},render:function(){if(this.autoFill){var a=this.grid.ownerCt;if(a&amp;&amp;a.getLayout()){a.on(&quot;afterlayout&quot;,function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI()},renderUI:function(){var b=this.grid;var d=b.enableDragDrop||b.enableDrag;b.enableDragDrop=false;b.enableDrag=false;var a=this._gridViewSuperclass.renderUI.call(this);b=this.grid;b.enableDragDrop=d;b.enableDrag=d;if(d){this.dragZone=new Ext.ux.grid.livegrid.DragZone(b,{ddGroup:b.ddGroup||&quot;GridDD&quot;})}return a},afterRenderUI:function(){this._gridViewSuperclass.afterRenderUI.call(this);if(this.loadMask){this._loadMaskAnchor=Ext.get(this.mainBody.dom.parentNode.parentNode);Ext.apply(this.loadMask,{msgCls:&quot;x-mask-loading&quot;});this._loadMaskAnchor.mask(this.loadMask.msg,this.loadMask.msgCls);var b=this._loadMaskAnchor.dom;var a=Ext.Element.data;a(b,&quot;mask&quot;).addClass(&quot;ext-ux-livegrid&quot;);a(b,&quot;mask&quot;).setDisplayed(false);a(b,&quot;maskMsg&quot;).setDisplayed(false)}},init:function(a){this._gridViewSuperclass.init.call(this,a);a.on(&quot;expand&quot;,this._onExpand,this)},initData:function(b,a){if(this.ds){this.ds.un(&quot;bulkremove&quot;,this.onBulkRemove,this);this.ds.un(&quot;beforeload&quot;,this.onBeforeLoad,this)}if(b){b.on(&quot;bulkremove&quot;,this.onBulkRemove,this);b.on(&quot;beforeload&quot;,this.onBeforeLoad,this)}this._gridViewSuperclass.initData.call(this,b,a)},renderBody:function(){var a=this.renderRows(0,this.visibleRows-1);return this.templates.body.apply({rows:a})},doRender:function(d,b,g,a,e,k){return this._gridViewSuperclass.doRender.call(this,d,b,g,a+this.ds.bufferRange[0],e,k)},initElements:function(){var k=Ext.Element;var d=this.grid.getGridEl().dom.firstChild;var b=d.childNodes;this.el=new k(d);this.mainWrap=new k(b[1]);this.liveScroller=new k(b[0]);var g=this.liveScroller.dom.firstChild;this.liveScrollerInsets=[g];var a=g.nextSibling;while(!Ext.isEmpty(a)){this.liveScrollerInsets.push(a);a=a.nextSibling}this.liveScroller.on(&quot;scroll&quot;,this.onLiveScroll,this,{buffer:this.scrollDelay});var e=this.mainWrap.dom.firstChild;this.mainHd=new k(e);this.hdHeight=e.offsetHeight;this.innerHd=this.mainHd.dom.firstChild;this.scroller=new k(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle(&quot;overflow-x&quot;,&quot;hidden&quot;)}this.mainBody=new k(this.scroller.dom.firstChild);this.mainBody.on(&quot;mousewheel&quot;,this.handleWheel,this);this.focusEl=new k(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent(&quot;click&quot;,true);this.resizeMarker=new k(b[2]);this.resizeProxy=new k(b[3])},layout:function(){if(!this.mainBody){return}var k=this.grid;var m=k.getGridEl(),p=this.cm,b=k.autoExpandColumn,a=this;var d=m.getSize(true);var n=d.width;if(!k.hideHeaders&amp;&amp;n&lt;20||d.height&lt;20){return}if(k.autoHeight){this.scroller.dom.style.overflow=&quot;visible&quot;;if(Ext.isWebKit){this.scroller.dom.style.position=&quot;static&quot;}}else{this.el.setSize(d.width,d.height);var l=this.mainHd.getHeight();var e=d.height-(l);this.scroller.setSize(n,e);if(this.innerHd){this.innerHd.style.width=(n)+&quot;px&quot;}}this.liveScroller.dom.style.top=this.hdHeight+&quot;px&quot;;if(this.forceFit){if(this.lastViewWidth!=n){this.fitColumns(false,false);this.lastViewWidth=n}}else{this.autoExpand()}this.adjustVisibleRows();this.adjustBufferInset();this.onLayout(n,e)},removeRow:function(a){Ext.removeNode(this.getRow(a))},removeRows:function(d,a){var b=this.mainBody.dom;for(var e=d;e&lt;=a;e++){Ext.removeNode(b.childNodes[d])}},_onExpand:function(a){this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*this.rowIndex,true)},onColumnMove:function(a,d,b){this.indexMap=null;this.replaceLiveRows(this.rowIndex,true);this.updateHeaders();this.updateHeaderSortState();this.afterMove(b);this.grid.fireEvent(&quot;columnmove&quot;,d,b)},onColumnWidthUpdated:function(d,a,b){this.adjustVisibleRows();this.adjustBufferInset()},onAllColumnWidthsUpdated:function(a,b){this.adjustVisibleRows();this.adjustBufferInset()},onRowSelect:function(a){if(a&lt;this.rowIndex||a&gt;this.rowIndex+this.visibleRows){return}this.addRowClass(a,this.selectedRowClass)},onRowDeselect:function(a){if(a&lt;this.rowIndex||a&gt;this.rowIndex+this.visibleRows){return}this.removeRowClass(a,this.selectedRowClass)},onClear:function(){this.reset(false)},onBulkRemove:function(t,u){var m=null;var p=0;var z=0;var q=u.length;var a=false;var n=false;var k=0;if(q===0){return}var d=this.rowIndex;var b=0;var g=0;var e=0;for(var l=0;l&lt;q;l++){m=u[l][0];p=u[l][1];z=(p!=Number.MIN_VALUE&amp;&amp;p!=Number.MAX_VALUE)?p+this.ds.bufferRange[0]:p;if(z&lt;this.rowIndex){b++}else{if(z&gt;=this.rowIndex&amp;&amp;z&lt;=this.rowIndex+(this.visibleRows-1)){e++}else{if(z&gt;=this.rowIndex+this.visibleRows){g++}}}this.fireEvent(&quot;beforerowremoved&quot;,this,z,m);this.fireEvent(&quot;rowremoved&quot;,this,z,m)}var v=this.ds.totalLength;this.rowIndex=Math.max(0,Math.min(this.rowIndex-b,v-(this.visibleRows-1)));this.lastRowIndex=this.rowIndex;this.adjustScrollerPos(-(b*this.rowHeight),true);this.updateLiveRows(this.rowIndex,true);this.adjustBufferInset();this.processRows(0,undefined,false)},onRemove:function(d,a,b){this.onBulkRemove(d,[[a,b]])},onAdd:function(b,d,l){if(this._checkEmptyBody){if(this.mainBody.dom.innerHTML==&quot;&amp;nbsp;&quot;){this.mainBody.dom.innerHTML=&quot;&quot;}this._checkEmptyBody=false}var k=d.length;if(l==Number.MAX_VALUE||l==Number.MIN_VALUE){this.fireEvent(&quot;beforerowsinserted&quot;,this,l,l);if(l==Number.MIN_VALUE){this.rowIndex=this.rowIndex+k;this.lastRowIndex=this.rowIndex;this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*k,true);this.fireEvent(&quot;rowsinserted&quot;,this,l,l,k);this.processRows(0,undefined,false);this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);return}this.adjustBufferInset();this.fireEvent(&quot;rowsinserted&quot;,this,l,l,k);return}var a=l+this.ds.bufferRange[0];var g=a+(k-1);var m=this.getRows().length;var e=0;var n=0;if(a&gt;this.rowIndex+(this.visibleRows-1)){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,g);this.fireEvent(&quot;rowsinserted&quot;,this,a,g,k);this.adjustVisibleRows();this.adjustBufferInset()}else{if(a&gt;=this.rowIndex&amp;&amp;a&lt;=this.rowIndex+(this.visibleRows-1)){e=l;n=l+(k-1);this.lastRowIndex=this.rowIndex;this.rowIndex=(a&gt;this.rowIndex)?this.rowIndex:a;this.insertRows(b,e,n);if(this.lastRowIndex!=this.rowIndex){this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}this.adjustVisibleRows();this.adjustBufferInset()}else{if(a&lt;this.rowIndex){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,g);this.rowIndex=this.rowIndex+k;this.lastRowIndex=this.rowIndex;this.adjustVisibleRows();this.adjustBufferInset();this.adjustScrollerPos(this.rowHeight*k,true);this.fireEvent(&quot;rowsinserted&quot;,this,a,g,k);this.processRows(0,undefined,true);this.fireEvent(&quot;cursormove&quot;,this,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength)}}}},onBeforeLoad:function(b,d){var e=b.proxy;if(e.activeRequest&amp;&amp;e.activeRequest[Ext.data.Api.actions.read]){e.getConnection().abort(e.activeRequest[Ext.data.Api.actions.read])}this.fireEvent(&quot;abortrequest&quot;,b,d);this.isBuffering=false;this.isPreBuffering=false;d.params=d.params||{};var a=Ext.apply;a(d,{scope:this,callback:function(){this.reset(false)},suspendLoadEvent:false});a(d.params,{start:0,limit:this.ds.bufferSize});return true},onLoad:function(d,b,a){this.adjustBufferInset()},onDataChange:function(a){this.updateHeaderSortState()},liveBufferUpdate:function(a,b,e){if(e===true){this.adjustBufferInset();this.fireEvent(&quot;buffer&quot;,this,this.ds,this.rowIndex,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,b);this.grid.selModel.replaceSelections(a);this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false);if(this.requestQueue&gt;=0){var d=this.requestQueue;this.requestQueue=-1;this.updateLiveRows(d);return}if(this.isInRange(this.rowIndex)){this.replaceLiveRows(this.rowIndex,b.forceRepaint)}else{this.updateLiveRows(this.rowIndex)}return}else{this.fireEvent(&quot;bufferfailure&quot;,this,this.ds,b)}this.requestQueue=-1;this.isBuffering=false;this.isPrebuffering=false;this.showLoadMask(false)},handleWheel:function(a){if(this.rowHeight==-1){a.stopEvent();return}var b=a.getWheelDelta();this.adjustScrollerPos(-(b*this.rowHeight));a.stopEvent()},onLiveScroll:function(){var a=this.liveScroller.dom.scrollTop;var b=Math.floor((a)/this.rowHeight);this.rowIndex=b;if(b==this.lastRowIndex){return}this.updateLiveRows(b);this.lastScrollPos=this.liveScroller.dom.scrollTop},refreshRow:function(a){var e=this.ds,d;if(typeof a==&quot;number&quot;){d=a;a=e.getAt(d)}else{d=e.indexOf(a)}var b=d+this.ds.bufferRange[0];if(b&lt;this.rowIndex||b&gt;=this.rowIndex+this.visibleRows){this.fireEvent(&quot;rowupdated&quot;,this,b,a);return}this.insertRows(e,d,d,true);this.fireEvent(&quot;rowupdated&quot;,this,b,a)},processRows:function(k,e,a){if(!this.ds||this.ds.getCount()&lt;1){return}e=e||!this.grid.stripeRows;var l=this.rowIndex;var n=this.getRows();var d=0;var m=null;for(var g=0,b=n.length;g&lt;b;g++){m=n[g];m.rowIndex=d=l+g;m.className=m.className.replace(this.rowClsRe,&quot; &quot;);if(!e&amp;&amp;(d+1)%2===0){m.className+=&quot; x-grid3-row-alt&quot;}if(a!==false){if(this.grid.selModel.isSelected(this.ds.getAt(d))===true){this.addRowClass(d,this.selectedRowClass)}else{this.removeRowClass(d,this.selectedRowClass)}this.fly(m).removeClass(&quot;x-grid3-row-over&quot;)}}if(l===0){Ext.fly(n[0]).addClass(this.firstRowCls)}else{if(l+n.length==this.ds.totalLength){Ext.fly(n[n.length-1]).addClass(this.lastRowCls)}}},insertRows:function(g,b,u,t){var a=b+this.ds.bufferRange[0];var k=u+this.ds.bufferRange[0];if(!t){this.fireEvent(&quot;beforerowsinserted&quot;,this,a,k)}if(t!==true&amp;&amp;(this.getRows().length+(u-b))&gt;=this.visibleRows){this.removeRows((this.visibleRows-1)-(u-b),this.visibleRows-1)}else{if(t){this.removeRows(a-this.rowIndex,k-this.rowIndex)}}var l=(b==u)?u:Math.min(u,(this.rowIndex-this.ds.bufferRange[0])+(this.visibleRows-1));var e=this.renderRows(b,l);var n=this.getRow(a);if(n){Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,n,e)}else{Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.mainBody.dom,e)}if(t===true){var q=this.getRows();var p=this.rowIndex;for(var d=0,m=q.length;d&lt;m;d++){q[d].rowIndex=p+d}}if(!t){this.fireEvent(&quot;rowsinserted&quot;,this,a,k,(k-a)+1);this.processRows(0,undefined,true)}},getRow:function(a){if(a-this.rowIndex&lt;0){return null}return this.getRows()[a-this.rowIndex]},getCell:function(d,a){var b=this.getRow(d);return b?b.getElementsByTagName(&quot;td&quot;)[a]:null},focusCell:function(e,a,d){var b=this.ensureVisible(e,a,d);if(!b){return}this.focusEl.setXY(b);if(Ext.isGecko){this.focusEl.focus()}else{this.focusEl.focus.defer(1,this.focusEl)}},ensureVisible:function(q,d,b){if(typeof q!=&quot;number&quot;){q=q.rowIndex}if(q&lt;0||q&gt;=this.ds.totalLength){return}d=(d!==undefined?d:0);var m=q-this.rowIndex;if(this.rowClipped&amp;&amp;q==this.rowIndex+this.visibleRows-1){this.adjustScrollerPos(this.rowHeight)}else{if(q&gt;=this.rowIndex+this.visibleRows){this.adjustScrollerPos(((q-(this.rowIndex+this.visibleRows))+1)*this.rowHeight)}else{if(q&lt;=this.rowIndex){this.adjustScrollerPos((m)*this.rowHeight)}}}var l=this.getRow(q),e;if(!l){return}if(!(b===false&amp;&amp;d===0)){while(this.cm.isHidden(d)){d++}e=this.getCell(q,d)}var p=this.scroller.dom;if(b!==false){var n=parseInt(e.offsetLeft,10);var k=n+e.offsetWidth;var g=parseInt(p.scrollLeft,10);var a=g+p.clientWidth;if(n&lt;g){p.scrollLeft=n}else{if(k&gt;a){p.scrollLeft=k-p.clientWidth}}}return e?Ext.fly(e).getXY():[p.scrollLeft+this.el.getX(),Ext.fly(l).getY()]},isRecordRendered:function(a){var b=this.ds.indexOf(a);if(b&gt;=this.rowIndex&amp;&amp;b&lt;this.rowIndex+this.visibleRows){return true}return false},isInRange:function(b){var a=Math.min(this.ds.totalLength-1,b+(this.visibleRows-1));return(b&gt;=this.ds.bufferRange[0])&amp;&amp;(a&lt;=this.ds.bufferRange[1])},getPredictedBufferIndex:function(a,b,d){if(!b){if(a+this.ds.bufferSize&gt;=this.ds.totalLength){return this.ds.totalLength-this.ds.bufferSize}return Math.max(0,(a+this.visibleRows)-Math.round(this.ds.bufferSize/2))}if(!d){return Math.max(0,(a-this.ds.bufferSize)+this.visibleRows)}if(d){return Math.max(0,Math.min(a,this.ds.totalLength-this.ds.bufferSize))}},updateLiveRows:function(l,m,e){var p=this.isInRange(l);if(this.isBuffering){if(this.isPrebuffering){if(p){this.replaceLiveRows(l,m)}else{this.showLoadMask(true)}}this.fireEvent(&quot;cursormove&quot;,this,l,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);this.requestQueue=l;return}var g=this.lastIndex;this.lastIndex=l;p=this.isInRange(l);var n=false;if(p&amp;&amp;e!==true){this.replaceLiveRows(l,m);this.fireEvent(&quot;cursormove&quot;,this,l,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength);if(l&gt;g){n=true;var q=this.ds.totalLength;if(l+this.visibleRows+this.nearLimit&lt;=this.ds.bufferRange[1]){return}if(this.ds.bufferRange[1]+1&gt;=q){return}}else{if(l&lt;g){n=false;if(this.ds.bufferRange[0]&lt;=0){return}if(l-this.nearLimit&gt;this.ds.bufferRange[0]){return}}else{return}}this.isPrebuffering=true}this.isBuffering=true;var b=this.getPredictedBufferIndex(l,p,n);if(!p){this.showLoadMask(true)}this.ds.suspendEvents();var k=this.ds.sortInfo;var d={};if(this.ds.lastOptions){Ext.apply(d,this.ds.lastOptions.params)}d.start=b;d.limit=this.ds.bufferSize;d.nocount=true;if(k){d.dir=k.direction;d.sort=k.field}var a={forceRepaint:m,callback:this.liveBufferUpdate,scope:this,params:d,suspendLoadEvent:true};this.fireEvent(&quot;beforebuffer&quot;,this,this.ds,l,Math.min(this.ds.totalLength,this.visibleRows-this.rowClipped),this.ds.totalLength,a);this.ds.load(a);this.ds.resumeEvents()},showLoadMask:function(b){if(!this.loadMask||b==this.loadMaskDisplayed){return}var g=this._loadMaskAnchor.dom;var e=Ext.Element.data;var a=e(g,&quot;mask&quot;);var d=e(g,&quot;maskMsg&quot;);if(b){a.setDisplayed(true);d.setDisplayed(true);d.center(this._loadMaskAnchor);if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;this._loadMaskAnchor.getStyle(&quot;height&quot;)==&quot;auto&quot;){a.setSize(undefined,this._loadMaskAnchor.getHeight())}}else{a.setDisplayed(false);d.setDisplayed(false)}this.loadMaskDisplayed=b},replaceLiveRows:function(m,l,d){var e=m-this.lastRowIndex;if(e===0&amp;&amp;l!==true){return}var a=e&gt;0;e=Math.abs(e);var b=this.ds.bufferRange;var n=m-b[0];var g=Math.min(n+this.visibleRows-1,b[1]-b[0]);if(e&gt;=this.visibleRows||e===0){this.mainBody.update(this.renderRows(n,g))}else{if(a){this.removeRows(0,e-1);if(n+this.visibleRows-e&lt;=b[1]-b[0]){var k=this.renderRows(n+this.visibleRows-e,g);Ext.DomHelper.insertHtml(&quot;beforeEnd&quot;,this.mainBody.dom,k)}}else{this.removeRows(this.visibleRows-e,this.visibleRows-1);k=this.renderRows(n,n+e-1);Ext.DomHelper.insertHtml(&quot;beforeBegin&quot;,this.mainBody.dom.firstChild,k)}}if(d!==false){this.processRows(0,undefined,true)}this.lastRowIndex=m},adjustBufferInset:function(){var n=this.liveScroller.dom;var k=this.grid,b=k.store;var m=k.getGridEl();var t=m.getSize().width;var a=(b.totalLength==this.visibleRows-this.rowClipped)?0:Math.max(0,b.totalLength-(this.visibleRows-this.rowClipped));if(a===0){this.scroller.setWidth(t);n.style.display=&quot;none&quot;;return}else{this.scroller.setWidth(t-this.getScrollOffset());n.style.display=&quot;&quot;}var v=this.cm.getTotalWidth()+this.getScrollOffset()&gt;t;var q=n.parentNode.offsetHeight+((b.totalLength&gt;0&amp;&amp;v)?-this.horizontalScrollOffset:0)-this.hdHeight;n.style.height=Math.max(q,this.horizontalScrollOffset*2)+&quot;px&quot;;this.liveScroller.dom.style.width=(this.getScrollOffset()+2)+&quot;px&quot;;if(this.rowHeight==-1){return}var e=(a===0?0:q+(a*this.rowHeight));if(e&gt;35791380){e=35000000;var u=Math.floor(e/this.rowHeight);if(this._displayWarningTooManyRows){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),String.format(i18n.get(&quot;label.tooManyRecords&quot;),u,this.visibleRows+a));this._displayWarningTooManyRows=false}}var p=e;var l=this.liveScrollerInsets.length;if(e===0){e=0}else{e=Math.round(e/l)}for(var d=0;d&lt;l;d++){if(d==l-1&amp;&amp;e!==0){e-=(e*l)-p}this.liveScrollerInsets[d].style.height=e+&quot;px&quot;}},adjustVisibleRows:function(){if(this.rowHeight==-1){if(this.getRows()[0]){this.rowHeight=this.getRows()[0].offsetHeight;if(this.rowHeight&lt;=0){this.rowHeight=-1;return}}else{return}}var k=this.grid,d=k.store;var l=k.getGridEl();var n=this.cm;var q=l.getSize();var b=q.width;var e=q.height;var m=b-this.getScrollOffset();if(n.getTotalWidth()&gt;m){e-=this.horizontalScrollOffset}e-=this.mainHd.getHeight();var p=d.totalLength||0;var a=Math.max(1,Math.floor(e/this.rowHeight));this.rowClipped=0;if(p&gt;a&amp;&amp;this.rowHeight/3&lt;(e-(a*this.rowHeight))){a=Math.min(a+1,p);this.rowClipped=1}if(this.visibleRows==a){return}this.visibleRows=a;if(this.isBuffering&amp;&amp;!this.isPrebuffering){return}if(this.rowIndex+(a-this.rowClipped)&gt;p){this.rowIndex=Math.max(0,p-(a-this.rowClipped));this.lastRowIndex=this.rowIndex}this.updateLiveRows(this.rowIndex,true)},adjustScrollerPos:function(e,a){if(e===0){return}var d=this.liveScroller;var b=d.dom;if(a===true){d.un(&quot;scroll&quot;,this.onLiveScroll,this)}this.lastScrollPos=b.scrollTop;b.scrollTop+=e;if(a===true){b.scrollTop=b.scrollTop;d.on(&quot;scroll&quot;,this.onLiveScroll,this,{buffer:this.scrollDelay})}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.JsonReader=function(a,b){Ext.ux.grid.livegrid.JsonReader.superclass.constructor.call(this,a,b)};Ext.extend(Ext.ux.grid.livegrid.JsonReader,Ext.data.JsonReader,{buildExtractors:function(){if(this.ef){return}var a=this.meta;if(a.versionProperty){this.getVersion=this.createAccessor(a.versionProperty)}Ext.ux.grid.livegrid.JsonReader.superclass.buildExtractors.call(this)},readRecords:function(d){if(!this.__readRecords){this.__readRecords=Ext.ux.grid.livegrid.JsonReader.superclass.readRecords}var b=this.__readRecords.call(this,d);if(this.meta.versionProperty){var a=this.getVersion(d);b.version=(a===undefined||a===&quot;&quot;)?null:a}if(Ext.isEmpty(d.total)){b.totalRecords=this.totalRecordsSitools}else{this.totalRecordsSitools=d.total}return b}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.RowSelectionModel=function(a){this.addEvents({selectiondirty:true,handleMouseDown:true});Ext.apply(this,a);this.pendingSelections={};Ext.ux.grid.livegrid.RowSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.livegrid.RowSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Ext.ux.grid.livegrid.RowSelectionModel.superclass.initEvents.call(this);this.grid.view.on(&quot;rowsinserted&quot;,this.onAdd,this);this.grid.store.on(&quot;selectionsload&quot;,this.onSelectionsLoad,this)},handleMouseDown:function(k,m,l){if(l.button!==0||this.isLocked()){return}var a=this.grid.getView();if(l.shiftKey&amp;&amp;!this.singleSelect&amp;&amp;this.last!==false){var d=this.last;this.selectRange(d,m,l.ctrlKey);this.last=d;this.fireEvent(&quot;handleMouseDown&quot;,this)}else{var b=this.isSelected(m);if(l.ctrlKey&amp;&amp;b){this.deselectRow(m);this.fireEvent(&quot;handleMouseDown&quot;,this)}else{if(!b||this.getCount()&gt;1){this.selectRow(m,l.ctrlKey||l.shiftKey);this.fireEvent(&quot;handleMouseDown&quot;,this)}}}},onRemove:function(b,e,l){var a=this.getPendingSelections();var d=a.length;var k=false;if(e==Number.MIN_VALUE||e==Number.MAX_VALUE){if(l){if(this.isIdSelected(l.id)&amp;&amp;e==Number.MIN_VALUE){this.shiftSelections(this.grid.store.bufferRange[1],-1)}this.selections.remove(l);k=true}if(e==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0])}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(d!==0){this.fireEvent(&quot;selectiondirty&quot;,this,e,1)}}else{k=this.isIdSelected(l.id);if(!k){return}this.selections.remove(l);if(d!==0){var m=a[0];var g=a[d-1];if(e&lt;=g||e&lt;=m){this.shiftSelections(e,-1);this.fireEvent(&quot;selectiondirty&quot;,this,e,1)}}}if(k){this.fireEvent(&quot;selectionchange&quot;,this)}},onAdd:function(l,g,e,b){var a=this.getPendingSelections();var m=a.length;if((g==Number.MIN_VALUE||g==Number.MAX_VALUE)){if(g==Number.MIN_VALUE){this.clearPendingSelections(0,this.grid.store.bufferRange[0]);this.shiftSelections(this.grid.store.bufferRange[1],b)}else{this.clearPendingSelections(this.grid.store.bufferRange[1])}if(m!==0){this.fireEvent(&quot;selectiondirty&quot;,this,g,r)}return}var k=a[0];var d=a[m-1];var n=g;if(n&lt;=d||n&lt;=k){this.fireEvent(&quot;selectiondirty&quot;,this,n,b);this.shiftSelections(n,b)}},shiftSelections:function(t,d){var m=0;var q=0;var b={};var e=this.grid.store;var n=t-e.bufferRange[0];var k=0;var u=this.grid.store.totalLength;var g=null;var a=this.getPendingSelections();var p=a.length;if(p===0){return}for(var l=0;l&lt;p;l++){m=a[l];if(m&lt;t){continue}q=m+d;k=n+d;if(q&gt;=u){break}g=e.getAt(k);if(g){this.selections.add(g)}else{b[q]=true}this.allSelections[q]=true}this.pendingSelections=b},onSelectionsLoad:function(d,b,a){this.replaceSelections(b)},hasNext:function(){return this.last!==false&amp;&amp;(this.last+1)&lt;this.grid.store.getTotalCount()},getCount:function(){return this.selections.length+this.getPendingSelections().length},isSelected:function(a){if(typeof a==&quot;number&quot;){var b=a;a=this.grid.store.getAt(b);if(!a){var e=this.getPendingSelections().indexOf(b);if(e!=-1){return true}return false}}var d=a;return(d&amp;&amp;this.selections.key(d.id)?true:false)},deselectRecord:function(a,d){if(this.locked){return}var g=this.selections.key(a.id);if(!g){return}var b=this.grid.store;var e=b.indexOfId(a.id);if(e==-1){e=b.findInsertIndex(a);if(e!=Number.MIN_VALUE&amp;&amp;e!=Number.MAX_VALUE){e+=b.bufferRange[0]}}else{delete this.pendingSelections[e]}if(this.last==e){this.last=false}if(this.lastActive==e){this.lastActive=false}delete this.allSelections[e];this.selections.remove(a);if(!d){this.grid.getView().onRowDeselect(e)}this.fireEvent(&quot;rowdeselect&quot;,this,e,a);this.fireEvent(&quot;selectionchange&quot;,this)},deselectRow:function(b,a){if(this.locked){return}if(this.last==b){this.last=false}if(this.lastActive==b){this.lastActive=false}var d=this.grid.store.getAt(b);delete this.allSelections[b];delete this.pendingSelections[b];if(d){this.selections.remove(d)}if(!a){this.grid.getView().onRowDeselect(b)}this.fireEvent(&quot;rowdeselect&quot;,this,b,d);this.fireEvent(&quot;selectionchange&quot;,this)},selectRow:function(b,e,a){if(this.locked||b&lt;0||b&gt;=this.grid.store.getTotalCount()){return}var d=this.grid.store.getAt(b);if(this.fireEvent(&quot;beforerowselect&quot;,this,b,e,d)!==false){if(!e||this.singleSelect){this.clearSelections()}if(d){this.selections.add(d);delete this.pendingSelections[b]}else{this.pendingSelections[b]=true}this.allSelections[b]=true;this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent(&quot;rowselect&quot;,this,b,d);this.fireEvent(&quot;selectionchange&quot;,this)}},clearPendingSelections:function(l,k){if(k===undefined){k=Number.MAX_VALUE}var b={};var a=this.getPendingSelections();var e=a.length;var d=0;for(var g=0;g&lt;e;g++){d=a[g];if(d&lt;=k&amp;&amp;d&gt;=l){continue}b[d]=true}this.pendingSelections=b},replaceSelections:function(g){if(!g||g.length===0){return}var e=this.grid.store;var k=null;var p=[];var a=this.getPendingSelections();var q=a.length;var d=this.selections;var n=0;for(var l=0;l&lt;q;l++){n=a[l];k=e.getAt(n);if(k){d.add(k);p.push(k.id);delete this.pendingSelections[n]}}var b=null;var m=null;for(l=0,m=g.length;l&lt;m;l++){k=g[l];b=k.id;if(p.indexOf(b)==-1&amp;&amp;d.containsKey(b)){d.add(k)}}},getPendingSelections:function(k){var e=1;var d=[];var b=0;var l=[];for(var g in this.pendingSelections){l.push(parseInt(g))}l.sort(function(n,m){if(n&gt;m){return 1}else{if(n&lt;m){return -1}else{return 0}}});if(!k){return l}var a=l.length;if(a===0){return[]}d[b]=[l[0],l[0]];for(var g=0,a=a-1;g&lt;a;g++){if(l[g+1]-l[g]==1){d[b][1]=l[g+1]}else{b++;d[b]=[l[g+1],l[g+1]]}}return d},getAllSelections:function(k){var e=1;var d=[];var b=0;var l=[];for(var g in this.allSelections){l.push(parseInt(g))}l.sort(function(n,m){if(n&gt;m){return 1}else{if(n&lt;m){return -1}else{return 0}}});if(!k){return l}var a=l.length;if(a===0){return[]}d[b]=[l[0],l[0]];for(var g=0,a=a-1;g&lt;a;g++){if(l[g+1]-l[g]==1){d[b][1]=l[g+1]}else{b++;d[b]=[l[g+1],l[g+1]]}}return d},clearSelections:function(a){if(this.locked){return}if(a!==true){var e=this.grid.store;var b=this.selections;var d=-1;b.each(function(g){d=e.indexOfId(g.id);if(d!=-1){this.deselectRow(d+e.bufferRange[0])}},this);b.clear();this.pendingSelections={}}else{this.selections.clear();this.pendingSelections={}}this.allSelections={};this.last=false},selectRange:function(b,a,e){if(this.locked){return}if(!e){this.clearSelections()}if(b&lt;=a){for(var d=b;d&lt;=a;d++){this.selectRow(d,true)}}else{for(var d=b;d&gt;=a;d--){this.selectRow(d,true)}}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.Store=function(a){a=a||{};a.remoteSort=true;this._autoLoad=a.autoLoad?true:false;a.autoLoad=false;this.addEvents(&quot;bulkremove&quot;,&quot;versionchange&quot;,&quot;beforeselectionsload&quot;,&quot;selectionsload&quot;);Ext.ux.grid.livegrid.Store.superclass.constructor.call(this,a);this.totalLength=0;this.bufferRange=[-1,-1];this.on(&quot;clear&quot;,function(){this.bufferRange=[-1,-1]},this);if(this.url&amp;&amp;!this.selectionsProxy){this.selectionsProxy=new Ext.data.HttpProxy({url:this.url})}};Ext.extend(Ext.ux.grid.livegrid.Store,Ext.data.Store,{version:null,insert:function(e,d){d=[].concat(d);e=e&gt;=this.bufferSize?Number.MAX_VALUE:e;if(e==Number.MIN_VALUE||e==Number.MAX_VALUE){var b=d.length;if(e==Number.MIN_VALUE){this.bufferRange[0]+=b;this.bufferRange[1]+=b}this.totalLength+=b;this.fireEvent(&quot;add&quot;,this,d,e);return}var k=false;var m=d;if(d.length+e&gt;=this.bufferSize){k=true;m=d.splice(0,this.bufferSize-e)}this.totalLength+=m.length;if(this.bufferRange[0]&lt;=-1){this.bufferRange[0]=0}if(this.bufferRange[1]&lt;(this.bufferSize-1)){this.bufferRange[1]=Math.min(this.bufferRange[1]+m.length,this.bufferSize-1)}for(var g=0,a=m.length;g&lt;a;g++){this.data.insert(e,m[g]);m[g].join(this)}while(this.getCount()&gt;this.bufferSize){this.data.remove(this.data.last())}this.fireEvent(&quot;add&quot;,this,m,e);if(k===true){this.fireEvent(&quot;add&quot;,this,d,Number.MAX_VALUE)}},remove:function(b,a){var d=this._getIndex(b);if(d&lt;0){this.totalLength-=1;if(this.pruneModifiedRecords){this.modified.remove(b)}this.bufferRange[0]=Math.max(-1,this.bufferRange[0]-1);this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);if(a!==true){this.fireEvent(&quot;remove&quot;,this,b,d)}return d}this.bufferRange[1]=Math.max(-1,this.bufferRange[1]-1);this.data.removeAt(d);if(this.pruneModifiedRecords){this.modified.remove(b)}this.totalLength-=1;if(a!==true){this.fireEvent(&quot;remove&quot;,this,b,d)}return d},_getIndex:function(a){var b=this.indexOfId(a.id);if(b&lt;0){b=this.findInsertIndex(a)}return b},bulkRemove:function(b){var l=null;var g=[];var e=0;var a=b.length;var k=[];for(var d=0;d&lt;a;d++){l=b[d];k[l.id]=this._getIndex(l)}for(var d=0;d&lt;a;d++){l=b[d];this.remove(l,true);g.push([l,k[l.id]])}this.fireEvent(&quot;bulkremove&quot;,this,g)},removeAll:function(){this.totalLength=0;this.bufferRange=[-1,-1];this.data.clear();if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent(&quot;clear&quot;,this)},loadRanges:function(b){var a=b.length;if(a&gt;0&amp;&amp;!this.selectionsProxy.activeRequest[Ext.data.Api.actions.read]&amp;&amp;this.fireEvent(&quot;beforeselectionsload&quot;,this,b)!==false){var g=this.lastOptions.params;var k={};k.ranges=Ext.encode(b);if(g){if(g.sort){k.sort=g.sort}if(g.dir){k.dir=g.dir}}var d={};for(var e in this.lastOptions){d.i=this.lastOptions.i}d.ranges=k.ranges;this.selectionsProxy.doRequest(Ext.data.Api.actions.read,null,d,this.reader,this.selectionsLoaded,this,d)}},loadSelections:function(a){if(a.length===0){return}this.loadRanges(a)},selectionsLoaded:function(k,b,g){if(this.checkVersionChange(k,b,g)!==false){var e=k.records;for(var d=0,a=e.length;d&lt;a;d++){e[d].join(this)}this.fireEvent(&quot;selectionsload&quot;,this,k.records,Ext.decode(b.ranges))}else{this.fireEvent(&quot;selectionsload&quot;,this,[],Ext.decode(b.ranges))}},checkVersionChange:function(e,b,d){if(e&amp;&amp;d!==false){if(e.version!==undefined){var a=this.version;this.version=e.version;if(this.version!==a){return this.fireEvent(&quot;versionchange&quot;,this,a,this.version)}}}},findInsertIndex:function(a){this.remoteSort=false;var b=Ext.ux.grid.livegrid.Store.superclass.findInsertIndex.call(this,a);this.remoteSort=true;if(this.bufferRange[0]&lt;=0&amp;&amp;b===0){return b}else{if(this.bufferRange[0]&gt;0&amp;&amp;b===0){return Number.MIN_VALUE}else{if(b&gt;=this.bufferSize){return Number.MAX_VALUE}}}return b},sortData:function(d,e){e=e||&quot;ASC&quot;;var a=this.fields.get(d).sortType;var b=function(k,g){var m=a(k.data[d]),l=a(g.data[d]);return m&gt;l?1:(m&lt;l?-1:0)};this.data.sort(e,b)},onMetaChange:function(b,a,d){this.version=null;Ext.ux.grid.livegrid.Store.superclass.onMetaChange.call(this,b,a,d)},loadRecords:function(d,a,b){this.checkVersionChange(d,a,b);if(!d){this.bufferRange=[-1,-1]}else{this.bufferRange=[a.params.start,Math.max(0,Math.min((a.params.start+a.params.limit)-1,d.totalRecords-1))]}if(a.suspendLoadEvent===true){this.suspendEvents()}Ext.ux.grid.livegrid.Store.superclass.loadRecords.call(this,d,a,b);if(a.suspendLoadEvent===true){this.resumeEvents()}},getAt:function(a){if(this.bufferRange[0]==-1){return undefined}var b=a-this.bufferRange[0];return this.data.itemAt(b)},clearFilter:function(){},isFiltered:function(){},collect:function(){},createFilterFn:function(){},sum:function(){},filter:function(){},filterBy:function(){},query:function(){},queryBy:function(){},find:function(){},findBy:function(){}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.Toolbar=Ext.extend(Ext.Toolbar,{displayMsg:&quot;&quot;,emptyMsg:&quot;No data to display&quot;,refreshText:&quot;Refresh&quot;,initComponent:function(){this.displayMsg=i18n.get(&quot;paging.display&quot;);Ext.ux.grid.livegrid.Toolbar.superclass.initComponent.call(this);if(this.grid){this.view=this.grid.getView()}var a=this;this.view.init=this.view.init.createSequence(function(){a.bind(this)},this.view)},updateInfo:function(e,d,a){if(this.displayEl){var b=a===0?this.emptyMsg:String.format(this.displayMsg,e+1,e+d,a);this.displayEl.update(b)}},unbind:function(a){var b;var d;if(a instanceof Ext.grid.GridView){d=a}else{d=a.getView()}b=a.ds;b.un(&quot;loadexception&quot;,this.enableLoading,this);b.un(&quot;beforeload&quot;,this.disableLoading,this);b.un(&quot;load&quot;,this.enableLoading,this);d.un(&quot;rowremoved&quot;,this.onRowRemoved,this);d.un(&quot;rowsinserted&quot;,this.onRowsInserted,this);d.un(&quot;beforebuffer&quot;,this.beforeBuffer,this);d.un(&quot;cursormove&quot;,this.onCursorMove,this);d.un(&quot;buffer&quot;,this.onBuffer,this);d.un(&quot;bufferfailure&quot;,this.enableLoading,this);this.view=undefined},bind:function(a){this.view=a;var b=a.ds;b.on(&quot;loadexception&quot;,this.enableLoading,this);b.on(&quot;beforeload&quot;,this.disableLoading,this);b.on(&quot;load&quot;,this.enableLoading,this);a.on(&quot;rowremoved&quot;,this.onRowRemoved,this);a.on(&quot;rowsinserted&quot;,this.onRowsInserted,this);a.on(&quot;beforebuffer&quot;,this.beforeBuffer,this);a.on(&quot;cursormove&quot;,this.onCursorMove,this);a.on(&quot;buffer&quot;,this.onBuffer,this);a.on(&quot;bufferfailure&quot;,this.enableLoading,this)},enableLoading:function(){this.loading.setDisabled(false)},disableLoading:function(){this.loading.setDisabled(true)},onCursorMove:function(b,e,d,a){this.updateInfo(e,d,a)},onRowsInserted:function(b,d,a){this.updateInfo(b.rowIndex,Math.min(b.ds.totalLength,b.visibleRows-b.rowClipped),b.ds.totalLength)},onRowRemoved:function(b,d,a){this.updateInfo(b.rowIndex,Math.min(b.ds.totalLength,b.visibleRows-b.rowClipped),b.ds.totalLength)},beforeBuffer:function(b,d,k,g,a,e){this.loading.disable();this.updateInfo(k,g,a)},onBuffer:function(b,d,m,l,a){this.loading.enable();this.updateInfo(m,l,a);var e=Ext.getCmp(&quot;plot&quot;+this.ownerCt.datasetId);if(e){var g=e.findById(&quot;plot-right-panel&quot;);var k=g.fireEvent(&quot;buffer&quot;,d,m,l,a)}},onClick:function(a){switch(a){case&quot;refresh&quot;:if(this.view.reset(true)){this.loading.disable()}else{this.loading.enable()}break}},onRender:function(b,a){Ext.PagingToolbar.superclass.onRender.call(this,b,a);this.loading=new Ext.Toolbar.Button({tooltip:this.refreshText,iconCls:&quot;x-tbar-loading&quot;,handler:this.onClick.createDelegate(this,[&quot;refresh&quot;])});this.addButton(this.loading);this.addSeparator();if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:&quot;x-paging-info&quot;})}}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.DragZone=function(b,a){Ext.ux.grid.livegrid.DragZone.superclass.constructor.call(this,b,a);this.view.ds.on(&quot;beforeselectionsload&quot;,this._onBeforeSelectionsLoad,this);this.view.ds.on(&quot;selectionsload&quot;,this._onSelectionsLoad,this)};Ext.extend(Ext.ux.grid.livegrid.DragZone,Ext.grid.GridDragZone,{isDropValid:true,onInitDrag:function(a){this.view.ds.loadSelections(this.grid.selModel.getPendingSelections(true));Ext.ux.grid.livegrid.DragZone.superclass.onInitDrag.call(this,a)},_onBeforeSelectionsLoad:function(){this.isDropValid=false;Ext.fly(this.proxy.el.dom.firstChild).addClass(&quot;ext-ux-livegrid-drop-waiting&quot;)},_onSelectionsLoad:function(){this.isDropValid=true;this.ddel.innerHTML=this.grid.getDragDropText();Ext.fly(this.proxy.el.dom.firstChild).removeClass(&quot;ext-ux-livegrid-drop-waiting&quot;)}});Ext.namespace(&quot;Ext.ux.grid.livegrid&quot;);Ext.ux.grid.livegrid.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initEvents:function(){Ext.ux.grid.livegrid.EditorGridPanel.superclass.initEvents.call(this);this.view.on(&quot;cursormove&quot;,this.stopEditing,this,[true])},startEditing:function(b,a){this.stopEditing();if(this.colModel.isCellEditable(a,b)){this.view.ensureVisible(b,a,true);if(!this.store.getAt(b)){return}}return Ext.ux.grid.livegrid.EditorGridPanel.superclass.startEditing.call(this,b,a)},walkCells:function(g,a,e,d,b){return Ext.ux.grid.livegrid.GridPanel.prototype.walkCells.call(this,g,a,e,d,b)},onRender:function(b,a){return Ext.ux.grid.livegrid.GridPanel.prototype.onRender.call(this,b,a)},initComponent:function(){if(this.cls){this.cls+=&quot; ext-ux-livegrid&quot;}else{this.cls=&quot;ext-ux-livegrid&quot;}return Ext.ux.grid.livegrid.EditorGridPanel.superclass.initComponent.call(this)}});Ext.namespace(&quot;sitools.user.component.dataviews&quot;);sitools.user.component.dataviews.dataviewUtils={getFormParamsFromRecsSelected:function(d){var g=d[0],a={};var b=&quot;&quot;;Ext.each(g.fields.items,function(k){if(k.primaryKey){b=k.name}});if(Ext.isEmpty(b)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noPrimaryKey&quot;));return}var e=[];Ext.each(d,function(k){e.push(encodeURIComponent(k.get(b)))});a[&quot;p[0]&quot;]=&quot;LISTBOXMULTIPLE|&quot;+b+&quot;|&quot;+e.join(&quot;|&quot;);return a},getRendererLiveGrid:function(b,a){var d;if(!Ext.isEmpty(b.columnRenderer)){d=function(q,n,g,m,u,t){if(!Ext.isEmpty(q)){if(!Ext.isEmpty(b.columnRenderer.toolTip)){n.attr='ext:qtip=&quot;'+b.columnRenderer.toolTip+'&quot;'}var k=&quot;max-width:&quot;+(b.width-10)+&quot;px;&quot;;if(!Ext.isEmpty(a)&amp;&amp;!Ext.isEmpty(a.lineHeight)){k+=&quot;max-height: &quot;+(a.lineHeight-10)+&quot;px;&quot;}var e=sitools.user.component.dataviews.dataviewUtils.getRendererHTML(b,k);var l;if(!Ext.isEmpty(e)){if(b.columnRenderer.behavior==ColumnRendererEnum.IMAGE_FROM_SQL){var p=g.get(b.columnRenderer.columnAlias);l=String.format(e,q,p)}else{l=String.format(e,q)}}return l}else{return q}}}else{d=function(e){var g=e;if(sql2ext.get(b.sqlColumnType)==&quot;dateAsString&quot;){g=sitools.user.component.dataviews.dataviewUtils.formatDate(e,b)}if(sql2ext.get(b.sqlColumnType)==&quot;boolean&quot;){g=e?i18n.get(&quot;label.true&quot;):i18n.get(&quot;label.false&quot;)}return g}}return d},getRendererDataView:function(d,b,p){var k=&quot;&quot;,n,a,l,q;var e=d.columnRenderer;if(!Ext.isEmpty(e)){a=e.behavior;var g=sitools.user.component.dataviews.dataviewUtils.getRendererHTML(d,p);switch(a){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:case ColumnRendererEnum.DATASET_ICON_LINK:if(!Ext.isEmpty(e.linkText)){k+=String.format('&lt;tpl if=&quot;this.isNotEmpty({0})&quot;&gt;',d.columnAlias);n=String.format(g,&quot;{&quot;+d.columnAlias+&quot;}&quot;);if(!Ext.isEmpty(e.toolTip)){k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',e.toolTip)}k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; {1}&lt;/span&gt;',d.header,n,b);k+=&quot;&lt;/tpl&gt;&quot;;k+=String.format('&lt;tpl if=&quot;this.isEmpty({0})&quot;&gt;',d.columnAlias);n=&quot;&quot;;k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; {1}&lt;/span&gt;',d.header,n,b);k+=&quot;&lt;/tpl&gt;&quot;}else{if(!Ext.isEmpty(e.image)){k+=String.format('&lt;tpl if=&quot;this.isNotEmpty({0})&quot;&gt;',d.columnAlias);if(!Ext.isEmpty(e.toolTip)){k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',e.toolTip)}else{k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',d.header)}k+=String.format(g,&quot;{&quot;+d.columnAlias+&quot;}&quot;);k+=&quot;&lt;/li&gt;&lt;/tpl&gt;&quot;}}break;case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:k+=String.format('&lt;tpl if=&quot;this.isNotEmpty({0})&quot;&gt;',d.columnAlias);if(!Ext.isEmpty(e.toolTip)){k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',e.toolTip)}else{k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',d.header)}k+=String.format(g,&quot;{&quot;+d.columnAlias+&quot;}&quot;);k+=&quot;&lt;/li&gt;&lt;/tpl&gt;&quot;;break;case ColumnRendererEnum.IMAGE_FROM_SQL:var m=&quot;&quot;;if(!Ext.isEmpty(e.url)){m=e.url}else{if(!Ext.isEmpty(e.columnAlias)){m=&quot;{&quot;+e.columnAlias+&quot;}&quot;}}k+=String.format('&lt;tpl if=&quot;this.isNotEmpty({0})&quot;&gt;',d.columnAlias);if(!Ext.isEmpty(e.toolTip)){k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',e.toolTip)}else{k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',d.header,m)}k+=String.format(g,&quot;{&quot;+d.columnAlias+&quot;}&quot;,m);k+=&quot;&lt;/li&gt;&lt;/tpl&gt;&quot;;break;default:k+=String.format('&lt;tpl if=&quot;this.isNotEmpty({0})&quot;&gt;',d.columnAlias);if(!Ext.isEmpty(e.toolTip)){k+=String.format('&lt;li  class=&quot;img-link&quot; ext:qtip=&quot;{0}&quot;&gt;',e.toolTip)}n=String.format(g,&quot;{&quot;+d.columnAlias+&quot;}&quot;);k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; {1}&lt;/span&gt;',d.header,n,b);k+=&quot;&lt;/tpl&gt;&quot;;k+=String.format('&lt;tpl if=&quot;this.isEmpty({0})&quot;&gt;',d.columnAlias);n=&quot;&quot;;k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; {1}&lt;/span&gt;',d.header,n,b);k+=&quot;&lt;/tpl&gt;&quot;;break}}else{if(sql2ext.get(d.sqlColumnType)==&quot;dateAsString&quot;){k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; &lt;tpl if=&quot;this.isValidDate({1})&quot;&gt;{[Date.parseDate(values.{1}, SITOOLS_DATE_FORMAT).format(&quot;{3}&quot;)]}&lt;/tpl&gt;&lt;/span&gt;',d.header,d.columnAlias,b,Ext.isEmpty(d.format)?SITOOLS_DEFAULT_IHM_DATE_FORMAT:d.format)}else{k+=String.format('&lt;span class=&quot;dataview_columnValue&quot;&gt;&lt;div class=x-view-entete style=&quot;{2}&quot;&gt;{0} &lt;/div&gt; {{1}}&lt;/span&gt;',d.header,d.columnAlias,b)}}return k},getRendererHTML:function(k,b){var l,a,d;var e;if(!Ext.isEmpty(k.columnRenderer)&amp;&amp;!Ext.isEmpty(k.columnRenderer.behavior)){var g=k.columnRenderer;switch(g.behavior){case ColumnRendererEnum.URL_LOCAL:a=&quot;&quot;;if(!Ext.isEmpty(g.linkText)){a=g.linkText}else{if(!Ext.isEmpty(g.image)){a='&lt;img src=&quot;'+g.image.url+&quot;\&quot; class='sitools-display-image' style ='&quot;+b+&quot;' &gt;&lt;/img&gt;&quot;}}e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.downloadData(\&quot;{0}\&quot;);'&gt;&quot;+a+&quot;&lt;/a&gt;&quot;;break;case ColumnRendererEnum.URL_EXT_NEW_TAB:a=&quot;&quot;;if(!Ext.isEmpty(g.linkText)){a=g.linkText}else{if(!Ext.isEmpty(g.image)){a='&lt;img  src=&quot;'+g.image.url+&quot;\&quot; class='sitools-display-image' style ='&quot;+b+&quot;' &gt;&lt;/img&gt;&quot;}}e=&quot;&lt;a href='#' onClick='window.open(\&quot;{0}\&quot;);'&gt;&quot;+a+&quot;&lt;/a&gt;&quot;;break;case ColumnRendererEnum.URL_EXT_DESKTOP:a=&quot;&quot;;if(!Ext.isEmpty(g.linkText)){a=g.linkText}else{if(!Ext.isEmpty(g.image)){a='&lt;img src=&quot;'+g.image.url+&quot;\&quot; class='sitools-display-image' style ='&quot;+b+&quot;' &gt;&lt;/img&gt;&quot;}}e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showDisplayableUrl(\&quot;{0}\&quot;, &quot;+g.displayable+&quot;);'&gt;&quot;+a+&quot;&lt;/a&gt;&quot;;break;case ColumnRendererEnum.IMAGE_NO_THUMB:e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showPreview(\&quot;{0}\&quot;,\&quot;&quot;+g.linkText+&quot;\&quot;);'&gt;&quot;+g.linkText+&quot;&lt;/a&gt;&quot;;break;case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showPreview(\&quot;{0}\&quot;,\&quot;&quot;+k.header+&quot;\&quot;);'&gt;&lt;img class='sitools-display-image' src='{0}' style ='&quot;+b+&quot;'&gt;&lt;/img&gt;&lt;/a&gt;&quot;;break;case ColumnRendererEnum.IMAGE_FROM_SQL:e=&quot;&lt;div style='text-align:center;'&gt;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showPreview(\&quot;{0}\&quot;,\&quot;&quot;+k.header+&quot;\&quot;);'&gt;&lt;img class='sitools-display-image' src='{1}' style ='&quot;+b+&quot;'&gt;&lt;/a&gt;&lt;/div&gt;&quot;;break;case ColumnRendererEnum.DATASET_LINK:e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showDetailsData(\&quot;{0}\&quot;,\&quot;&quot;+g.columnAlias+'&quot;, &quot;'+g.datasetLinkUrl+&quot;\&quot;);'&gt;{0}&lt;/a&gt;&quot;;break;case ColumnRendererEnum.DATASET_ICON_LINK:if(!Ext.isEmpty(g.image)){d=g.image.url}e=&quot;&lt;a href='#' onClick='sitools.user.component.dataviews.dataviewUtils.showDetailsData(\&quot;{0}\&quot;, \&quot;&quot;+g.columnAlias+'&quot;, &quot;'+g.datasetLinkUrl+&quot;\&quot;);'&gt;&lt;img style ='&quot;+b+&quot;' class='sitools-display-image' src='&quot;+d+&quot;'&gt;&lt;/a&gt;&quot;;break;default:e=&quot;{0}&quot;;break}}return e},getRendererViewDataDetails:function(a){},formatDate:function(e,d){var g;var a=Date.parseDate(e,SITOOLS_DATE_FORMAT,true);if(Ext.isEmpty(a)){g=&quot;&quot;}else{if(Ext.isEmpty(d.format)){g=a.format(SITOOLS_DEFAULT_IHM_DATE_FORMAT)}else{try{g=a.format(d.format)}catch(b){g=&quot;unable to format Date&quot;}}}return g},downloadData:function(a){Ext.Ajax.request({url:a,method:&quot;HEAD&quot;,scope:this,success:function(d){try{var b=d.getResponseHeader(&quot;Content-Type&quot;).split(&quot;;&quot;)[0].split(&quot;/&quot;)[0];if(b==&quot;text&quot;){Ext.Ajax.request({url:a,method:&quot;GET&quot;,scope:this,success:function(l){var g={id:&quot;winPreferenceDetailId&quot;,title:a};var m=Ext.Panel;var k={layout:&quot;fit&quot;,autoScroll:true,html:l.responseText};SitoolsDesk.addDesktopWindow(g,k,m)}})}else{if(b==&quot;image&quot;){sitools.user.component.dataviews.dataviewUtils.showPreview(a,item.header)}else{sitools.user.component.dataviews.dataviewUtils.downloadFile(a)}}}catch(e){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),e)}},failure:function(b){return null}})},showDisplayableUrl:function(e,a){if(a){var b={title:e,id:e};var g=Ext.ux.ManagedIFrame.Panel;var d={defaults:{padding:10},layout:&quot;fit&quot;,region:&quot;center&quot;,defaultSrc:e};SitoolsDesk.addDesktopWindow(b,d,g)}else{sitools.user.component.dataviews.dataviewUtils.downloadFile(e)}},downloadFile:function(a){if(Ext.getCmp(&quot;mifToDownload&quot;)){Ext.getCmp(&quot;mifToDownload&quot;).destroy()}var b=new Ext.ux.ManagedIFrame.Panel({layout:&quot;fit&quot;,id:&quot;mifToDownload&quot;,region:&quot;center&quot;,defaultSrc:a,renderTo:Ext.getBody(),cls:&quot;x-hidden&quot;})},showDetailsData:function(value,columnAlias,datasetUrl){var desktop=getDesktop();Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:datasetUrl,success:function(response,opts){try{var json=Ext.decode(response.responseText);if(!json.success){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),json.message);return}var formParams=[&quot;RADIO|&quot;+columnAlias+&quot;|&quot;+value];var dataset=json.dataset;var jsObj=eval(dataset.datasetView.jsObject);var componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.id,datasetCm:dataset.columnModel,formParams:formParams,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings,datasetViewConfig:dataset.datasetViewConfig};var AppUserStorage=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var windowConfig={id:&quot;wind&quot;+dataset.id+columnAlias+value,title:i18n.get(&quot;label.dataTitle&quot;)+&quot; : &quot;+dataset.name,datasetName:dataset.name,type:&quot;data&quot;,saveToolbar:true,urlPreferences:loadUrl.get(&quot;APP_URL&quot;)+AppUserStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+dataset.name+&quot;/data&quot;};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,jsObj)}catch(err){}}})},showPreview:function(b,d){var a=new sitools.widget.WindowImageViewer({title:d,src:b,hideAction:&quot;close&quot;,resizeImage:false});a.show();a.toFront()},isNoClientAccess:function(a){return !Ext.isEmpty(a.columnRenderer)&amp;&amp;ColumnRendererEnum.NO_CLIENT_ACCESS==a.columnRenderer.behavior}};Ext.namespace(&quot;sitools.user.component.dataviews&quot;);sitools.user.component.dataviews.ctxMenu=Ext.extend(Ext.menu.Menu,{dataUrl:null,grid:null,datasetName:null,datasetId:null,origin:null,event:null,urlDetail:null,constructor:function(a){this.dataUrl=a.dataUrl;this.grid=a.grid;this.datasetId=a.datasetId;this.datasetName=a.datasetName;this.origin=a.origin;this.event=a.event;this.urlDetail=a.urlDetail;this.config=a;this.selections=this.grid.getSelections();sitools.user.component.dataviews.ctxMenu.superclass.constructor.call(this,a);if(!this.svaStore){this.svaStore=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;id&quot;,type:&quot;string&quot;},{name:&quot;image&quot;},{name:&quot;method&quot;,type:&quot;string&quot;},{name:&quot;runType&quot;,type:&quot;string&quot;},{name:&quot;label&quot;,type:&quot;string&quot;}],url:this.dataUrl+&quot;/sva?filter=active&quot;})}if(!this.resourceStore){this.resourceStore=new Ext.data.JsonStore({root:&quot;data&quot;,fields:[{name:&quot;parameters&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;description&quot;,type:&quot;string&quot;},{name:&quot;dataSetSelection&quot;,type:&quot;string&quot;},{name:&quot;behavior&quot;,type:&quot;string&quot;}],url:this.dataUrl+&quot;/services&quot;,listeners:{load:function(d,b,e){Ext.each(b,function(g){if(g.get(&quot;dataSetSelection&quot;)==&quot;NONE&quot;){d.remove(g)}},this)}}})}this.resourceStore.on(&quot;beforeload&quot;,this.onBeforeLoad,this);this.resourceStore.on(&quot;load&quot;,this.onLoad,this);this.on(&quot;show&quot;,this.onMenuLoad,this);this.svaStore.on(&quot;beforeload&quot;,this.onBeforeLoad,this);this.svaStore.on(&quot;load&quot;,this.onLoad,this)},onMenuLoad:function(){this.svaStore.load();this.resourceStore.load()},onBeforeLoad:function(){this.svaStore.baseParams=this.baseParams;this.resourceStore.baseParams=this.baseParams;this.updateMenuItems(false)},onLoad:function(b,a){this.updateMenuItems(true,a)},updateMenuItems:function(b,a){this.selections=this.grid.getSelections();this.svaPresent=false;this.removeAll();this.el.sync();this.menuSva=new Ext.menu.Menu();this.menuResources=new Ext.menu.Menu();this.resourcePresent=false;if(b){this.svaStore.each(function(e){var l=e.data;this.svaPresent=true;var g=this.dataUrl+&quot;/sva/&quot;+l.id+&quot;/tasks&quot;;var k;if(!Ext.isEmpty(l.image)){k=l.image.url}var d=&quot;&quot;;if(l.method==&quot;GET&quot;||l.runType==&quot;SVA_FORCE_RUN_ASYNC&quot;||l.runType==&quot;SVA_FORCE_RUN_SYNC&quot;){d=l.runType==&quot;SVA_FORCE_RUN_ASYNC&quot;?&quot;async&quot;:&quot;sync&quot;;this.menuSva.add({text:l.label,cls:&quot;x-btn-text-icon&quot;,icon:k,listeners:{scope:this,click:function(){this.svaClick(g,l.method,d)}}})}else{d=l.runType==&quot;SVA_DEFAULT_RUN_ASYNC&quot;?&quot;async&quot;:&quot;sync&quot;;this.menuSva.add({text:l.label,cls:&quot;x-btn-text-icon&quot;,icon:k,menu:{items:[{text:i18n.get(&quot;label.default&quot;),listeners:{scope:this,click:function(){this.svaClick(g,l.method,d)}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/sva_exe_default.png&quot;},{text:i18n.get(&quot;label.synchrone&quot;),listeners:{scope:this,click:function(){this.svaClick(g,l.method,&quot;sync&quot;)}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/sva_exe_synchrone.png&quot;},{text:i18n.get(&quot;label.asynchrone&quot;),listeners:{scope:this,click:function(){this.svaClick(g,l.method,&quot;async&quot;)}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/sva_exe_asynchrone.png&quot;}]}})}},this);this.resourceStore.each(function(d){var n=d.data;this.resourcePresent=true;var m=n.parameters;var k,g,l,e;m.each(function(p){switch(p.name){case&quot;methods&quot;:e=p.value;break;case&quot;runTypeUserInput&quot;:g=p.value;break;case&quot;url&quot;:k=this.dataUrl+p.value;break;case&quot;image&quot;:l=p.value;break}},this);this.menuResources.add({text:n.name,cls:&quot;x-btn-text-icon&quot;,icon:l,listeners:{scope:this,click:function(){this.resourceClick(n,k,e,g,m)}}})},this)}else{this.menuResources.add('&lt;span class=&quot;loading-indicator&quot;&gt;'+this.loadingText+&quot;&lt;/span&gt;&quot;)}this.add({text:i18n.get(&quot;label.addSelection&quot;),listeners:{scope:this,click:function(d,g){g.stopEvent();this.orderAction=&quot;add&quot;;this._onOrder()}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/add_selection.png&quot;});this.add({text:i18n.get(&quot;label.export.all.CSV&quot;),listeners:{scope:this,click:function(){this._onExportCsv()}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/csv.png&quot;});if(this.origin==&quot;Ext.ux.livegrid&quot;||this.origin==&quot;sitools.user.component.dataviews.tplView.TplView&quot;){this.add({text:i18n.get(&quot;label.downloadFile&quot;),listeners:{scope:this,click:function(){this.orderAction=&quot;download&quot;;this._onOrder()}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/add_request.png&quot;})}this.add({text:i18n.get(&quot;label.details&quot;),listeners:{scope:this,click:function(d,g){g.stopEvent();g.stopPropagation();this._onDetails()}},icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toolbar_details.png&quot;});if(this.resourcePresent){this.add({text:i18n.get(&quot;label.resources&quot;),menu:this.menuResources,icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/tree_datasets_resource.png&quot;})}},svaClick:function(b,g,a){Ext.getBody().mask(&quot;loading...&quot;,&quot;x-mask-loading&quot;);var e=&quot;&quot;;if(!(g==&quot;POST&quot;&amp;&amp;a==&quot;async&quot;)){try{e=this.grid.getRequestParam()}catch(d){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),String.format(i18n.get(&quot;label.notImplementedService&quot;),d));return false}}b+=&quot;?1=1&quot;+e;if(g==&quot;GET&quot;){window.open(b);Ext.getBody().unmask();return}else{if(!Ext.isEmpty(a)){b+=&quot;&amp;run=&quot;+a}if(this.selections.length!==0){this._addSelectionsForSVA(this.selections,b)}else{if(this.origin==&quot;Ext.ux.livegrid&quot;||this.origin==&quot;sitools.user.component.dataviews.tplView.TplView&quot;){this._addRequestForSVA(b)}else{this._addSelectionsForSVA(this.grid.getStore().data.items,b)}}}},_addSelectionsForSVA:function(d,e){var a=&quot;&quot;;var g=d[0];Ext.each(g.fields.items,function(l){if(l.primaryKey){a=l.name}},g);if(Ext.isEmpty(a)||Ext.isEmpty(g.get(a))){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noPrimaryKey&quot;));return}var k={};k.orderRecord={};k.orderRecord.records=[];Ext.each(d,function(m){var l={};l[a]=m.get(a);k.orderRecord.records.push(l)});var b;if(!Ext.isEmpty(userLogin)){b=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin)}else{b=&quot;/tmp&quot;}Ext.Ajax.request({url:loadUrl.get(&quot;APP_URL&quot;)+b,method:&quot;POST&quot;,scope:this,params:{filepath:&quot;/tmp&quot;,filename:&quot;SvaRecordDefinitionFile.json&quot;},jsonData:k,success:function(m){var l=Ext.decode(m.responseText);if(!l.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),l.message);return}else{this._addRequestForSVA(e,{params:{urlFile:b+&quot;/tmp/SvaRecordDefinitionFile.json&quot;}})}},failure:alertFailure})},_addRequestForSVA:function(b,d){var a={method:&quot;POST&quot;,url:b,scope:this,success:function(e,m){try{var k=Ext.decode(e.responseText);if(!k.success){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),k.message);return}var n=k.SvaTaskModel;if(!Ext.isEmpty(n.urlResult)){window.open(n.urlResult)}else{var g=new sitools.user.component.dataviews.goToSvaTaskWindow({svaTask:n});g.show()}}catch(l){Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:l,width:300,buttons:Ext.MessageBox.OK})}},failure:function(e,g){Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:e.responseText,width:300,buttons:Ext.MessageBox.OK})},callback:function(){if(Ext.getBody().isMasked()){Ext.getBody().unmask()}}};if(!Ext.isEmpty(d)){Ext.apply(a,d)}Ext.Ajax.request(a)},_onOrder:function(){if(this.orderAction==&quot;add&quot;&amp;&amp;Ext.isEmpty(this.selections)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}if(this.origin==&quot;Ext.ux.livegrid&quot;){if(this.grid.selModel.getPendingSelections().length&gt;0){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;livegrid.selection.invalide.txt&quot;));return}}var b=&quot;&quot;;if(this.orderAction==&quot;add&quot;){b=i18n.get(&quot;label.addSelection&quot;)}else{b=i18n.get(&quot;label.addRequest&quot;)}var a=new Ext.Window({title:b,width:300,modal:true,items:[{xtype:&quot;form&quot;,labelWidth:75,items:[{xtype:&quot;textfield&quot;,fieldLabel:i18n.get(&quot;label.name&quot;),name:&quot;orderName&quot;,anchor:&quot;100%&quot;}],buttons:[{text:i18n.get(&quot;label.ok&quot;),scope:this,handler:function(){var d=a.findByType(&quot;form&quot;)[0].getForm().getFieldValues().orderName;if(this.orderAction==&quot;add&quot;){this._addSelection(this.selections,this.grid,this.datasetId,d)}else{this._onDownload(this.datasetId,this.grid,d)}a.close()}},{text:i18n.get(&quot;label.cancel&quot;),handler:function(){a.close()}}]}]});a.show()},_addSelection:function(g,e,k,a){var b=&quot;&quot;;var l=g[0];Ext.each(l.fields.items,function(n){if(n.primaryKey){b=n.name}},l);if(Ext.isEmpty(b)||Ext.isEmpty(l.get(b))){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noPrimaryKey&quot;));return}var m={};m.orderRecord={};m.orderRecord.records=[];var d=extColModelToStorage(e.getColumnModel());Ext.each(g,function(p){var n={};Ext.each(d,function(q){if(!q.hidden||q.primaryKey){n[q.columnAlias]=p.get(q.columnAlias)}});m.orderRecord.records.push(n)});m.orderRecord.colModel=d;m.orderRecord.datasetId=k;m.orderRecord.projectId=projectId;m.orderRecord.dataUrl=this.dataUrl;m.orderRecord.datasetName=this.datasetName;userStorage.set(a+&quot;.json&quot;,&quot;/&quot;+DEFAULT_ORDER_FOLDER+&quot;/records&quot;,m)},_onExportCsv:function(){var d=this.selections;var e=window.location.protocol+&quot;//&quot;+window.location.host+this.dataUrl+&quot;/records&quot;;var b=&quot;&quot;;try{b=this.grid.getRequestParam()}catch(a){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),String.format(i18n.get(&quot;label.notImplementedService&quot;),a));return false}e+=&quot;?media=csv&quot;+b+&quot;&amp;limit=&quot;+this.grid.store.totalLength;window.open(e)},_onDownload:function(k,e,a){var m={};m.orderRequest={};m.orderRequest.datasetId=k;m.orderRequest.datasetUrl=e.dataUrl;var g=e.getFilters();if(!Ext.isEmpty(g)){m.orderRequest.filters=g.getFilterData(g)}var d=e.getStore().getSortState();if(!Ext.isEmpty(d)){m.orderRequest.sort=d}var l=e.getStore().filtersCfg;if(!Ext.isEmpty(l)){m.orderRequest.filtersCfg=l}var b=Ext.util.JSON.encode(extColModelToStorage(e.getColumnModel()));m.orderRequest.colModel=b;m.orderRequest.datasetId=k;m.orderRequest.projectId=projectId;m.orderRequest.formParams=e.getStore().getFormParams();userStorage.set(a+&quot;.json&quot;,&quot;/&quot;+DEFAULT_ORDER_FOLDER+&quot;/request&quot;,m)},_onDetails:function(){var g=this.grid.getSelections()[0];if(Ext.isEmpty(g)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noselection&quot;));return}var d={baseUrl:this.urlDetail+&quot;/records/&quot;,grid:this.grid,fromWhere:this.origin,datasetId:this.datasetId,selections:this.grid.getSelections(),datasetName:this.datasetName,datasetUrl:this.urlDetail};var e=sitools.user.component.viewDataDetail;var b=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var a={id:&quot;dataDetail&quot;+this.datasetId,title:i18n.get(&quot;label.viewDataDetail&quot;)+&quot; : &quot;+this.datasetName,datasetName:this.datasetName,saveToolbar:true,urlPreferences:loadUrl.get(&quot;APP_URL&quot;)+b+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+this.datasetName+&quot;/dataDetail&quot;,type:&quot;dataDetail&quot;,toolbarItems:[{icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-left.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goPrevious()}},{icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-right.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goNext()}}]};SitoolsDesk.addDesktopWindow(a,d,e,true)},getNbRowsSelected:function(){if(this.grid.getNbRowsSelected()){return this.grid.getNbRowsSelected()}else{return null}},getNbGridRecords:function(){return this.grid.getStore().totalLength},setGrid:function(a){this.grid=a},setSelections:function(a){this.selections=a},resourceClick:function(g,d,b,a,e){this.checkResourceParameters(g,d,b,a,e)},handleResourceClick:function(l,e,d,a,k){var g=false;var m=[];Ext.each(k,function(n){if(n.type==&quot;PARAMETER_USER_INPUT&quot;&amp;&amp;n.userUpdatable){g=true}m[n.name]=n.value});if(d.split(&quot;|&quot;)&amp;&amp;d.split(&quot;|&quot;).length&gt;1){g=true}if(g){var b=new sitools.user.component.dataviews.resourcePluginParamsWindow({resource:l,url:e,methods:d,runType:a,parameters:k,contextMenu:this,withSelection:(this.getNbRowsSelected()!==0)});b.show()}else{this.onResourceCallClick(l,e,d,a,null,m)}},onResourceCallClick:function(k,b,a,t,n,q){if((a==&quot;POST&quot;||a==&quot;PUT&quot;||a==&quot;DELETE&quot;)&amp;&amp;t==&quot;TASK_RUN_SYNC&quot;){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),String.format(i18n.get(&quot;error.invalidMethodOrSyncRessourceCall&quot;),a,t));return}var p;try{p=this.grid.getRequestParam()}catch(m){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),String.format(i18n.get(&quot;label.notImplementedService&quot;),m));return false}b+=&quot;?1=1&quot;+p;if(!Ext.isEmpty(n)){b+=&quot;&amp;limit=&quot;+n}if(!Ext.isEmpty(q)){Ext.iterate(q,function(u,v){b+=&quot;&amp;&quot;+u+&quot;=&quot;+v})}if(a==&quot;GET&quot;){switch(k.behavior){case&quot;DISPLAY_IN_NEW_TAB&quot;:window.open(b);Ext.getBody().unmask();break;case&quot;DISPLAY_IN_DESKTOP&quot;:var l={title:i18n.get(&quot;downloadedResource&quot;)};var g=Ext.ux.ManagedIFrame.Panel;var e={layout:&quot;fit&quot;,defaultSrc:b,autoScroll:true};Ext.Ajax.request({method:&quot;HEAD&quot;,url:b,success:function(z){var v=&quot;&quot;;try{v=z.getResponseHeader(&quot;Content-Type&quot;).split(&quot;;&quot;)[0].split(&quot;/&quot;)[0]}catch(A){v=&quot;&quot;}var B=z.getResponseHeader(&quot;Content-Disposition&quot;);if(v==&quot;text&quot;&amp;&amp;Ext.isEmpty(B)){SitoolsDesk.addDesktopWindow(l,e,g)}else{var u=Ext.getCmp(&quot;tempMifDownload&quot;);if(Ext.isEmpty(u)){u=new Ext.ux.ManagedIFrame.Panel({layout:&quot;fit&quot;,defaultSrc:b,autoScroll:true,renderTo:Ext.getBody(),id:&quot;tempMifDownload&quot;})}else{u.setSrc(b)}}},failure:alertFailure});break;case&quot;DOWNLOAD&quot;:var d=Ext.getCmp(&quot;tempMifDownload&quot;);if(Ext.isEmpty(d)){d=new Ext.ux.ManagedIFrame.Panel({layout:&quot;fit&quot;,defaultSrc:b,autoScroll:true,renderTo:Ext.getBody(),id:&quot;tempMifDownload&quot;})}else{d.setSrc(b)}break}return}else{this._executeRequestForResource(b,a)}},_executeRequestForResource:function(b,e,d){var a={method:e,url:b,scope:this,success:function(l,n){var m=Ext.decode(l.responseText);if(!m.success){Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:m.message,width:300,buttons:Ext.MessageBox.OK});return}var k=m.TaskModel;if(!Ext.isEmpty(k.urlResult)){window.open(k.urlResult)}else{var g=new sitools.user.component.dataviews.goToTaskWindow({task:k});g.show()}},failure:function(g,k){Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:g.responseText,width:300,buttons:Ext.MessageBox.OK})},callback:function(){if(Ext.getBody().isMasked()){Ext.getBody().unmask()}}};if(!Ext.isEmpty(d)){Ext.apply(a,d)}Ext.Ajax.request(a)},checkResourceParameters:function(g,a,e,b,q){var p=true;var u=this.getParameterFromName(q,&quot;too_many_selected_threshold&quot;);var l;if(!Ext.isEmpty(u)){var n,t;l=(Ext.isEmpty(this.getNbRowsSelected())||this.getNbRowsSelected()===0)?this.getNbGridRecords():this.getNbRowsSelected();if(!Ext.isEmpty(u.value)&amp;&amp;u.value!=-1&amp;&amp;l&gt;u.value){n=this.getParameterFromName(q,&quot;too_many_selected_threshold_text&quot;);t=i18n.get(&quot;label.defaultMaxThresholdText&quot;);if(!Ext.isEmpty(n)){t=n.value}Ext.Msg.alert(i18n.get(&quot;label.error&quot;),t);return}}var m=this.getParameterFromName(q,&quot;max_warning_threshold&quot;);if(!Ext.isEmpty(m)){l=(Ext.isEmpty(this.getNbRowsSelected())||this.getNbRowsSelected()===0)?this.getNbGridRecords():this.getNbRowsSelected();if(!Ext.isEmpty(m.value)&amp;&amp;m.value!=-1&amp;&amp;l&gt;m.value){var k=this.getParameterFromName(q,&quot;max_warning_threshold_text&quot;);var d=i18n.get(&quot;label.defaultWarningThresholdText&quot;);if(!Ext.isEmpty(k)){d=k.value}Ext.Msg.show({title:i18n.get(&quot;label.warning&quot;),buttons:Ext.Msg.YESNO,msg:d,scope:this,fn:function(v,z){if(v==&quot;yes&quot;){this.handleResourceClick(g,a,e,b,q)}}});return}}this.handleResourceClick(g,a,e,b,q)},getParameterFromName:function(e,d){var a=null;for(var b=0;b&lt;e.length&amp;&amp;a===null;b++){if(e[b].name==d){a=e[b]}}return a}});Ext.namespace(&quot;sitools.user.component.dataviews.livegrid&quot;);Ext.override(Ext.ux.grid.livegrid.Store,{multiSort:function(b,a){this.hasMultiSort=true;a=a||&quot;ASC&quot;;if(this.multiSortInfo&amp;&amp;a==this.multiSortInfo.direction){a=a.toggle(&quot;ASC&quot;,&quot;DESC&quot;)}this.multiSortInfo={sorters:b,direction:a};if(this.remoteSort){this.load(this.lastOptions)}else{this.applySort();this.fireEvent(&quot;datachanged&quot;,this)}},getSortState:function(){return this.hasMultiSort?this.multiSortInfo:this.sortInfo},load:function(d){d=Ext.apply({},d);this.storeOptions(d);if((this.sortInfo||this.multiSortInfo)&amp;&amp;this.remoteSort){var b=this.paramNames;d.params=Ext.apply({},d.params);this.isInSort=true;var a=b.sort;if(this.hasMultiSort){d.params[b.sort]=Ext.encode({ordersList:this.multiSortInfo.sorters})}else{d.params[b.sort]=Ext.encode({ordersList:[this.sortInfo]})}}try{return this.execute(&quot;read&quot;,null,d)}catch(g){this.handleException(g);return false}}});sitools.user.component.dataviews.livegrid.StoreLiveGrid=function(e){if(Ext.isEmpty(e)){return false}var d;if(!Ext.isEmpty(e.userPreference)&amp;&amp;e.userPreference.datasetView==&quot;Ext.ux.livegrid&quot;&amp;&amp;!Ext.isEmpty(e.userPreference.colModel)){d=Ext.applyIf(e.userPreference.colModel,e.datasetCm)}else{d=e.datasetCm}var a=getColumnModel(d);var k=this.getFields(e.datasetCm);var b=this.getPrimaryKey(e.datasetCm);var m=new Ext.ux.grid.livegrid.JsonReader({idProperty:b,root:&quot;data&quot;,versionProperty:&quot;version&quot;,totalProperty:&quot;total&quot;},k);var l;if(this.userPreference){d=extColModelToSrv(a);l={colModel:Ext.util.JSON.encode(d)}}else{l={}}var g=0;this.formParams={};if(!Ext.isEmpty(e.formParams)){Ext.each(e.formParams,function(n){this.formParams[&quot;p[&quot;+g+&quot;]&quot;]=n;g+=1},this);Ext.apply(l,this.formParams)}g=0;if(!Ext.isEmpty(e.formMultiDsParams)){Ext.each(e.formMultiDsParams,function(n){this.formParams[&quot;c[&quot;+g+&quot;]&quot;]=n;g+=1},this);Ext.apply(l,this.formParams)}Ext.apply(e,{autoLoad:true,bufferSize:DEFAULT_LIVEGRID_BUFFER_SIZE,restful:true,reader:m,url:e.urlRecords,dataUrl:e.sitoolsAttachementForUsers,baseParams:l,listeners:{scope:this,exception:function(z,t,u,q,p,n){this.mainView.ownerCt.minimize();var v=this.mainView.ownerCt;Ext.Msg.show({title:i18n.get(&quot;label.error&quot;),msg:p.responseText,buttons:Ext.Msg.OK,fn:function(){v.close()}})}}});sitools.user.component.dataviews.livegrid.StoreLiveGrid.superclass.constructor.call(this,e)};Ext.extend(sitools.user.component.dataviews.livegrid.StoreLiveGrid,Ext.ux.grid.livegrid.Store,{getFields:function(d){var a=[];var b=0;if(!Ext.isEmpty(d)){Ext.each(d,function(g,e,k){a[b]=new Ext.data.Field({name:g.columnAlias,primaryKey:g.primaryKey,type:sql2ext.get(g.sqlColumnType)});if(sql2ext.get(g.sqlColumnType)==&quot;boolean&quot;){Ext.apply(a[b],{convert:function(m,l){if(m==&quot;f&quot;||m==&quot;false&quot;||m===0){return 0}if(m==&quot;t&quot;||m==&quot;true&quot;||m==1){return 1}return m}})}b++},this)}return a},getPrimaryKey:function(d){var b=0,a=&quot;&quot;;if(!Ext.isEmpty(d)){Ext.each(d,function(g,e,k){if(!Ext.isEmpty(g.primaryKey)){if(g.primaryKey){a=g.columnAlias}}},this)}return a},getFormParams:function(){return this.formParams},paramValueToApi:function(b){var a=b.type+&quot;|&quot;+b.code+&quot;|&quot;+b.value;if(!Ext.isEmpty(b.userDimension)&amp;&amp;!Ext.isEmpty(b.userUnit)){a+=&quot;|&quot;+b.userDimension+&quot;|&quot;+b.userUnit.unitName}return a}});Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.columnsDefinition=function(e){this.datasetName=e.datasetName;this.dictionaryMappings=e.dictionaryMappings[0];this.datasetCm=e.datasetCm;var b=[{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;unit&quot;,type:&quot;string&quot;}];var k=[{header:i18n.get(&quot;label.columnAlias&quot;),dataIndex:&quot;columnAlias&quot;,width:100,sortable:true},{header:i18n.get(&quot;label.unit&quot;),dataIndex:&quot;unit&quot;,width:100,sortable:true}];if(!Ext.isEmpty(this.dictionaryMappings)&amp;&amp;!Ext.isEmpty(this.dictionaryMappings.mapping)&amp;&amp;!Ext.isEmpty(this.dictionaryMappings.mapping[0])){var d=this.dictionaryMappings.mapping[0].concept;k.push({header:i18n.get(&quot;headers.name&quot;),dataIndex:&quot;name&quot;,width:100});k.push({header:i18n.get(&quot;headers.description&quot;),dataIndex:&quot;description&quot;,width:120});b.push({name:&quot;name&quot;,type:&quot;string&quot;});b.push({name:&quot;description&quot;,type:&quot;string&quot;});for(var g=0;g&lt;d.properties.length;g++){var l=d.properties[g];k.push({header:l.name,dataIndex:l.name,width:80});b.push({name:l.name,type:&quot;string&quot;})}}var a=new Ext.data.JsonReader({fields:b,idProperty:&quot;columnAlias&quot;});this.grid=new Ext.grid.GridPanel({store:new Ext.data.GroupingStore({idProperty:&quot;id&quot;,fields:b,autoload:false,groupField:false,reader:a,sortInfo:{field:&quot;columnAlias&quot;,direction:&quot;ASC&quot;},remoteSort:false}),cm:new Ext.grid.ColumnModel({columns:k}),view:new Ext.grid.GroupingView({groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length &gt; 1 ? &quot;Items&quot; : &quot;Item&quot;]})',autoFill:true}),tbar:{xtype:&quot;toolbar&quot;,defaults:{scope:this,xtype:&quot;s-menuButton&quot;},items:[{text:i18n.get(&quot;label.toggleGroup&quot;),icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/toggle_group.png&quot;,handler:this.toggleGroup}]},layout:&quot;fit&quot;});this.layout=&quot;fit&quot;;this.items=[this.grid];sitools.user.component.columnsDefinition.superclass.constructor.call(this)};Ext.extend(sitools.user.component.columnsDefinition,Ext.Panel,{componentType:&quot;defi&quot;,_getSettings:function(){var a=[];return(extColModelToJsonColModel(this.grid.getColumnModel().config))},onRender:function(){sitools.user.component.columnsDefinition.superclass.onRender.apply(this,arguments);var b=this.grid.getStore();var d,a;Ext.each(this.datasetCm,function(e){d=this.getConcepts(e);if(!Ext.isEmpty(d)){Ext.each(d,function(l){var n={columnAlias:e.columnAlias,unit:e.unit&amp;&amp;e.unit.label};n=Ext.apply(n,{id:l.id,name:l.name,description:l.description});for(var k=0;k&lt;l.properties.length;k++){var m=l.properties[k];n[m.name]=m.value}a=new Ext.data.Record(n);b.add(a)})}else{var g={columnAlias:e.columnAlias};a=new Ext.data.Record(g);b.add(a)}},this)},getConcepts:function(d){if(Ext.isEmpty(this.dictionaryMappings)){return}var a=this.dictionaryMappings.mapping;var e=[],g;for(var b=0;b&lt;a.length;b++){g=a[b];if(d.columnAlias==g.columnAlias){e.push(g.concept)}}return e},toggleGroup:function(){var a=this.grid.getStore();if(a.groupField===false){a.groupBy(&quot;columnAlias&quot;);var b=this.grid.getColumnModel().findColumnIndex(&quot;columnAlias&quot;);this.grid.getColumnModel().setHidden(b,true);this.grid.getView().enableGrouping=true;this.grid.getView().refresh()}else{a.clearGrouping();this.grid.getColumnModel().setHidden(0,false)}}});Ext.reg(&quot;sitools.user.component.columnsDefinition&quot;,sitools.user.component.columnsDefinition);Ext.namespace(&quot;sitools.user.component.dataviews&quot;);sitools.user.component.dataviews.resourcePluginParamsWindow=Ext.extend(Ext.Window,{modal:true,width:&quot;450&quot;,showMethod:false,defaultMethod:&quot;&quot;,showRunType:false,initComponent:function(){this.title=i18n.get(&quot;label.resourceReqParam&quot;);var e=this.methods.split(&quot;|&quot;);this.showMethod=e.length&gt;1;this.defaultMethod=e[0];this.methodsStore=new Ext.data.ArrayStore({fields:[&quot;method&quot;],idIndex:0});Ext.each(e,function(k,g){this.methodsStore.add(new Ext.data.Record({method:k}))},this);var d=[];var b=new Ext.form.ComboBox({xtype:&quot;combo&quot;,mode:&quot;local&quot;,triggerAction:&quot;all&quot;,editable:false,name:&quot;method&quot;,fieldLabel:i18n.get(&quot;label.method&quot;),width:100,store:this.methodsStore,valueField:&quot;method&quot;,displayField:&quot;method&quot;,anchor:&quot;100%&quot;,value:this.defaultMethod,forceSelection:true});this.items=[];if(this.showMethod){d.push(b);this.formParams=new Ext.form.FormPanel({padding:5,items:[{xtype:&quot;fieldset&quot;,title:i18n.get(&quot;label.commonParameters&quot;),items:d}]});this.items.push(this.formParams)}var a=[];Ext.each(this.resource.parameters,function(l,g){if(l.type==&quot;PARAMETER_USER_INPUT&quot;&amp;&amp;l.userUpdatable){var k=this.buildFormItemFromParam(l);a.push(k);if(l.name==&quot;runTypeUserInput&quot;){this.showRunType=true}}},this);if(!Ext.isEmpty(a)){this.formParamsUserInput=new Ext.form.FormPanel({padding:5,labelWidth:150,items:{xtype:&quot;fieldset&quot;,title:i18n.get(&quot;label.specificParameter&quot;),items:a}});this.items.push(this.formParamsUserInput)}this.buttons=[{text:i18n.get(&quot;label.submit&quot;),scope:this,handler:this.onCall},{text:i18n.get(&quot;label.cancel&quot;),scope:this,handler:function(){this.close()}}];sitools.user.component.dataviews.resourcePluginParamsWindow.superclass.initComponent.call(this)},onCall:function(){var k;if(this.showMethod){var e=this.formParams.getForm();k=e.findField(&quot;method&quot;).getValue()}else{k=this.defaultMethod}var b;if(this.showRunType){b=this.formParamsUserInput.getForm().findField(&quot;runTypeUserInput&quot;).getValue()}else{b=this.runType}var a;var g={};if(!Ext.isEmpty(this.formParamsUserInput)){var d=this.formParamsUserInput.getForm();Ext.iterate(d.getValues(),function(l,m){g[l]=m})}this.contextMenu.onResourceCallClick(this.resource,this.url,k,b,a,g);this.close()},buildFormItemFromParam:function(m,b){var d=m.valueType;var n={};if(d.indexOf(&quot;xs:boolean&quot;)!=-1){d=&quot;xs:enum[true,false]&quot;}if(d.indexOf(&quot;xs:enum&quot;)!=-1){var a=d.split(&quot;[&quot;);a=a[1].split(&quot;]&quot;);a=a[0].split(&quot;,&quot;);var p=false;if(d.indexOf(&quot;xs:enum-multiple&quot;)&gt;=0||d.indexOf(&quot;xs:enum-editable-multiple&quot;)&gt;=0){p=true}var k=[];for(var g=0;g&lt;a.length;g++){var e=a[g].trim();k.push([e,e])}var l=new Ext.data.ArrayStore({fields:[&quot;value&quot;,&quot;text&quot;],data:k,valueField:&quot;value&quot;,displayField:&quot;text&quot;});if(p){n={store:l,name:m.name,xtype:&quot;multiselect&quot;,values:m.value,delimiter:&quot;|&quot;,fieldLabel:m.name,width:235,tooltip:m.description}}else{n={store:l,name:m.name,xtype:&quot;combo&quot;,value:m.value,valueField:&quot;value&quot;,displayField:&quot;text&quot;,mode:&quot;local&quot;,fieldLabel:m.name,triggerAction:&quot;all&quot;,selectOnFocus:true,editable:false,anchor:&quot;100%&quot;,tooltip:m.description}}}else{n={name:m.name,xtype:&quot;textfield&quot;,value:m.value,fieldLabel:m.name,anchor:&quot;100%&quot;,tooltip:m.description}}return n}});Ext.namespace(&quot;sitools.user.component.dataviews&quot;);sitools.user.component.dataviews.goToTaskWindow=Ext.extend(Ext.Window,{width:&quot;500&quot;,buttonAlign:&quot;left&quot;,initComponent:function(){this.title=i18n.get(&quot;label.info&quot;);this.mainPanel=this.createNewFormComponent(this.task);this.buttons=[&quot;-&gt;&quot;,{text:i18n.get(&quot;label.goToTask&quot;),scope:this,handler:this.goToTask},{text:i18n.get(&quot;label.close&quot;),scope:this,handler:function(){this.close()}}];this.items=[this.mainPanel];sitools.user.component.dataviews.goToTaskWindow.superclass.initComponent.call(this)},refreshTask:function(){var a=this.task.statusUrl;Ext.Ajax.request({url:a,method:&quot;GET&quot;,scope:this,success:function(b){var d=Ext.decode(b.responseText);if(!d.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),d.message);return false}this.task=d.TaskModel;this.mainPanel=this.createNewFormComponent(this.task);this.removeAll();this.add(this.mainPanel);this.doLayout()},failure:alertFailure})},createNewFormComponent:function(b){var d=String.format(i18n.get(&quot;label.taskLaunched&quot;),b.status);d+=String.format(&quot;&lt;a href='#'&gt;{0}&lt;/a&gt;&lt;br&gt;&quot;,i18n.get(&quot;label.detail&quot;));if(!Ext.isEmpty(b.urlResult)){d+=&quot;&lt;br&gt;&quot;+String.format(i18n.get(&quot;label.taskResult&quot;),b.urlResult);d+=String.format(&quot;&lt;a href='#'&gt;{0}&lt;/a&gt;&lt;br&gt;&quot;,i18n.get(&quot;label.result&quot;))}else{d+=&quot;&lt;br&gt;&quot;+i18n.get(&quot;label.refreshTaskWindow&quot;);d+=String.format(&quot;&lt;a href='#'&gt;{0}&lt;/a&gt;&lt;br&gt;&quot;,i18n.get(&quot;label.refresh&quot;))}var a=new Ext.Panel({padding:5,layout:&quot;fit&quot;,html:d,listeners:{scope:this,afterrender:function(e){e.getEl().child(&quot;a&quot;).on(&quot;click&quot;,function(){this.showTaskDetail(b)},this);var g=e.getEl().child(&quot;a&quot;).next(&quot;a&quot;);if(!Ext.isEmpty(b.urlResult)){g.on(&quot;click&quot;,function(){this.showTaskResults(b)},this)}else{g.on(&quot;click&quot;,function(){this.refreshTask()},this)}}}});return a},goToTask:function(){this.close();var a=SitoolsDesk.app.findModule(&quot;EspacePersonnel&quot;);if(!Ext.isEmpty(a.getWindow())){a.getWindow().close()}a.createWindow({activePanel:&quot;taskResource&quot;})},_showOrderDetails:function(a){Ext.Ajax.request({url:a,method:&quot;GET&quot;,scope:this,success:function(e){var g=Ext.decode(e.responseText);if(!g.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),g.message);return false}var m=new Ext.data.Record(g.order);var l=sitools.user.modules.userSpaceDependencies.orderProp;var d={action:&quot;detail&quot;,orderRec:m};var k=i18n.get(&quot;label.details&quot;)+&quot; : &quot;;k+=m.data.userId;k+=&quot; &quot;+i18n.get(&quot;label.the&quot;);k+=&quot; &quot;+m.data.dateOrder;var b={id:&quot;showDataDetailId&quot;,title:k,specificType:&quot;dataDetail&quot;};SitoolsDesk.addDesktopWindow(b,d,l)},failure:alertFailure})},_showDatasetDetails:function(url){var urlDataset=url.substring(0,url.indexOf(&quot;/records&quot;));Ext.Ajax.request({url:urlDataset,method:&quot;GET&quot;,scope:this,success:function(ret){var data=Ext.decode(ret.responseText);if(!data.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),data.message);return false}var dataset=new Ext.data.Record(data.dataset).data;var windowConfig={title:i18n.get(&quot;label.dataTitle&quot;)+&quot; : &quot;+dataset.name,datasetName:dataset.name,datasetDescription:dataset.description,type:&quot;data&quot;,saveToolbar:true,toolbarItems:[]};var javascriptObject=eval(dataset.datasetView.jsObject);Ext.apply(windowConfig,{id:&quot;data&quot;+dataset.datasetId});var componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings,datasetViewConfig:dataset.datasetViewConfig};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject)},failure:alertFailure})},showTaskDetail:function(b){var e=sitools.user.modules.userSpaceDependencies.svaTasksDetails;var d={sva:b};var a={id:&quot;taskStatusDetails&quot;,title:i18n.get(&quot;label.taskDetails&quot;)+&quot;:&quot;+b.id};SitoolsDesk.addDesktopWindow(a,d,e)},showTaskResults:function(a){var b=loadUrl.get(&quot;APP_URL&quot;)+loadUrl.get(&quot;APP_ORDERS_USER_URL&quot;);if(a.urlResult.indexOf(b)!=-1){this._showOrderDetails(a.urlResult)}else{if(a.urlResult.indexOf(&quot;/records&quot;)!=-1){this._showDatasetDetails(a.urlResult)}else{window.open(a.urlResult)}}}});Ext.namespace(&quot;sitools.user.modules.userSpaceDependencies&quot;);sitools.user.modules.userSpaceDependencies.tasksDetails=Ext.extend(Ext.FormPanel,{labelWidth:120,frame:true,autoScroll:true,initComponent:function(){var a=[];Ext.iterate(this.sva,function(b,d){a.push({xtype:&quot;textfield&quot;,name:b,fieldLabel:i18n.get(&quot;label.&quot;+b),anchor:&quot;100%&quot;,value:d})});this.items=a;sitools.user.modules.userSpaceDependencies.tasksDetails.superclass.initComponent.call(this)},_getSettings:function(){return null}});Ext.namespace(&quot;sitools.user.component.dataviews.tplView&quot;);sitools.user.component.dataviews.tplView.dataViewPagingToolbar=Ext.extend(Ext.PagingToolbar,{doLoad:function(l){var k=this.store.lastOptions||{};var g=k.params,b=this.getParams();g[b.start]=l;g[b.limit]=this.pageSize;if(this.fireEvent(&quot;beforechange&quot;,this,g)!==false){this.store.load({params:g})}var a=Ext.getCmp(&quot;plot&quot;+this.ownerCt.datasetId);if(a){var d=a.findById(&quot;plot-right-panel&quot;);var e=d.fireEvent(&quot;buffer&quot;,this.store)}}});Ext.namespace(&quot;sitools.user.component.dataviews.tplView&quot;);sitools.user.component.dataviews.tplView.StoreTplView=Ext.extend(sitools.user.component.dataviews.livegrid.StoreLiveGrid,{paramPrefix:&quot;filter&quot;,getAt:function(a){return this.data.itemAt(a)},buildQuery:function(b){if(Ext.isEmpty(b)){return}var a={},d,l,m,g,n,e,k=b.length;for(d=0;d&lt;k;d++){l=b[d];m=[this.paramPrefix,&quot;[&quot;,d,&quot;]&quot;].join(&quot;&quot;);a[m+&quot;[columnAlias]&quot;]=l.columnAlias;g=m+&quot;[data]&quot;;for(n in l.data){a[[g,&quot;[&quot;,n,&quot;]&quot;].join(&quot;&quot;)]=l.data[n]}}return a}});Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.formComponentsPanel=Ext.extend(Ext.Panel,{initComponent:function(){Ext.apply(this,{id:&quot;panelResultForm&quot;+this.formId,bodyCssClass:this.css,height:this.height,width:this.width,layout:&quot;absolute&quot;,labelWidth:100,padding:10,items:[],parameters:[]});this.addEvents(&quot;componentChanged&quot;);this.on(&quot;componentChanged&quot;,function(d,a){var b=d.find(&quot;parentParam&quot;,a.parameterId);Ext.each(b,function(g){if(g.valueSelection==&quot;D&quot;){var e=g.find(&quot;stype&quot;,&quot;sitoolsFormItem&quot;)[0].store;var l=e.baseParams;if(!Ext.isEmpty(a.getSelectedValue())){var k=a.getParameterValue();l[&quot;p[0]&quot;]=this.paramToAPI(k)}else{l[&quot;p[0]&quot;]=null}e.baseParams=l;g.setSelectedValue(null);e.reload({callback:function(){d.fireEvent(&quot;componentChanged&quot;,d,g)}})}},this)});this.listeners={scope:this,afterrender:function(){var d=this.getSize();var b=this.ownerCt.ownerCt.body.getSize();var a=0,e=0;if(b.height&gt;d.height){e=(b.height-d.height)/2}if(b.width&gt;d.width){a=(b.width-d.width)/2}this.setPosition(a,e)}};sitools.user.component.formComponentsPanel.superclass.initComponent.apply(this,arguments)},loadParameters:function(b,d,a){Ext.each(b,function(m){var l=Ext.isEmpty(m.ypos)?l+50:m.ypos;var e=Ext.isEmpty(m.xpos)?e:m.xpos;var k=[sitools.common.forms.formParameterToComponent(m,d,this.formId,this.datasetCm,a).component];var g=new Ext.Container({width:m.width,height:m.height,x:e,y:l,bodyCssClass:&quot;noborder&quot;,cls:m.css,items:k});this.add(g)},this)},paramToAPI:function(b){var a=b.type+&quot;|&quot;+b.code+&quot;|&quot;+b.value;if(!Ext.isEmpty(b.userDimension)&amp;&amp;!Ext.isEmpty(b.userUnit)){a+=&quot;|&quot;+b.userDimension+&quot;|&quot;+b.userUnit.unitName}return a}});Ext.reg(&quot;sitools.user.component.formComponentsPanel&quot;,sitools.user.component.formComponentsPanel);Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.forms=function(a){Ext.apply(this,a);this.componentType=&quot;form&quot;;this.componentList=new sitools.user.component.formComponentsPanel({width:a.formWidth,height:a.formHeight,css:a.formCss,formId:a.formId});if(Ext.isEmpty(a.dataset)){Ext.Ajax.request({url:a.dataUrl,method:&quot;GET&quot;,scope:this,success:function(b){if(showResponse(b)){var d=Ext.decode(b.responseText);this.componentList.datasetCm=d.dataset.columnModel;this.componentList.loadParameters(a.formParameters,a.dataUrl,&quot;dataset&quot;);this.datasetId=d.dataset.id;this.datasetName=d.dataset.name;this.datasetCm=d.dataset.columnModel;this.datasetView=d.dataset.datasetView;this.dictionaryMappings=d.dataset.dictionaryMappings}}})}else{this.componentList.datasetCm=a.dataset.columnModel;this.componentList.loadParameters(a.formParameters,a.dataUrl,&quot;dataset&quot;);this.datasetId=a.dataset.id;this.datasetName=a.dataset.name;this.datasetCm=a.dataset.columnModel;this.datasetView=a.dataset.datasetView;this.dictionaryMappings=a.dataset.dictionaryMappings}sitools.user.component.forms.superclass.constructor.call(this,Ext.apply({height:a.formHeight,width:a.formWidth,autoScroll:true,items:[this.componentList],layout:&quot;absolute&quot;,buttons:[{text:i18n.get(&quot;label.search&quot;),scope:this,handler:function(){this.onSearch(a)}}],listeners:{scope:this,resize:function(){if(!Ext.isEmpty(this.componentList.getEl())){var e=this.componentList.getSize();var d=this.body.getSize();var b=0,g=0;if(d.height&gt;e.height){g=(d.height-e.height)/2}if(d.width&gt;e.width){b=(d.width-e.width)/2}this.componentList.setPosition(b,g)}}}}))};Ext.extend(sitools.user.component.forms,Ext.Panel,{onSearch:function(a){Ext.Ajax.request({url:a.dataUrl,method:&quot;GET&quot;,scope:this,success:function(d){var b=Ext.decode(d.responseText);if(!b.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),b.message);return}else{var e=b.dataset;this.doSearch(a,e)}},failure:alertFailure})},doSearch:function(config,dataset){var containers=this.find(&quot;stype&quot;,&quot;sitoolsFormContainer&quot;);var formParams=[];var glue=&quot;&quot;;var i=0;Ext.each(containers,function(container){if(Ext.isFunction(container.getParameterValue)){var param=container.getParameterValue();if(!Ext.isEmpty(param)){formParams.push(this.paramValueToApi(param))}}},this);var desktop=getDesktop();var win=desktop.getWindow(&quot;windResultForm&quot;+config.formId);if(win){win.close()}var jsObj=eval(dataset.datasetView.jsObject);var componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,formParams:formParams,dictionaryMappings:dataset.dictionaryMappings,datasetViewConfig:dataset.datasetViewConfig};var AppUserStorage=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var windowConfig={id:&quot;windResultForm&quot;+config.formId,title:i18n.get(&quot;label.dataTitle&quot;)+&quot; : &quot;+dataset.name,datasetName:dataset.name,type:&quot;data&quot;,saveToolbar:true,urlPreferences:loadUrl.get(&quot;APP_URL&quot;)+AppUserStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+dataset.name+&quot;/data&quot;};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,jsObj)},_getSettings:function(){return{dataUrl:this.dataUrl,datasetId:this.datasetId,datasetName:this.datasetName,datasetCm:this.datasetCm,formId:this.formId,formName:this.formName,formParameters:this.formParameters,formWidth:this.formWidth,formHeight:this.formHeight,formCss:this.formCss,datasetView:this.datasetView,dictionaryMappings:this.dictionaryMappings}},paramValueToApi:function(b){var a=b.type+&quot;|&quot;+b.code+&quot;|&quot;+b.value;if(!Ext.isEmpty(b.userDimension)&amp;&amp;!Ext.isEmpty(b.userUnit)){a+=&quot;|&quot;+b.userDimension+&quot;|&quot;+b.userUnit.unitName}return a}});Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.datasetOpensearch=function(k){var g=k.dataUrl+&quot;/opensearch/search&quot;;var m=k.dataUrl+&quot;/opensearch/suggest&quot;;function b(){var v=d.getForm().getValues().searchQuery;t.updateStore(g+&quot;?q=&quot;+v)}var u;var e=new Ext.data.JsonStore({url:m,restful:true,root:&quot;data&quot;,fields:[{name:&quot;field&quot;,type:&quot;string&quot;},{name:&quot;name&quot;,type:&quot;string&quot;},{name:&quot;nb&quot;,type:&quot;string&quot;}]});var l=new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;search-item&quot;&gt;',&quot;&lt;h3&gt;{name}&lt;span&gt; ({field} / {nb} results ) &lt;/span&gt;&lt;/h3&gt;&quot;,&quot;&lt;/div&gt;&lt;/tpl&gt;&quot;);u=new Ext.form.ComboBox({store:e,displayField:&quot;name&quot;,typeAhead:false,loadingText:i18n.get(&quot;label.searching&quot;),hideTrigger:true,name:&quot;searchQuery&quot;,anchor:&quot;90%&quot;,tpl:l,itemSelector:&quot;div.search-item&quot;,minChars:2,queryParam:&quot;q&quot;,enableKeyEvents:true,scope:this,listeners:{scope:this,beforequery:function(v){if(v.query.indexOf(&quot; &quot;)==-1){return true}else{return false}},specialkey:function(z,v){if(v.getKey()==v.ENTER){b()}},beforeselect:function(z,v,A){var B=v.data.name.split(&quot;:&quot;);if(B.length&gt;1){v.data.name=B[1]}v.data.name=v.data.field+&quot;:&quot;+v.data.name;return true}}});var p=new Ext.Button({icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/help.png&quot;,scope:this,handler:function(){var v=SitoolsDesk.app.findModule(&quot;helpWindow&quot;);if(!Ext.isEmpty(v.getWindow())){v.getWindow().close()}v.createWindow({activeNode:&quot;Recherche_OpenSearch&quot;})},width:20});var q=new Ext.form.CompositeField({fieldLabel:i18n.get(&quot;label.search&quot;),anchor:&quot;100%&quot;,defaults:{flex:1},items:[u,p]});var n=q;var a=[{text:i18n.get(&quot;label.search&quot;),scope:this,handler:b}];var d=new Ext.FormPanel({labelWidth:75,height:75,frame:true,defaultType:&quot;textfield&quot;,items:n,buttons:a});var t=new sitools.user.component.openSearchResultFeed({input:u,dataUrl:k.dataUrl,pagging:true,datasetName:k.datasetName,datasetId:k.datasetId,exceptionHttpHandler:function(B,C,D,A,v,z){if((v.status==403)&amp;&amp;!Ext.isEmpty(Ext.util.Cookies.get(&quot;hashCode&quot;))){Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get(&quot;label.session.expired&quot;),v.responseText);return false}return true}});sitools.user.component.datasetOpensearch.superclass.constructor.call(this,Ext.apply({items:[d,t],layout:&quot;vbox&quot;,layoutConfig:{align:&quot;stretch&quot;,pack:&quot;start&quot;}},k))};Ext.extend(sitools.user.component.datasetOpensearch,Ext.Panel,{componentType:&quot;openSearch&quot;,_getSettings:function(){return[]}});Ext.reg(&quot;sitools.user.component.datasetOpensearch&quot;,sitools.user.component.datasetOpensearch);Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.openSearchResultFeed=function(e){this.pageSize=10;var b=e.urlFeed;this.input=e.input;this.uriRecords=e.dataUrl+&quot;/records&quot;;var l=e.pagging;var d=(b===undefined)?&quot;/tmp&quot;:b;var a=(Ext.isEmpty(e.exceptionHttpHandler))?onRequestFeedException:e.exceptionHttpHandler;this.httpProxy=new Ext.data.HttpProxy({url:d,restful:true,listeners:{scope:this,exception:a}});this.xmlReader=new sitools.component.users.datasets.XmlReader({record:&quot;item&quot;,totalProperty:&quot;opensearch:totalResults&quot;},[&quot;title&quot;,&quot;link&quot;,&quot;guid&quot;,&quot;pubDate&quot;,&quot;description&quot;]);this.store=new Ext.data.Store({proxy:this.httpProxy,reader:this.xmlReader,autoLoad:e.autoLoad,paramNames:{start:&quot;start&quot;,limit:&quot;rows&quot;},listeners:{scope:this,load:function(n,m,p){if(m.length&gt;1){if(Ext.isEmpty(m[0].data.pubDate)){this.getColumnModel().setHidden(1,true)}else{this.getColumnModel().setHidden(1,false)}}if(!l&amp;&amp;!Ext.isEmpty(this.displayNbResults)){this.displayNbResults.setText(&quot;Total number of results : &quot;+this.store.getTotalCount())}return true},exception:function(q,t,v,p,n,m){var u=Ext.decode(n.responseText);if(!u.success){this.input.markInvalid(i18n.get(u.message));this.store.removeAll()}return true}}});this.store.setDefaultSort(&quot;pubDate&quot;,&quot;DESC&quot;);var g=[{id:&quot;title&quot;,header:&quot;Title&quot;,dataIndex:&quot;title&quot;,sortable:true,renderer:this.formatTitle},{id:&quot;last&quot;,header:&quot;Date&quot;,dataIndex:&quot;pubDate&quot;,sortable:true}];if(l){this.bbar={xtype:&quot;paging&quot;,pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get(&quot;paging.display&quot;),emptyMsg:i18n.get(&quot;paging.empty&quot;),totalProperty:&quot;totalCount&quot;}}else{this.displayNbResults=new Ext.form.Label({text:&quot;Total number of results : &quot;});this.bbar={items:[&quot;-&gt;&quot;,this.displayNbResults]}}function k(C,z,u){u.stopEvent();var q=C.store.getAt(z);var v=q.get(&quot;guid&quot;);if(Ext.isEmpty(v)){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),i18n.get(&quot;warning.noGuidFieldDefined&quot;)+&quot;&lt;br/&gt;&quot;+i18n.get(&quot;warning.noPrimaryKeyDefinedOSNotice&quot;));return}if(Ext.isEmpty(window)||Ext.isEmpty(window.SitoolsDesk)){var A=new sitools.user.component.simpleViewDataDetail({fromWhere:&quot;openSearch&quot;,urlDataDetail:v});var t=new Ext.Window({stateful:false,title:i18n.get(&quot;label.viewDataDetail&quot;),width:400,height:600,shim:false,animCollapse:false,constrainHeader:true,layout:&quot;fit&quot;});t.add(A);t.show()}else{var n={grid:this,fromWhere:&quot;openSearch&quot;,datasetId:e.datasetId,datasetUrl:e.dataUrl,datasetName:e.datasetName};var m=sitools.user.component.viewDataDetail;var B=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var p={id:&quot;dataDetail&quot;+e.datasetId,title:i18n.get(&quot;label.viewDataDetail&quot;)+&quot; : &quot;+e.datasetName,datasetName:e.datasetName,saveToolbar:true,urlPreferences:loadUrl.get(&quot;APP_URL&quot;)+B+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+e.datasetName+&quot;/dataDetail&quot;,type:&quot;dataDetail&quot;,toolbarItems:[{icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-left.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goPrevious()}},{icon:loadUrl.get(&quot;APP_URL&quot;)+&quot;/common/res/images/icons/simple-arrow-right.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goNext()}}]};SitoolsDesk.addDesktopWindow(p,n,m,true)}}sitools.user.component.openSearchResultFeed.superclass.constructor.call(this,{columns:g,layout:&quot;fit&quot;,flex:1,store:this.store,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:&quot;title&quot;,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},listeners:{rowdblclick:k}});this.updateStore=function(m){this.httpProxy.setUrl(m,true);this.store.load()}};Ext.extend(sitools.user.component.openSearchResultFeed,Ext.grid.GridPanel,{componentType:&quot;feeds&quot;,applyRowClass:function(a,g,e,d){if(this.showPreview){var b=Ext.util.Format;e.body=&quot;&lt;p class=sous-titre-flux&gt;&quot;+b.ellipsis(b.stripTags(a.data.description),200)+&quot;&lt;/p&gt;&quot;;return&quot;x-grid3-row-expanded&quot;}return&quot;x-grid3-row-collapsed&quot;},formatDate:function(b){if(!b){return&quot;&quot;}var a=new Date();var g=a.clearTime(true);var e=b.clearTime(true).getTime();if(e==g.getTime()){return&quot;Today &quot;+b.dateFormat(&quot;g:i a&quot;)}g=g.add(&quot;d&quot;,-6);if(g.getTime()&lt;=e){return b.dateFormat(&quot;D g:i a&quot;)}return b.dateFormat(&quot;n/j g:i a&quot;)},formatTitle:function(e,g,a){var d=a.data.link;var b=(Ext.isEmpty(a.data.author))?&quot;&quot;:a.data.author;if(d!==undefined&amp;&amp;d!==&quot;&quot;){return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0}&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{1}&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{2}&lt;/span&gt;&lt;/div&gt;',d,e,b)}else{return String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{1}&lt;/span&gt;&lt;/div&gt;',e,b)}}});Ext.reg(&quot;sitools.user.component.openSearchResultFeed&quot;,sitools.user.component.openSearchResultFeed);Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.viewDataDetail=Ext.extend(Ext.Panel,{datasetColumnModel:null,initComponent:function(){var g;switch(this.fromWhere){case&quot;openSearch&quot;:this.grid=this.grid;this.recSelected=this.grid.getSelectionModel().getSelected();this.url=this.recSelected.data.guid;break;case&quot;dataView&quot;:break;case&quot;plot&quot;:break;default:this.recSelected=this.selections[0];if(Ext.isEmpty(this.recSelected)){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),i18n.get(&quot;label.noSelection&quot;));return}var e=&quot;&quot;,d=&quot;&quot;;Ext.each(this.recSelected.fields.items,function(k){if(k.primaryKey){this.primaryKeyName=k.name}},this);this.primaryKeyValue=this.recSelected.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break}this.layout=&quot;border&quot;;this.linkStore=new Ext.data.Store({fields:[&quot;name&quot;,&quot;value&quot;,&quot;image&quot;,&quot;behavior&quot;,&quot;columnRenderer&quot;]});var a=new Ext.DataView({store:this.linkStore,tpl:new Ext.XTemplate(&quot;&lt;ul&gt;&quot;,'&lt;tpl for=&quot;.&quot;&gt;','&lt;li id=&quot;{name}&quot; class=&quot;img-link&quot;','&lt;tpl if=&quot;this.hasToolTip(toolTip)&quot;&gt;','ext:qtip=&quot;{toolTip}&quot;&gt;',&quot;&lt;/tpl&gt;&quot;,'&lt;tpl if=&quot;this.hasToolTip(toolTip) == false&quot;&gt;','ext:qtip=&quot;{name}&quot;&gt;',&quot;&lt;/tpl&gt;&quot;,'&lt;img src=&quot;{image}&quot; /&gt;',&quot;&lt;/li&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/ul&gt;&quot;,{compiled:true,disableFormats:true,hasToolTip:function(k){return !Ext.isEmpty(k)}}),cls:&quot;linkImageDataView&quot;,itemSelector:&quot;li.img-link&quot;,overClass:&quot;nodes-hover&quot;,selectedClass:&quot;&quot;,singleSelect:true,multiSelect:false,autoScroll:true,listeners:{scope:this,click:this.handleClickOnLink}});this.formPanel=new Ext.FormPanel({labelAlign:&quot;top&quot;,anchor:&quot;100%&quot;,defaults:{labelStyle:&quot;font-weight:bold;&quot;}});this.linkPanel=new Ext.Panel({title:i18n.get(&quot;label.complementaryInformation&quot;),items:[a],anchor:&quot;100%&quot;});this.formPanelImg=new Ext.FormPanel({frame:true,autoScroll:true,region:&quot;east&quot;,hideLabels:true,split:(this.fromWhere!=&quot;dataView&quot;),collapsible:(this.fromWhere!=&quot;dataView&quot;),collapsed:(this.fromWhere!=&quot;dataView&quot;),flex:1,title:(this.fromWhere==&quot;dataView&quot;)?i18n.get(&quot;label.formImagePanelTitle&quot;):null});var b;if(this.fromWhere==&quot;dataView&quot;){b=[this.formPanel,this.formPanelImg,this.linkPanel]}else{b=[this.formPanel,this.linkPanel]}this.centerPanel=new Ext.Panel({autoScroll:true,frame:true,region:&quot;center&quot;,split:true,layout:{type:&quot;anchor&quot;},items:b});this.getCmDefAndbuildForm();this.componentType=&quot;dataDetail&quot;;if(this.fromWhere==&quot;dataView&quot;){this.items=[this.centerPanel]}else{this.items=[this.centerPanel,this.formPanelImg]}this.listeners={scope:this,afterrender:function(k){k.getEl().on(&quot;contextmenu&quot;,function(m,l,n){m.stopPropagation()},this)}};sitools.user.component.viewDataDetail.superclass.initComponent.call(this)},afterRender:function(){this._loadMaskAnchor=Ext.get(this.body.dom);sitools.user.component.viewDataDetail.superclass.afterRender.apply(this,arguments)},_getSettings:function(){return null},goNext:function(){if(Ext.isEmpty(this.grid)){return}var e,d;switch(this.fromWhere){case&quot;openSearch&quot;:d=this.grid.getSelectionModel();if(!d.selectNext()){return}e=d.getSelected();this.url=e.data.guid;break;case&quot;sitools.user.component.dataviews.tplView.TplView&quot;:var a=this.grid.getStore().indexOf(this.recSelected);var b=this.grid.getStore().getAt(a+1);if(Ext.isEmpty(b)){return}this.primaryKeyValue=b.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;this.recSelected=b;this.grid.select(b);break;default:d=this.grid.getSelectionModel();if(!d.selectNext()){return}e=d.getSelected();this.primaryKeyValue=e.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break}this.getCmDefAndbuildForm()},goPrevious:function(){if(Ext.isEmpty(this.grid)){return}var e,d;switch(this.fromWhere){case&quot;openSearch&quot;:d=this.grid.getSelectionModel();if(!d.selectPrevious()){return}e=d.getSelected();this.url=e.data.guid;break;case&quot;sitools.user.component.dataviews.tplView.TplView&quot;:var a=this.grid.getStore().indexOf(this.recSelected);var b=this.grid.getStore().getAt(a-1);if(Ext.isEmpty(b)){return}this.primaryKeyValue=b.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;this.recSelected=b;this.grid.select(b);break;default:d=this.grid.getSelectionModel();if(!d.selectPrevious()){return}e=d.getSelected();this.primaryKeyValue=e.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break}this.getCmDefAndbuildForm()},getCmDefAndbuildForm:function(){if(Ext.isEmpty(this.datasetColumnModel)){Ext.Ajax.request({url:this.datasetUrl,method:&quot;GET&quot;,scope:this,success:function(b){try{var a=Ext.decode(b.responseText);if(!a.success){throw a.message}this.datasetColumnModel=a.dataset.columnModel;this.buildForm()}catch(d){Ext.Msg.alert(i18n.get(&quot;label.error&quot;),d)}},failure:alertFailure})}else{this.buildForm()}},buildForm:function(){if(!Ext.isEmpty(this._loadMaskAnchor)){this._loadMaskAnchor.mask(i18n.get(&quot;label.waitMessage&quot;),&quot;x-mask-loading&quot;)}if(!Ext.isEmpty(this.url)){this.linkStore.removeAll();Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(B){var C=Ext.decode(B.responseText);var a=[];var l=[];if(!C.success){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),&quot;Server error&quot;);return false}var b=C.record;var t=b.id;var m=b.attributeValues;if(m!==undefined){var v;for(v=0;v&lt;m.length;v++){var D=m[v].name;var d=this.findColumn(D);var u=m[v].value;var g=u;if(sql2ext.get(d.sqlColumnType)==&quot;dateAsString&quot;){g=sitools.user.component.dataviews.dataviewUtils.formatDate(u,d)}if(sql2ext.get(d.sqlColumnType)==&quot;boolean&quot;){g=u?i18n.get(&quot;label.true&quot;):i18n.get(&quot;label.false&quot;)}var A=new Ext.BoxComponent({fieldLabel:d.header,labelSeparator:&quot;&quot;,html:g});if(Ext.isEmpty(d)||Ext.isEmpty(d.columnRenderer)){a.push(A)}else{var p=d.columnRenderer;var q=&quot;&quot;;if(!Ext.isEmpty(d.columnRenderer)){q=d.columnRenderer.behavior;var n=sitools.user.component.dataviews.dataviewUtils.getRendererHTML(d,{});switch(q){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:case ColumnRendererEnum.DATASET_ICON_LINK:if(!Ext.isEmpty(u)){if(!Ext.isEmpty(p.linkText)){A=new Ext.BoxComponent({fieldLabel:d.header,labelSeparator:&quot;&quot;,html:String.format(n,u)});a.push(A)}else{if(!Ext.isEmpty(p.image)){var k={name:D,value:u,image:p.image.url,behavior:q,columnRenderer:p,toolTip:p.toolTip};k=new Ext.data.Record(k);this.linkStore.add(k)}}}break;case ColumnRendererEnum.IMAGE_FROM_SQL:case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:if(!Ext.isEmpty(u)){var e=&quot;&quot;;var z=&quot;&quot;;if(Ext.isEmpty(p.toolTip)){e=p.toolTip}else{e=col.header}if(!Ext.isEmpty(p.url)){z=p.url}else{if(!Ext.isEmpty(p.columnAlias)){z=this.findRecordValue(b,p.columnAlias)}}A=new Ext.BoxComponent({html:String.format(n,u,z),tooltip:e,cls:&quot;x-form-item&quot;})}l.push(A);break;case ColumnRendererEnum.NO_CLIENT_ACCESS:break;default:A=new Ext.BoxComponent({fieldLabel:d.header,labelSeparator:&quot;&quot;,html:String.format(n,u)});a.push(A);break}}}}this.formPanel.removeAll();this.formPanelImg.removeAll();this.formPanel.add(a);this.formPanel.doLayout();if(this.linkStore.getCount()===0){this.linkPanel.setVisible(false)}else{this.linkPanel.setVisible(true);this.linkPanel.doLayout()}if(l.length===0){this.formPanelImg.setVisible(false)}else{this.formPanelImg.add(l);this.formPanelImg.setVisible(true);this.linkPanel.doLayout()}this.doLayout();if(this._loadMaskAnchor&amp;&amp;this._loadMaskAnchor.isMasked()){this._loadMaskAnchor.unmask()}}},failure:function(){alertFailure();if(this._loadMaskAnchor&amp;&amp;this._loadMaskAnchor.isMasked()){this._loadMaskAnchor.unmask()}}})}},findColumn:function(b){var a=null;Ext.each(this.datasetColumnModel,function(d){if(d.columnAlias==b){a=d;return}},this);return a},findRecordValue:function(b,d){var a=null;Ext.each(b.attributeValues,function(e){if(e.name==d){a=e.value;return}},this);return a},handleClickOnLink:function(l,a,d,k){var g=l.getRecord(d).data;var b=g.behavior;switch(b){case ColumnRendererEnum.URL_LOCAL:sitools.user.component.dataviews.dataviewUtils.downloadData(g.value);break;case ColumnRendererEnum.URL_EXT_NEW_TAB:window.open(g.value);break;case ColumnRendererEnum.URL_EXT_DESKTOP:sitools.user.component.dataviews.dataviewUtils.showDisplayableUrl(g.value,g.columnRenderer.displayable);break;case ColumnRendererEnum.DATASET_ICON_LINK:sitools.user.component.dataviews.dataviewUtils.showDetailsData(g.value,g.columnRenderer.columnAlias,g.columnRenderer.datasetLinkUrl);break;default:break}}});Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.simpleViewDataDetail=Ext.extend(Ext.Panel,{initComponent:function(){this.url=this.urlDataDetail;var b=this.url.split(&quot;/&quot;);this.url=&quot;&quot;;for(var a=0;a&lt;b.length;a++){if(a&lt;b.length-1){this.url+=b[a]+&quot;/&quot;}else{this.url+=encodeURIComponent(b[a])}}this.layout=&quot;fit&quot;;this.autoScroll=true;this.formPanel=new Ext.FormPanel({frame:true,autoScroll:true,labelWidth:150,labelAlign:&quot;top&quot;});var d=[];Ext.Ajax.request({url:this.url,method:&quot;GET&quot;,scope:this,success:function(p){var l=Ext.decode(p.responseText);if(!l.success){Ext.Msg.alert(i18n.get(&quot;label.information&quot;),&quot;Server error&quot;);return false}var n=l.record;var g=n.id;var k=n.attributeValues;if(k!==undefined){var m;for(m=0;m&lt;k.length;m++){var e=k[m].name;var q=k[m].value;var t;if(q!==null&amp;&amp;q.length&gt;100){t=new Ext.form.TextArea({fieldLabel:e,value:q,anchor:&quot;90%&quot;,readOnly:true})}else{t=new Ext.form.TextField({fieldLabel:e,value:q,anchor:&quot;90%&quot;,readOnly:true})}d.push(t)}this.formPanel.add(d);this.formPanel.doLayout()}},failure:alertFailure});this.componentType=&quot;detail&quot;;this.items=[this.formPanel];sitools.user.component.simpleViewDataDetail.superclass.initComponent.call(this)},_getSettings:function(){return null}});
/*!
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.namespace(&quot;sitools.component.users.datasets&quot;);sitools.component.users.datasets.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/&gt;+~]\s?|\s|$)/,tagTokenRe=/^(#)?((?:opensearch:)?[\w-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;eval(&quot;var batch = 30803;&quot;);function child(parent,index){var i=0,n=parent.firstChild;while(n){if(n.nodeType==1){if(++i==index){return n}}n=n.nextSibling}return null}function next(n){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1){}return n}function prev(n){while((n=n.previousSibling)&amp;&amp;n.nodeType!=1){}return n}function children(parent){var n=parent.firstChild,nodeIndex=-1,nextNode;while(n){nextNode=n.nextSibling;if(n.nodeType==3&amp;&amp;!nonSpace.test(n.nodeValue)){parent.removeChild(n)}else{n.nodeIndex=++nodeIndex}n=nextNode}return this}function byClassName(nodeSet,cls){if(!cls){return nodeSet}var result=[],ri=-1;for(var i=0,ci;ci=nodeSet[i];i++){if((&quot; &quot;+ci.className+&quot; &quot;).indexOf(cls)!=-1){result[++ri]=ci}}return result}function attrValue(n,attr){if(!n.tagName&amp;&amp;typeof n.length!=&quot;undefined&quot;){n=n[0]}if(!n){return null}if(attr==&quot;for&quot;){return n.htmlFor}if(attr==&quot;class&quot;||attr==&quot;className&quot;){return n.className}return n.getAttribute(attr)||n[attr]}function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;if(!ns){return result}tagName=tagName||&quot;*&quot;;if(typeof ns.getElementsByTagName!=&quot;undefined&quot;){ns=[ns]}if(!mode){for(var i=0,ni;ni=ns[i];i++){cs=ni.getElementsByTagName(tagName);for(var j=0,ci;ci=cs[j];j++){result[++ri]=ci}}}else{if(mode==&quot;/&quot;||mode==&quot;&gt;&quot;){var utag=tagName.toUpperCase();for(var i=0,ni,cn;ni=ns[i];i++){cn=ni.childNodes;for(var j=0,cj;cj=cn[j];j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName==&quot;*&quot;){result[++ri]=cj}}}}else{if(mode==&quot;+&quot;){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1){}if(n&amp;&amp;(n.nodeName==utag||n.nodeName==tagName||tagName==&quot;*&quot;)){result[++ri]=n}}}else{if(mode==&quot;~&quot;){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName==&quot;*&quot;){result[++ri]=n}}}}}}}return result}function concat(a,b){if(b.slice){return a.concat(b)}for(var i=0,l=b.length;i&lt;l;i++){a[a.length]=b[i]}return a}function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs]}if(!tagName){return cs}var result=[],ri=-1;tagName=tagName.toLowerCase();for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType==1&amp;&amp;ci.tagName.toLowerCase()==tagName){result[++ri]=ci}}return result}function byId(cs,id){if(cs.tagName||cs==document){cs=[cs]}if(!id){return cs}var result=[],ri=-1;for(var i=0,ci;ci=cs[i];i++){if(ci&amp;&amp;ci.id==id){result[++ri]=ci;return result}}return result}function byAttribute(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom==&quot;{&quot;,fn=sitools.component.users.datasets.DomQuery.operators[op],a,xml,hasXml;for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType!=1){continue}if(!hasXml){xml=sitools.component.users.datasets.DomQuery.isXml(ci);hasXml=true}if(!xml){if(useGetStyle){a=sitools.component.users.datasets.DomQuery.getStyle(ci,attr)}else{if(attr==&quot;class&quot;||attr==&quot;className&quot;){a=ci.className}else{if(attr==&quot;for&quot;){a=ci.htmlFor}else{if(attr==&quot;href&quot;){a=ci.getAttribute(&quot;href&quot;,2)}else{a=ci.getAttribute(attr)}}}}}else{a=ci.getAttribute(attr)}if((fn&amp;&amp;fn(a,value))||(!fn&amp;&amp;a)){result[++ri]=ci}}return result}function byPseudo(cs,name,value){return sitools.component.users.datasets.DomQuery.pseudos[name](cs,value)}function nodupIEXml(cs){var d=++key,r;cs[0].setAttribute(&quot;_nodup&quot;,d);r=[cs[0]];for(var i=1,len=cs.length;i&lt;len;i++){var c=cs[i];if(!c.getAttribute(&quot;_nodup&quot;)!=d){c.setAttribute(&quot;_nodup&quot;,d);r[r.length]=c}}for(var i=0,len=cs.length;i&lt;len;i++){cs[i].removeAttribute(&quot;_nodup&quot;)}return r}function nodup(cs){if(!cs){return[]}var len=cs.length,c,i,r=cs,cj,ri=-1;if(!len||typeof cs.nodeType!=&quot;undefined&quot;||len==1){return cs}if(isIE&amp;&amp;typeof cs[0].selectSingleNode!=&quot;undefined&quot;){return nodupIEXml(cs)}var d=++key;cs[0]._nodup=d;for(i=1;c=cs[i];i++){if(c._nodup!=d){c._nodup=d}else{r=[];for(var j=0;j&lt;i;j++){r[++ri]=cs[j]}for(j=i+1;cj=cs[j];j++){if(cj._nodup!=d){cj._nodup=d;r[++ri]=cj}}return r}}return r}function quickDiffIEXml(c1,c2){var d=++key,r=[];for(var i=0,len=c1.length;i&lt;len;i++){c1[i].setAttribute(&quot;_qdiff&quot;,d)}for(var i=0,len=c2.length;i&lt;len;i++){if(c2[i].getAttribute(&quot;_qdiff&quot;)!=d){r[r.length]=c2[i]}}for(var i=0,len=c1.length;i&lt;len;i++){c1[i].removeAttribute(&quot;_qdiff&quot;)}return r}function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];if(!len1){return c2}if(isIE&amp;&amp;typeof c1[0].selectSingleNode!=&quot;undefined&quot;){return quickDiffIEXml(c1,c2)}for(var i=0;i&lt;len1;i++){c1[i]._qdiff=d}for(var i=0,len=c2.length;i&lt;len;i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i]}}return r}function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;return d.getElementById(id)}ns=getNodes(ns,mode,&quot;*&quot;);return byId(ns,id)}return{getStyle:function(el,name){return Ext.fly(el).getStyle(name)},compile:function(path,type){type=type||&quot;select&quot;;var fn=[&quot;var f = function(root){\n var mode; ++batch; var n = root || document;\n&quot;],mode,lastPath,matchers=sitools.component.users.datasets.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);if(lmode&amp;&amp;lmode[1]){fn[fn.length]='mode=&quot;'+lmode[1].replace(trimRe,&quot;&quot;)+'&quot;;';path=path.replace(lmode[1],&quot;&quot;)}while(path.substr(0,1)==&quot;/&quot;){path=path.substr(1)}while(path&amp;&amp;lastPath!=path){lastPath=path;var tokenMatch=path.match(tagTokenRe);if(type==&quot;select&quot;){if(tokenMatch){if(tokenMatch[1]==&quot;#&quot;){fn[fn.length]='n = quickId(n, mode, root, &quot;'+tokenMatch[2]+'&quot;);'}else{fn[fn.length]='n = getNodes(n, mode, &quot;'+tokenMatch[2]+'&quot;);'}path=path.replace(tokenMatch[0],&quot;&quot;)}else{if(path.substr(0,1)!=&quot;@&quot;){fn[fn.length]='n = getNodes(n, mode, &quot;*&quot;);'}}}else{if(tokenMatch){if(tokenMatch[1]==&quot;#&quot;){fn[fn.length]='n = byId(n, &quot;'+tokenMatch[2]+'&quot;);'}else{fn[fn.length]='n = byTag(n, &quot;'+tokenMatch[2]+'&quot;);'}path=path.replace(tokenMatch[0],&quot;&quot;)}}while(!(modeMatch=path.match(modeRe))){var matched=false;for(var j=0;j&lt;matchersLn;j++){var t=matchers[j];var m=path.match(t.re);if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i]});path=path.replace(m[0],&quot;&quot;);matched=true;break}}if(!matched){throw'Error parsing selector, parsing failed at &quot;'+path+'&quot;'}}if(modeMatch[1]){fn[fn.length]='mode=&quot;'+modeMatch[1].replace(trimRe,&quot;&quot;)+'&quot;;';path=path.replace(modeMatch[1],&quot;&quot;)}}fn[fn.length]=&quot;return nodup(n);\n}&quot;;eval(fn.join(&quot;&quot;));return f},jsSelect:function(path,root,type){root=root||document;if(typeof root==&quot;string&quot;){root=document.getElementById(root)}var paths=path.split(&quot;,&quot;),results=[];for(var i=0,len=paths.length;i&lt;len;i++){var subPath=paths[i].replace(trimRe,&quot;&quot;);if(!cache[subPath]){cache[subPath]=sitools.component.users.datasets.DomQuery.compile(subPath);if(!cache[subPath]){throw subPath+&quot; is not a valid selector&quot;}}var result=cache[subPath](root);if(result&amp;&amp;result!=document){results=results.concat(result)}}if(paths.length&gt;1){return nodup(results)}return results},isXml:function(el){var docEl=(el?el.ownerDocument||el:0).documentElement;return docEl?docEl.nodeName!==&quot;HTML&quot;:false},select:document.querySelectorAll?function(path,root,type){root=root||document;if(!sitools.component.users.datasets.DomQuery.isXml(root)){try{var cs=root.querySelectorAll(path);return Ext.toArray(cs)}catch(ex){}}return sitools.component.users.datasets.DomQuery.jsSelect.call(this,path,root,type)}:function(path,root,type){return sitools.component.users.datasets.DomQuery.jsSelect.call(this,path,root,type)},selectNode:function(path,root){return sitools.component.users.datasets.DomQuery.select(path,root)[0]},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,&quot;&quot;);if(!valueCache[path]){valueCache[path]=sitools.component.users.datasets.DomQuery.compile(path,&quot;select&quot;)}var n=valueCache[path](root),v;n=n[0]?n[0]:n;if(typeof n.normalize==&quot;function&quot;){n.normalize()}v=(n&amp;&amp;n.firstChild?n.firstChild.nodeValue:null);return((v===null||v===undefined||v===&quot;&quot;)?defaultValue:v)},selectNumber:function(path,root,defaultValue){var v=sitools.component.users.datasets.DomQuery.selectValue(path,root,defaultValue||0);return parseFloat(v)},is:function(el,ss){if(typeof el==&quot;string&quot;){el=document.getElementById(el)}var isArray=Ext.isArray(el),result=sitools.component.users.datasets.DomQuery.filter(isArray?el:[el],ss);return isArray?(result.length==el.length):(result.length&gt;0)},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,&quot;&quot;);if(!simpleCache[ss]){simpleCache[ss]=sitools.component.users.datasets.DomQuery.compile(ss,&quot;simple&quot;)}var result=simpleCache[ss](els);return nonMatches?quickDiff(result,els):result},matchers:[{re:/^\.([\w-]+)/,select:'n = byClassName(n, &quot; {1} &quot;);'},{re:/^\:([\w-]+)(?:\(((?:[^\s&gt;\/]*|.*?))\))?/,select:'n = byPseudo(n, &quot;{1}&quot;, &quot;{2}&quot;);'},{re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['&quot;]?(.*?)[&quot;']?)?[\]\}])/,select:'n = byAttribute(n, &quot;{2}&quot;, &quot;{4}&quot;, &quot;{3}&quot;, &quot;{1}&quot;);'},{re:/^#([\w-]+)/,select:'n = byId(n, &quot;{1}&quot;);'},{re:/^@([\w-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, &quot;{1}&quot;)}};'}],operators:{&quot;=&quot;:function(a,v){return a==v},&quot;!=&quot;:function(a,v){return a!=v},&quot;^=&quot;:function(a,v){return a&amp;&amp;a.substr(0,v.length)==v},&quot;$=&quot;:function(a,v){return a&amp;&amp;a.substr(a.length-v.length)==v},&quot;*=&quot;:function(a,v){return a&amp;&amp;a.indexOf(v)!==-1},&quot;%=&quot;:function(a,v){return(a%v)==0},&quot;|=&quot;:function(a,v){return a&amp;&amp;(a==v||a.substr(0,v.length+1)==v+&quot;-&quot;)},&quot;~=&quot;:function(a,v){return a&amp;&amp;(&quot; &quot;+a+&quot; &quot;).indexOf(&quot; &quot;+v+&quot; &quot;)!=-1}},pseudos:{&quot;first-child&quot;:function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.previousSibling)&amp;&amp;n.nodeType!=1){}if(!n){r[++ri]=ci}}return r},&quot;last-child&quot;:function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1){}if(!n){r[++ri]=ci}}return r},&quot;nth-child&quot;:function(c,a){var r=[],ri=-1,m=nthRe.exec(a==&quot;even&quot;&amp;&amp;&quot;2n&quot;||a==&quot;odd&quot;&amp;&amp;&quot;2n+1&quot;||!nthRe2.test(a)&amp;&amp;&quot;n+&quot;+a||a),f=(m[1]||1)-0,l=m[2]-0;for(var i=0,n;n=c[i];i++){var pn=n.parentNode;if(batch!=pn._batch){var j=0;for(var cn=pn.firstChild;cn;cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j}}pn._batch=batch}if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n}}else{if((n.nodeIndex+l)%f==0){r[++ri]=n}}}return r},&quot;only-child&quot;:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(!prev(ci)&amp;&amp;!next(ci)){r[++ri]=ci}}return r},empty:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var cns=ci.childNodes,j=0,cn,empty=true;while(cn=cns[j]){++j;if(cn.nodeType==1||cn.nodeType==3){empty=false;break}}if(empty){r[++ri]=ci}}return r},contains:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if((ci.textContent||ci.innerText||&quot;&quot;).indexOf(v)!=-1){r[++ri]=ci}}return r},nodeValue:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.firstChild&amp;&amp;ci.firstChild.nodeValue==v){r[++ri]=ci}}return r},checked:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.checked==true){r[++ri]=ci}}return r},not:function(c,ss){return sitools.component.users.datasets.DomQuery.filter(c,ss,true)},any:function(c,selectors){var ss=selectors.split(&quot;|&quot;),r=[],ri=-1,s;for(var i=0,ci;ci=c[i];i++){for(var j=0;s=ss[j];j++){if(sitools.component.users.datasets.DomQuery.is(ci,s)){r[++ri]=ci;break}}}return r},odd:function(c){return this[&quot;nth-child&quot;](c,&quot;odd&quot;)},even:function(c){return this[&quot;nth-child&quot;](c,&quot;even&quot;)},nth:function(c,a){return c[a-1]||[]},first:function(c){return c[0]||[]},last:function(c){return c[c.length-1]||[]},has:function(c,ss){var s=sitools.component.users.datasets.DomQuery.select,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(s(ss,ci).length&gt;0){r[++ri]=ci}}return r},next:function(c,ss){var is=sitools.component.users.datasets.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=next(ci);if(n&amp;&amp;is(n,ss)){r[++ri]=ci}}return r},prev:function(c,ss){var is=sitools.component.users.datasets.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=prev(ci);if(n&amp;&amp;is(n,ss)){r[++ri]=ci}}return r}}}}();Ext.query=sitools.component.users.datasets.DomQuery.select;Ext.namespace(&quot;sitools.component.users.datasets&quot;);sitools.component.users.datasets.XmlReader=function(a,b){a=a||{};Ext.applyIf(a,{idProperty:a.idProperty||a.idPath||a.id,successProperty:a.successProperty||a.success});sitools.component.users.datasets.XmlReader.superclass.constructor.call(this,a,b||a.fields)};Ext.extend(sitools.component.users.datasets.XmlReader,Ext.data.XmlReader,{createAccessor:function(){var a=sitools.component.users.datasets.DomQuery;return function(b){if(Ext.isFunction(b)){return b}switch(b){case this.meta.totalProperty:return function(d,e){return a.selectNumber(b,d,e)};break;case this.meta.successProperty:return function(e,g){var d=a.selectValue(b,e,true);var k=d!==false&amp;&amp;d!==&quot;false&quot;;return k};break;default:return function(d,e){return a.selectValue(b,d,e)};break}}}()});(function(){var a=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;var e=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];function b(q){var l,n,g;var p,m,k;g=q.length;n=0;l=&quot;&quot;;while(n&lt;g){p=q.charCodeAt(n++)&amp;255;if(n==g){l+=a.charAt(p&gt;&gt;2);l+=a.charAt((p&amp;3)&lt;&lt;4);l+=&quot;==&quot;;break}m=q.charCodeAt(n++);if(n==g){l+=a.charAt(p&gt;&gt;2);l+=a.charAt(((p&amp;3)&lt;&lt;4)|((m&amp;240)&gt;&gt;4));l+=a.charAt((m&amp;15)&lt;&lt;2);l+=&quot;=&quot;;break}k=q.charCodeAt(n++);l+=a.charAt(p&gt;&gt;2);l+=a.charAt(((p&amp;3)&lt;&lt;4)|((m&amp;240)&gt;&gt;4));l+=a.charAt(((m&amp;15)&lt;&lt;2)|((k&amp;192)&gt;&gt;6));l+=a.charAt(k&amp;63)}return l}function d(t){var q,p,m,k;var n,g,l;g=t.length;n=0;l=&quot;&quot;;while(n&lt;g){do{q=e[t.charCodeAt(n++)&amp;255]}while(n&lt;g&amp;&amp;q==-1);if(q==-1){break}do{p=e[t.charCodeAt(n++)&amp;255]}while(n&lt;g&amp;&amp;p==-1);if(p==-1){break}l+=String.fromCharCode((q&lt;&lt;2)|((p&amp;48)&gt;&gt;4));do{m=t.charCodeAt(n++)&amp;255;if(m==61){return l}m=e[m]}while(n&lt;g&amp;&amp;m==-1);if(m==-1){break}l+=String.fromCharCode(((p&amp;15)&lt;&lt;4)|((m&amp;60)&gt;&gt;2));do{k=t.charCodeAt(n++)&amp;255;if(k==61){return l}k=e[k]}while(n&lt;g&amp;&amp;k==-1);if(k==-1){break}l+=String.fromCharCode(((m&amp;3)&lt;&lt;6)|k)}return l}if(!window.btoa){window.btoa=b}if(!window.atob){window.atob=d}})();var Canvas2Image=(function(){var m=document.createElement(&quot;canvas&quot;);if(!m.getContext){return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}}}var d=!!(m.getContext(&quot;2d&quot;).getImageData);var e=!!(m.toDataURL);var a=!!(window.btoa);var g=&quot;image/octet-stream&quot;;var t=function(u){var v=parseInt(u.width);var z=parseInt(u.height);return u.getContext(&quot;2d&quot;).getImageData(0,0,v,z)};var k=function(z){var A=&quot;&quot;;if(typeof z==&quot;string&quot;){A=z}else{var u=z;for(var v=0;v&lt;u.length;v++){A+=String.fromCharCode(u[v])}}return btoa(A)};var p=function(M){var C=[];var P=M.width;var z=M.height;C.push(66);C.push(77);var K=P*z*3+54;C.push(K%256);K=Math.floor(K/256);C.push(K%256);K=Math.floor(K/256);C.push(K%256);K=Math.floor(K/256);C.push(K%256);C.push(0);C.push(0);C.push(0);C.push(0);C.push(54);C.push(0);C.push(0);C.push(0);var E=[];E.push(40);E.push(0);E.push(0);E.push(0);var J=P;E.push(J%256);J=Math.floor(J/256);E.push(J%256);J=Math.floor(J/256);E.push(J%256);J=Math.floor(J/256);E.push(J%256);var u=z;E.push(u%256);u=Math.floor(u/256);E.push(u%256);u=Math.floor(u/256);E.push(u%256);u=Math.floor(u/256);E.push(u%256);E.push(1);E.push(0);E.push(24);E.push(0);E.push(0);E.push(0);E.push(0);E.push(0);var v=P*z*3;E.push(v%256);v=Math.floor(v/256);E.push(v%256);v=Math.floor(v/256);E.push(v%256);v=Math.floor(v/256);E.push(v%256);for(var O=0;O&lt;16;O++){E.push(0)}var L=(4-((P*3)%4))%4;var S=M.data;var A=&quot;&quot;;var B=z;do{var Q=P*(B-1)*4;var N=&quot;&quot;;for(var D=0;D&lt;P;D++){var R=4*D;N+=String.fromCharCode(S[Q+R+2]);N+=String.fromCharCode(S[Q+R+1]);N+=String.fromCharCode(S[Q+R])}for(var T=0;T&lt;L;T++){N+=String.fromCharCode(0)}A+=N}while(--B);return k(C.concat(E))+k(A)};var b=function(u,v){if(!window.open(u)){document.location.href=u}};var n=function(v,u){return&quot;data:&quot;+u+&quot;;base64,&quot;+v};var q=function(u){var v=document.createElement(&quot;img&quot;);v.src=u;return v};var l=function(v,z,B){if(z&amp;&amp;B){var A=document.createElement(&quot;canvas&quot;);A.width=z;A.height=B;A.style.width=z+&quot;px&quot;;A.style.height=B+&quot;px&quot;;var u=A.getContext(&quot;2d&quot;);u.drawImage(v,0,0,v.width,v.height,0,0,z,z);return A}return v};return{saveAsPNG:function(v,D,u,z,C){if(!e){return false}var A=l(v,z,C);var B=A.toDataURL(&quot;image/png&quot;);if(u){return q(B)}else{A.toBlob(function(E){saveAs(E,D+&quot;.png&quot;)},&quot;image/png&quot;)}return true},saveAsJPEG:function(v,u,z,D){if(!e){return false}var A=l(v,z,D);var C=&quot;image/jpeg&quot;;var B=A.toDataURL(C);if(B.indexOf(C)!=5){return false}if(u){return q(B)}else{b(B.replace(C,g))}return true},saveAsBMP:function(z,v,A,C){if(!(d&amp;&amp;a)){return false}var B=l(z,A,C);var D=t(B);var u=p(D);if(v){return q(n(u,&quot;image/bmp&quot;))}else{b(n(u,g))}return true}}})();var CanvasText={letters:{&quot;\n&quot;:{width:-1,points:[]},&quot; &quot;:{width:10,points:[]},&quot;!&quot;:{width:10,points:[[5,21],[5,7],null,[5,2],[4,1],[5,0],[6,1],[5,2]]},'&quot;':{width:16,points:[[4,21],[4,14],null,[12,21],[12,14]]},&quot;#&quot;:{width:21,points:[[11,25],[4,-7],null,[17,25],[10,-7],null,[4,12],[18,12],null,[3,6],[17,6]]},&quot;$&quot;:{width:20,points:[[8,25],[8,-4],null,[12,25],[12,-4],null,[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},&quot;%&quot;:{width:24,points:[[21,21],[3,0],null,[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],null,[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},&quot;&amp;&quot;:{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},&quot;'&quot;:{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},&quot;(&quot;:{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},&quot;)&quot;:{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},&quot;*&quot;:{width:16,points:[[8,21],[8,9],null,[3,18],[13,12],null,[13,18],[3,12]]},&quot;+&quot;:{width:26,points:[[13,18],[13,0],null,[4,9],[22,9]]},&quot;,&quot;:{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},&quot;-&quot;:{width:26,points:[[4,9],[22,9]]},&quot;.&quot;:{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},&quot;/&quot;:{width:22,points:[[20,25],[2,-7]]},&quot;0&quot;:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},&quot;1&quot;:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},&quot;2&quot;:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},&quot;3&quot;:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},&quot;4&quot;:{width:20,points:[[13,21],[3,7],[18,7],null,[13,21],[13,0]]},&quot;5&quot;:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},&quot;6&quot;:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},&quot;7&quot;:{width:20,points:[[17,21],[7,0],null,[3,21],[17,21]]},&quot;8&quot;:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},&quot;9&quot;:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},&quot;:&quot;:{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],null,[5,2],[4,1],[5,0],[6,1],[5,2]]},&quot;;&quot;:{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],null,[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},&quot;&lt;&quot;:{width:24,points:[[20,18],[4,9],[20,0]]},&quot;=&quot;:{width:26,points:[[4,12],[22,12],null,[4,6],[22,6]]},&quot;&gt;&quot;:{width:24,points:[[4,18],[20,9],[4,0]]},&quot;?&quot;:{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],null,[9,2],[8,1],[9,0],[10,1],[9,2]]},&quot;@&quot;:{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],null,[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],null,[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],null,[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],null,[9,21],[17,0],null,[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],null,[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],null,[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],null,[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],null,[4,21],[17,21],null,[4,11],[12,11],null,[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],null,[4,21],[17,21],null,[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],null,[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],null,[18,21],[18,0],null,[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],null,[18,21],[4,7],null,[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],null,[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],null,[4,21],[12,0],null,[20,21],[12,0],null,[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],null,[4,21],[18,0],null,[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],null,[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],null,[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],null,[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],null,[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],null,[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],null,[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],null,[12,21],[7,0],null,[12,21],[17,0],null,[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],null,[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],null,[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],null,[3,21],[17,21],null,[3,0],[17,0]]},&quot;[&quot;:{width:14,points:[[4,25],[4,-7],null,[5,25],[5,-7],null,[4,25],[11,25],null,[4,-7],[11,-7]]},&quot;\\&quot;:{width:14,points:[[0,21],[14,-3]]},&quot;]&quot;:{width:14,points:[[9,25],[9,-7],null,[10,25],[10,-7],null,[3,25],[10,25],null,[3,-7],[10,-7]]},&quot;^&quot;:{width:14,points:[[3,10],[8,18],[13,10]]},_:{width:16,points:[[0,-2],[16,-2]]},&quot;`&quot;:{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],null,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],null,[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],null,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],null,[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],null,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],null,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],null,[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],null,[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],null,[14,14],[4,4],null,[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],null,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],null,[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],null,[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],null,[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],null,[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],null,[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],null,[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],null,[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],null,[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],null,[11,14],[7,0],null,[11,14],[15,0],null,[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],null,[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],null,[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],null,[3,14],[14,14],null,[3,0],[14,0]]},&quot;{&quot;:{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],null,[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],null,[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},&quot;|&quot;:{width:8,points:[[4,25],[4,-7]]},&quot;}&quot;:{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],null,[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],null,[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},&quot;~&quot;:{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],null,[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;e&quot;},&quot;�&quot;:{diacritic:&quot;`&quot;,letter:&quot;e&quot;},&quot;�&quot;:{diacritic:&quot;^&quot;,letter:&quot;e&quot;},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;e&quot;},&quot;�&quot;:{diacritic:&quot;`&quot;,letter:&quot;a&quot;},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;c&quot;},&quot;�&quot;:{diacritic:&quot;~&quot;,letter:&quot;n&quot;},&quot;�&quot;:{diacritic:&quot;^&quot;,letter:&quot;o&quot;},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;E&quot;},&quot;�&quot;:{diacritic:&quot;`&quot;,letter:&quot;E&quot;},&quot;�&quot;:{diacritic:&quot;^&quot;,letter:&quot;E&quot;},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;E&quot;},&quot;�&quot;:{diacritic:&quot;`&quot;,letter:&quot;A&quot;},&quot;�&quot;:{diacritic:&quot;�&quot;,letter:&quot;C&quot;},&quot;�&quot;:{diacritic:&quot;~&quot;,letter:&quot;N&quot;},&quot;�&quot;:{diacritic:&quot;^&quot;,letter:&quot;O&quot;}},specialchars:{pi:{width:19,points:[[6,14],[6,0],null,[14,14],[14,0],null,[2,13],[6,16],[13,13],[17,16]]}},diacritics:{&quot;�&quot;:{entity:&quot;cedil&quot;,points:[[6,-4],[4,-6],[2,-7],[1,-7]]},&quot;�&quot;:{entity:&quot;acute&quot;,points:[[8,19],[13,22]]},&quot;`&quot;:{entity:&quot;grave&quot;,points:[[7,22],[12,19]]},&quot;^&quot;:{entity:&quot;circ&quot;,points:[[5.5,19],[9.5,23],[12.5,19]]},&quot;�&quot;:{entity:&quot;trema&quot;,points:[[5,21],[6,20],[7,21],[6,22],[5,21],null,[12,21],[13,20],[14,21],[13,22],[12,21]]},&quot;~&quot;:{entity:&quot;tilde&quot;,points:[[4,18],[7,22],[10,18],[13,22]]}},style:{size:8,font:null,color:&quot;#000000&quot;,weight:1,halign:&quot;l&quot;,valign:&quot;b&quot;,adjustAlign:false,angle:0,tracking:1,boundingBoxColor:&quot;#ff0000&quot;,originPointColor:&quot;#000000&quot;},debug:false,_bufferLexemes:{},letter:function(a){return CanvasText.letters[a]},parseLexemes:function(k){if(CanvasText._bufferLexemes[k]){return CanvasText._bufferLexemes[k]}var d,l,g=k.match(/&amp;[A-Za-z]{2,5};|\s|./g);var a=[],e=[];for(d=0;d&lt;g.length;d++){l=g[d];if(l.length==1){e.push(l)}else{var b=l.substring(1,l.length-1);if(CanvasText.specialchars[b]){e.push(b)}else{e=e.concat(l.toArray())}}}for(d=0;d&lt;e.length;d++){l=e[d];if(l=CanvasText.letters[l]||CanvasText.specialchars[l]){a.push(l)}}return CanvasText._bufferLexemes[k]=a.compact()},ascent:function(a){a=a||{};return(a.size||CanvasText.style.size)},descent:function(a){a=a||{};return 7*(a.size||CanvasText.style.size)/25},measure:function(g,d){if(!g){return}d=d||{};var a,b,k=CanvasText.parseLexemes(g),e=0;for(a=k.length-1;a&gt;-1;--a){c=k[a];b=(c.diacritic)?CanvasText.letter(c.letter).width:c.width;e+=b*(d.tracking||CanvasText.style.tracking)*(d.size||CanvasText.style.size)/25}return e},getDimensions:function(g,d){var b=CanvasText.measure(g,d),a=d.size||CanvasText.style.size,e=d.angle||CanvasText.style.angle;if(d.angle==0){return{width:b,height:a}}return{width:Math.abs(Math.cos(e)*b)+Math.abs(Math.sin(e)*a),height:Math.abs(Math.sin(e)*b)+Math.abs(Math.cos(e)*a)}},getBestAlign:function(e,d){e+=CanvasText.getAngleFromAlign(d.halign,d.valign);var b={h:&quot;c&quot;,v:&quot;m&quot;};if(Math.round(Math.cos(e)*1000)/1000!=0){b.h=(Math.cos(e)&gt;0?&quot;r&quot;:&quot;l&quot;)}if(Math.round(Math.sin(e)*1000)/1000!=0){b.v=(Math.sin(e)&gt;0?&quot;t&quot;:&quot;b&quot;)}return b},getAngleFromAlign:function(d,a){var e=Math.PI,b={rm:0,rt:e/4,ct:e/2,lt:3*(e/4),lm:e,lb:-3*(e/4),cb:-e/2,rb:-e/4,cm:0};return b[d+a]},drawPoints:function(q,p,n,l,k,e){var g,m,d=true,b=0;e=e||{x:0,y:0};q.beginPath();for(g=0;g&lt;p.length;g++){m=p[g];if(!m){d=true;continue}if(d){q.moveTo(n+m[0]*k+e.x,l-m[1]*k+e.y);d=false}else{q.lineTo(n+m[0]*k+e.x,l-m[1]*k+e.y)}}q.stroke()},draw:function(t,q,l,a,A){if(!q){return}A=A||CanvasText.style;A.halign=A.halign||CanvasText.style.halign;A.valign=A.valign||CanvasText.style.valign;A.angle=A.angle||CanvasText.style.angle;A.size=A.size||CanvasText.style.size;A.adjustAlign=A.adjustAlign||CanvasText.style.adjustAlign;var z,B,D=0,b=A.size/25,n=0,m=0,d=CanvasText.parseLexemes(q);var g={x:0,y:0},e=CanvasText.measure(q,A),u;if(A.adjustAlign){u=CanvasText.getBestAlign(A.angle,A);A.halign=u.h;A.valign=u.v}switch(A.halign){case&quot;l&quot;:break;case&quot;c&quot;:g.x=-e/2;break;case&quot;r&quot;:g.x=-e;break}switch(A.valign){case&quot;b&quot;:break;case&quot;m&quot;:g.y=A.size/2;break;case&quot;t&quot;:g.y=A.size;break}t.save();t.translate(l,a);t.rotate(A.angle);t.lineCap=&quot;round&quot;;t.lineWidth=2*b*(A.weight||CanvasText.style.weight);t.strokeStyle=A.color||CanvasText.style.color;for(z=0;z&lt;d.length;z++){B=d[z];if(B.width==-1){n=0;m=A.size*1.4;continue}var v=B.points,p=B.width;if(B.diacritic){var C=CanvasText.diacritics[B.diacritic];var k=CanvasText.letter(B.letter);CanvasText.drawPoints(t,C.points,n,m-(B.letter.toUpperCase()==B.letter?3:0),b,g);v=k.points;p=k.width}CanvasText.drawPoints(t,v,n,m,b,g);if(CanvasText.debug){t.save();t.lineJoin=&quot;miter&quot;;t.lineWidth=0.5;t.strokeStyle=(A.boundingBoxColor||CanvasText.style.boundingBoxColor);t.strokeRect(n+g.x,m+g.y,p*b,-A.size);t.fillStyle=(A.originPointColor||CanvasText.style.originPointColor);t.beginPath();t.arc(0,0,1.5,0,Math.PI*2,true);t.fill();t.restore()}n+=p*b*(A.tracking||CanvasText.style.tracking)}t.restore();return D},enable:function(a){a.drawText=function(e,b,g,d){return CanvasText.draw(a,e,b,g,d)};a.measureText=function(d,b){return CanvasText.measure(d,b)};a.getTextBounds=function(d,b){return CanvasText.getDimensions(d,b)};a.fontAscent=function(b){return CanvasText.ascent(b)};a.fontDescent=function(b){return CanvasText.descent(b)}}};var Flotr={version:&quot;0.2.0-alpha&quot;,author:&quot;Bas Wenneker&quot;,website:&quot;http://www.solutoire.com&quot;,_registeredTypes:{lines:&quot;drawSeriesLines&quot;,points:&quot;drawSeriesPoints&quot;,bars:&quot;drawSeriesBars&quot;,candles:&quot;drawSeriesCandles&quot;,pie:&quot;drawSeriesPie&quot;},register:function(a,b){Flotr._registeredTypes[a]=b+&quot;&quot;},draw:function(b,e,a,d){d=d||Flotr.Graph;return new d(b,e,a)},getSeries:function(a){return a.collect(function(d){var b,d=(d.data)?Object.clone(d):{data:d};for(b=d.data.length-1;b&gt;-1;--b){d.data[b][1]=(d.data[b][1]===null?null:parseFloat(d.data[b][1]))}return d})},merge:function(e,b){var a=b||{};for(var d in e){a[d]=(e[d]!=null&amp;&amp;typeof(e[d])==&quot;object&quot;&amp;&amp;!(e[d].constructor==Array||e[d].constructor==RegExp)&amp;&amp;!Object.isElement(e[d]))?Flotr.merge(e[d],b[d]):a[d]=e[d]}return a},getTickSize:function(g,e,a,b){var m=(a-e)/g;var l=Flotr.getMagnitude(m);var d=m/l;var k=10;if(d&lt;1.5){k=1}else{if(d&lt;2.25){k=2}else{if(d&lt;3){k=((b==0)?2:2.5)}else{if(d&lt;7.5){k=5}}}}return k*l},defaultTickFormatter:function(a){return a+&quot;&quot;},defaultTrackFormatter:function(a){return&quot;(&quot;+a.x+&quot;, &quot;+a.y+&quot;)&quot;},defaultPieLabelFormatter:function(a){return(a.fraction*100).toFixed(2)+&quot;%&quot;},getMagnitude:function(a){return Math.pow(10,Math.floor(Math.log(a)/Math.LN10))},toPixel:function(a){return Math.floor(a)+0.5},toRad:function(a){return -a*(Math.PI/180)},parseColor:function(e){if(e instanceof Flotr.Color){return e}var a,d=Flotr.Color;if((a=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))){return new d(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]))}if((a=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))){return new d(parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseFloat(a[4]))}if((a=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))){return new d(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55)}if((a=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))){return new d(parseFloat(a[1])*2.55,parseFloat(a[2])*2.55,parseFloat(a[3])*2.55,parseFloat(a[4]))}if((a=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))){return new d(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16))}if((a=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))){return new d(parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16))}var b=e.strip().toLowerCase();if(b==&quot;transparent&quot;){return new d(255,255,255,0)}return((a=d.lookupColors[b]))?new d(a[0],a[1],a[2]):false},extractColor:function(b){var a;do{a=b.getStyle(&quot;background-color&quot;).toLowerCase();if(!(a==&quot;&quot;||a==&quot;transparent&quot;)){break}b=b.up(0)}while(!b.nodeName.match(/^body$/i));return(a==&quot;rgba(0, 0, 0, 0)&quot;)?&quot;transparent&quot;:a}};Flotr.Graph=Class.create({initialize:function(b,d,a){this.el=$(b);if(!this.el){throw&quot;The target container doesn't exist&quot;}this.data=d;this.series=Flotr.getSeries(d);this.setOptions(a);this.lastMousePos={pageX:null,pageY:null};this.selection={first:{x:-1,y:-1},second:{x:-1,y:-1}};this.prevSelection=null;this.selectionInterval=null;this.ignoreClick=false;this.prevHit=null;this.constructCanvas();this.initEvents();this.findDataRanges();this.calculateTicks(this.axes.x);this.calculateTicks(this.axes.x2);this.calculateTicks(this.axes.y);this.calculateTicks(this.axes.y2);this.calculateSpacing();this.draw();this.insertLegend();if(this.options.spreadsheet.show){this.constructTabs()}},setOptions:function(b){var A={colors:[&quot;#00A8F0&quot;,&quot;#C0D800&quot;,&quot;#CB4B4B&quot;,&quot;#4DA74D&quot;,&quot;#9440ED&quot;],title:null,subtitle:null,legend:{show:true,noColumns:1,labelFormatter:Prototype.K,labelBoxBorderColor:&quot;#CCCCCC&quot;,labelBoxWidth:14,labelBoxHeight:10,labelBoxMargin:5,container:null,position:&quot;nw&quot;,margin:5,backgroundColor:null,backgroundOpacity:0.85},xaxis:{ticks:null,showLabels:true,labelsAngle:0,title:null,titleAngle:0,noTicks:5,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscaleMargin:0,color:null},x2axis:{},yaxis:{ticks:null,showLabels:true,labelsAngle:0,title:null,titleAngle:90,noTicks:5,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscaleMargin:0,color:null},y2axis:{titleAngle:270},points:{show:false,radius:3,lineWidth:2,fill:true,fillColor:&quot;#FFFFFF&quot;,fillOpacity:0.4},lines:{show:false,lineWidth:2,fill:false,fillColor:null,fillOpacity:0.4},bars:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,fillOpacity:0.4,horizontal:false,stacked:false},candles:{show:false,lineWidth:1,wickLineWidth:1,candleWidth:0.6,fill:true,upFillColor:&quot;#00A8F0&quot;,downFillColor:&quot;#CB4B4B&quot;,fillOpacity:0.5,barcharts:false},pie:{show:false,lineWidth:1,fill:true,fillColor:null,fillOpacity:0.6,explode:6,sizeRatio:0.6,startAngle:Math.PI/4,labelFormatter:Flotr.defaultPieLabelFormatter,pie3D:false,pie3DviewAngle:(Math.PI/2*0.8),pie3DspliceThickness:20},grid:{color:&quot;#545454&quot;,backgroundColor:null,tickColor:&quot;#DDDDDD&quot;,labelMargin:3,verticalLines:true,horizontalLines:true,outlineWidth:2},selection:{mode:null,color:&quot;#B6D9FF&quot;,fps:20},mouse:{track:false,position:&quot;se&quot;,relative:false,trackFormatter:Flotr.defaultTrackFormatter,margin:5,lineColor:&quot;#FF3F19&quot;,trackDecimals:1,sensibility:2,radius:3},shadowSize:4,defaultType:&quot;lines&quot;,HtmlText:true,fontSize:7.5,spreadsheet:{show:false,tabGraphLabel:&quot;Graph&quot;,tabDataLabel:&quot;Data&quot;,toolbarDownload:&quot;Download CSV&quot;,toolbarSelectAll:&quot;Select all&quot;}};A.x2axis=Object.extend(Object.clone(A.xaxis),A.x2axis);A.y2axis=Object.extend(Object.clone(A.yaxis),A.y2axis);this.options=Flotr.merge((b||{}),A);this.axes={x:{options:this.options.xaxis,n:1},x2:{options:this.options.x2axis,n:2},y:{options:this.options.yaxis,n:1},y2:{options:this.options.y2axis,n:2}};var m=[],d=[],q=this.series.length,v=this.series.length,e=this.options.colors,a=[],l=0,u,p,n,z,g;for(p=v-1;p&gt;-1;--p){u=this.series[p].color;if(u!=null){--v;if(Object.isNumber(u)){m.push(u)}else{a.push(Flotr.parseColor(u))}}}for(p=m.length-1;p&gt;-1;--p){v=Math.max(v,m[p]+1)}for(p=0;d.length&lt;v;){u=(e.length==p)?new Flotr.Color(100,100,100):Flotr.parseColor(e[p]);var k=l%2==1?-1:1;var t=1+k*Math.ceil(l/2)*0.2;u.scale(t,t,t);d.push(u);if(++p&gt;=e.length){p=0;++l}}for(p=0,n=0;p&lt;q;++p){z=this.series[p];if(z.color==null){z.color=d[n++].toString()}else{if(Object.isNumber(z.color)){z.color=d[z.color].toString()}}if(!z.xaxis){z.xaxis=this.axes.x}if(z.xaxis==1){z.xaxis=this.axes.x}else{if(z.xaxis==2){z.xaxis=this.axes.x2}}if(!z.yaxis){z.yaxis=this.axes.y}if(z.yaxis==1){z.yaxis=this.axes.y}else{if(z.yaxis==2){z.yaxis=this.axes.y2}}z.lines=Object.extend(Object.clone(this.options.lines),z.lines);z.points=Object.extend(Object.clone(this.options.points),z.points);z.bars=Object.extend(Object.clone(this.options.bars),z.bars);z.candles=Object.extend(Object.clone(this.options.candles),z.candles);z.pie=Object.extend(Object.clone(this.options.pie),z.pie);z.mouse=Object.extend(Object.clone(this.options.mouse),z.mouse);if(z.shadowSize==null){z.shadowSize=this.options.shadowSize}}},constructCanvas:function(){var d=this.el,b,e,a;this.canvas=d.select(&quot;.flotr-canvas&quot;)[0];this.overlay=d.select(&quot;.flotr-overlay&quot;)[0];d.childElements().invoke(&quot;remove&quot;);d.setStyle({position:&quot;relative&quot;,cursor:&quot;default&quot;});this.canvasWidth=d.getWidth();this.canvasHeight=d.getHeight();b={width:this.canvasWidth,height:this.canvasHeight};if(this.canvasWidth&lt;=0||this.canvasHeight&lt;=0){throw&quot;Invalid dimensions for plot, width = &quot;+this.canvasWidth+&quot;, height = &quot;+this.canvasHeight}if(!this.canvas){e=this.canvas=new Element(&quot;canvas&quot;,b);e.className=&quot;flotr-canvas&quot;;e=e.writeAttribute(&quot;style&quot;,&quot;position:absolute;left:0px;top:0px;&quot;)}else{e=this.canvas.writeAttribute(b)}d.insert(e);if(Prototype.Browser.IE){e=window.G_vmlCanvasManager.initElement(e)}this.ctx=e.getContext(&quot;2d&quot;);if(!this.overlay){a=this.overlay=new Element(&quot;canvas&quot;,b);a.className=&quot;flotr-overlay&quot;;a=a.writeAttribute(&quot;style&quot;,&quot;position:absolute;left:0px;top:0px;&quot;)}else{a=this.overlay.writeAttribute(b)}d.insert(a);if(Prototype.Browser.IE){a=window.G_vmlCanvasManager.initElement(a)}this.octx=a.getContext(&quot;2d&quot;);if(window.CanvasText){CanvasText.enable(this.ctx);CanvasText.enable(this.octx);this.textEnabled=true}this.ctx.globalAlpha=1;this.ctx.fillStyle=&quot;#FFFFFF&quot;;this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight)},getTextDimensions:function(k,d,b,e){if(!k){return{width:0,height:0}}if(!this.options.HtmlText&amp;&amp;this.textEnabled){var g=this.ctx.getTextBounds(k,d);return{width:g.width+2,height:g.height+6}}else{var a=this.el.insert('&lt;div style=&quot;position:absolute;top:-10000px;'+b+'&quot; class=&quot;'+e+' flotr-dummy-div&quot;&gt;'+k+&quot;&lt;/div&gt;&quot;).select(&quot;.flotr-dummy-div&quot;)[0];dim=a.getDimensions();a.remove();return dim}},loadDataGrid:function(){if(this.seriesData){return this.seriesData}var a=this.series;var b=[];for(i=0;i&lt;a.length;++i){a[i].data.each(function(e){var d=e[0],k=e[1];if(r=b.find(function(l){return l[0]==d})){r[i+1]=k}else{var g=[];g[0]=d;g[i+1]=k;b.push(g)}})}b=b.sortBy(function(d){return d[0]});return this.seriesData=b},showTab:function(b,d){var a=&quot;canvas, .flotr-labels, .flotr-legend, .flotr-legend-bg, .flotr-title, .flotr-subtitle&quot;;switch(b){case&quot;graph&quot;:this.datagrid.up().hide();this.el.select(a).invoke(&quot;show&quot;);this.tabs.data.removeClassName(&quot;selected&quot;);this.tabs.graph.addClassName(&quot;selected&quot;);break;case&quot;data&quot;:this.constructDataGrid();this.datagrid.up().show();this.el.select(a).invoke(&quot;hide&quot;);this.tabs.data.addClassName(&quot;selected&quot;);this.tabs.graph.removeClassName(&quot;selected&quot;);break}},constructTabs:function(){var a=new Element(&quot;div&quot;,{className:&quot;flotr-tabs-group&quot;,style:&quot;position:absolute;left:0px;top:&quot;+this.canvasHeight+&quot;px;width:&quot;+this.canvasWidth+&quot;px;&quot;});this.el.insert({bottom:a});this.tabs={graph:new Element(&quot;div&quot;,{className:&quot;flotr-tab selected&quot;,style:&quot;float:left;&quot;}).update(this.options.spreadsheet.tabGraphLabel),data:new Element(&quot;div&quot;,{className:&quot;flotr-tab&quot;,style:&quot;float:left;&quot;}).update(this.options.spreadsheet.tabDataLabel)};a.insert(this.tabs.graph).insert(this.tabs.data);this.el.setStyle({height:this.canvasHeight+this.tabs.data.getHeight()+2+&quot;px&quot;});this.tabs.graph.observe(&quot;click&quot;,(function(){this.showTab(&quot;graph&quot;)}).bind(this));this.tabs.data.observe(&quot;click&quot;,(function(){this.showTab(&quot;data&quot;)}).bind(this))},constructDataGrid:function(){if(this.datagrid){return this.datagrid}var e,b,u=this.series,p=this.loadDataGrid();var q=this.datagrid=new Element(&quot;table&quot;,{className:&quot;flotr-datagrid&quot;,style:&quot;height:100px;&quot;});var d=[&quot;&lt;colgroup&gt;&lt;col /&gt;&quot;];var k=['&lt;tr class=&quot;first-row&quot;&gt;'];k.push(&quot;&lt;th&gt;&amp;nbsp;&lt;/th&gt;&quot;);for(e=0;e&lt;u.length;++e){k.push('&lt;th scope=&quot;col&quot;&gt;'+(u[e].label||String.fromCharCode(65+e))+&quot;&lt;/th&gt;&quot;);d.push(&quot;&lt;col /&gt;&quot;)}k.push(&quot;&lt;/tr&gt;&quot;);for(b=0;b&lt;p.length;++b){k.push(&quot;&lt;tr&gt;&quot;);for(e=0;e&lt;u.length+1;++e){var v=&quot;td&quot;;var l=(p[b][e]!=null?Math.round(p[b][e]*100000)/100000:&quot;&quot;);if(e==0){v=&quot;th&quot;;var n;if(this.options.xaxis.ticks){var g=this.options.xaxis.ticks.find(function(t){return t[0]==p[b][e]});if(g){n=g[1]}}else{n=this.options.xaxis.tickFormatter(l)}if(n){l=n}}k.push(&quot;&lt;&quot;+v+(v==&quot;th&quot;?' scope=&quot;row&quot;':&quot;&quot;)+&quot;&gt;&quot;+l+&quot;&lt;/&quot;+v+&quot;&gt;&quot;)}k.push(&quot;&lt;/tr&gt;&quot;)}d.push(&quot;&lt;/colgroup&gt;&quot;);q.update(d.join(&quot;&quot;)+k.join(&quot;&quot;));if(!Prototype.Browser.IE){q.select(&quot;td&quot;).each(function(t){t.observe(&quot;mouseover&quot;,function(z){t=z.element();var A=t.previousSiblings();q.select(&quot;th[scope=col]&quot;)[A.length-1].addClassName(&quot;hover&quot;);q.select(&quot;colgroup col&quot;)[A.length].addClassName(&quot;hover&quot;)});t.observe(&quot;mouseout&quot;,function(){q.select(&quot;colgroup col.hover, th.hover&quot;).each(function(z){z.removeClassName(&quot;hover&quot;)})})})}var m=new Element(&quot;div&quot;,{className:&quot;flotr-datagrid-toolbar&quot;}).insert(new Element(&quot;button&quot;,{type:&quot;button&quot;,className:&quot;flotr-datagrid-toolbar-button&quot;}).update(this.options.spreadsheet.toolbarDownload).observe(&quot;click&quot;,this.downloadCSV.bind(this))).insert(new Element(&quot;button&quot;,{type:&quot;button&quot;,className:&quot;flotr-datagrid-toolbar-button&quot;}).update(this.options.spreadsheet.toolbarSelectAll).observe(&quot;click&quot;,this.selectAllData.bind(this)));var a=new Element(&quot;div&quot;,{className:&quot;flotr-datagrid-container&quot;,style:&quot;left:0px;top:0px;width:&quot;+this.canvasWidth+&quot;px;height:&quot;+this.canvasHeight+&quot;px;overflow:auto;&quot;});a.insert(m);q.wrap(a.hide());this.el.insert(a);return q},selectAllData:function(){if(this.tabs){var b,a,g,e,d=this.constructDataGrid();this.showTab(&quot;data&quot;);(function(){if((g=d.ownerDocument)&amp;&amp;(e=g.defaultView)&amp;&amp;e.getSelection&amp;&amp;g.createRange&amp;&amp;(b=window.getSelection())&amp;&amp;b.removeAllRanges){a=g.createRange();a.selectNode(d);b.removeAllRanges();b.addRange(a)}else{if(document.body&amp;&amp;document.body.createTextRange&amp;&amp;(a=document.body.createTextRange())){a.moveToElementText(d);a.select()}}}).defer();return true}else{return false}},downloadCSV:function(){var e,a='&quot;x&quot;',d=this.series,g=this.loadDataGrid();for(e=0;e&lt;d.length;++e){a+='%09&quot;'+(d[e].label||String.fromCharCode(65+e))+'&quot;'}a+=&quot;%0D%0A&quot;;for(e=0;e&lt;g.length;++e){if(this.options.xaxis.ticks){var b=this.options.xaxis.ticks.find(function(k){return k[0]==g[e][0]});if(b){g[e][0]=b[1]}}else{g[e][0]=this.options.xaxis.tickFormatter(g[e][0])}a+=g[e].join(&quot;%09&quot;)+&quot;%0D%0A&quot;}if(Prototype.Browser.IE){a=a.gsub(&quot;%09&quot;,&quot;\t&quot;).gsub(&quot;%0A&quot;,&quot;\n&quot;).gsub(&quot;%0D&quot;,&quot;\r&quot;);window.open().document.write(a)}else{window.open(&quot;data:text/csv,&quot;+a)}},initEvents:function(){this.overlay.stopObserving();this.overlay.observe(&quot;mousedown&quot;,this.mouseDownHandler.bind(this));this.overlay.observe(&quot;mousemove&quot;,this.mouseMoveHandler.bind(this));this.overlay.observe(&quot;click&quot;,this.clickHandler.bind(this))},findDataRanges:function(){var q=this.series,m=this.axes;m.x.datamin=0;m.x.datamax=0;m.x2.datamin=0;m.x2.datamax=0;m.y.datamin=0;m.y.datamax=0;m.y2.datamin=0;m.y2.datamax=0;if(q.length&gt;0){var e,b,g,n,l,d,p,k;for(e=0;e&lt;q.length;++e){d=q[e].data,p=q[e].xaxis,k=q[e].yaxis;if(d.length&gt;0&amp;&amp;!q[e].hide){if(!p.used){p.datamin=p.datamax=d[0][0]}if(!k.used){k.datamin=k.datamax=d[0][1]}p.used=true;k.used=true;for(g=d.length-1;g&gt;-1;--g){n=d[g][0];if(n&lt;p.datamin){p.datamin=n}else{if(n&gt;p.datamax){p.datamax=n}}for(b=1;b&lt;2;b++){l=d[g][b];if(l&lt;k.datamin){k.datamin=l}else{if(l&gt;k.datamax){k.datamax=l}}}}}}}this.findXAxesValues();this.calculateRange(m.x);this.extendXRangeIfNeededByBar(m.x);if(m.x2.used){this.calculateRange(m.x2);this.extendXRangeIfNeededByBar(m.x2)}this.calculateRange(m.y);this.extendYRangeIfNeededByBar(m.y);if(m.y2.used){this.calculateRange(m.y2);this.extendYRangeIfNeededByBar(m.y2)}},calculateRange:function(e){var k=e.options,d=k.min!=null?k.min:e.datamin,a=k.max!=null?k.max:e.datamax,g;if(a-d==0){var b=(a==0)?1:0.01;d-=b;a+=b}e.tickSize=Flotr.getTickSize(k.noTicks,d,a,k.tickDecimals);if(k.min==null){g=k.autoscaleMargin;if(g!=0){d-=e.tickSize*g;if(d&lt;0&amp;&amp;e.datamin&gt;=0){d=0}d=e.tickSize*Math.floor(d/e.tickSize)}}if(k.max==null){g=k.autoscaleMargin;if(g!=0){a+=e.tickSize*g;if(a&gt;0&amp;&amp;e.datamax&lt;=0){a=0}a=e.tickSize*Math.ceil(a/e.tickSize)}}e.min=d;e.max=a},extendXRangeIfNeededByBar:function(a){if(a.options.max==null){var g=a.max,d,p,l,k,n=[],e=null;for(d=0;d&lt;this.series.length;++d){p=this.series[d];l=p.bars;k=p.candles;if(p.axis==a&amp;&amp;(l.show||k.show)){if(!l.horizontal&amp;&amp;(l.barWidth+a.datamax&gt;g)||(k.candleWidth+a.datamax&gt;g)){g=a.max+p.bars.barWidth}if(l.stacked&amp;&amp;l.horizontal){for(j=0;j&lt;p.data.length;j++){if(p.bars.show&amp;&amp;p.bars.stacked){var m=p.data[j][0];n[m]=(n[m]||0)+p.data[j][1];e=p}}for(j=0;j&lt;n.length;j++){g=Math.max(n[j],g)}}}}a.lastSerie=e;a.max=g}},extendYRangeIfNeededByBar:function(a){if(a.options.max==null){var g=a.max,d,p,l,k,n=[],e=null;for(d=0;d&lt;this.series.length;++d){p=this.series[d];l=p.bars;k=p.candles;if(p.yaxis==a&amp;&amp;l.show&amp;&amp;!p.hide){if(l.horizontal&amp;&amp;(l.barWidth+a.datamax&gt;g)||(k.candleWidth+a.datamax&gt;g)){g=a.max+l.barWidth}if(l.stacked&amp;&amp;!l.horizontal){for(j=0;j&lt;p.data.length;j++){if(p.bars.show&amp;&amp;p.bars.stacked){var m=p.data[j][0];n[m]=(n[m]||0)+p.data[j][1];e=p}}for(j=0;j&lt;n.length;j++){g=Math.max(n[j],g)}}}}a.lastSerie=e;a.max=g}},findXAxesValues:function(){for(i=this.series.length-1;i&gt;-1;--i){s=this.series[i];s.xaxis.values=s.xaxis.values||[];for(j=s.data.length-1;j&gt;-1;--j){s.xaxis.values[s.data[j][0]]={}}}},calculateTicks:function(e){var b=e.options,g,m;e.ticks=[];if(b.ticks){var l=b.ticks,n,k;if(Object.isFunction(l)){l=l({min:e.min,max:e.max})}for(g=0;g&lt;l.length;++g){n=l[g];if(typeof(n)==&quot;object&quot;){m=n[0];k=(n.length&gt;1)?n[1]:b.tickFormatter(m)}else{m=n;k=b.tickFormatter(m)}e.ticks[g]={v:m,label:k}}}else{var a=e.tickSize*Math.ceil(e.min/e.tickSize),d;for(g=0;a+g*e.tickSize&lt;=e.max;++g){m=a+g*e.tickSize;d=b.tickDecimals;if(d==null){d=1-Math.floor(Math.log(e.tickSize)/Math.LN10)}if(d&lt;0){d=0}m=m.toFixed(d);e.ticks.push({v:m,label:b.tickFormatter(m)})}}},calculateSpacing:function(){var z=this.axes,B=this.options,q=this.series,g=B.grid.labelMargin,A=z.x,b=z.x2,u=z.y,v=z.y2,m=2,n,k,e,t;[A,b,u,v].each(function(l){var a=&quot;&quot;;if(l.options.showLabels){for(n=0;n&lt;l.ticks.length;++n){e=l.ticks[n].label.length;if(e&gt;a.length){a=l.ticks[n].label}}}l.maxLabel=this.getTextDimensions(a,{size:B.fontSize,angle:Flotr.toRad(l.options.labelsAngle)},&quot;font-size:smaller;&quot;,&quot;flotr-grid-label&quot;);l.titleSize=this.getTextDimensions(l.options.title,{size:B.fontSize*1.2,angle:Flotr.toRad(l.options.titleAngle)},&quot;font-weight:bold;&quot;,&quot;flotr-axis-title&quot;)},this);t=this.getTextDimensions(B.title,{size:B.fontSize*1.5},&quot;font-size:1em;font-weight:bold;&quot;,&quot;flotr-title&quot;);this.titleHeight=t.height;t=this.getTextDimensions(B.subtitle,{size:B.fontSize},&quot;font-size:smaller;&quot;,&quot;flotr-subtitle&quot;);this.subtitleHeight=t.height;if(B.show){m=Math.max(m,B.points.radius+B.points.lineWidth/2)}for(k=0;k&lt;B.length;++k){if(q[k].points.show){m=Math.max(m,q[k].points.radius+q[k].points.lineWidth/2)}}var d=this.plotOffset={left:0,right:0,top:0,bottom:0};d.left=d.right=d.top=d.bottom=m;d.bottom+=(A.options.showLabels?(A.maxLabel.height+g):0)+(A.options.title?(A.titleSize.height+g):0);d.top+=(b.options.showLabels?(b.maxLabel.height+g):0)+(b.options.title?(b.titleSize.height+g):0)+this.subtitleHeight+this.titleHeight;d.left+=(u.options.showLabels?(u.maxLabel.width+g):0)+(u.options.title?(u.titleSize.width+g):0);d.right+=(v.options.showLabels?(v.maxLabel.width+g):0)+(v.options.title?(v.titleSize.width+g):0);d.top=Math.floor(d.top);this.plotWidth=this.canvasWidth-d.left-d.right;this.plotHeight=this.canvasHeight-d.bottom-d.top;A.scale=this.plotWidth/(A.max-A.min);b.scale=this.plotWidth/(b.max-b.min);u.scale=this.plotHeight/(u.max-u.min);v.scale=this.plotHeight/(v.max-v.min)},draw:function(){this.drawGrid();this.drawLabels();this.drawTitles();if(this.series.length){this.el.fire(&quot;flotr:beforedraw&quot;,[this.series,this]);for(var a=0;a&lt;this.series.length;a++){if(!this.series[a].hide){this.drawSeries(this.series[a])}}}this.el.fire(&quot;flotr:afterdraw&quot;,[this.series,this])},tHoz:function(a,b){b=b||this.axes.x;return(a-b.min)*b.scale},tVert:function(b,a){a=a||this.axes.y;return this.plotHeight-(b-a.min)*a.scale},drawGrid:function(){var b,g=this.options,a=this.ctx;if(g.grid.verticalLines||g.grid.horizontalLines){this.el.fire(&quot;flotr:beforegrid&quot;,[this.axes.x,this.axes.y,g,this])}a.save();a.translate(this.plotOffset.left,this.plotOffset.top);if(g.grid.backgroundColor!=null){a.fillStyle=g.grid.backgroundColor;a.fillRect(0,0,this.plotWidth,this.plotHeight)}a.lineWidth=1;a.strokeStyle=g.grid.tickColor;a.beginPath();if(g.grid.verticalLines){for(var e=0;e&lt;this.axes.x.ticks.length;++e){b=this.axes.x.ticks[e].v;if((b==this.axes.x.min||b==this.axes.x.max)&amp;&amp;g.grid.outlineWidth!=0){continue}a.moveTo(Math.floor(this.tHoz(b))+a.lineWidth/2,0);a.lineTo(Math.floor(this.tHoz(b))+a.lineWidth/2,this.plotHeight)}}if(g.grid.horizontalLines){for(var d=0;d&lt;this.axes.y.ticks.length;++d){b=this.axes.y.ticks[d].v;if((b==this.axes.y.min||b==this.axes.y.max)&amp;&amp;g.grid.outlineWidth!=0){continue}a.moveTo(0,Math.floor(this.tVert(b))+a.lineWidth/2);a.lineTo(this.plotWidth,Math.floor(this.tVert(b))+a.lineWidth/2)}}a.stroke();if(g.grid.outlineWidth!=0){a.lineWidth=g.grid.outlineWidth;a.strokeStyle=g.grid.color;a.lineJoin=&quot;round&quot;;a.strokeRect(0,0,this.plotWidth,this.plotHeight)}a.restore();if(g.grid.verticalLines||g.grid.horizontalLines){this.el.fire(&quot;flotr:aftergrid&quot;,[this.axes.x,this.axes.y,g,this])}},drawLabels:function(){var e=0,g,d,k,l,m,q=this.options,p=this.ctx,n=this.axes;for(k=0;k&lt;n.x.ticks.length;++k){if(n.x.ticks[k].label){++e}}d=this.plotWidth/e;if(!q.HtmlText&amp;&amp;this.textEnabled){var b={size:q.fontSize,adjustAlign:true};g=n.x;b.color=g.options.color||q.grid.color;for(k=0;k&lt;g.ticks.length&amp;&amp;g.options.showLabels&amp;&amp;g.used;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}b.angle=Flotr.toRad(g.options.labelsAngle);b.halign=&quot;c&quot;;b.valign=&quot;t&quot;;p.drawText(m.label,this.plotOffset.left+this.tHoz(m.v,g),this.plotOffset.top+this.plotHeight+q.grid.labelMargin,b)}g=n.x2;b.color=g.options.color||q.grid.color;for(k=0;k&lt;g.ticks.length&amp;&amp;g.options.showLabels&amp;&amp;g.used;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}b.angle=Flotr.toRad(g.options.labelsAngle);b.halign=&quot;c&quot;;b.valign=&quot;b&quot;;p.drawText(m.label,this.plotOffset.left+this.tHoz(m.v,g),this.plotOffset.top+q.grid.labelMargin,b)}g=n.y;b.color=g.options.color||q.grid.color;for(k=0;k&lt;g.ticks.length&amp;&amp;g.options.showLabels&amp;&amp;g.used;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}b.angle=Flotr.toRad(g.options.labelsAngle);b.halign=&quot;r&quot;;b.valign=&quot;m&quot;;p.drawText(m.label,this.plotOffset.left-q.grid.labelMargin,this.plotOffset.top+this.tVert(m.v,g),b)}g=n.y2;b.color=g.options.color||q.grid.color;for(k=0;k&lt;g.ticks.length&amp;&amp;g.options.showLabels&amp;&amp;g.used;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}b.angle=Flotr.toRad(g.options.labelsAngle);b.halign=&quot;l&quot;;b.valign=&quot;m&quot;;p.drawText(m.label,this.plotOffset.left+this.plotWidth+q.grid.labelMargin,this.plotOffset.top+this.tVert(m.v,g),b);p.save();p.strokeStyle=b.color;p.beginPath();p.moveTo(this.plotOffset.left+this.plotWidth-8,this.plotOffset.top+this.tVert(m.v,g));p.lineTo(this.plotOffset.left+this.plotWidth,this.plotOffset.top+this.tVert(m.v,g));p.stroke();p.restore()}}else{if(n.x.options.showLabels||n.x2.options.showLabels||n.y.options.showLabels||n.y2.options.showLabels){l=['&lt;div style=&quot;font-size:smaller;color:'+q.grid.color+';&quot; class=&quot;flotr-labels&quot;&gt;'];g=n.x;if(g.options.showLabels){for(k=0;k&lt;g.ticks.length;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}l.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.plotHeight+q.grid.labelMargin)+&quot;px;left:&quot;+(this.plotOffset.left+this.tHoz(m.v,g)-d/2)+&quot;px;width:&quot;+d+&quot;px;text-align:center;&quot;+(g.options.color?(&quot;color:&quot;+g.options.color+&quot;;&quot;):&quot;&quot;)+'&quot; class=&quot;flotr-grid-label&quot;&gt;'+m.label+&quot;&lt;/div&gt;&quot;)}}g=n.x2;if(g.options.showLabels&amp;&amp;g.used){for(k=0;k&lt;g.ticks.length;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}l.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top-q.grid.labelMargin-g.maxLabel.height)+&quot;px;left:&quot;+(this.plotOffset.left+this.tHoz(m.v,g)-d/2)+&quot;px;width:&quot;+d+&quot;px;text-align:center;&quot;+(g.options.color?(&quot;color:&quot;+g.options.color+&quot;;&quot;):&quot;&quot;)+'&quot; class=&quot;flotr-grid-label&quot;&gt;'+m.label+&quot;&lt;/div&gt;&quot;)}}g=n.y;if(g.options.showLabels){for(k=0;k&lt;g.ticks.length;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}l.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.tVert(m.v,g)-g.maxLabel.height/2)+&quot;px;left:0;width:&quot;+(this.plotOffset.left-q.grid.labelMargin)+&quot;px;text-align:right;&quot;+(g.options.color?(&quot;color:&quot;+g.options.color+&quot;;&quot;):&quot;&quot;)+'&quot; class=&quot;flotr-grid-label&quot;&gt;'+m.label+&quot;&lt;/div&gt;&quot;)}}g=n.y2;if(g.options.showLabels&amp;&amp;g.used){p.save();p.strokeStyle=g.options.color||q.grid.color;p.beginPath();for(k=0;k&lt;g.ticks.length;++k){m=g.ticks[k];if(!m.label||m.label.length==0){continue}l.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.tVert(m.v,g)-g.maxLabel.height/2)+&quot;px;right:0;width:&quot;+(this.plotOffset.right-q.grid.labelMargin)+&quot;px;text-align:left;&quot;+(g.options.color?(&quot;color:&quot;+g.options.color+&quot;;&quot;):&quot;&quot;)+'&quot; class=&quot;flotr-grid-label&quot;&gt;'+m.label+&quot;&lt;/div&gt;&quot;);p.moveTo(this.plotOffset.left+this.plotWidth-8,this.plotOffset.top+this.tVert(m.v,g));p.lineTo(this.plotOffset.left+this.plotWidth,this.plotOffset.top+this.tVert(m.v,g))}p.stroke();p.restore()}l.push(&quot;&lt;/div&gt;&quot;);this.el.insert(l.join(&quot;&quot;))}}},drawTitles:function(){var g,e=this.options,l=e.grid.labelMargin,d=this.ctx,b=this.axes;if(!e.HtmlText&amp;&amp;this.textEnabled){var k={size:e.fontSize,color:e.grid.color,halign:&quot;c&quot;};if(e.subtitle){d.drawText(e.subtitle,this.plotOffset.left+this.plotWidth/2,this.titleHeight+this.subtitleHeight-2,k)}k.weight=1.5;k.size*=1.5;if(e.title){d.drawText(e.title,this.plotOffset.left+this.plotWidth/2,this.titleHeight-2,k)}k.weight=1.8;k.size*=0.8;k.adjustAlign=true;if(b.x.options.title&amp;&amp;b.x.used){k.halign=&quot;c&quot;;k.valign=&quot;t&quot;;k.angle=Flotr.toRad(b.x.options.titleAngle);d.drawText(b.x.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+b.x.maxLabel.height+this.plotHeight+2*l,k)}if(b.x2.options.title&amp;&amp;b.x2.used){k.halign=&quot;c&quot;;k.valign=&quot;b&quot;;k.angle=Flotr.toRad(b.x2.options.titleAngle);d.drawText(b.x2.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top-b.x2.maxLabel.height-2*l,k)}if(b.y.options.title&amp;&amp;b.y.used){k.halign=&quot;r&quot;;k.valign=&quot;m&quot;;k.angle=Flotr.toRad(b.y.options.titleAngle);d.drawText(b.y.options.title,this.plotOffset.left-b.y.maxLabel.width-2*l,this.plotOffset.top+this.plotHeight/2,k)}if(b.y2.options.title&amp;&amp;b.y2.used){k.halign=&quot;l&quot;;k.valign=&quot;m&quot;;k.angle=Flotr.toRad(b.y2.options.titleAngle);d.drawText(b.y2.options.title,this.plotOffset.left+this.plotWidth+b.y2.maxLabel.width+2*l,this.plotOffset.top+this.plotHeight/2,k)}}else{g=['&lt;div style=&quot;color:'+e.grid.color+';&quot; class=&quot;flotr-titles&quot;&gt;'];if(e.title){g.push('&lt;div style=&quot;position:absolute;top:0;left:'+this.plotOffset.left+&quot;px;font-size:1em;font-weight:bold;text-align:center;width:&quot;+this.plotWidth+'px;&quot; class=&quot;flotr-title&quot;&gt;'+e.title+&quot;&lt;/div&gt;&quot;)}if(e.subtitle){g.push('&lt;div style=&quot;position:absolute;top:'+this.titleHeight+&quot;px;left:&quot;+this.plotOffset.left+&quot;px;font-size:smaller;text-align:center;width:&quot;+this.plotWidth+'px;&quot; class=&quot;flotr-subtitle&quot;&gt;'+e.subtitle+&quot;&lt;/div&gt;&quot;)}g.push(&quot;&lt;/div&gt;&quot;);g.push('&lt;div class=&quot;flotr-axis-title&quot; style=&quot;font-weight:bold;&quot;&gt;');if(b.x.options.title&amp;&amp;b.x.used){g.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.plotHeight+e.grid.labelMargin+b.x.titleSize.height)+&quot;px;left:&quot;+this.plotOffset.left+&quot;px;width:&quot;+this.plotWidth+'px;text-align:center;&quot; class=&quot;flotr-axis-title&quot;&gt;'+b.x.options.title+&quot;&lt;/div&gt;&quot;)}if(b.x2.options.title&amp;&amp;b.x2.used){g.push('&lt;div style=&quot;position:absolute;top:0;left:'+this.plotOffset.left+&quot;px;width:&quot;+this.plotWidth+'px;text-align:center;&quot; class=&quot;flotr-axis-title&quot;&gt;'+b.x2.options.title+&quot;&lt;/div&gt;&quot;)}if(b.y.options.title&amp;&amp;b.y.used){g.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.plotHeight/2-b.y.titleSize.height/2)+'px;left:0;text-align:right;&quot; class=&quot;flotr-axis-title&quot;&gt;'+b.y.options.title+&quot;&lt;/div&gt;&quot;)}if(b.y2.options.title&amp;&amp;b.y2.used){g.push('&lt;div style=&quot;position:absolute;top:'+(this.plotOffset.top+this.plotHeight/2-b.y.titleSize.height/2)+'px;right:0;text-align:right;&quot; class=&quot;flotr-axis-title&quot;&gt;'+b.y2.options.title+&quot;&lt;/div&gt;&quot;)}g.push(&quot;&lt;/div&gt;&quot;);this.el.insert(g.join(&quot;&quot;))}},drawSeries:function(a){a=a||this.series;var d=false;for(var b in Flotr._registeredTypes){if(a[b]&amp;&amp;a[b].show){this[Flotr._registeredTypes[b]](a);d=true}}if(!d){this[Flotr._registeredTypes[this.options.defaultType]](a)}},plotLine:function(n,k){var z=this.ctx,a=n.xaxis,q=n.yaxis,p=this.tHoz.bind(this),u=this.tVert.bind(this),m=n.data;if(m.length&lt;2){return}var g=p(m[0][0],a),e=u(m[0][1],q)+k;z.beginPath();z.moveTo(g,e);for(var l=0;l&lt;m.length-1;++l){var d=m[l][0],v=m[l][1],b=m[l+1][0],t=m[l+1][1];if(v===null||t===null){continue}if(v&lt;=t&amp;&amp;v&lt;q.min){if(t&lt;q.min){continue}d=(q.min-v)/(t-v)*(b-d)+d;v=q.min}else{if(t&lt;=v&amp;&amp;t&lt;q.min){if(v&lt;q.min){continue}b=(q.min-v)/(t-v)*(b-d)+d;t=q.min}}if(v&gt;=t&amp;&amp;v&gt;q.max){if(t&gt;q.max){continue}d=(q.max-v)/(t-v)*(b-d)+d;v=q.max}else{if(t&gt;=v&amp;&amp;t&gt;q.max){if(v&gt;q.max){continue}b=(q.max-v)/(t-v)*(b-d)+d;t=q.max}}if(d&lt;=b&amp;&amp;d&lt;a.min){if(b&lt;a.min){continue}v=(a.min-d)/(b-d)*(t-v)+v;d=a.min}else{if(b&lt;=d&amp;&amp;b&lt;a.min){if(d&lt;a.min){continue}t=(a.min-d)/(b-d)*(t-v)+v;b=a.min}}if(d&gt;=b&amp;&amp;d&gt;a.max){if(b&gt;a.max){continue}v=(a.max-d)/(b-d)*(t-v)+v;d=a.max}else{if(b&gt;=d&amp;&amp;b&gt;a.max){if(d&gt;a.max){continue}t=(a.max-d)/(b-d)*(t-v)+v;b=a.max}}if(g!=p(d,a)||e!=u(v,q)+k){z.moveTo(p(d,a),u(v,q)+k)}g=p(b,a);e=u(t,q)+k;z.lineTo(g,e)}z.stroke()},plotLineArea:function(p,e){var D=p.data;if(D.length&lt;2){return}var t,l=0,v=this.ctx,B=p.xaxis,b=p.yaxis,g=this.tHoz.bind(this),u=this.tVert.bind(this),m=Math.min(Math.max(0,b.min),b.max),k=true;v.beginPath();for(var z=0;z&lt;D.length-1;++z){var C=D[z][0],d=D[z][1],A=D[z+1][0],a=D[z+1][1];if(C&lt;=A&amp;&amp;C&lt;B.min){if(A&lt;B.min){continue}d=(B.min-C)/(A-C)*(a-d)+d;C=B.min}else{if(A&lt;=C&amp;&amp;A&lt;B.min){if(C&lt;B.min){continue}a=(B.min-C)/(A-C)*(a-d)+d;A=B.min}}if(C&gt;=A&amp;&amp;C&gt;B.max){if(A&gt;B.max){continue}d=(B.max-C)/(A-C)*(a-d)+d;C=B.max}else{if(A&gt;=C&amp;&amp;A&gt;B.max){if(C&gt;B.max){continue}a=(B.max-C)/(A-C)*(a-d)+d;A=B.max}}if(k){v.moveTo(g(C,B),u(m,b)+e);k=false}if(d&gt;=b.max&amp;&amp;a&gt;=b.max){v.lineTo(g(C,B),u(b.max,b)+e);v.lineTo(g(A,B),u(b.max,b)+e);continue}else{if(d&lt;=b.min&amp;&amp;a&lt;=b.min){v.lineTo(g(C,B),u(b.min,b)+e);v.lineTo(g(A,B),u(b.min,b)+e);continue}}var n=C,q=A;if(d&lt;=a&amp;&amp;d&lt;b.min&amp;&amp;a&gt;=b.min){C=(b.min-d)/(a-d)*(A-C)+C;d=b.min}else{if(a&lt;=d&amp;&amp;a&lt;b.min&amp;&amp;d&gt;=b.min){A=(b.min-d)/(a-d)*(A-C)+C;a=b.min}}if(d&gt;=a&amp;&amp;d&gt;b.max&amp;&amp;a&lt;=b.max){C=(b.max-d)/(a-d)*(A-C)+C;d=b.max}else{if(a&gt;=d&amp;&amp;a&gt;b.max&amp;&amp;d&lt;=b.max){A=(b.max-d)/(a-d)*(A-C)+C;a=b.max}}if(C!=n){t=(d&lt;=b.min)?t=b.min:b.max;v.lineTo(g(n,B),u(t,b)+e);v.lineTo(g(C,B),u(t,b)+e)}v.lineTo(g(C,B),u(d,b)+e);v.lineTo(g(A,B),u(a,b)+e);if(A!=q){t=(a&lt;=b.min)?b.min:b.max;v.lineTo(g(q,B),u(t,b)+e);v.lineTo(g(A,B),u(t,b)+e)}l=Math.max(A,q)}v.lineTo(g(l,B),u(m,b)+e);v.closePath();v.fill()},drawSeriesLines:function(d){d=d||this.series;var b=this.ctx;b.save();b.translate(this.plotOffset.left,this.plotOffset.top);b.lineJoin=&quot;round&quot;;var e=d.lines.lineWidth;var a=d.shadowSize;if(a&gt;0){b.lineWidth=a/2;var g=e/2+b.lineWidth/2;b.strokeStyle=&quot;rgba(0,0,0,0.1)&quot;;this.plotLine(d,g+a/2);b.strokeStyle=&quot;rgba(0,0,0,0.2)&quot;;this.plotLine(d,g);if(d.lines.fill){b.fillStyle=&quot;rgba(0,0,0,0.05)&quot;;this.plotLineArea(d,g+a/2)}}b.lineWidth=e;b.strokeStyle=d.color;if(d.lines.fill){b.fillStyle=d.lines.fillColor!=null?d.lines.fillColor:Flotr.parseColor(d.color).scale(null,null,null,d.lines.fillOpacity).toString();this.plotLineArea(d,0)}this.plotLine(d,0);b.restore()},drawSeriesPoints:function(d){var b=this.ctx;b.save();b.translate(this.plotOffset.left,this.plotOffset.top);var e=d.lines.lineWidth;var a=d.shadowSize;if(a&gt;0){b.lineWidth=a/2;b.strokeStyle=&quot;rgba(0,0,0,0.1)&quot;;this.plotPointShadows(d,a/2+b.lineWidth/2,d.points.radius);b.strokeStyle=&quot;rgba(0,0,0,0.2)&quot;;this.plotPointShadows(d,b.lineWidth/2,d.points.radius)}b.lineWidth=d.points.lineWidth;b.strokeStyle=d.color;b.fillStyle=d.points.fillColor!=null?d.points.fillColor:d.color;this.plotPoints(d,d.points.radius,d.points.fill);b.restore()},plotPoints:function(d,g,n){var a=d.xaxis,k=d.yaxis,p=this.ctx,e,b=d.data;for(e=b.length-1;e&gt;-1;--e){var m=b[e][0],l=b[e][1];if(m&lt;a.min||m&gt;a.max||l&lt;k.min||l&gt;k.max){continue}p.beginPath();p.arc(this.tHoz(m,a),this.tVert(l,k),g,0,2*Math.PI,true);if(n){p.fill()}p.stroke()}},plotPointShadows:function(e,b,k){var a=e.xaxis,l=e.yaxis,p=this.ctx,g,d=e.data;for(g=d.length-1;g&gt;-1;--g){var n=d[g][0],m=d[g][1];if(n&lt;a.min||n&gt;a.max||m&lt;l.min||m&gt;l.max){continue}p.beginPath();p.arc(this.tHoz(n,a),this.tVert(m,l)+b,k,0,Math.PI,false);p.stroke()}},drawSeriesBars:function(b){var a=this.ctx,e=b.bars.barWidth,d=Math.min(b.bars.lineWidth,e);a.save();a.translate(this.plotOffset.left,this.plotOffset.top);a.lineJoin=&quot;miter&quot;;a.lineWidth=d;a.strokeStyle=b.color;this.plotBarsShadows(b,e,0,b.bars.fill);if(b.bars.fill){a.fillStyle=b.bars.fillColor!=null?b.bars.fillColor:Flotr.parseColor(b.color).scale(null,null,null,b.bars.fillOpacity).toString()}this.plotBars(b,e,0,b.bars.fill);a.restore()},plotBars:function(q,v,e,B){var J=q.data;if(J.length&lt;1){return}var D=q.xaxis,b=q.yaxis,A=this.ctx,k=this.tHoz.bind(this),z=this.tVert.bind(this);for(var C=0;C&lt;J.length;C++){var p=J[C][0],n=J[C][1];var g=true,t=true,a=true;var m=0;if(q.bars.stacked){D.values.each(function(L,K){if(K==p){m=L.stack||0;L.stack=m+n}})}if(q.bars.horizontal){var d=m,E=p+m,l=n,u=n+v}else{var d=p,E=p+v,l=m,u=n+m}if(E&lt;D.min||d&gt;D.max||u&lt;b.min||l&gt;b.max){continue}if(d&lt;D.min){d=D.min;g=false}if(E&gt;D.max){E=D.max;if(D.lastSerie!=q&amp;&amp;q.bars.horizontal){t=false}}if(l&lt;b.min){l=b.min}if(u&gt;b.max){u=b.max;if(b.lastSerie!=q&amp;&amp;!q.bars.horizontal){t=false}}if(B){A.beginPath();A.moveTo(k(d,D),z(l,b)+e);A.lineTo(k(d,D),z(u,b)+e);A.lineTo(k(E,D),z(u,b)+e);A.lineTo(k(E,D),z(l,b)+e);A.fill()}if(q.bars.lineWidth!=0&amp;&amp;(g||a||t)){A.beginPath();A.moveTo(k(d,D),z(l,b)+e);A[g?&quot;lineTo&quot;:&quot;moveTo&quot;](k(d,D),z(u,b)+e);A[t?&quot;lineTo&quot;:&quot;moveTo&quot;](k(E,D),z(u,b)+e);A[a?&quot;lineTo&quot;:&quot;moveTo&quot;](k(E,D),z(l,b)+e);A.stroke()}}},plotBarsShadows:function(n,q,d){var E=n.data;if(E.length&lt;1){return}var C=n.xaxis,a=n.yaxis,A=this.ctx,e=this.tHoz.bind(this),u=this.tVert.bind(this),v=this.options.shadowSize;for(var B=0;B&lt;E.length;B++){var m=E[B][0],l=E[B][1];var g=0;if(n.bars.stacked){C.values.each(function(K,J){if(J==m){g=K.stackShadow||0;K.stackShadow=g+l}})}if(n.bars.horizontal){var b=g,D=m+g,k=l,p=l+q}else{var b=m,D=m+q,k=g,p=l+g}if(D&lt;C.min||b&gt;C.max||p&lt;a.min||k&gt;a.max){continue}if(b&lt;C.min){b=C.min}if(D&gt;C.max){D=C.max}if(k&lt;a.min){k=a.min}if(p&gt;a.max){p=a.max}var z=e(D,C)-e(b,C)-((e(D,C)+v&lt;=this.plotWidth)?0:v);var t=Math.max(0,u(k,a)-u(p,a)-((u(k,a)+v&lt;=this.plotHeight)?0:v));A.fillStyle=&quot;rgba(0,0,0,0.05)&quot;;A.fillRect(Math.min(e(b,C)+v,this.plotWidth),Math.min(u(p,a)+v,this.plotWidth),z,t)}},drawSeriesCandles:function(b){var a=this.ctx,d=b.candles.candleWidth;a.save();a.translate(this.plotOffset.left,this.plotOffset.top);a.lineJoin=&quot;miter&quot;;a.lineWidth=b.candles.lineWidth;this.plotCandlesShadows(b,d/2);this.plotCandles(b,d/2);a.restore()},plotCandles:function(t,g){var M=t.data;if(M.length&lt;1){return}var J=t.xaxis,b=t.yaxis,B=this.ctx,k=this.tHoz.bind(this),A=this.tVert.bind(this);for(var E=0;E&lt;M.length;E++){var K=M[E],q=K[0],u=K[1],p=K[2],N=K[3],z=K[4];var e=q,L=q+t.candles.candleWidth,m=Math.max(b.min,N),v=Math.min(b.max,p),a=Math.max(b.min,Math.min(u,z)),D=Math.min(b.max,Math.max(u,z));if(L&lt;J.min||e&gt;J.max||v&lt;b.min||m&gt;b.max){continue}var C=t.candles[u&gt;z?&quot;downFillColor&quot;:&quot;upFillColor&quot;];if(t.candles.fill&amp;&amp;!t.candles.barcharts){B.fillStyle=Flotr.parseColor(C).scale(null,null,null,t.candles.fillOpacity).toString();B.fillRect(k(e,J),A(D,b)+g,k(L,J)-k(e,J),A(a,b)-A(D,b))}if(t.candles.lineWidth||t.candles.wickLineWidth){var q,n,l=(t.candles.wickLineWidth%2)/2;q=Math.floor(k((e+L)/2),J)+l;B.save();B.strokeStyle=C;B.lineWidth=t.candles.wickLineWidth;B.lineCap=&quot;butt&quot;;if(t.candles.barcharts){B.beginPath();B.moveTo(q,Math.floor(A(v,b)+g));B.lineTo(q,Math.floor(A(m,b)+g));n=Math.floor(A(u,b)+g)+0.5;B.moveTo(Math.floor(k(e,J))+l,n);B.lineTo(q,n);n=Math.floor(A(z,b)+g)+0.5;B.moveTo(Math.floor(k(L,J))+l,n);B.lineTo(q,n)}else{B.strokeRect(k(e,J),A(D,b)+g,k(L,J)-k(e,J),A(a,b)-A(D,b));B.beginPath();B.moveTo(q,Math.floor(A(D,b)+g));B.lineTo(q,Math.floor(A(v,b)+g));B.moveTo(q,Math.floor(A(a,b)+g));B.lineTo(q,Math.floor(A(m,b)+g))}B.stroke();B.restore()}}},plotCandlesShadows:function(n,e){var J=n.data;if(J.length&lt;1||n.candles.barcharts){return}var C=n.xaxis,a=n.yaxis,g=this.tHoz.bind(this),v=this.tVert.bind(this),z=this.options.shadowSize;for(var B=0;B&lt;J.length;B++){var D=J[B],m=D[0],p=D[1],l=D[2],K=D[3],t=D[4];var b=m,E=m+n.candles.candleWidth,k=Math.max(a.min,Math.min(p,t)),q=Math.min(a.max,Math.max(p,t));if(E&lt;C.min||b&gt;C.max||q&lt;a.min||k&gt;a.max){continue}var A=g(E,C)-g(b,C)-((g(E,C)+z&lt;=this.plotWidth)?0:z);var u=Math.max(0,v(k,a)-v(q,a)-((v(k,a)+z&lt;=this.plotHeight)?0:z));this.ctx.fillStyle=&quot;rgba(0,0,0,0.05)&quot;;this.ctx.fillRect(Math.min(g(b,C)+z,this.plotWidth),Math.min(v(q,a)+z,this.plotWidth),A,u)}},drawSeriesPie:function(l){if(!this.options.pie.drawn){var q=this.ctx,d=this.options,g=l.pie.lineWidth,n=l.shadowSize,C=l.data,e=(Math.min(this.canvasWidth,this.canvasHeight)*l.pie.sizeRatio)/2,m=[];var t=1;var A=Math.sin(l.pie.viewAngle)*l.pie.spliceThickness/t;var u={size:d.fontSize*1.2,color:d.grid.color,weight:1.5};var B={x:(this.canvasWidth+this.plotOffset.left)/2,y:(this.canvasHeight-this.plotOffset.bottom)/2};var z=this.series.collect(function(E,D){if(E.pie.show){return{name:(E.label||E.data[0][1]),value:[D,E.data[0][1]],explode:E.pie.explode}}});var b=z.pluck(&quot;value&quot;).pluck(1).inject(0,function(D,E){return D+E});var k=0,v=l.pie.startAngle,p=0;var a=z.collect(function(D){v+=k;p=parseFloat(D.value[1]);k=p/b;return{name:D.name,fraction:k,x:D.value[0],y:p,explode:D.explode,startAngle:2*v*Math.PI,endAngle:2*(v+k)*Math.PI}});q.save();if(n&gt;0){a.each(function(K){var D=(K.startAngle+K.endAngle)/2;var E=B.x+Math.cos(D)*K.explode+n;var J=B.y+Math.sin(D)*K.explode+n;this.plotSlice(E,J,e,K.startAngle,K.endAngle,false,t);q.fillStyle=&quot;rgba(0,0,0,0.1)&quot;;q.fill()},this)}if(d.HtmlText){m=['&lt;div style=&quot;color:'+this.options.grid.color+'&quot; class=&quot;flotr-labels&quot;&gt;']}a.each(function(R,M){var L=(R.startAngle+R.endAngle)/2;var K=d.colors[M];var N=B.x+Math.cos(L)*R.explode;var J=B.y+Math.sin(L)*R.explode;this.plotSlice(N,J,e,R.startAngle,R.endAngle,false,t);if(l.pie.fill){q.fillStyle=Flotr.parseColor(K).scale(null,null,null,l.pie.fillOpacity).toString();q.fill()}q.lineWidth=g;q.strokeStyle=K;q.stroke();var Q=d.pie.labelFormatter(R);var D=(Math.cos(L)&lt;0);var P=N+Math.cos(L)*(l.pie.explode+e);var O=J+Math.sin(L)*(l.pie.explode+e);if(R.fraction&amp;&amp;Q){if(d.HtmlText){var E=&quot;position:absolute;top:&quot;+(O-5)+&quot;px;&quot;;if(D){E+=&quot;right:&quot;+(this.canvasWidth-P)+&quot;px;text-align:right;&quot;}else{E+=&quot;left:&quot;+P+&quot;px;text-align:left;&quot;}m.push('&lt;div style=&quot;'+E+'&quot; class=&quot;flotr-grid-label&quot;&gt;'+Q+&quot;&lt;/div&gt;&quot;)}else{u.halign=D?&quot;r&quot;:&quot;l&quot;;q.drawText(Q,P,O+u.size/2,u)}}},this);if(d.HtmlText){m.push(&quot;&lt;/div&gt;&quot;);this.el.insert(m.join(&quot;&quot;))}q.restore();d.pie.drawn=true}},plotSlice:function(b,m,a,g,e,k,l){var d=this.ctx;l=l||1;d.save();d.scale(1,l);d.beginPath();d.moveTo(b,m);d.arc(b,m,a,g,e,k);d.lineTo(b,m);d.closePath();d.restore()},plotPie:function(){},insertLegend:function(){if(!this.options.legend.show){return}var n=this.series,q=this.plotOffset,b=this.options,S=[],a=false,B=this.ctx,E;var D=n.findAll(function(m){return(m.label&amp;&amp;!m.hide)}).size();if(D){if(!b.HtmlText&amp;&amp;this.textEnabled){var K={size:b.fontSize*1.1,color:b.grid.color};var z=b.legend.position,A=b.legend.margin,v=b.legend.labelBoxWidth,Q=b.legend.labelBoxHeight,J=b.legend.labelBoxMargin,N=q.left+A,L=q.top+A;var R=0;for(E=n.length-1;E&gt;-1;--E){if(!n[E].label||n[E].hide){continue}var g=b.legend.labelFormatter(n[E].label);R=Math.max(R,B.measureText(g,K))}var u=Math.round(v+J*3+R),d=Math.round(D*(J+Q)+J);if(z.charAt(0)==&quot;s&quot;){L=q.top+this.plotHeight-(A+d)}if(z.charAt(1)==&quot;e&quot;){N=q.left+this.plotWidth-(A+u)}var C=Flotr.parseColor(b.legend.backgroundColor||&quot;rgb(240,240,240)&quot;).scale(null,null,null,b.legend.backgroundOpacity||0.1).toString();B.fillStyle=C;B.fillRect(N,L,u,d);B.strokeStyle=b.legend.labelBoxBorderColor;B.strokeRect(Flotr.toPixel(N),Flotr.toPixel(L),u,d);var l=N+J;var k=L+J;for(E=0;E&lt;n.length;E++){if(!n[E].label||n[E].hide){continue}var g=b.legend.labelFormatter(n[E].label);B.fillStyle=n[E].color;B.fillRect(l,k,v-1,Q-1);B.strokeStyle=b.legend.labelBoxBorderColor;B.lineWidth=1;B.strokeRect(Math.ceil(l)-1.5,Math.ceil(k)-1.5,v+2,Q+2);B.drawText(g,l+v+J,k+(Q+K.size-B.fontDescent(K))/2,K);k+=Q+J}}else{for(E=0;E&lt;n.length;++E){if(!n[E].label||n[E].hide){continue}if(E%b.legend.noColumns==0){S.push(a?&quot;&lt;/tr&gt;&lt;tr&gt;&quot;:&quot;&lt;tr&gt;&quot;);a=true}var g=b.legend.labelFormatter(n[E].label);S.push('&lt;td class=&quot;flotr-legend-color-box&quot;&gt;&lt;div style=&quot;border:1px solid '+b.legend.labelBoxBorderColor+';padding:1px&quot;&gt;&lt;div style=&quot;width:'+b.legend.labelBoxWidth+&quot;px;height:&quot;+b.legend.labelBoxHeight+&quot;px;background-color:&quot;+n[E].color+'&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&quot;flotr-legend-label&quot;&gt;'+g+&quot;&lt;/td&gt;&quot;)}if(a){S.push(&quot;&lt;/tr&gt;&quot;)}if(S.length&gt;0){var M='&lt;table style=&quot;font-size:smaller;color:'+b.grid.color+'&quot;&gt;'+S.join(&quot;&quot;)+&quot;&lt;/table&gt;&quot;;if(b.legend.container!=null){$(b.legend.container).update(M)}else{var e=&quot;&quot;;var z=b.legend.position,A=b.legend.margin;if(z.charAt(0)==&quot;n&quot;){e+=&quot;top:&quot;+(A+q.top)+&quot;px;&quot;}else{if(z.charAt(0)==&quot;s&quot;){e+=&quot;bottom:&quot;+(A+q.bottom)+&quot;px;&quot;}}if(z.charAt(1)==&quot;e&quot;){e+=&quot;right:&quot;+(A+q.right)+&quot;px;&quot;}else{if(z.charAt(1)==&quot;w&quot;){e+=&quot;left:&quot;+(A+q.left)+&quot;px;&quot;}}var t=this.el.insert('&lt;div class=&quot;flotr-legend&quot; style=&quot;position:absolute;z-index:2;'+e+'&quot;&gt;'+M+&quot;&lt;/div&gt;&quot;).select(&quot;div.flotr-legend&quot;).first();if(b.legend.backgroundOpacity!=0){var P=b.legend.backgroundColor;if(P==null){var O=(b.grid.backgroundColor!=null)?b.grid.backgroundColor:Flotr.extractColor(t);P=Flotr.parseColor(O).adjust(null,null,null,1).toString()}this.el.insert('&lt;div class=&quot;flotr-legend-bg&quot; style=&quot;position:absolute;width:'+t.getWidth()+&quot;px;height:&quot;+t.getHeight()+&quot;px;&quot;+e+&quot;background-color:&quot;+P+';&quot;&gt; &lt;/div&gt;').select(&quot;div.flotr-legend-bg&quot;).first().setStyle({opacity:b.legend.backgroundOpacity})}}}}}},getEventPosition:function(e){var m=this.overlay.cumulativeOffset(),l=(e.pageX-m.left-this.plotOffset.left),k=(e.pageY-m.top-this.plotOffset.top),g=0,d=0;if(e.pageX==null&amp;&amp;e.clientX!=null){var n=document.documentElement,a=document.body;g=e.clientX+(n&amp;&amp;n.scrollLeft||a.scrollLeft||0);d=e.clientY+(n&amp;&amp;n.scrollTop||a.scrollTop||0)}else{g=e.pageX;d=e.pageY}return{x:this.axes.x.min+l/this.axes.x.scale,x2:this.axes.x2.min+l/this.axes.x2.scale,y:this.axes.y.max-k/this.axes.y.scale,y2:this.axes.y2.max-k/this.axes.y2.scale,relX:l,relY:k,absX:g,absY:d}},clickHandler:function(a){if(this.ignoreClick){this.ignoreClick=false;return}this.el.fire(&quot;flotr:click&quot;,[this.getEventPosition(a),this])},mouseMoveHandler:function(a){var b=this.getEventPosition(a);this.lastMousePos.pageX=b.absX;this.lastMousePos.pageY=b.absY;if(this.selectionInterval==null&amp;&amp;(this.options.mouse.track||this.series.any(function(d){return d.mouse&amp;&amp;d.mouse.track}))){this.hit(b)}this.el.fire(&quot;flotr:mousemove&quot;,[a,b,this])},mouseDownHandler:function(d){if(d.isRightClick()){d.stop();var b=this.overlay;b.hide();function a(){b.show();$(document).stopObserving(&quot;mousemove&quot;,a)}$(document).observe(&quot;mousemove&quot;,a);return}if(!this.options.selection.mode||!d.isLeftClick()){return}this.setSelectionPos(this.selection.first,d);if(this.selectionInterval!=null){clearInterval(this.selectionInterval)}this.lastMousePos.pageX=null;this.selectionInterval=setInterval(this.updateSelection.bind(this),1000/this.options.selection.fps);this.mouseUpHandler=this.mouseUpHandler.bind(this);$(document).observe(&quot;mouseup&quot;,this.mouseUpHandler)},fireSelectEvent:function(){var b=this.axes,l=this.selection,e=(l.first.x&lt;=l.second.x)?l.first.x:l.second.x,d=(l.first.x&lt;=l.second.x)?l.second.x:l.first.x,k=(l.first.y&gt;=l.second.y)?l.first.y:l.second.y,g=(l.first.y&gt;=l.second.y)?l.second.y:l.first.y;e=b.x.min+e/b.x.scale;d=b.x.min+d/b.x.scale;k=b.y.max-k/b.y.scale;g=b.y.max-g/b.y.scale;this.el.fire(&quot;flotr:select&quot;,[{x1:e,y1:k,x2:d,y2:g},this])},mouseUpHandler:function(a){$(document).stopObserving(&quot;mouseup&quot;,this.mouseUpHandler);a.stop();if(this.selectionInterval!=null){clearInterval(this.selectionInterval);this.selectionInterval=null}this.setSelectionPos(this.selection.second,a);this.clearSelection();if(this.selectionIsSane()){this.drawSelection();this.fireSelectEvent();this.ignoreClick=true}},setSelectionPos:function(e,b){var a=this.options,d=$(this.overlay).cumulativeOffset();if(a.selection.mode.indexOf(&quot;x&quot;)==-1){e.x=(e==this.selection.first)?0:this.plotWidth}else{e.x=b.pageX-d.left-this.plotOffset.left;e.x=Math.min(Math.max(0,e.x),this.plotWidth)}if(a.selection.mode.indexOf(&quot;y&quot;)==-1){e.y=(e==this.selection.first)?0:this.plotHeight}else{e.y=b.pageY-d.top-this.plotOffset.top;e.y=Math.min(Math.max(0,e.y),this.plotHeight)}},updateSelection:function(){if(this.lastMousePos.pageX==null){return}this.setSelectionPos(this.selection.second,this.lastMousePos);this.clearSelection();if(this.selectionIsSane()){this.drawSelection()}},clearSelection:function(){if(this.prevSelection==null){return}var l=this.prevSelection,g=this.octx,d=this.plotOffset,a=Math.min(l.first.x,l.second.x),k=Math.min(l.first.y,l.second.y),b=Math.abs(l.second.x-l.first.x),e=Math.abs(l.second.y-l.first.y);g.clearRect(a+d.left-g.lineWidth,k+d.top-g.lineWidth,b+g.lineWidth*2,e+g.lineWidth*2);this.prevSelection=null},setSelection:function(l){var b=this.options,m=this.axes.x,a=this.axes.y,k=yaxis.scale,e=xaxis.scale,g=b.selection.mode.indexOf(&quot;x&quot;)!=-1,d=b.selection.mode.indexOf(&quot;y&quot;)!=-1;this.clearSelection();this.selection.first.y=g?0:(a.max-l.y1)*k;this.selection.second.y=g?this.plotHeight:(a.max-l.y2)*k;this.selection.first.x=d?0:(l.x1-m.min)*e;this.selection.second.x=d?this.plotWidth:(l.x2-m.min)*e;this.drawSelection();this.fireSelectEvent()},drawSelection:function(){var d=this.prevSelection,k=this.selection,m=this.octx,n=this.options,a=this.plotOffset;if(d!=null&amp;&amp;k.first.x==d.first.x&amp;&amp;k.first.y==d.first.y&amp;&amp;k.second.x==d.second.x&amp;&amp;k.second.y==d.second.y){return}m.strokeStyle=Flotr.parseColor(n.selection.color).scale(null,null,null,0.8).toString();m.lineWidth=1;m.lineJoin=&quot;round&quot;;m.fillStyle=Flotr.parseColor(n.selection.color).scale(null,null,null,0.4).toString();this.prevSelection={first:{x:k.first.x,y:k.first.y},second:{x:k.second.x,y:k.second.y}};var g=Math.min(k.first.x,k.second.x),e=Math.min(k.first.y,k.second.y),l=Math.abs(k.second.x-k.first.x),b=Math.abs(k.second.y-k.first.y);m.fillRect(g+a.left,e+a.top,l,b);m.strokeRect(g+a.left,e+a.top,l,b)},selectionIsSane:function(){var a=this.selection;return Math.abs(a.second.x-a.first.x)&gt;=5&amp;&amp;Math.abs(a.second.y-a.first.y)&gt;=5},clearHit:function(){if(this.prevHit){var b=this.options,a=this.plotOffset,d=this.prevHit;this.octx.clearRect(this.tHoz(d.x)+a.left-b.points.radius*2,this.tVert(d.y)+a.top-b.points.radius*2,b.points.radius*3+b.points.lineWidth*3,b.points.radius*3+b.points.lineWidth*3);this.prevHit=null}},hit:function(t){var l=this.series,d=this.options,J=this.prevHit,q=this.plotOffset,e=this.octx,K,a,A,E,z={dist:Number.MAX_VALUE,x:null,y:null,relX:t.relX,relY:t.relY,absX:t.absX,absY:t.absY,mouse:null,serie:null,primaryKey:null,pointTag:null};for(E=0;E&lt;l.length;E++){s=l[E];if(!s.mouse.track){continue}K=s.data;a=(s.xaxis.scale*s.mouse.sensibility);A=(s.yaxis.scale*s.mouse.sensibility);for(var D=0,b,g;D&lt;K.length;D++){if(K[D][1]===null){continue}b=Math.pow(s.xaxis.scale*(K[D][0]-t.x),2);g=Math.pow(s.yaxis.scale*(K[D][1]-t.y),2);if(b&lt;a&amp;&amp;g&lt;A&amp;&amp;Math.sqrt(b+g)&lt;z.dist){z.dist=Math.sqrt(b+g);z.x=K[D][0];z.y=K[D][1];z.primaryKey=K[D][2];z.pointTag=K[D][3];z.mouse=s.mouse;z.serie=s}}}if(z.mouse&amp;&amp;z.mouse.track&amp;&amp;!J||(J&amp;&amp;(z.x!=J.x||z.y!=J.y))){var v=this.mouseTrack||this.el.select(&quot;.flotr-mouse-value&quot;)[0],k=&quot;&quot;,u=d.mouse.position,B=d.mouse.margin,C=&quot;opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;&quot;;if(!d.mouse.relative){if(u.charAt(0)==&quot;n&quot;){k+=&quot;top:&quot;+(B+q.top)+&quot;px;&quot;}else{if(u.charAt(0)==&quot;s&quot;){k+=&quot;bottom:&quot;+(B+q.bottom)+&quot;px;&quot;}}if(u.charAt(1)==&quot;e&quot;){k+=&quot;right:&quot;+(B+q.right)+&quot;px;&quot;}else{if(u.charAt(1)==&quot;w&quot;){k+=&quot;left:&quot;+(B+q.left)+&quot;px;&quot;}}}else{if(u.charAt(0)==&quot;n&quot;){k+=&quot;bottom:&quot;+(B-q.top-this.tVert(z.y)+this.canvasHeight)+&quot;px;&quot;}else{if(u.charAt(0)==&quot;s&quot;){k+=&quot;top:&quot;+(B+q.top+this.tVert(z.y))+&quot;px;&quot;}}if(u.charAt(1)==&quot;e&quot;){k+=&quot;left:&quot;+(B+q.left+this.tHoz(z.x))+&quot;px;&quot;}else{if(u.charAt(1)==&quot;w&quot;){k+=&quot;right:&quot;+(B-q.left-this.tHoz(z.x)+this.canvasWidth)+&quot;px;&quot;}}}C+=k;if(!v){this.el.insert('&lt;div class=&quot;flotr-mouse-value&quot; style=&quot;'+C+'&quot;&gt;&lt;/div&gt;');v=this.mouseTrack=this.el.select(&quot;.flotr-mouse-value&quot;).first()}else{this.mouseTrack=v.setStyle(C)}if(z.x!==null&amp;&amp;z.y!==null){v.show();this.clearHit();if(z.mouse.lineColor!=null){e.save();e.translate(q.left,q.top);e.lineWidth=d.points.lineWidth;e.strokeStyle=z.mouse.lineColor;e.fillStyle=&quot;#ffffff&quot;;e.beginPath();e.arc(this.tHoz(z.x),this.tVert(z.y),d.mouse.radius,0,2*Math.PI,true);e.fill();e.stroke();e.restore()}this.prevHit=z;var L=z.mouse.trackDecimals;if(L==null||L&lt;0){L=0}v.innerHTML=z.pointTag;v.fire(&quot;flotr:hit&quot;,[z,this])}else{if(J){v.hide();this.clearHit()}}}},saveImage:function(e,k,d,a,b){var g=null;switch(e){case&quot;jpeg&quot;:case&quot;jpg&quot;:g=Canvas2Image.saveAsJPEG(this.canvas,b,d,a);break;default:case&quot;png&quot;:g=Canvas2Image.saveAsPNG(this.canvas,k,b,d,a);break;case&quot;bmp&quot;:g=Canvas2Image.saveAsBMP(this.canvas,b,d,a);break}if(Object.isElement(g)&amp;&amp;b){this.restoreCanvas();this.canvas.hide();this.overlay.hide();this.el.insert(g.setStyle({position:&quot;absolute&quot;}))}},restoreCanvas:function(){this.canvas.show();this.overlay.show();this.el.select(&quot;img&quot;).invoke(&quot;remove&quot;)}});Flotr.Color=Class.create({initialize:function(m,l,e,k){this.rgba=[&quot;r&quot;,&quot;g&quot;,&quot;b&quot;,&quot;a&quot;];var d=4;while(-1&lt;--d){this[this.rgba[d]]=arguments[d]||((d==3)?1:0)}this.normalize()},adjust:function(e,d,g,b){var a=4;while(-1&lt;--a){if(arguments[a]!=null){this[this.rgba[a]]+=arguments[a]}}return this.normalize()},clone:function(){return new Flotr.Color(this.r,this.b,this.g,this.a)},limit:function(b,a,d){return Math.max(Math.min(b,d),a)},normalize:function(){var a=this.limit;this.r=a(parseInt(this.r),0,255);this.g=a(parseInt(this.g),0,255);this.b=a(parseInt(this.b),0,255);this.a=a(this.a,0,1);return this},scale:function(e,d,g,b){var a=4;while(-1&lt;--a){if(arguments[a]!=null){this[this.rgba[a]]*=arguments[a]}}return this.normalize()},distance:function(b){if(!b){return}b=new Flotr.parseColor(b);var d=0;var a=3;while(-1&lt;--a){d+=Math.abs(this[this.rgba[a]]-b[this.rgba[a]])}return d},toString:function(){return(this.a&gt;=1)?&quot;rgb(&quot;+[this.r,this.g,this.b].join(&quot;,&quot;)+&quot;)&quot;:&quot;rgba(&quot;+[this.r,this.g,this.b,this.a].join(&quot;,&quot;)+&quot;)&quot;}});Flotr.Color.lookupColors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]};Flotr.Date={format:function(l,k){if(!l){return}var a=function(d){d=d.toString();return d.length==1?&quot;0&quot;+d:d};var g=[];var e=false;for(var b=0;b&lt;k.length;++b){var m=k.charAt(b);if(e){switch(m){case&quot;h&quot;:m=l.getUTCHours().toString();break;case&quot;H&quot;:m=a(l.getUTCHours());break;case&quot;M&quot;:m=a(l.getUTCMinutes());break;case&quot;S&quot;:m=a(l.getUTCSeconds());break;case&quot;d&quot;:m=l.getUTCDate().toString();break;case&quot;m&quot;:m=(l.getUTCMonth()+1).toString();break;case&quot;y&quot;:m=l.getUTCFullYear().toString();break;case&quot;b&quot;:m=Flotr.Date.monthNames[l.getUTCMonth()];break}g.push(m);e=false}else{if(m==&quot;%&quot;){e=true}else{g.push(m)}}}return g.join(&quot;&quot;)},timeUnits:{second:1000,minute:60*1000,hour:60*60*1000,day:24*60*60*1000,month:30*24*60*60*1000,year:365.2425*24*60*60*1000},spec:[[1,&quot;second&quot;],[2,&quot;second&quot;],[5,&quot;second&quot;],[10,&quot;second&quot;],[30,&quot;second&quot;],[1,&quot;minute&quot;],[2,&quot;minute&quot;],[5,&quot;minute&quot;],[10,&quot;minute&quot;],[30,&quot;minute&quot;],[1,&quot;hour&quot;],[2,&quot;hour&quot;],[4,&quot;hour&quot;],[8,&quot;hour&quot;],[12,&quot;hour&quot;],[1,&quot;day&quot;],[2,&quot;day&quot;],[3,&quot;day&quot;],[0.25,&quot;month&quot;],[0.5,&quot;month&quot;],[1,&quot;month&quot;],[2,&quot;month&quot;],[3,&quot;month&quot;],[6,&quot;month&quot;],[1,&quot;year&quot;]],monthNames:[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]};Ext.namespace(&quot;sitools.user.component&quot;);sitools.user.component.dataPlotter=function(P){var q=false;function e(U){var S=[];var T=new Ext.data.JsonStore({fields:[{name:&quot;columnAlias&quot;,type:&quot;string&quot;},{name:&quot;sqlColumnType&quot;,type:&quot;string&quot;}]});Ext.each(U,function(W){if(!Ext.isEmpty(W.sqlColumnType)){var V=sql2ext.get(W.sqlColumnType);if(V.match(/^(numeric)+[48]?$/gi)!==null&amp;&amp;!W.hidden){T.add(new Ext.data.Record(W))}if(V.match(/dateAsString/gi)!==null&amp;&amp;!W.hidden){T.add(new Ext.data.Record(W))}}},this);return T}function a(T){var S=[];Ext.each(T,function(U){if(!U.hidden){S.push(U.columnAlias)}},this);return S}var g=P.dataplot.getCount();var d=P.dataplot.bufferRange;var u=P.dataplot.dataUrl;var C=null;var L=P.dataplot.columnModel;var J=e(P.dataplot.columnModel.columns);var l=a(P.dataplot.columnModel.columns);var E=P.dataplot.data.items;var D=new Ext.form.Field({fieldLabel:i18n.get(&quot;label.plot.form.xlabel&quot;),anchor:&quot;95%&quot;,name:&quot;titleX&quot;});var z=null;var B=new Ext.form.Field({fieldLabel:i18n.get(&quot;label.plot.form.ylabel&quot;),anchor:&quot;95%&quot;,name:&quot;titleY&quot;});var v=null;var Q=new Ext.form.ComboBox({store:J,anchor:&quot;95%&quot;,name:&quot;comboX&quot;,allowBlank:false,emptyText:i18n.get(&quot;label.plot.select.xaxis&quot;),fieldLabel:i18n.get(&quot;label.plot.select.xcolumn&quot;),selectOnFocus:true,triggerAction:&quot;all&quot;,valueField:&quot;columnAlias&quot;,displayField:&quot;columnAlias&quot;,editable:false,mode:&quot;local&quot;,listeners:{scope:this,select:function(V,S,T){D.setValue(V.getValue());var U=sql2ext.get(S.get(&quot;sqlColumnType&quot;));if(U.match(/dateAsString/gi)!==null){if(Ext.isEmpty(z)){z=new Ext.form.Field({fieldLabel:i18n.get(&quot;label.plot.form.xFormat&quot;),anchor:&quot;95%&quot;,name:&quot;xFormat&quot;,value:P.userPreference&amp;&amp;P.userPreference.xFormat?P.userPreference.xFormat:SITOOLS_DEFAULT_IHM_DATE_FORMAT});this.fieldSetX.insert(1,z)}}else{this.fieldSetX.remove(z);z=null}this.fieldSetX.doLayout()},expand:function(S){S.store.clearFilter(true);if(O.getValue()!==&quot;&quot;&amp;&amp;O.getValue()!==null){S.store.filterBy(function(T,U){return T.get(&quot;field1&quot;)!==O.getValue()})}}}});var O=new Ext.form.ComboBox({store:J,name:&quot;comboY&quot;,allowBlank:false,anchor:&quot;95%&quot;,emptyText:i18n.get(&quot;label.plot.select.yaxis&quot;),fieldLabel:i18n.get(&quot;label.plot.select.ycolumn&quot;),selectOnFocus:true,editable:false,valueField:&quot;columnAlias&quot;,displayField:&quot;columnAlias&quot;,triggerAction:&quot;all&quot;,mode:&quot;local&quot;,listeners:{scope:this,select:function(V,S,T){B.setValue(V.getValue());var U=sql2ext.get(S.get(&quot;sqlColumnType&quot;));if(U.match(/dateAsString/gi)!==null){if(Ext.isEmpty(v)){v=new Ext.form.Field({fieldLabel:i18n.get(&quot;label.plot.form.yFormat&quot;),anchor:&quot;95%&quot;,name:&quot;yFormat&quot;,value:P.userPreference&amp;&amp;P.userPreference.yFormat?P.userPreference.yFormat:SITOOLS_DEFAULT_IHM_DATE_FORMAT});this.fieldSetY.insert(1,v)}}else{this.fieldSetY.remove(v);v=null}this.fieldSetY.doLayout()},expand:function(S){S.store.clearFilter(true);if(Q.getValue()!==&quot;&quot;&amp;&amp;Q.getValue()!==null){S.store.filterBy(function(T,U){return T.get(&quot;field1&quot;)!==Q.getValue()})}}}});var K=new Ext.form.Field({anchor:&quot;95%&quot;,fieldLabel:i18n.get(&quot;label.plot.form.title&quot;),name:&quot;titlePlot&quot;});var M=new Ext.form.Checkbox({fieldLabel:i18n.get(&quot;label.plot.form.drawline&quot;),name:&quot;checkLine&quot;,scope:this,listeners:{check:function(T,S){if(!R.disabled&amp;&amp;q){R.fireEvent(&quot;click&quot;,null)}}}});var t=new Ext.form.ComboBox({store:l,name:&quot;comboTag&quot;,anchor:&quot;95%&quot;,allowBlank:true,emptyText:i18n.get(&quot;label.plot.select.tag&quot;),fieldLabel:i18n.get(&quot;label.plot.select.tagcolumn&quot;),selectOnFocus:true,triggerAction:&quot;all&quot;,mode:&quot;local&quot;,scope:this,listeners:{select:function(U,S,T){if(!R.disabled&amp;&amp;q){R.fireEvent(&quot;click&quot;,null)}}}});var p=new sitools.widget.colorField({fieldLabel:i18n.get(&quot;label.plot.label.color&quot;),anchor:&quot;95%&quot;,name:&quot;comboXColor&quot;});var A=new sitools.widget.colorField({fieldLabel:i18n.get(&quot;label.plot.label.color&quot;),anchor:&quot;95%&quot;,name:&quot;comboYColor&quot;,value:&quot;#000000&quot;});this.fieldSetX=new Ext.form.FieldSet({title:i18n.get(&quot;title.plot.xAxis&quot;),items:[Q,D,p],collapsible:true});this.fieldSetY=new Ext.form.FieldSet({title:i18n.get(&quot;title.plot.yAxis&quot;),items:[O,B,A],collapsible:true});var N=new Ext.Panel({id:&quot;plot-right-panel&quot;,title:i18n.get(&quot;title.plot.panel&quot;),region:&quot;center&quot;,margins:&quot;2 2 2 1&quot;,scope:this,listeners:{bodyresize:function(U,T,S){if(this.isVisible()&amp;&amp;q){R.fireEvent(&quot;click&quot;,null)}}}});var R=new Ext.Button({text:i18n.get(&quot;label.plot.draw&quot;),disabled:true,listeners:{scope:this,click:function(S,U){var T=m(L);this.plot=Flotr.draw($(N.body.id),[T.data],T.config);$(N.body.id).stopObserving(&quot;flotr:click&quot;);$(N.body.id).observe(&quot;flotr:click&quot;,function(W){var V=encodeURIComponent(W.memo[1].prevHit.primaryKey);var aa=sitools.user.component.viewDataDetail;var Z={datasetUrl:u,baseUrl:u+&quot;/records&quot;,datasetId:P.dataplot.datasetId,fromWhere:&quot;plot&quot;,url:u+&quot;/records/&quot;+V};var Y=loadUrl.get(&quot;APP_USERSTORAGE_USER_URL&quot;).replace(&quot;{identifier}&quot;,userLogin);var X={id:&quot;simpleDataDetail&quot;+P.datasetId,title:i18n.get(&quot;label.viewDataDetail&quot;)+&quot; : &quot;+W.memo[1].prevHit.primaryKey,datasetName:P.datasetName,saveToolbar:false,urlPreferences:loadUrl.get(&quot;APP_URL&quot;)+Y+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName+&quot;/&quot;+P.datasetName+&quot;/simpleDataDetail&quot;,type:&quot;simpleDataDetail&quot;};SitoolsDesk.addDesktopWindow(X,Z,aa,true)});$(N.body.id).stopObserving(&quot;flotr:select&quot;);$(N.body.id).observe(&quot;flotr:select&quot;,function(V){var X=V.memo[0];var W=T.config;W.xaxis.min=X.x1;W.xaxis.max=X.x2;W.yaxis.min=X.y1;W.yaxis.max=X.y2;this.plot=Flotr.draw($(this.id),[T.data],W)});q=true}}});this.leftPanel=new Ext.FormPanel({title:i18n.get(&quot;title.plot.form&quot;),region:&quot;west&quot;,split:true,width:300,autoScroll:true,collapsible:true,margins:&quot;2 1 2 2&quot;,cmargins:&quot;2 2 2 2&quot;,padding:&quot;5&quot;,monitorValid:true,items:[K,M,t,this.fieldSetX,this.fieldSetY],buttons:[R],listeners:{clientvalidation:function(S,T){if(T&amp;&amp;(Q.getValue()!==O.getValue())){R.setDisabled(false)}else{R.setDisabled(true)}}}});var n=new Ext.Toolbar({items:[&quot;-&gt;&quot;,{id:&quot;plot-tb-text&quot;,xtype:&quot;tbtext&quot;,text:&quot;Displaying &quot;+g+&quot; record&quot;+(g&gt;1?&quot;s&quot;:&quot;&quot;)+&quot; from &quot;+(d[0]+1)+&quot; to &quot;+(d[1]+1)}]});N.addListener(&quot;buffer&quot;,function(W,T,S,U){if(this.isVisible()&amp;&amp;q){E=W.data.items;g=W.bufferSize;d=W.bufferRange;n.findById(&quot;plot-tb-text&quot;).setText(&quot;Displaying &quot;+g+&quot; record&quot;+(g&gt;1?&quot;s&quot;:&quot;&quot;)+&quot; from &quot;+(d[0]+1)+&quot; to &quot;+(d[1]+1));var V=m(L,E);this.plot=Flotr.draw($(N.body.id),[V.data],V.config)}},this);function k(S,T){var U=[];Ext.each(T,function(Z){var V=t.getValue()!==&quot;&quot;?Z.get(t.getValue()):null;var ab=sql2ext.get(b(S,Q.getValue()).sqlColumnType);var W=sql2ext.get(b(S,O.getValue()).sqlColumnType);var Y,X;switch(ab){case&quot;dateAsString&quot;:Y=Date.parseDate(Z.get(Q.getValue()),SITOOLS_DATE_FORMAT,true);if(!Ext.isEmpty(Y)){Y=Y.getTime()}break;case&quot;numeric&quot;:Y=parseFloat(Z.get(Q.getValue()));break;default:Y=Z.get(Q.getValue());break}switch(W){case&quot;dateAsString&quot;:var aa=Z.get(O.getValue());X=Date.parseDate(aa,SITOOLS_DATE_FORMAT,true);if(!Ext.isEmpty(X)){X=X.getTime()}break;case&quot;numeric&quot;:X=parseFloat(Z.get(O.getValue()));break;default:X=Z.get(O.getValue());break}U.push([Y,X,Z.id,V?V:Z.id])},this);return U}function b(U,V){var S;for(var T=0;T&lt;U.columns.length;T++){if(U.columns[T].columnAlias==V){S=U.columns[T]}}return S}function m(V,W){var S=k(V,W||E);var U=&quot;Normal&quot;;var Z=b(V,O.getValue());var Y=sql2ext.get(Z.sqlColumnType);var X=&quot;Normal&quot;;var ab=b(V,Q.getValue());var aa=sql2ext.get(ab.sqlColumnType);var ac={HtmlText:false,colors:[&quot;#00A8F0&quot;,&quot;#C0D800&quot;,&quot;#cb4b4b&quot;,&quot;#4da74d&quot;,&quot;#9440ed&quot;],title:K.getValue(),legend:{show:true,noColumns:1,labelFormatter:null,labelBoxBorderColor:&quot;#ccc&quot;,container:null,position:&quot;ne&quot;,margin:5,backgroundColor:&quot;#CCCCCC&quot;,backgroundOpacity:1},xaxis:{ticks:null,noTicks:5,color:p.getValue()?p.getValue():&quot;#000000&quot;,tickFormatter:function(ae){if(aa==&quot;dateAsString&quot;){var ad=new Date();ad.setTime(ae);return ad.format(z?z.getValue():SITOOLS_DEFAULT_IHM_DATE_FORMAT)}return ae},tickDecimals:null,min:null,max:null,autoscaleMargin:0,title:D.getValue(),mode:aa==&quot;dateAsString&quot;?&quot;time&quot;:&quot;Normal&quot;,labelsAngle:aa==&quot;dateAsString&quot;?45:0,timeFormat:this.xFormat?this.xFormat.getValue():SITOOLS_DATE_FORMAT},yaxis:{ticks:null,color:A.getValue()?A.getValue():&quot;#000000&quot;,noTicks:5,tickDecimals:null,tickFormatter:function(ae){if(Y==&quot;dateAsString&quot;){var ad=new Date();ad.setTime(ae);return ad.format(v?v.getValue():SITOOLS_DEFAULT_IHM_DATE_FORMAT)}return ae},min:null,max:null,autoscaleMargin:0,title:B.getValue(),mode:Y==&quot;dateAsString&quot;?&quot;time&quot;:&quot;Normal&quot;,labelsAngle:0,timeFormat:SITOOLS_DATE_FORMAT},y2axis:{title:&quot; &quot;},points:{show:true,radius:3,lineWidth:2,fill:true,fillColor:&quot;#ffffff&quot;},lines:{show:M.getValue(),lineWidth:0.1,fill:false,fillColor:null},grid:{color:&quot;#545454&quot;,backgroundColor:&quot;#FFFFFF&quot;,tickColor:&quot;#dddddd&quot;,labelMargin:3},selection:{mode:&quot;xy&quot;,color:&quot;#B6D9FF&quot;,fps:10},spreadsheet:{show:false},mouse:{track:true,position:&quot;se&quot;,margin:2,color:&quot;#ff3f19&quot;,trackDecimals:1,sensibility:10*1000000000,radius:3},shadowSize:4};var T={data:S,config:ac};return T}sitools.user.component.dataPlotter.superclass.constructor.call(this,Ext.apply({id:&quot;plot-panel&quot;,layout:&quot;border&quot;,items:[this.leftPanel,N],bbar:n},P))};Ext.extend(sitools.user.component.dataPlotter,Ext.Panel,{_getSettings:function(){return this.leftPanel.getForm().getValues()},afterRender:function(){sitools.user.component.dataPlotter.superclass.afterRender.call(this);this.el.on(&quot;contextmenu&quot;,function(l,k,m){l.stopEvent();var g=new Ext.menu.Menu({items:[{text:i18n.get(&quot;label.plot.savePng&quot;),scope:this,handler:function(){this.plot.saveImage(&quot;png&quot;,&quot;plotImage&quot;)}}]});g.showAt(l.getXY())},this);if(Ext.isEmpty(this.userPreference)){return}var b,a;this.leftPanel.getForm().loadRecord(new Ext.data.Record(this.userPreference));var e=this.leftPanel.find(&quot;name&quot;,&quot;comboX&quot;)[0];if(!Ext.isEmpty(e.getValue())){a=e.getStore().find(&quot;columnAlias&quot;,this.userPreference.comboX);b=e.getStore().getAt(a);if(b){e.fireEvent(&quot;select&quot;,e,b,a)}}var d=this.leftPanel.find(&quot;name&quot;,&quot;comboY&quot;)[0];if(!Ext.isEmpty(d.getValue())){a=d.getStore().find(&quot;columnAlias&quot;,this.userPreference.comboY);b=d.getStore().getAt(a);if(b){d.fireEvent(&quot;select&quot;,d,b,a)}}this.leftPanel.getForm().loadRecord(new Ext.data.Record(this.userPreference))}});Ext.reg(&quot;sitools.user.component.dataPlotter&quot;,sitools.user.component.dataPlotter);Ext.ns(&quot;sitools.widget&quot;);sitools.widget.WindowImageViewer=Ext.extend(Ext.Window,{resizeImage:false,maximizable:true,minHeight:0,minWidth:0,initComponent:function(){this.renderTo=SitoolsDesk.getDesktop().getDesktopEl();if(!this.resizeImage){this.panel=new Ext.Panel({bodyCfg:{tag:&quot;img&quot;,src:this.src},listeners:{scope:this,render:function(){this.panel.body.on(&quot;load&quot;,this.onImageLoad,this,{single:true})}}});this.items=[this.panel];this.autoScroll=true}else{this.bodyCfg={tag:&quot;img&quot;,src:this.src}}this.constrain=true;sitools.widget.WindowImageViewer.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.WindowImageViewer.superclass.onRender.apply(this,arguments);if(this.resizeImage){this.body.on(&quot;load&quot;,this.onImageLoad,this,{single:true})}},onImageLoad:function(){var m=Ext.DomQuery.select(&quot;div[id='&quot;+this.id+&quot;'] img&quot;)[0];var d=this.body.dom.offsetHeight;var b=this.body.dom.offsetWidth;var a=m.offsetHeight;var l=m.offsetWidth;if(!this.resizeImage){this.panel.setSize(l,a)}var n=getDesktop();var e=n.getWinWidth();var g=n.getWinHeight();var k=false;if(d&gt;g){b=b*g/d;d=g;k=true}if(b&gt;e){d=d*e/b;b=e;k=true}if(k){d*=0.9;b*=0.9}this.setSize(b+this.getFrameWidth(),d+this.getFrameHeight());this.center()},setSrc:function(b){var a;if(resizeImage){a=this}else{a=this.panel}a.body.on(&quot;load&quot;,this.onImageLoad,this,{single:true});a.body.dom.style.width=a.body.dom.style.width=&quot;auto&quot;;a.body.dom.src=b},initEvents:function(){sitools.widget.WindowImageViewer.superclass.initEvents.apply(this,arguments);if(this.resizer&amp;&amp;this.resizeImage){this.resizer.preserveRatio=true}}});sitools.widget.PanelImageViewer=Ext.extend(Ext.Panel,{initComponent:function(){this.bodyCfg={tag:&quot;img&quot;,src:this.src};sitools.widget.PanelImageViewer.superclass.initComponent.apply(this,arguments)},onRender:function(){sitools.widget.PanelImageViewer.superclass.onRender.apply(this,arguments);this.body.on(&quot;load&quot;,this.onImageLoad,this,{single:true})},onImageLoad:function(){var b=this.getFrameHeight(),a=this.getFrameWidth();this.setSize(this.body.dom.offsetWidth+a,this.body.dom.offsetHeight+b);if(Ext.isIE){this.center()}},setSrc:function(a){this.body.on(&quot;load&quot;,this.onImageLoad,this,{single:true});this.body.dom.style.width=this.body.dom.style.width=&quot;auto&quot;;this.body.dom.src=a},initEvents:function(){sitools.widget.PanelImageViewer.superclass.initEvents.apply(this,arguments);if(this.resizer){this.resizer.preserveRatio=true}}});Ext.namespace(&quot;sitools.component.version&quot;);sitools.component.version.sitoolsVersion=Ext.extend(Ext.Panel,{layout:&quot;fit&quot;,version:null,initComponent:function(){this.versionUrl=loadUrl.get(&quot;APP_URL&quot;)+&quot;/version&quot;;var k=new Ext.form.Label({html:&quot;&lt;h2&gt;SITools2&lt;/h2&quot;});var g=new Ext.form.Label({html:&quot;&lt;img src=&quot;+loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/images/logo_02_tailleMoyenne.png&gt;&quot;});var d=new Ext.form.Label({html:&quot;&lt;p&gt;Copyright 2010, 2011, 2012 CNES&lt;/p&gt;&quot;});var a=new Ext.form.Label({html:'&lt;a href=&quot;http://www.sitools2.sourceforge.net&quot;&gt;sitools2.sourceforge.net&lt;/&gt;'});this.versionLabel=new Ext.form.Label({});var b=new Ext.Panel({title:i18n.get(&quot;label.version&quot;),layout:&quot;fit&quot;,padding:10});var e=new Ext.ux.ManagedIFrame.Panel({title:i18n.get(&quot;label.licence&quot;),layout:&quot;fit&quot;,defaultSrc:loadUrl.get(&quot;APP_URL&quot;)+&quot;/res/licences/gpl-3.0.txt&quot;});b.add([g,k,this.versionLabel,d,a]);this.tabs=new Ext.TabPanel({activeTab:0,items:[b,e]});this.items=[this.tabs];this.listeners={scope:this,resize:function(m){var l=m.body.getSize();this.tabs.setSize(l)}};sitools.component.version.sitoolsVersion.superclass.initComponent.call(this)},afterRender:function(){sitools.component.version.sitoolsVersion.superclass.afterRender.apply(this,arguments);Ext.Ajax.request({url:this.versionUrl,method:&quot;GET&quot;,scope:this,success:function(b){var d=Ext.decode(b.responseText);if(!d.success){Ext.Msg.alert(i18n.get(&quot;label.warning&quot;),d.message);return false}this.version=d.version;this.versionLabel.setText(&quot;&lt;h3&gt;Version : &quot;+this.version+&quot;&lt;/h3&gt;&quot;,false)},failure:alertFailure});var a=this.ownerCt.body.getSize();this.tabs.setSize(a)}});function showVersion(){var a=Ext.getCmp(&quot;winVersionId&quot;);if(!a){var b=new sitools.component.version.sitoolsVersion();a=new Ext.Window({title:i18n.get(&quot;label.version&quot;),id:&quot;winVersionId&quot;,items:[b],modal:false,width:700,height:480,resizable:false,buttons:[{text:i18n.get(&quot;label.close&quot;),handler:function(){this.ownerCt.ownerCt.close()}}]});a.show()}else{a.show()}}Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:&quot;x-form-spinner-trigger&quot;,splitterClass:&quot;x-form-spinner-splitter&quot;,alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(a){Ext.ux.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=false},init:function(a){this.field=a;a.afterMethod(&quot;onRender&quot;,this.doRender,this);a.afterMethod(&quot;onEnable&quot;,this.doEnable,this);a.afterMethod(&quot;onDisable&quot;,this.doDisable,this);a.afterMethod(&quot;afterRender&quot;,this.doAfterRender,this);a.afterMethod(&quot;onResize&quot;,this.doResize,this);a.afterMethod(&quot;onFocus&quot;,this.doFocus,this);a.beforeMethod(&quot;onDestroy&quot;,this.doDestroy,this)},doRender:function(b,a){var d=this.el=this.field.getEl();var e=this.field;if(!e.wrap){e.wrap=this.wrap=d.wrap({cls:&quot;x-form-field-wrap&quot;})}else{this.wrap=e.wrap.addClass(&quot;x-form-field-wrap&quot;)}this.trigger=this.wrap.createChild({tag:&quot;img&quot;,src:Ext.BLANK_IMAGE_URL,cls:&quot;x-form-trigger &quot;+this.triggerClass});if(!e.width){this.wrap.setWidth(d.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:&quot;div&quot;,cls:this.splitterClass,style:&quot;width:13px; height:2px;&quot;});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy(&quot;&quot;,this.splitter,true);this.proxy.addClass(&quot;x-form-spinner-proxy&quot;);this.proxy.setStyle(&quot;left&quot;,&quot;0px&quot;);this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,&quot;SpinnerDrag&quot;,{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var a;if(Ext.isIE&amp;&amp;this.el.getY()!=(a=this.trigger.getY())){this.el.position();this.el.setY(a)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(a,b){if(typeof a==&quot;number&quot;){this.el.setWidth(a-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass(&quot;x-trigger-wrap-focus&quot;);this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on(&quot;mousedown&quot;,this.mimicBlur,this,{delay:10});this.el.on(&quot;keydown&quot;,this.checkTab,this)}},checkTab:function(a){if(a.getKey()==a.TAB){this.triggerBlur()}},mimicBlur:function(a){if(!this.wrap.contains(a.target)&amp;&amp;this.field.validateBlur(a)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un(&quot;mousedown&quot;,this.mimicBlur,this);this.el.un(&quot;keydown&quot;,this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass(&quot;x-trigger-wrap-focus&quot;);this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver(&quot;x-form-trigger-over&quot;);this.trigger.addClassOnClick(&quot;x-form-trigger-click&quot;)},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp()},down:function(a){a.preventDefault();this.onSpinDown()},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate()},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,&quot;click&quot;,this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,&quot;mousewheel&quot;,this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()&lt;a)?&quot;x-form-spinner-overup&quot;:&quot;x-form-spinner-overdown&quot;;this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var a=this.getMiddle();if(((Ext.EventObject.getPageY()&gt;a)&amp;&amp;this.tmpHoverClass==&quot;x-form-spinner-overup&quot;)||((Ext.EventObject.getPageY()&lt;a)&amp;&amp;this.tmpHoverClass==&quot;x-form-spinner-overdown&quot;)){}},onMouseDown:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()&lt;a)?&quot;x-form-spinner-clickup&quot;:&quot;x-form-spinner-clickdown&quot;;this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var b=this.getMiddle();var a=(Ext.EventObject.getPageY()&lt;b)?&quot;Up&quot;:&quot;Down&quot;;this[&quot;onSpin&quot;+a]()},getMiddle:function(){var b=this.trigger.getTop();var d=this.trigger.getHeight();var a=b+(d/2);return a},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(a){if(this.wrap.hasClass(&quot;x-trigger-wrap-focus&quot;)==false){return}var b=a.getWheelDelta();if(b&gt;0){this.onSpinUp();a.stopEvent()}else{if(b&lt;0){this.onSpinDown();a.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var b=Ext.fly(this.dd.getDragEl()).getTop();var a=&quot;&quot;;if(this._previousY&gt;b){a=&quot;Up&quot;}if(this._previousY&lt;b){a=&quot;Down&quot;}if(a!=&quot;&quot;){this[&quot;onSpin&quot;+a]()}this._previousY=b},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spinup&quot;,this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spindown&quot;,this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spinup&quot;,this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent(&quot;spin&quot;,this);this.field.fireEvent(&quot;spindown&quot;,this)},spin:function(e,b){var a=parseFloat(this.field.getValue());var d=(b==true)?this.alternateIncrementValue:this.incrementValue;(e==true)?a-=d:a+=d;a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setRawValue(a)},fixBoundries:function(b){var a=b;if(this.field.minValue!=undefined&amp;&amp;a&lt;this.field.minValue){a=this.field.minValue}if(this.field.maxValue!=undefined&amp;&amp;a&gt;this.field.maxValue){a=this.field.maxValue}return this.fixPrecision(a)},fixPrecision:function(b){var a=isNaN(b);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||a||!b){return a?&quot;&quot;:b}return parseFloat(parseFloat(b).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:&quot;wrap&quot;,deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(d){var b=Ext.copyTo({},d,&quot;incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass&quot;);var e=this.spinner=new Ext.ux.Spinner(b);var a=d.plugins?(Ext.isArray(d.plugins)?d.plugins.push(e):[d.plugins,e]):e;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(d,{plugins:a}))},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,&quot;tl-tr&quot;,[2,0])}},validateBlur:function(){return true}});Ext.reg(&quot;spinnerfield&quot;,Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.SitoolsDatePicker=Ext.extend(Ext.BoxComponent,{todayText:&quot;Today&quot;,okText:&quot;&amp;#160;OK&amp;#160;&quot;,cancelText:&quot;Cancel&quot;,todayTip:&quot;{0} (Spacebar)&quot;,minText:&quot;This date is before the minimum date&quot;,maxText:&quot;This date is after the maximum date&quot;,format:&quot;m/d/y&quot;,disabledDaysText:&quot;Disabled&quot;,disabledDatesText:&quot;Disabled&quot;,monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:&quot;Next Month (Control+Right)&quot;,prevText:&quot;Previous Month (Control+Left)&quot;,monthYearText:&quot;Choose a month (Control+Up/Down to move years)&quot;,startDay:0,showToday:true,showTime:false,focusOnSelect:true,initHour:12,initComponent:function(){Ext.SitoolsDatePicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime(true):new Date().clearTime();this.hourValue=this.value?this.value.getHours():new Date().getHours();this.minuteValue=this.value?this.value.getMinutes():new Date().getMinutes();this.secondValue=this.value?this.value.getSeconds():new Date().getSeconds();this.addEvents(&quot;select&quot;);if(this.handler){this.on(&quot;select&quot;,this.handler,this.scope||this)}this.initDisabledDays()},initDisabledDays:function(){if(!this.disabledDatesRE&amp;&amp;this.disabledDates){var b=this.disabledDates,a=b.length-1,d=&quot;(?:&quot;;Ext.each(b,function(g,e){d+=Ext.isDate(g)?&quot;^&quot;+Ext.escapeRe(g.dateFormat(this.format))+&quot;$&quot;:b[e];if(e!=a){d+=&quot;|&quot;}},this);this.disabledDatesRE=new RegExp(d+&quot;)&quot;)}},setDisabledDates:function(a){if(Ext.isArray(a)){this.disabledDates=a;this.disabledDatesRE=null}else{this.disabledDatesRE=a}this.initDisabledDays();this.update(this.value,true)},setDisabledDays:function(a){this.disabledDays=a;this.update(this.value,true)},setMinDate:function(a){this.minDate=a;this.update(this.value,true)},setMaxDate:function(a){this.maxDate=a;this.update(this.value,true)},setValue:function(a){this.value=a;this.update(this.value)},getValue:function(){return this.value},focus:function(){this.update(this.activeDate);if(this.showTime){this.updateTime(this.activeDate)}},updateTime:function(a){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())},onEnable:function(a){Ext.SitoolsDatePicker.superclass.onEnable.call(this);this.doDisabled(false);this.update(a?this.value:this.activeDate);if(Ext.isIE){this.el.repaint()}},onDisable:function(){Ext.SitoolsDatePicker.superclass.onDisable.call(this);this.doDisabled(true);if(Ext.isIE&amp;&amp;!Ext.isIE8){Ext.each([].concat(this.textNodes,this.el.query(&quot;th span&quot;)),function(a){Ext.fly(a).repaint()})}},doDisabled:function(a){this.keyNav.setDisabled(a);this.prevRepeater.setDisabled(a);this.nextRepeater.setDisabled(a);if(this.showToday){this.todayKeyListener.setDisabled(a);this.todayBtn.setDisabled(a)}},onRender:function(a,l){var e=['&lt;table cellspacing=&quot;0&quot;&gt;','&lt;tr&gt;&lt;td class=&quot;x-date-left&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;',this.prevText,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-middle&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;td class=&quot;x-date-right&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;',this.nextText,'&quot;&gt;&amp;#160;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;','&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;&lt;table class=&quot;x-date-inner&quot; cellspacing=&quot;0&quot;&gt;&lt;thead&gt;&lt;tr&gt;'],k=this.dayNames,g;for(g=0;g&lt;7;g++){var n=this.startDay+g;if(n&gt;6){n=n-7}e.push(&quot;&lt;th&gt;&lt;span&gt;&quot;,k[n].substr(0,1),&quot;&lt;/span&gt;&lt;/th&gt;&quot;)}e[e.length]=&quot;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&quot;;for(g=0;g&lt;42;g++){if(g%7===0&amp;&amp;g!==0){e[e.length]=&quot;&lt;/tr&gt;&lt;tr&gt;&quot;}e[e.length]='&lt;td&gt;&lt;a href=&quot;#&quot; hidefocus=&quot;on&quot; class=&quot;x-date-date&quot; tabIndex=&quot;1&quot;&gt;&lt;em&gt;&lt;span&gt;&lt;/span&gt;&lt;/em&gt;&lt;/a&gt;&lt;/td&gt;'}e.push(&quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&quot;,this.showTime?'&lt;tr&gt;&lt;td colspan=&quot;3&quot; class=&quot;x-date-time&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;/tr&gt;':&quot;&quot;,this.showToday?'&lt;tr&gt;&lt;td colspan=&quot;3&quot; class=&quot;x-date-bottom&quot; align=&quot;center&quot;&gt;&lt;/td&gt;&lt;/tr&gt;':&quot;&quot;,'&lt;/table&gt;&lt;div class=&quot;x-date-mp&quot;&gt;&lt;/div&gt;');var b=document.createElement(&quot;div&quot;);b.className=&quot;x-date-picker&quot;;b.innerHTML=e.join(&quot;&quot;);a.dom.insertBefore(b,l);this.el=Ext.get(b);this.eventEl=Ext.get(b.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child(&quot;td.x-date-left a&quot;),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child(&quot;td.x-date-right a&quot;),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down(&quot;div.x-date-mp&quot;);this.monthPicker.enableDisplayMode(&quot;block&quot;);this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(d){if(d.ctrlKey){this.showPrevMonth()}else{this.update(this.activeDate.add(&quot;d&quot;,-1))}},right:function(d){if(d.ctrlKey){this.showNextMonth()}else{this.update(this.activeDate.add(&quot;d&quot;,1))}},up:function(d){if(d.ctrlKey){this.showNextYear()}else{this.update(this.activeDate.add(&quot;d&quot;,-7))}},down:function(d){if(d.ctrlKey){this.showPrevYear()}else{this.update(this.activeDate.add(&quot;d&quot;,7))}},pageUp:function(d){this.showNextMonth()},pageDown:function(d){this.showPrevMonth()},enter:function(d){d.stopPropagation();return true},scope:this});this.cells=this.el.select(&quot;table.x-date-inner tbody td&quot;);this.textNodes=this.el.query(&quot;table.x-date-inner tbody span&quot;);this.mbtn=new Ext.Button({text:&quot;&amp;#160;&quot;,tooltip:this.monthYearText,renderTo:this.el.child(&quot;td.x-date-middle&quot;,true)});this.mbtn.el.child(&quot;em&quot;).addClass(&quot;x-btn-arrow&quot;);if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var p=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child(&quot;td.x-date-bottom&quot;,true),text:String.format(this.todayText,p),tooltip:String.format(this.todayTip,p),handler:this.selectToday,scope:this})}if(this.showTime){this.hourField=new Ext.form.TextField({value:this.hourValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.secondField.focus()}else{this.minuteField.focus()}}}},maxLength:2,maskRe:/[0-9]/,disabled:false,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=23&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});this.minuteField=new Ext.form.TextField({value:this.minuteValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.hourField.focus()}else{this.secondField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=59&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});this.secondField=new Ext.form.TextField({value:this.minuteValue,width:&quot;25&quot;,listeners:{scope:this,specialkey:function(m,d){if(d.getKey()==d.TAB){if(d.shiftKey){this.minuteField.focus()}else{this.hourField.focus()}}}},maxLength:2,maskRe:/[0-9]/,validationEvent:&quot;blur&quot;,validator:function(m){var d=parseInt(m);if(!Ext.isEmpty(d)&amp;&amp;d&lt;=59&amp;&amp;d&gt;=0){if(m.length==1){this.setValue(&quot;0&quot;+m)}return true}else{return&quot;incorrect Value&quot;}}});var t=new Ext.form.DisplayField({value:&quot;:&quot;});var q=new Ext.form.DisplayField({value:&quot;:&quot;});this.timeForm=new Ext.form.FormPanel({labelWidth:1,itemsCls:&quot;sitools-no-margin&quot;,items:[{xtype:&quot;compositefield&quot;,width:135,style:{padding:&quot;3px&quot;},items:[this.hourField,t,this.minuteField,q,this.secondField]}],renderTo:this.el.child(&quot;td.x-date-time&quot;,true)})}this.mon(this.eventEl,&quot;mousewheel&quot;,this.handleMouseWheel,this);this.mon(this.eventEl,&quot;click&quot;,this.handleDateClick,this,{delegate:&quot;a.x-date-date&quot;});this.mon(this.mbtn,&quot;click&quot;,this.showMonthPicker,this);this.onEnable(true)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var a=['&lt;table border=&quot;0&quot; cellspacing=&quot;0&quot;&gt;'];for(var b=0;b&lt;6;b++){a.push('&lt;tr&gt;&lt;td class=&quot;x-date-mp-month&quot;&gt;&lt;a href=&quot;#&quot;&gt;',Date.getShortMonthName(b),&quot;&lt;/a&gt;&lt;/td&gt;&quot;,'&lt;td class=&quot;x-date-mp-month x-date-mp-sep&quot;&gt;&lt;a href=&quot;#&quot;&gt;',Date.getShortMonthName(b+6),&quot;&lt;/a&gt;&lt;/td&gt;&quot;,b===0?'&lt;td class=&quot;x-date-mp-ybtn&quot; align=&quot;center&quot;&gt;&lt;a class=&quot;x-date-mp-prev&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-mp-ybtn&quot; align=&quot;center&quot;&gt;&lt;a class=&quot;x-date-mp-next&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;':'&lt;td class=&quot;x-date-mp-year&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;td class=&quot;x-date-mp-year&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;')}a.push('&lt;tr class=&quot;x-date-mp-btns&quot;&gt;&lt;td colspan=&quot;4&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;x-date-mp-ok&quot;&gt;',this.okText,'&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;x-date-mp-cancel&quot;&gt;',this.cancelText,&quot;&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;&quot;,&quot;&lt;/table&gt;&quot;);this.monthPicker.update(a.join(&quot;&quot;));this.mon(this.monthPicker,&quot;click&quot;,this.onMonthClick,this);this.mon(this.monthPicker,&quot;dblclick&quot;,this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select(&quot;td.x-date-mp-month&quot;);this.mpYears=this.monthPicker.select(&quot;td.x-date-mp-year&quot;);this.mpMonths.each(function(d,e,g){g+=1;if((g%2)===0){d.dom.xmonth=5+Math.round(g*0.5)}else{d.dom.xmonth=Math.round((g-1)*0.5)}})}},showMonthPicker:function(){if(!this.disabled){this.createMonthPicker();var a=this.el.getSize();this.monthPicker.setSize(a);this.monthPicker.child(&quot;table&quot;).setSize(a);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn(&quot;t&quot;,{duration:0.2})}},updateMPYear:function(g){this.mpyear=g;var d=this.mpYears.elements;for(var b=1;b&lt;=10;b++){var e=d[b-1],a;if((b%2)===0){a=g+Math.round(b*0.5);e.firstChild.innerHTML=a;e.xyear=a}else{a=g-(5-Math.round(b*0.5));e.firstChild.innerHTML=a;e.xyear=a}this.mpYears.item(b-1)[a==this.mpSelYear?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;x-date-mp-sel&quot;)}},updateMPMonth:function(a){this.mpMonths.each(function(b,d,e){b[b.dom.xmonth==a?&quot;addClass&quot;:&quot;removeClass&quot;](&quot;x-date-mp-sel&quot;)})},selectMPMonth:function(a){},onMonthClick:function(k,b){k.stopEvent();var g=new Ext.Element(b),a;if(g.is(&quot;button.x-date-mp-cancel&quot;)){this.hideMonthPicker()}else{if(g.is(&quot;button.x-date-mp-ok&quot;)){var l=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());if(l.getMonth()!=this.mpSelMonth){l=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(l);this.hideMonthPicker()}else{if((a=g.up(&quot;td.x-date-mp-month&quot;,2))){this.mpMonths.removeClass(&quot;x-date-mp-sel&quot;);a.addClass(&quot;x-date-mp-sel&quot;);this.mpSelMonth=a.dom.xmonth}else{if((a=g.up(&quot;td.x-date-mp-year&quot;,2))){this.mpYears.removeClass(&quot;x-date-mp-sel&quot;);a.addClass(&quot;x-date-mp-sel&quot;);this.mpSelYear=a.dom.xyear}else{if(g.is(&quot;a.x-date-mp-prev&quot;)){this.updateMPYear(this.mpyear-10)}else{if(g.is(&quot;a.x-date-mp-next&quot;)){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(g,b){g.stopEvent();var d=new Ext.Element(b),a;if((a=d.up(&quot;td.x-date-mp-month&quot;,2))){this.update(new Date(this.mpSelYear,a.dom.xmonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}else{if((a=d.up(&quot;td.x-date-mp-year&quot;,2))){this.update(new Date(a.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.hideMonthPicker()}}},hideMonthPicker:function(a){if(this.monthPicker){if(a===true){this.monthPicker.hide()}else{this.monthPicker.slideOut(&quot;t&quot;,{duration:0.2})}}},showPrevMonth:function(a){this.update(this.activeDate.add(&quot;mo&quot;,-1))},showNextMonth:function(a){this.update(this.activeDate.add(&quot;mo&quot;,1))},showPrevYear:function(){this.update(this.activeDate.add(&quot;y&quot;,-1))},showNextYear:function(){this.update(this.activeDate.add(&quot;y&quot;,1))},handleMouseWheel:function(a){a.stopEvent();if(!this.disabled){var b=a.getWheelDelta();if(b&gt;0){this.showPrevMonth()}else{if(b&lt;0){this.showNextMonth()}}}},handleDateClick:function(d,b){d.stopEvent();if(!this.disabled&amp;&amp;b.dateValue&amp;&amp;!Ext.fly(b.parentNode).hasClass(&quot;x-date-disabled&quot;)){this.cancelFocus=this.focusOnSelect===false;var a=new Date(b.dateValue);if(this.showTime){a=a.add(Date.HOUR,this.hourField.getValue());a=a.add(Date.MINUTE,this.minuteField.getValue());a=a.add(Date.SECOND,this.secondField.getValue());if(!this.hourField.isValid()||!this.minuteField.isValid()||!this.secondField.isValid()){return}}this.setValue(a);delete this.cancelFocus;this.fireEvent(&quot;select&quot;,this,this.value)}},selectToday:function(){if(this.todayBtn&amp;&amp;!this.todayBtn.disabled){var a=new Date();this.setValue(a);if(this.showTime){this.hourField.setValue(a.getHours());this.minuteField.setValue(a.getMinutes());this.secondField.setValue(a.getSeconds())}this.fireEvent(&quot;select&quot;,this,this.value)}},update:function(L,E){if(this.rendered){if(!Ext.isDate(L)){L=new Date()}var a=this.activeDate,A=this.isVisible();var u=new Date(L.getTime());u.setHours(0);u.setMinutes(0);u.setMilliseconds(0);u.setSeconds(0);this.activeDate=L;if(!E&amp;&amp;a&amp;&amp;this.el){var z=u.getTime();if(a.getMonth()==u.getMonth()&amp;&amp;a.getFullYear()==u.getFullYear()){this.cells.removeClass(&quot;x-date-selected&quot;);this.cells.each(function(d){if(d.dom.firstChild.dateValue==z){d.addClass(&quot;x-date-selected&quot;);if(A&amp;&amp;!this.cancelFocus){Ext.fly(d.dom.firstChild).focus(50)}return false}},this);return}}var n=L.getDaysInMonth(),B=L.getFirstDateOfMonth(),k=B.getDay()-this.startDay;if(k&lt;0){k+=7}n+=k;var J=L.add(&quot;mo&quot;,-1),l=J.getDaysInMonth()-k,g=this.cells.elements,C=this.textNodes,K=(new Date(J.getFullYear(),J.getMonth(),l,this.initHour));K.setHours(J.getHours());K.setMinutes(J.getMinutes());K.setSeconds(J.getSeconds());today=new Date().getTime(),sel=L.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(&quot;&quot;):false,ddaysText=this.disabledDaysText,format=this.format;if(this.showToday){var q=new Date().clearTime(),e=(q&lt;min||q&gt;max||(ddMatch&amp;&amp;format&amp;&amp;ddMatch.test(q.dateFormat(format)))||(ddays&amp;&amp;ddays.indexOf(q.getDay())!=-1));if(!this.disabled){this.todayBtn.setDisabled(e);this.todayKeyListener[e?&quot;disable&quot;:&quot;enable&quot;]()}}var p=function(P,d){d.title=&quot;&quot;;var N=K.clearTime(true).getTime();d.firstChild.dateValue=N;if(N==today){d.className+=&quot; x-date-today&quot;;d.title=P.todayText}if(N==sel){d.className+=&quot; x-date-selected&quot;;if(A){Ext.fly(d.firstChild).focus(50)}}if(N&lt;min){d.className=&quot; x-date-disabled&quot;;d.title=P.minText;return}if(N&gt;max){d.className=&quot; x-date-disabled&quot;;d.title=P.maxText;return}if(ddays){if(ddays.indexOf(K.getDay())!=-1){d.title=ddaysText;d.className=&quot; x-date-disabled&quot;}}if(ddMatch&amp;&amp;format){var O=K.dateFormat(format);if(ddMatch.test(O)){d.title=ddText.replace(&quot;%0&quot;,O);d.className=&quot; x-date-disabled&quot;}}};var D=0;for(;D&lt;k;D++){C[D].innerHTML=(++l);K.setDate(K.getDate()+1);g[D].className=&quot;x-date-prevday&quot;;p(this,g[D])}for(;D&lt;n;D++){var b=D-k+1;C[D].innerHTML=(b);K.setDate(K.getDate()+1);g[D].className=&quot;x-date-active&quot;;p(this,g[D])}var M=0;for(;D&lt;42;D++){C[D].innerHTML=(++M);K.setDate(K.getDate()+1);g[D].className=&quot;x-date-nextday&quot;;p(this,g[D])}this.mbtn.setText(this.monthNames[L.getMonth()]+&quot; &quot;+L.getFullYear());if(!this.internalRender){var m=this.el.dom.firstChild,v=m.offsetWidth;this.el.setWidth(v+this.el.getBorderWidth(&quot;lr&quot;));Ext.fly(m).setWidth(v);this.internalRender=true;if(Ext.isOpera&amp;&amp;!this.secondPass){m.rows[0].cells[1].style.width=(v-(m.rows[0].cells[0].offsetWidth+m.rows[0].cells[2].offsetWidth))+&quot;px&quot;;this.secondPass=true;this.update.defer(10,this,[L])}}}},beforeDestroy:function(){if(this.rendered){Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);delete this.textNodes;delete this.cells.elements}}});Ext.reg(&quot;datepicker&quot;,Ext.SitoolsDatePicker);Ext.ns(&quot;Ext.ux.form&quot;);Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:&quot;Browse...&quot;,buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents(&quot;fileselected&quot;)},onRender:function(d,a){Ext.ux.form.FileUploadField.superclass.onRender.call(this,d,a);this.wrap=this.el.wrap({cls:&quot;x-form-field-wrap x-form-file-wrap&quot;});this.el.addClass(&quot;x-form-file-text&quot;);this.el.dom.removeAttribute(&quot;name&quot;);this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:&quot;x-form-file-btn&quot;+(b.iconCls?&quot; x-btn-icon&quot;:&quot;&quot;)}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;])},mouseleave:function(){this.button.removeClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;,&quot;x-btn-click&quot;])},mousedown:function(){this.button.addClass(&quot;x-btn-click&quot;)},mouseup:function(){this.button.removeClass([&quot;x-btn-over&quot;,&quot;x-btn-focus&quot;,&quot;x-btn-click&quot;])},change:function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent(&quot;fileselected&quot;,this,a)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:&quot;x-form-file&quot;,tag:&quot;input&quot;,type:&quot;file&quot;,size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+&quot;-file&quot;},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,&quot;tl-tr&quot;,[2,0])}});Ext.reg(&quot;fileuploadfield&quot;,Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;SitoolsDesk=new sitools.user.desktop.App();Ext.namespace(&quot;sitools.admin.datasets.columnRenderer&quot;);sitools.admin.datasets.columnRenderer.behaviorEnum={URL_LOCAL:&quot;localUrl&quot;,URL_EXT_NEW_TAB:&quot;extUrlNewTab&quot;,URL_EXT_DESKTOP:&quot;extUrlDesktop&quot;,IMAGE_NO_THUMB:&quot;ImgNoThumb&quot;,IMAGE_THUMB_FROM_IMAGE:&quot;ImgAutoThumb&quot;,IMAGE_FROM_SQL:&quot;ImgThumbSQL&quot;,DATASET_LINK:&quot;datasetLink&quot;,DATASET_ICON_LINK:&quot;datasetIconLink&quot;,NO_CLIENT_ACCESS:&quot;noClientAccess&quot;,getColumnRendererCategoryFromBehavior:function(b){var a;switch(b){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:a=&quot;URL&quot;;break;case ColumnRendererEnum.IMAGE_NO_THUMB:case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:a=&quot;Image&quot;;break;case ColumnRendererEnum.DATASET_LINK:case ColumnRendererEnum.DATASET_ICON_LINK:a=&quot;DataSetLink&quot;;break;case ColumnRendererEnum.NO_CLIENT_ACCESS:a=&quot;Other&quot;;break;default:a=&quot;&quot;;break}return a},isDisplayingImage:function(b){var a=false;switch(b.behavior){case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:case ColumnRendererEnum.IMAGE_FROM_SQL:case ColumnRendererEnum.DATASET_ICON_LINK:a=true;break;case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:if(b.type==&quot;Image&quot;){a=true}break}return a}};var ColumnRendererEnum=sitools.admin.datasets.columnRenderer.behaviorEnum;</pre>
</body>
</html>
