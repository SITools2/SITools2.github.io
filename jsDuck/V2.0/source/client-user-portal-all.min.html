<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
var Base64={_keyStr:&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;,encode:function(input){var output=&quot;&quot;;var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i&lt;input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1&gt;&gt;2;enc2=((chr1&amp;3)&lt;&lt;4)|(chr2&gt;&gt;4);enc3=((chr2&amp;15)&lt;&lt;2)|(chr3&gt;&gt;6);enc4=chr3&amp;63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output=&quot;&quot;;var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,&quot;&quot;);while(i&lt;input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1&lt;&lt;2)|(enc2&gt;&gt;4);chr2=((enc2&amp;15)&lt;&lt;4)|(enc3&gt;&gt;2);chr3=((enc3&amp;3)&lt;&lt;6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,&quot;\n&quot;);var utftext=&quot;&quot;;for(var n=0;n&lt;string.length;n++){var c=string.charCodeAt(n);if(c&lt;128){utftext+=String.fromCharCode(c);}
else if((c&gt;127)&amp;&amp;(c&lt;2048)){utftext+=String.fromCharCode((c&gt;&gt;6)|192);utftext+=String.fromCharCode((c&amp;63)|128);}
else{utftext+=String.fromCharCode((c&gt;&gt;12)|224);utftext+=String.fromCharCode(((c&gt;&gt;6)&amp;63)|128);utftext+=String.fromCharCode((c&amp;63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string=&quot;&quot;;var i=0;var c=c1=c2=0;while(i&lt;utftext.length){c=utftext.charCodeAt(i);if(c&lt;128){string+=String.fromCharCode(c);i++;}
else if((c&gt;191)&amp;&amp;(c&lt;224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&amp;31)&lt;&lt;6)|(c2&amp;63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&amp;15)&lt;&lt;12)|((c2&amp;63)&lt;&lt;6)|(c3&amp;63));i+=3;}}
return string;}};function array(n){for(i=0;i&lt;n;i++)this[i]=0;this.length=n;}
function integer(n){return n%(0xffffffff+1);}
function shr(a,b){a=integer(a);b=integer(b);if(a-0x80000000&gt;=0){a=a%0x80000000;a&gt;&gt;=b;a+=0x40000000&gt;&gt;(b-1);}else
a&gt;&gt;=b;return a;}
function shl1(a){a=a%0x80000000;if(a&amp;0x40000000==0x40000000)
{a-=0x40000000;a*=2;a+=0x80000000;}else
a*=2;return a;}
function shl(a,b){a=integer(a);b=integer(b);for(var i=0;i&lt;b;i++)a=shl1(a);return a;}
function and(a,b){a=integer(a);b=integer(b);var t1=(a-0x80000000);var t2=(b-0x80000000);if(t1&gt;=0)
if(t2&gt;=0)
return((t1&amp;t2)+0x80000000);else
return(t1&amp;b);else
if(t2&gt;=0)
return(a&amp;t2);else
return(a&amp;b);}
function or(a,b){a=integer(a);b=integer(b);var t1=(a-0x80000000);var t2=(b-0x80000000);if(t1&gt;=0)
if(t2&gt;=0)
return((t1|t2)+0x80000000);else
return((t1|b)+0x80000000);else
if(t2&gt;=0)
return((a|t2)+0x80000000);else
return(a|b);}
function xor(a,b){a=integer(a);b=integer(b);var t1=(a-0x80000000);var t2=(b-0x80000000);if(t1&gt;=0)
if(t2&gt;=0)
return(t1^t2);else
return((t1^b)+0x80000000);else
if(t2&gt;=0)
return((a^t2)+0x80000000);else
return(a^b);}
function not(a){a=integer(a);return(0xffffffff-a);}
var state=new array(4);var count=new array(2);count[0]=0;count[1]=0;var buffer=new array(64);var transformBuffer=new array(16);var digestBits=new array(16);var S11=7;var S12=12;var S13=17;var S14=22;var S21=5;var S22=9;var S23=14;var S24=20;var S31=4;var S32=11;var S33=16;var S34=23;var S41=6;var S42=10;var S43=15;var S44=21;function F(x,y,z){return or(and(x,y),and(not(x),z));}
function G(x,y,z){return or(and(x,z),and(y,not(z)));}
function H(x,y,z){return xor(xor(x,y),z);}
function I(x,y,z){return xor(y,or(x,not(z)));}
function rotateLeft(a,n){return or(shl(a,n),(shr(a,(32-n))));}
function FF(a,b,c,d,x,s,ac){a=a+F(b,c,d)+x+ac;a=rotateLeft(a,s);a=a+b;return a;}
function GG(a,b,c,d,x,s,ac){a=a+G(b,c,d)+x+ac;a=rotateLeft(a,s);a=a+b;return a;}
function HH(a,b,c,d,x,s,ac){a=a+H(b,c,d)+x+ac;a=rotateLeft(a,s);a=a+b;return a;}
function II(a,b,c,d,x,s,ac){a=a+I(b,c,d)+x+ac;a=rotateLeft(a,s);a=a+b;return a;}
function transform(buf,offset){var a=0,b=0,c=0,d=0;var x=transformBuffer;a=state[0];b=state[1];c=state[2];d=state[3];for(i=0;i&lt;16;i++){x[i]=and(buf[i*4+offset],0xff);for(j=1;j&lt;4;j++){x[i]+=shl(and(buf[i*4+j+offset],0xff),j*8);}}
a=FF(a,b,c,d,x[0],S11,0xd76aa478);d=FF(d,a,b,c,x[1],S12,0xe8c7b756);c=FF(c,d,a,b,x[2],S13,0x242070db);b=FF(b,c,d,a,x[3],S14,0xc1bdceee);a=FF(a,b,c,d,x[4],S11,0xf57c0faf);d=FF(d,a,b,c,x[5],S12,0x4787c62a);c=FF(c,d,a,b,x[6],S13,0xa8304613);b=FF(b,c,d,a,x[7],S14,0xfd469501);a=FF(a,b,c,d,x[8],S11,0x698098d8);d=FF(d,a,b,c,x[9],S12,0x8b44f7af);c=FF(c,d,a,b,x[10],S13,0xffff5bb1);b=FF(b,c,d,a,x[11],S14,0x895cd7be);a=FF(a,b,c,d,x[12],S11,0x6b901122);d=FF(d,a,b,c,x[13],S12,0xfd987193);c=FF(c,d,a,b,x[14],S13,0xa679438e);b=FF(b,c,d,a,x[15],S14,0x49b40821);a=GG(a,b,c,d,x[1],S21,0xf61e2562);d=GG(d,a,b,c,x[6],S22,0xc040b340);c=GG(c,d,a,b,x[11],S23,0x265e5a51);b=GG(b,c,d,a,x[0],S24,0xe9b6c7aa);a=GG(a,b,c,d,x[5],S21,0xd62f105d);d=GG(d,a,b,c,x[10],S22,0x2441453);c=GG(c,d,a,b,x[15],S23,0xd8a1e681);b=GG(b,c,d,a,x[4],S24,0xe7d3fbc8);a=GG(a,b,c,d,x[9],S21,0x21e1cde6);d=GG(d,a,b,c,x[14],S22,0xc33707d6);c=GG(c,d,a,b,x[3],S23,0xf4d50d87);b=GG(b,c,d,a,x[8],S24,0x455a14ed);a=GG(a,b,c,d,x[13],S21,0xa9e3e905);d=GG(d,a,b,c,x[2],S22,0xfcefa3f8);c=GG(c,d,a,b,x[7],S23,0x676f02d9);b=GG(b,c,d,a,x[12],S24,0x8d2a4c8a);a=HH(a,b,c,d,x[5],S31,0xfffa3942);d=HH(d,a,b,c,x[8],S32,0x8771f681);c=HH(c,d,a,b,x[11],S33,0x6d9d6122);b=HH(b,c,d,a,x[14],S34,0xfde5380c);a=HH(a,b,c,d,x[1],S31,0xa4beea44);d=HH(d,a,b,c,x[4],S32,0x4bdecfa9);c=HH(c,d,a,b,x[7],S33,0xf6bb4b60);b=HH(b,c,d,a,x[10],S34,0xbebfbc70);a=HH(a,b,c,d,x[13],S31,0x289b7ec6);d=HH(d,a,b,c,x[0],S32,0xeaa127fa);c=HH(c,d,a,b,x[3],S33,0xd4ef3085);b=HH(b,c,d,a,x[6],S34,0x4881d05);a=HH(a,b,c,d,x[9],S31,0xd9d4d039);d=HH(d,a,b,c,x[12],S32,0xe6db99e5);c=HH(c,d,a,b,x[15],S33,0x1fa27cf8);b=HH(b,c,d,a,x[2],S34,0xc4ac5665);a=II(a,b,c,d,x[0],S41,0xf4292244);d=II(d,a,b,c,x[7],S42,0x432aff97);c=II(c,d,a,b,x[14],S43,0xab9423a7);b=II(b,c,d,a,x[5],S44,0xfc93a039);a=II(a,b,c,d,x[12],S41,0x655b59c3);d=II(d,a,b,c,x[3],S42,0x8f0ccc92);c=II(c,d,a,b,x[10],S43,0xffeff47d);b=II(b,c,d,a,x[1],S44,0x85845dd1);a=II(a,b,c,d,x[8],S41,0x6fa87e4f);d=II(d,a,b,c,x[15],S42,0xfe2ce6e0);c=II(c,d,a,b,x[6],S43,0xa3014314);b=II(b,c,d,a,x[13],S44,0x4e0811a1);a=II(a,b,c,d,x[4],S41,0xf7537e82);d=II(d,a,b,c,x[11],S42,0xbd3af235);c=II(c,d,a,b,x[2],S43,0x2ad7d2bb);b=II(b,c,d,a,x[9],S44,0xeb86d391);state[0]+=a;state[1]+=b;state[2]+=c;state[3]+=d;}
function init(){count[0]=count[1]=0;state[0]=0x67452301;state[1]=0xefcdab89;state[2]=0x98badcfe;state[3]=0x10325476;for(i=0;i&lt;digestBits.length;i++)
digestBits[i]=0;}
function update(b){var index,i;index=and(shr(count[0],3),0x3f);if(count[0]&lt;0xffffffff-7)
count[0]+=8;else{count[1]++;count[0]-=0xffffffff+1;count[0]+=8;}
buffer[index]=and(b,0xff);if(index&gt;=63){transform(buffer,0);}}
function finish(){var bits=new array(8);var padding;var i=0,index=0,padLen=0;for(i=0;i&lt;4;i++){bits[i]=and(shr(count[0],(i*8)),0xff);}
for(i=0;i&lt;4;i++){bits[i+4]=and(shr(count[1],(i*8)),0xff);}
index=and(shr(count[0],3),0x3f);padLen=(index&lt;56)?(56-index):(120-index);padding=new array(64);padding[0]=0x80;for(i=0;i&lt;padLen;i++)
update(padding[i]);for(i=0;i&lt;8;i++)
update(bits[i]);for(i=0;i&lt;4;i++){for(j=0;j&lt;4;j++){digestBits[i*4+j]=and(shr(state[i],(j*8)),0xff);}}}
function hexa(n){var hexa_h=&quot;0123456789abcdef&quot;;var hexa_c=&quot;&quot;;var hexa_m=n;for(hexa_i=0;hexa_i&lt;8;hexa_i++){hexa_c=hexa_h.charAt(Math.abs(hexa_m)%16)+hexa_c;hexa_m=Math.floor(hexa_m/16);}
return hexa_c;}
var ascii=&quot;01234567890123456789012345678901&quot;+&quot; !\&quot;#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;+&quot;[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~&quot;;function MD5(message)
{var l,s,k,ka,kb,kc,kd;init();for(k=0;k&lt;message.length;k++){l=message.charAt(k);update(ascii.lastIndexOf(l));}
finish();ka=kb=kc=kd=0;for(i=0;i&lt;4;i++)ka+=shl(digestBits[15-i],(i*8));for(i=4;i&lt;8;i++)kb+=shl(digestBits[15-i],((i-4)*8));for(i=8;i&lt;12;i++)kc+=shl(digestBits[15-i],((i-8)*8));for(i=12;i&lt;16;i++)kd+=shl(digestBits[15-i],((i-12)*8));s=hexa(kd)+hexa(kc)+hexa(kb)+hexa(ka);return s;}
function Digest(config){this.url=config.url;this.usr=config.usr;this.pwd=config.pwd;this.realm=config.realm;this.algorithm=config.algorithm;this.nonce=config.nonce;this.method=config.method;this.mode=config.mode;this.A1=config.A1;this.getDigestAuth=function(){this.resetHeaders();return this.buildAuthenticationRequest();};this.getA1=function(){this.resetHeaders();return this.digest(this.usr+':'+this.realm+':'+this.pwd);};this.resetHeaders=function(){if(typeof(this.headers)!=&quot;undefined&quot;){delete this.headers;}
this.headers={'uri':this.url,'username':this.usr,'algorithm':this.algorithm,'realm':this.realm,'nonce':this.nonce};};this.digest=function(s){if(typeof(window[this.headers.algorithm])!='function'){if(typeof(window['MD5'])!='function'){alert('Votre navigateur ne supporte pas l\'authentification HTTP Digest !');return false;}else{return MD5(s);}}
return window[this.headers.algorithm](s);};this.buildResponseHash=function(){if(this.headers.salt){auth.secret=auth.secret+':'+auth.headers.salt;delete auth.headers.salt;}
if(this.headers.migrate){auth.secret=this.digest(auth.secret);}
var A1;if(Ext.isEmpty(this.A1)){A1=this.getA1();}
else{A1=this.A1;}
var A2=this.digest(this.method+':'+this.headers.uri);if(this.mode=='digest'){return this.digest(A1+&quot;:&quot;+this.headers.nonce+&quot;:&quot;+A2);}
return null;};this.buildAuthenticationRequest=function(){var request=&quot;Digest&quot;;var comma=' ';for(name in this.headers){request+=comma+name+'=&quot;'+this.headers[name]+'&quot;';comma=',';}
if(typeof(this.headers.algorithm)=='undefined'){return request;}
var r=this.buildResponseHash();if(r){request+=&quot;, response=\&quot;&quot;+r+&quot;\&quot;&quot;;return request;}
return false;};};function ann(obj,message){if(obj===true||obj===false){return;}
if(obj===undefined){cerr('Object is undefined - '+message);ctrace();return;}
if(obj===null){cerr('Object is null - '+message);ctrace();return;}
if(obj===&quot;&quot;){cerr('String seems empty - '+message);ctrace();return;}
if(obj==NaN){cerr('Object equals NaN - '+message);ctrace();return;}}
function assert(condition,message){if(!condition){cerr('Condition is not valid : '+message);ctrace();return;}}
function clog(message){if(isFirebugConsoleIsActive()){console.log(message);}}
function cerr(message){if(isFirebugConsoleIsActive()){console.trace();}}
function ctrace(){if(isFirebugConsoleIsActive()){console.trace();}}
function cdir(obj){if(isFirebugConsoleIsActive()){console.dir(obj);}}
function isFirebugConsoleIsActive(){try{if(console!==null&amp;&amp;console!==undefined)
{return true;}else{return false;}}
catch(e){return false;}}
Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:'x-statusbar',busyIconCls:'x-status-busy',busyText:'Loading...',autoClear:5000,emptyText:'&amp;nbsp;',activeThreadId:0,initComponent:function(){if(this.statusAlign=='right'){this.cls+=' x-status-right';}
Ext.ux.StatusBar.superclass.initComponent.call(this);},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var right=this.statusAlign=='right';this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:'x-status-text '+(this.currIconCls||''),text:this.text||this.defaultText||''});if(right){this.add('-&gt;');this.add(this.statusEl);}else{this.insert(0,this.statusEl);this.insert(1,'-&gt;');}
this.doLayout();},setStatus:function(o){o=o||{};if(typeof o=='string'){o={text:o};}
if(o.text!==undefined){this.setText(o.text);}
if(o.iconCls!==undefined){this.setIcon(o.iconCls);}
if(o.clear){var c=o.clear,wait=this.autoClear,defaults={useDefaults:true,anim:true};if(typeof c=='object'){c=Ext.applyIf(c,defaults);if(c.wait){wait=c.wait;}}else if(typeof c=='number'){wait=c;c=defaults;}else if(typeof c=='boolean'){c=defaults;}
c.threadId=this.activeThreadId;this.clearStatus.defer(wait,this,[c]);}
return this;},clearStatus:function(o){o=o||{};if(o.threadId&amp;&amp;o.threadId!==this.activeThreadId){return this;}
var text=o.useDefaults?this.defaultText:this.emptyText,iconCls=o.useDefaults?(this.defaultIconCls?this.defaultIconCls:''):'';if(o.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:text,iconCls:iconCls});this.statusEl.el.show();}});}else{this.statusEl.hide();this.setStatus({text:text,iconCls:iconCls});this.statusEl.show();}
return this;},setText:function(text){this.activeThreadId++;this.text=text||'';if(this.rendered){this.statusEl.setText(this.text);}
return this;},getText:function(){return this.text;},setIcon:function(cls){this.activeThreadId++;cls=cls||'';if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null;}
if(cls.length&gt;0){this.statusEl.addClass(cls);this.currIconCls=cls;}}else{this.currIconCls=cls;}
return this;},showBusy:function(o){if(typeof o=='string'){o={text:o};}
o=Ext.applyIf(o||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(o);}});Ext.reg('statusbar',Ext.ux.StatusBar);Ext.namespace('sitools.userProfile');sitools.userProfile.Login=Ext.extend(Ext.Window,{id:'winLogin',layout:'hbox',width:392,height:200,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get('label.login');this.bbar=new Ext.ux.StatusBar({text:i18n.get('label.ready'),id:'sbWinLogin',iconCls:'x-status-valid',items:[{text:i18n.get('label.passwordLost'),hidden:!this.reset,scope:this,icon:loadUrl.get('APP_URL')+'/common/res/images/icons/wadl.gif',iconAlign:'right',handler:function(){Ext.getCmp('winLogin').close();var reset=new sitools.userProfile.resetPassword({closable:this.closable,url:this.reset,handler:this.handler});reset.show();}}]});this.combo=new Ext.form.ComboBox({typeAhead:true,triggerAction:'all',forceSelection:true,allowBlank:false,lazyRender:true,mode:'local',store:new Ext.data.ArrayStore({id:0,fields:['myId','displayText'],data:[[1,i18n.get('label.userPortal')],[2,i18n.get('label.administration')]]}),valueField:'myId',displayField:'displayText',anchor:'80%',value:1,fieldLabel:i18n.get('label.target'),hideLabel:true});if(this.chooseLocation){this.combo.setVisible(true);this.combo.hideLabel=false;}else{this.combo.setVisible(false);this.setSize(392,160);}
this.items=[{xtype:'form',frame:true,border:false,buttonAlign:'center',id:'frmLogin',width:392,labelWidth:100,padding:&quot;10px 10px 0px 60px&quot;,bodyStyle:&quot;background-image: url(&quot;+loadUrl.get('APP_URL')+&quot;/common/res/images/ux/login-big.gif);&quot;+&quot;background-position: top left;&quot;+&quot;background-repeat: no-repeat;&quot;,items:[{xtype:'textfield',fieldLabel:i18n.get('label.login'),name:'login',id:'logId',allowBlank:false,anchor:'80%'},{xtype:'textfield',fieldLabel:i18n.get('label.password'),name:'password',id:'pwdId',allowBlank:false,inputType:'password',anchor:'80%',listeners:{scope:this,specialkey:function(field,e){if(e.getKey()==e.ENTER){this.getAuth();}}}},this.combo],buttons:[{text:i18n.get('label.login'),handler:this.getAuth,scope:this},{text:i18n.get('label.reset'),handler:function(){Ext.getCmp('frmLogin').getForm().reset();Ext.getCmp('sbWinLogin').setStatus({text:i18n.get('label.ready'),iconCls:'x-status-valid'});}},{text:i18n.get('label.cancel'),hidden:!this.defurl,scope:this,handler:function(){window.location.href=this.defurl;}},{text:i18n.get('label.register'),hidden:!this.register,scope:this,icon:loadUrl.get('APP_URL')+'/common/res/images/icons/refresh.png',handler:function(){Ext.getCmp('winLogin').close();var register=new sitools.userProfile.Register({closable:this.closable,url:this.register,login:this.url,handler:this.handler});register.show();}}]}];sitools.userProfile.Login.superclass.initComponent.call(this);},getAuth:function(){Ext.util.Cookies.set('A1',&quot;&quot;);Ext.util.Cookies.set('userLogin',&quot;&quot;);Ext.util.Cookies.set('scheme',&quot;&quot;);Ext.util.Cookies.set('algorithm',&quot;&quot;);Ext.util.Cookies.set('realm',&quot;&quot;);Ext.util.Cookies.set('nonce',&quot;&quot;);Ext.util.Cookies.set('hashCode',&quot;&quot;);Ext.apply(Ext.Ajax.defaultHeaders,{&quot;Authorization&quot;:&quot;&quot;});Ext.Ajax.request({url:this.url,method:'GET',scope:this,success:function(response,opts){var Json=Ext.decode(response.responseText);var date=new Date();if(!Ext.isEmpty(Json.data)){if(Json.data.scheme=='HTTP_Digest'){var auth=new Digest({usr:Ext.getCmp('logId').getValue(),pwd:Ext.getCmp('pwdId').getValue(),realm:Json.data.realm});var A1=auth.getA1();Ext.util.Cookies.set('A1',A1);Ext.util.Cookies.set('userLogin',auth.usr,date.add(Date.MINUTE,1));Ext.util.Cookies.set('scheme',Json.data.scheme);Ext.util.Cookies.set('algorithm',Json.data.algorithm);Ext.util.Cookies.set('realm',auth.realm);Ext.util.Cookies.set('nonce',Json.data.nonce);}else if(Json.data.scheme==&quot;HTTP_Basic&quot;){var usr=Ext.getCmp('logId').getValue();var pwd=Ext.getCmp('pwdId').getValue();var tok=usr+':'+pwd;var hash=Base64.encode(tok);var auth='Basic '+hash;Ext.util.Cookies.set('userLogin',usr,date.add(Date.MINUTE,1));Ext.util.Cookies.set('scheme',Json.data.scheme);Ext.util.Cookies.set('hashCode',auth,date.add(Date.MINUTE,1));}}
this.login();},failure:alertFailure});},login:function(){if(!Ext.getCmp('frmLogin').getForm().isValid()){Ext.getCmp('sbWinLogin').setStatus({text:i18n.get('warning.checkForm'),iconCls:'x-status-error'});return;}
Ext.getCmp('winLogin').body.mask();Ext.getCmp('sbWinLogin').showBusy();Ext.Ajax.request({url:this.url,method:'GET',scope:this,success:function(response,opts){try{var Json=Ext.decode(response.responseText);if(Json.success){Ext.apply(Ext.Ajax.defaultHeaders,{&quot;Authorization&quot;:Ext.util.Cookies.get('hashCode')});Ext.getCmp('winLogin').close();if(this.chooseLocation){if(this.combo.getValue()==1){window.location.href=loadUrl.get('APP_URL')+'/login-redirect?kwd=/client-user/index.html';}else{Ext.Ajax.request({url:loadUrl.get('APP_URL')+'/login-redirect?kwd=/client-admin',method:&quot;GET&quot;,success:function(response){Ext.Msg.alert('error login.js redirect with authorization');}});}}else{window.location.reload();}}else{Ext.util.Cookies.set('userLogin',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set('scheme',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set('hashCode',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var txt=i18n.get('warning.serverError')+': '+Json.message;Ext.getCmp('winLogin').body.unmask();Ext.getCmp('sbWinLogin').setStatus({text:txt,iconCls:'x-status-error'});}}catch(err){Ext.Msg.alert(i18n.get('label.error'),err);}},failure:function(response,opts){Ext.util.Cookies.set('userLogin',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set('scheme',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));Ext.util.Cookies.set('hashCode',&quot;&quot;,new Date().add(Date.MINUTE,COOKIE_DURATION*-1));var txt;if(response.status==200){var ret=Ext.decode(response.responseText).error;txt=i18n.get('msg.error')+': '+ret;}else{txt=i18n.get('warning.serverError')+': '+response.statusText;}
Ext.getCmp('winLogin').body.unmask();Ext.getCmp('sbWinLogin').setStatus({text:txt,iconCls:'x-status-error'});}});}});Ext.reg('s-login',sitools.userProfile.Login);Ext.namespace('sitools.userProfile');sitools.userProfile.Register=Ext.extend(Ext.Window,{id:'winRegister',layout:'hbox',width:420,height:490,resizable:false,closable:false,modal:true,initComponent:function(){this.title=i18n.get('label.register');this.captchaUrl=loadUrl.get('APP_URL')+loadUrl.get('APP_INSCRIPTIONS_USER_URL')+'/captcha?width=300&amp;height=50';this.bbar=new Ext.ux.StatusBar({text:i18n.get('label.ready'),id:'sbWinRegister',iconCls:'x-status-valid'});this.captcha=new Ext.BoxComponent({id:'captchaBox',autoEl:{tag:'img',src:this.captchaUrl+'&amp;_dc='+new Date().getTime()},fieldLabel:i18n.get('label.captcha'),height:50,width:300,anchor:'100%'});this.items=[{xtype:'form',border:false,buttonAlign:'center',id:'frmRegister',bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get('APP_URL')+'/common/res/images/ux/register-big.gif&quot;) no-repeat;',width:400,height:420,labelWidth:120,items:[{xtype:'textfield',fieldLabel:i18n.get('label.login'),name:'identifier',id:'regLogin',allowBlank:false,vtype:'uniquelogin',anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.firstName'),name:'firstName',id:'regFirstName',allowBlank:false,anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.lastName'),name:'lastName',id:'regLastName',allowBlank:false,anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.password'),name:'password',allowBlank:false,inputType:'password',vtype:'passwordlength',id:'pass1',anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.confirmPassword'),name:'cpassword',submitValue:false,allowBlank:false,inputType:'password',id:'pass2',initialPassField:'pass1',vtype:'password',anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.email'),id:'regEmail',name:'email',vtype:'uniqueemail',allowBlank:false,validationEvent:'',anchor:'100%'},{xtype:'textfield',name:'organisation',fieldLabel:i18n.get('label.organisation'),anchor:'100%'},{xtype:'textarea',fieldLabel:i18n.get('label.comment'),id:'regComment',name:'comment',validationEvent:'',height:40,anchor:'100%'},this.captcha,{xtype:'button',text:i18n.get('label.captchaReload'),icon:loadUrl.get('APP_URL')+'/common/res/images/icons/refresh.png',x:150,arrowAlign:'right',reloadUrl:this.captchaUrl,handler:function(){Ext.util.Cookies.clear('captcha');var box=Ext.get('captchaBox');box.dom.src=this.reloadUrl+'&amp;_dc='+new Date().getTime();box.slideIn('l');}},{xtype:'textfield',fieldLabel:i18n.get('label.fieldCaptcha'),name:'captcha',id:'captcha',allowBlank:false,anchor:'100%'},{xtype:'checkbox',fieldLabel:String.format(i18n.get('label.acceptCGU'),URL_CGU),id:'acceptCGU',name:'acceptCGU',height:40,anchor:'100%',submitValue:false}],buttons:[{text:i18n.get('label.register'),handler:this.register,scope:this},{text:i18n.get('label.reset'),reloadUrl:this.captchaUrl,handler:function(){Ext.getCmp('frmRegister').getForm().reset();Ext.getCmp('sbWinRegister').setStatus({text:i18n.get('label.ready'),iconCls:'x-status-valid'});Ext.util.Cookies.clear('captcha');var box=Ext.get('captchaBox');box.dom.src=this.reloadUrl+'&amp;_dc='+new Date().getTime();box.slideIn('l');}},{text:i18n.get('label.login'),hidden:!this.register,scope:this,icon:loadUrl.get('APP_URL')+'/common/res/images/icons/refresh.png',handler:function(){Ext.getCmp('winRegister').close();var login=new sitools.userProfile.Login({closable:this.closable,url:this.login,register:this.url,handler:this.handler});login.show();}}]}];sitools.userProfile.Register.superclass.initComponent.call(this);},register:function(){var f=Ext.getCmp('frmRegister').getForm();if(!f.findField('acceptCGU').getValue()){Ext.getCmp('sbWinRegister').setStatus({text:i18n.get('label.mustAcceptCGU'),iconCls:'x-status-error'});;return;}
if(!f.isValid()){Ext.getCmp('sbWinRegister').setStatus({text:i18n.get('warning.checkForm'),iconCls:'x-status-error'});this.reloadCaptcha();return;}
var putObject=new Object();putObject.properties=[];Ext.iterate(f.getValues(),function(key,value){if(key=='organisation'){putObject.properties.push({name:&quot;organisation&quot;,value:value,scope:&quot;Editable&quot;});}else{if(key!='captcha'){putObject[key]=value;}}},this);var cook=Ext.util.Cookies.get('captcha');var capt=f.findField('captcha').getValue();Ext.getCmp('winRegister').body.mask();Ext.getCmp('sbWinRegister').showBusy();Ext.Ajax.request({url:this.url,method:'POST',jsonData:putObject,params:{&quot;captcha.id&quot;:cook,&quot;captcha.key&quot;:capt},scope:this,success:function(response,opts){var json=Ext.decode(response.responseText);if(json.success){new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get('label.registerSent'),autoDestroy:true,hideDelay:1000}).show(document);Ext.getCmp('winRegister').close();}
else{Ext.getCmp('winRegister').body.unmask();Ext.getCmp('sbWinRegister').setStatus({text:json.message,iconCls:'x-status-error'});}
if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this);}},failure:function(response,opts){var txt;if(response.status==200){var ret=Ext.decode(response.responseText).message;txt=i18n.get('msg.error')+': '+ret;}else if(response.status==403){txt=i18n.get('msg.wrongCaptcha');}else{txt=i18n.get('warning.serverError')+': '+response.statusText;}
Ext.getCmp('winRegister').body.unmask();Ext.getCmp('sbWinRegister').setStatus({text:txt,iconCls:'x-status-error'});this.reloadCaptcha();}});},reloadCaptcha:function(){Ext.util.Cookies.clear('captcha');var box=Ext.get('captchaBox');box.dom.src=this.captchaUrl+'&amp;_dc='+new Date().getTime();box.slideIn('l');var f=Ext.getCmp('frmRegister').getForm();var capt=f.findField('captcha').setValue(&quot;&quot;);}});Ext.reg('s-register',sitools.userProfile.Register);Ext.namespace('sitools.userProfile');sitools.userProfile.resetPassword=Ext.extend(Ext.Window,{id:'winPassword',layout:'hbox',width:420,height:183,resizable:false,modal:true,initComponent:function(){this.title=i18n.get('label.resetPassword');this.bbar=new Ext.ux.StatusBar({text:i18n.get('label.ready'),id:'sbWinPassword',iconCls:'x-status-valid'});this.items=[{xtype:'form',border:false,buttonAlign:'center',id:'frmResetPassword',bodyStyle:'padding:10px 10px 0px 60px; background:url(&quot;'+loadUrl.get('APP_URL')+'/common/res/images/ux/login-big.gif&quot;) no-repeat;',width:400,labelWidth:120,items:[{xtype:'textfield',fieldLabel:i18n.get('label.login'),name:'identifier',id:'regLogin',allowBlank:false,anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.email'),id:'regEmail',name:'email',vtype:'uniqueemail',allowBlank:false,validationEvent:'',anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.emailConfirm'),id:'regEmailConfirm',name:'emailConfirm',vtype:'uniqueemail',allowBlank:false,validationEvent:'',anchor:'100%'}],buttons:[{text:i18n.get('label.resetPassword'),handler:this.reset,scope:this},{text:i18n.get('label.reset'),handler:function(){Ext.getCmp('frmResetPassword').getForm().reset();Ext.getCmp('sbWinPassword').setStatus({text:i18n.get('label.ready'),iconCls:'x-status-valid'});}}]}];sitools.userProfile.resetPassword.superclass.initComponent.call(this);},reset:function(){var f=Ext.getCmp('frmResetPassword').getForm();if(f.findField('email').getValue()!=f.findField('emailConfirm').getValue()){Ext.getCmp('sbWinPassword').setStatus({text:i18n.get('warning.checkForm'),iconCls:'x-status-error'});return;}
if(!f.isValid()){Ext.getCmp('sbWinPassword').setStatus({text:i18n.get('warning.checkForm'),iconCls:'x-status-error'});return;}
var putObject=new Object();Ext.iterate(f.getValues(),function(key,value){if(key!='emailConfirm'){putObject[key]=value;}},this);Ext.getCmp('winPassword').body.mask();Ext.getCmp('sbWinPassword').showBusy();Ext.Ajax.request({url:this.url,method:'PUT',jsonData:putObject,scope:this,success:function(response,opts){var json=Ext.decode(response.responseText);if(json.success){Ext.getCmp('winPassword').body.unmask();Ext.getCmp('sbWinPassword').setStatus({text:json.message,iconCls:'x-status-valid'});Ext.getCmp('winPassword').close();var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get('label.passwordSent')+json.message,autoDestroy:true,hideDelay:1300});notify.show(document);}else{Ext.getCmp('winPassword').body.unmask();Ext.getCmp('sbWinPassword').setStatus({text:json.message,iconCls:'x-status-error'});}
if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this);}},failure:function(response,opts){var txt;if(response.status==200){var ret=Ext.decode(response.responseText).message;txt=i18n.get('msg.error')+': '+ret;}else{txt=i18n.get('warning.serverError')+': '+response.statusText;}
Ext.getCmp('winPassword').body.unmask();Ext.getCmp('sbWinPassword').setStatus({text:txt,iconCls:'x-status-error'});}});}});Ext.namespace('sitools.userProfile');sitools.userProfile.editProfile=Ext.extend(Ext.Panel,{padding:&quot;10px 10px 0px 60px&quot;,frame:true,layout:&quot;fit&quot;,initComponent:function(){this.bodyStyle=&quot;background-image: url(&quot;+loadUrl.get('APP_URL')+&quot;/common/res/images/ux/login-big.gif);&quot;+&quot;background-position: top left;&quot;+&quot;background-repeat: no-repeat;&quot;;this.bbar=new Ext.ux.StatusBar({text:i18n.get('label.ready'),id:'sbWinEditProfile',iconCls:'x-status-valid'});var storeProperties=new Ext.data.JsonStore({fields:[{name:'name',type:'string'},{name:'value',type:'string'},{name:'scope',type:'string'}],autoLoad:false});var smProperties=new Ext.grid.RowSelectionModel({singleSelect:true});var cmProperties=new Ext.grid.ColumnModel({columns:[{header:i18n.get('headers.name'),dataIndex:'name',editor:new Ext.form.TextField({readOnly:true})},{header:i18n.get('headers.value'),dataIndex:'value',editor:new Ext.form.TextField({allowBlank:false})}],defaults:{sortable:false,width:100}});this.gridProperties=new Ext.grid.EditorGridPanel({title:i18n.get('title.properties'),id:'userGridProperties',height:130,autoScroll:true,clicksToEdit:1,store:storeProperties,cm:cmProperties,sm:smProperties,viewConfig:{forceFit:true,getRowClass:function(row,col){var data=row.data;if(data.scope=='ReadOnly'){return&quot;row-grid-readOnly&quot;;}}},listeners:{beforeedit:function(e){var scope=e.record.data.scope;var name=e.field;if(scope=='ReadOnly'||name=='name'){return false;}}}});this.items=[{xtype:'form',flex:1,border:false,buttonAlign:'center',id:'frmEditProfile',labelWidth:120,items:[{xtype:'textfield',name:'identifier',fieldLabel:i18n.get('label.login'),anchor:'100%',allowBlank:false,readOnly:true,style:{color:'#C0C0C0'},id:&quot;nameField&quot;},{xtype:'textfield',fieldLabel:i18n.get('label.firstName'),name:'firstName',id:'regFirstName',allowBlank:false,anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.lastName'),name:'lastName',id:'regLastName',allowBlank:false,anchor:'100%'},{xtype:'textfield',fieldLabel:i18n.get('label.password'),anchor:'100%',inputType:'password',name:'secret',value:'',id:&quot;passwordField&quot;,vtype:'passwordlength'},{id:&quot;confirmSecret&quot;,xtype:'textfield',fieldLabel:i18n.get('label.confirmPassword'),anchor:'100%',inputType:'password',initialPassField:'passwordField',vtype:'password',name:'confirmSecret',submitValue:false,value:''},{xtype:'textfield',fieldLabel:i18n.get('label.email'),id:'regEmail',name:'email',vtype:'uniqueemail',allowBlank:false,validationEvent:'',anchor:'100%'},this.gridProperties],buttons:[{text:i18n.get('label.saveEdit'),x:30,handler:this.saveEdit,scope:this}]}];sitools.userProfile.editProfile.superclass.initComponent.call(this);},saveEdit:function(){var f=Ext.getCmp('frmEditProfile').getForm();if(!f.isValid()){Ext.getCmp('sbWinEditProfile').setStatus({text:i18n.get('warning.checkForm'),iconCls:'x-status-error'});return;}
var putObject=f.getValues();putObject.properties=[];this.gridProperties.getStore().each(function(item){putObject.properties.push({name:item.data.name,value:item.data.value,scope:item.data.scope});});this.body.mask();Ext.getCmp('sbWinEditProfile').showBusy();Ext.Ajax.request({url:this.url,method:'PUT',jsonData:putObject,scope:this,success:function(response,opts){var json=Ext.decode(response.responseText);if(json.success){this.ownerCt.close();var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:json.message,autoDestroy:true,hideDelay:1000});notify.show(document);}else{Ext.getCmp('winEditProfile').body.unmask();Ext.getCmp('sbWinEditProfile').setStatus({text:json.message,iconCls:'x-status-error'});}
if(this.handler!==null&amp;&amp;this.handler!==undefined){this.handler.call(this.scope||this,putObject);}},failure:function(response,opts){var txt;if(response.status==200){var ret=Ext.decode(response.responseText).message;txt=i18n.get('msg.error')+': '+ret;}else{txt=i18n.get('warning.serverError')+': '+response.statusText;}
Ext.getCmp('winEditProfile').body.unmask();Ext.getCmp('sbWinEditProfile').setStatus({text:txt,iconCls:'x-status-error'});}});},onRender:function(){sitools.userProfile.editProfile.superclass.onRender.apply(this,arguments);if(this.url){Ext.Ajax.request({url:this.url,method:'GET',scope:this,success:function(ret){var f=this.findByType('form')[0].getForm();var data=Ext.decode(ret.responseText);if(data.user!==undefined){f.setValues(data.user);f.findField('secret').setValue('');if(!Ext.isEmpty(data.user.properties)){Ext.each(data.user.properties,function(property){var rec=new Ext.data.Record({name:property.name,value:property.value,scope:property.scope});this.gridProperties.getStore().add(rec);},this);}}},failure:alertFailure});}},showMeInFixedNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);},showMeInDesktopNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);}});var loginErrLength='Login minimum 4 character !';var loginErrUnique='Login already in use !';var loginSuccess='Login avaliable';var emailErrFormat='Email not valid !';var emailErrUnique='Email already in use !';var emailSuccess='Email valid &amp; avaliable';Ext.apply(Ext.form.VTypes,{uniqueloginMask:/[a-z0-9_\.\-@\+]/i,uniquelogin:function(val){if(val.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false;}else{return true;}},uniqueloginText:loginErrUnique,uniqueemailMask:/[a-z0-9_\.\-@\+]/i,uniqueemail:function(val){var uniqueemail=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(uniqueemail.test(val)){return true;}else{return false;}},uniqueemailText:emailErrFormat,password:function(val,field){if(field.initialPassField){var pwd=Ext.getCmp(field.initialPassField);return(val==pwd.getValue());}
return true;},passwordText:'Passwords do not match',passwordlength:function(val){if(val.length&lt;6||val.length&gt;40){return false;}else{return true;}},passwordlengthText:'Invalid Password Length. It must be between 6 and 40'});function resetLoginValidator(is_error){Ext.apply(Ext.form.VTypes,{uniquelogin:function(val){if(val.length&lt;4){Ext.apply(Ext.form.VTypes,{uniqueloginText:loginErrLength});return false;}else{return true;}}});}
function resetEmailValidator(value){Ext.apply(Ext.form.VTypes,{uniqueemail:function(val){var uniqueemail=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/;if(uniqueemail.test(val)){return true;}else{return false;}
return(value);}});}
Ext.namespace('Ext.ux.plugin');Ext.onReady(function(){var CSS=Ext.util.CSS;if(CSS){CSS.getRule('.x-hide-nosize')||CSS.createStyleSheet('.x-hide-nosize{height:0px!important;width:0px!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;border:none!important;zoom:1;}');CSS.refreshCache();}});(function(){var El=Ext.Element,A=Ext.lib.Anim,supr=El.prototype;var VISIBILITY=&quot;visibility&quot;,DISPLAY=&quot;display&quot;,HIDDEN=&quot;hidden&quot;,NONE=&quot;none&quot;;var fx={};fx.El={setDisplayed:function(value){var me=this;me.visibilityCls?(me[value!==false?'removeClass':'addClass'](me.visibilityCls)):supr.setDisplayed.call(me,value);return me;},isDisplayed:function(){return!(this.hasClass(this.visibilityCls)||this.isStyle(DISPLAY,NONE));},fixDisplay:function(){var me=this;supr.fixDisplay.call(me);me.visibilityCls&amp;&amp;me.removeClass(me.visibilityCls);},isVisible:function(deep){var vis=this.visible||(!this.isStyle(VISIBILITY,HIDDEN)&amp;&amp;(this.visibilityCls?!this.hasClass(this.visibilityCls):!this.isStyle(DISPLAY,NONE)));if(deep!==true||!vis){return vis;}
var p=this.dom.parentNode,bodyRE=/^body/i;while(p&amp;&amp;!bodyRE.test(p.tagName)){if(!Ext.fly(p,'_isVisible').isVisible()){return false;}
p=p.parentNode;}
return true;},isStyle:supr.isStyle||function(style,val){return this.getStyle(style)==val;}};Ext.override(El.Flyweight,fx.El);Ext.ux.plugin.VisibilityMode=function(opt){Ext.apply(this,opt||{});var CSS=Ext.util.CSS;if(CSS&amp;&amp;!Ext.isIE&amp;&amp;this.fixMaximizedWindow!==false&amp;&amp;!Ext.ux.plugin.VisibilityMode.MaxWinFixed){CSS.updateRule('.x-window-maximized-ct','overflow','');Ext.ux.plugin.VisibilityMode.MaxWinFixed=true;}};Ext.extend(Ext.ux.plugin.VisibilityMode,Object,{bubble:true,fixMaximizedWindow:true,elements:null,visibilityCls:'x-hide-nosize',hideMode:'nosize',ptype:'uxvismode',init:function(c){var hideMode=this.hideMode||c.hideMode,plugin=this,bubble=Ext.Container.prototype.bubble,changeVis=function(){var els=[this.collapseEl,this.actionMode].concat(plugin.elements||[]);Ext.each(els,function(el){plugin.extend(this[el]||el);},this);var cfg={visFixed:true,animCollapse:false,animFloat:false,hideMode:hideMode,defaults:this.defaults||{}};cfg.defaults.hideMode=hideMode;Ext.apply(this,cfg);Ext.apply(this.initialConfig||{},cfg);};c.on('render',function(){if(plugin.bubble!==false&amp;&amp;this.ownerCt){bubble.call(this.ownerCt,function(){this.visFixed||this.on('afterlayout',changeVis,this,{single:true});});}
changeVis.call(this);},c,{single:true});},extend:function(el,visibilityCls){el&amp;&amp;Ext.each([].concat(el),function(e){if(e&amp;&amp;e.dom){if('visibilityCls'in e)return;Ext.apply(e,fx.El);e.visibilityCls=visibilityCls||this.visibilityCls;}},this);return this;}});Ext.preg&amp;&amp;Ext.preg('uxvismode',Ext.ux.plugin.VisibilityMode);Ext.provide&amp;&amp;Ext.provide('uxvismode');})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,A=Ext.lib.Anim,Evm=Ext.EventManager,E=Ext.lib.Event,DOC=document,emptyFn=function(){},OP=Object.prototype,OPString=OP.toString,HTMLDoc='[object HTMLDocument]';if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,''),10)&lt;311){alert('Ext Release '+Ext.version+' is not supported');}
Ext._documents={};Ext._documents[Ext.id(document,'_doc')]=Ext.elCache;var resolveCache=ELD.resolveDocumentCache=function(el,cacheId){var doc=GETDOC(el),c=Ext.isDocument(doc)?Ext.id(doc):cacheId,cache=Ext._documents[c]||null;return cache||(c?Ext._documents[c]={}:null);},clearCache=ELD.clearDocumentCache=function(cacheId){delete Ext._documents[cacheId];};El.addMethods||(El.addMethods=function(ov){Ext.apply(El.prototype,ov||{});});Ext.removeNode=function(n){var dom=n?n.dom||n:null,el,elc,elCache=resolveCache(dom),parent;if(dom&amp;&amp;(elc=elCache[dom.id])&amp;&amp;(el=elc.el)){if(el.dom){Ext.enableNestedListenerRemoval?Evm.purgeElement(el.dom,true):Evm.removeAll(el.dom);}
delete elCache[dom.id];delete el.dom;delete el._context;el=null;}
if(dom&amp;&amp;!dom.navigator&amp;&amp;!Ext.isDocument(dom)&amp;&amp;dom.tagName!='BODY'){(parent=dom.parentElement||dom.parentNode)&amp;&amp;parent.removeChild(dom);}
dom=parent=null;};var overload=function(pfn,fn){var f=typeof pfn==='function'?pfn:function t(){};var ov=f._ovl;if(!ov){ov={base:f};ov[f.length||0]=f;f=function t(){var o=arguments.callee._ovl;var fn=o[arguments.length]||o.base;return fn&amp;&amp;fn!=arguments.callee?fn.apply(this,arguments):undefined;};}
var fnA=[].concat(fn);for(var i=0,l=fnA.length;i&lt;l;++i){ov[fnA[i].length]=fnA[i];}
f._ovl=ov;var t=null;return f;};Ext.applyIf(Ext,{overload:overload(overload,[function(fn){return overload(null,fn);},function(obj,mname,fn){return obj[mname]=overload(obj[mname],fn);}]),isArray:function(v){return!!v&amp;&amp;OPString.apply(v)=='[object Array]';},isObject:function(obj){return!!obj&amp;&amp;typeof obj=='object';},isDocument:function(el,testOrigin){var elm=el?el.dom||el:null;var test=elm&amp;&amp;((OPString.apply(elm)==HTMLDoc)||(elm&amp;&amp;elm.nodeType==9));if(test&amp;&amp;testOrigin){try{test=!!elm.location;}
catch(e){return false;}}
return test;},isWindow:function(el){var elm=el?el.dom||el:null;return elm?!!elm.navigator||OPString.apply(elm)==&quot;[object Window]&quot;:false;},isIterable:function(v){if(Ext.isArray(v)||v.callee){return true;}
if(/NodeList|HTMLCollection/.test(OPString.call(v))){return true;}
return((typeof v.nextNode!='undefined'||v.item)&amp;&amp;Ext.isNumber(v.length));},isElement:function(obj){return obj&amp;&amp;Ext.type(obj)=='element';},isEvent:function(obj){return OPString.apply(obj)=='[object Event]'||(Ext.isObject(obj)&amp;&amp;!Ext.type(o.constructor)&amp;&amp;(window.event&amp;&amp;obj.clientX&amp;&amp;obj.clientX==window.event.clientX));},isFunction:function(obj){return!!obj&amp;&amp;typeof obj=='function';},isEventSupported:function(evName,testEl){var TAGNAMES={'select':'input','change':'input','submit':'form','reset':'form','load':'img','error':'img','abort':'img'},cache={},onPrefix=/^on/i,getKey=function(type,el){var tEl=Ext.getDom(el);return(tEl?(Ext.isElement(tEl)||Ext.isDocument(tEl)?tEl.nodeName.toLowerCase():el.self?'#window':el||'#object'):el||'div')+':'+type;};return function(evName,testEl){evName=(evName||'').replace(onPrefix,'');var el,isSupported=false;var eventName='on'+evName;var tag=(testEl?testEl:TAGNAMES[evName])||'div';var key=getKey(evName,tag);if(key in cache){return cache[key];}
el=Ext.isString(tag)?DOC.createElement(tag):testEl;isSupported=(!!el&amp;&amp;(eventName in el));isSupported||(isSupported=window.Event&amp;&amp;!!(String(evName).toUpperCase()in window.Event));if(!isSupported&amp;&amp;el){el.setAttribute&amp;&amp;el.setAttribute(eventName,'return;');isSupported=Ext.isFunction(el[eventName]);}
cache[key]=isSupported;el=null;return isSupported;};}()});var assertClass=function(el){return El;return El[(el.tagName||'-').toUpperCase()]||El;};var libFlyweight;function fly(el,doc){if(!libFlyweight){libFlyweight=new Ext.Element.Flyweight();}
libFlyweight.dom=Ext.getDom(el,null,doc);return libFlyweight;}
Ext.apply(Ext,{get:El.get=function(el,doc){if(!el){return null;}
var isDoc=Ext.isDocument(el);Ext.isDocument(doc)||(doc=DOC);var ex,elm,id,cache=resolveCache(doc);if(typeof el==&quot;string&quot;){elm=Ext.getDom(el,null,doc);if(!elm)return null;if(cache[el]&amp;&amp;cache[el].el){ex=cache[el].el;ex.dom=elm;}else{ex=El.addToCache(new(assertClass(elm))(elm,null,doc));}
return ex;}else if(isDoc){if(!Ext.isDocument(el,true)){return false;}
cache=resolveCache(el);if(cache[Ext.id(el)]&amp;&amp;cache[el.id].el){return cache[el.id].el;}
var f=function(){};f.prototype=El.prototype;var docEl=new f();docEl.dom=el;docEl.id=Ext.id(el,'_doc');docEl._isDoc=true;El.addToCache(docEl,null,cache);return docEl;}else if(el instanceof El){if(el.dom){el.id=Ext.id(el.dom);}else{el.dom=el.id?Ext.getDom(el.id,true):null;}
if(el.dom){cache=resolveCache(el);(cache[el.id]||(cache[el.id]={data:{},events:{}})).el=el;}
return el;}else if(el.tagName||Ext.isWindow(el)){cache=resolveCache(el);id=Ext.id(el);if(cache[id]&amp;&amp;(ex=cache[id].el)){ex.dom=el;}else{ex=El.addToCache(new(assertClass(el))(el,null,doc),null,cache);}
return ex;}else if(el.isComposite){return el;}else if(Ext.isArray(el)){return Ext.get(doc,doc).select(el);}
return null;},getDom:function(el,strict,doc){var D=doc||DOC;if(!el||!D){return null;}
if(el.dom){return el.dom;}else{if(Ext.isString(el)){var e=D.getElementById(el);if(e&amp;&amp;Ext.isIE&amp;&amp;strict){if(el==e.getAttribute('id')){return e;}else{return null;}}
return e;}else{return el;}}},getBody:function(doc){var D=ELD.getDocument(doc)||DOC;return Ext.get(D.body||D.documentElement);},getDoc:Ext.overload([Ext.getDoc,function(doc){return Ext.get(doc,doc);}])});El.data=function(el,key,value){el=El.get(el);if(!el){return null;}
var c=resolveCache(el)[el.id].data;if(arguments.length==2){return c[key];}else{return(c[key]=value);}};El.addToCache=function(el,id,cache){id=id||Ext.id(el);var C=cache||resolveCache(el);C[id]={el:el.dom?el:Ext.get(el),data:{},events:{}};var d=C[id].el.dom;(d.getElementById||d.navigator)&amp;&amp;(C[id].skipGC=true);return C[id].el;};El.removeFromCache=function(el,cache){if(el&amp;&amp;el.id){var C=cache||resolveCache(el);delete C[el.id];}};El.ASCLASS=3;El.visibilityCls='x-hide-nosize';var propCache={},camelRe=/(-[a-z])/gi,camelFn=function(m,a){return a.charAt(1).toUpperCase();},opacityRe=/alpha\(opacity=(.*)\)/i,trimRe=/^\s+|\s+$/g,marginRightRe=/marginRight/,propFloat=Ext.isIE?'styleFloat':'cssFloat',view=DOC.defaultView,VISMODE='visibilityMode',ELDISPLAY=El.DISPLAY,ELVISIBILITY=El.VISIBILITY,ELASCLASS=El.ASCLASS,ORIGINALDISPLAY='originalDisplay',PADDING=&quot;padding&quot;,MARGIN=&quot;margin&quot;,BORDER=&quot;border&quot;,LEFT=&quot;-left&quot;,RIGHT=&quot;-right&quot;,TOP=&quot;-top&quot;,BOTTOM=&quot;-bottom&quot;,WIDTH=&quot;-width&quot;,MATH=Math,OPACITY=&quot;opacity&quot;,VISIBILITY=&quot;visibility&quot;,DISPLAY=&quot;display&quot;,OFFSETS=&quot;offsets&quot;,ASCLASS=&quot;asclass&quot;,HIDDEN=&quot;hidden&quot;,NONE=&quot;none&quot;,ISVISIBLE='isVisible',ISCLIPPED='isClipped',OVERFLOW='overflow',OVERFLOWX='overflow-x',OVERFLOWY='overflow-y',ORIGINALCLIP='originalClip',XMASKED=&quot;x-masked&quot;,XMASKEDRELATIVE=&quot;x-masked-relative&quot;,borders={l:BORDER+LEFT+WIDTH,r:BORDER+RIGHT+WIDTH,t:BORDER+TOP+WIDTH,b:BORDER+BOTTOM+WIDTH},paddings={l:PADDING+LEFT,r:PADDING+RIGHT,t:PADDING+TOP,b:PADDING+BOTTOM},margins={l:MARGIN+LEFT,r:MARGIN+RIGHT,t:MARGIN+TOP,b:MARGIN+BOTTOM},data=El.data,GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper,propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,CSS=Ext.util.CSS,getDisplay=function(dom){var d=data(dom,ORIGINALDISPLAY);if(d===undefined){data(dom,ORIGINALDISPLAY,d='');}
return d;},getVisMode=function(dom){var m=data(dom,VISMODE);if(m===undefined){data(dom,VISMODE,m=El.prototype.visibilityMode);}
return m;};function chkCache(prop){return propCache[prop]||(propCache[prop]=prop=='float'?propFloat:prop.replace(camelRe,camelFn));};El.addMethods({getDocument:function(){return this._context||(this._context=GETDOC(this));},remove:function(cleanse,deep){var dom=this.dom;this.isMasked()&amp;&amp;this.unmask();if(dom){Ext.removeNode(dom);delete this._context;delete this.dom;}},appendChild:function(el,doc){return GET(el,doc||this.getDocument()).appendTo(this);},appendTo:function(el,doc){GETDOM(el,false,doc||this.getDocument()).appendChild(this.dom);return this;},insertBefore:function(el,doc){(el=GETDOM(el,false,doc||this.getDocument())).parentNode.insertBefore(this.dom,el);return this;},insertAfter:function(el,doc){(el=GETDOM(el,false,doc||this.getDocument())).parentNode.insertBefore(this.dom,el.nextSibling);return this;},insertFirst:function(el,returnDom){el=el||{};if(el.nodeType||el.dom||typeof el=='string'){el=GETDOM(el);this.dom.insertBefore(el,this.dom.firstChild);return!returnDom?GET(el):el;}else{return this.createChild(el,this.dom.firstChild,returnDom);}},replace:function(el,doc){el=GET(el,doc||this.getDocument());this.insertBefore(el);el.remove();return this;},replaceWith:function(el,doc){var me=this;if(el.nodeType||el.dom||typeof el=='string'){el=GETDOM(el,false,doc||me.getDocument());me.dom.parentNode.insertBefore(el,me.dom);}else{el=DH.insertBefore(me.dom,el);}
var C=resolveCache(me);Ext.removeNode(me.dom);me.id=Ext.id(me.dom=el);El.addToCache(me.isFlyweight?new(assertClass(me.dom))(me.dom,null,C):me);return me;},insertHtml:function(where,html,returnEl){var el=DH.insertHtml(where,this.dom,html);return returnEl?Ext.get(el,GETDOC(el)):el;},setVisibilityMode:function(visMode){data(this.dom,VISMODE,visMode);return this;},isVisible:function(){return this.visible||Ext.value(data(this.dom,ISVISIBLE),!this.isStyle(VISIBILITY,HIDDEN)&amp;&amp;!this.isStyle(DISPLAY,NONE));},setVisible:function(visible,animate){var me=this,dom=me.dom,isDisplay,isVisibility,isOffsets,isClass;if(typeof animate=='string'){isDisplay=animate==DISPLAY;isVisibility=animate==VISIBILITY;isOffsets=animate==OFFSETS;isClass=animate==ASCLASS;animate=false;}else{var visMode=getVisMode(dom);isDisplay=visMode==ELDISPLAY;isVisibility=visMode==ELVISIBILITY;isClass=visMode==ELASCLASS;}
if(!animate||!me.anim){if(isClass){me[visible?'removeClass':'addClass'](me.visibilityCls||El.visibilityCls);}else if(isDisplay){return me.setDisplayed(visible);}else if(isOffsets){if(!visible){me.hideModeStyles={position:me.getStyle('position'),top:me.getStyle('top'),left:me.getStyle('left')};me.applyStyles({position:'absolute',top:'-10000px',left:'-10000px'});}else{me.applyStyles(me.hideModeStyles||{position:'',top:'',left:''});delete me.hideModeStyles;}}else{me.fixDisplay();if(dom){dom.style.visibility=visible?&quot;visible&quot;:HIDDEN;}}}else{if(visible){me.setOpacity(.01);me.setVisible(true);}
me.anim({opacity:{to:(visible?1:0)}},me.preanim(arguments,1),null,.35,'easeIn',function(){if(!visible){isClass?me.addClass(me.visibilityCls||El.visibilityCls):dom.style[isDisplay?DISPLAY:VISIBILITY]=(isDisplay)?NONE:HIDDEN;me.setOpacity(1);}});}
data(dom,ISVISIBLE,visible);return me;},setDisplayed:function(value){var dom=this.dom,visMode=getVisMode(dom);if(typeof value==&quot;boolean&quot;){if(visMode==El.ASCLASS){return this.setVisible(value,ASCLASS);}
data(this.dom,ISVISIBLE,value);value=value?getDisplay(dom):NONE;}
this.setStyle(DISPLAY,value);return this;},fixDisplay:function(){var me=this;if(me.isStyle(DISPLAY,NONE)){me.setStyle(VISIBILITY,HIDDEN);me.setStyle(DISPLAY,getDisplay(me.dom));if(me.isStyle(DISPLAY,NONE)){me.setStyle(DISPLAY,&quot;block&quot;);}}
data(me.dom,ISVISIBLE)||me.removeClass(me.visibilityCls||El.visibilityCls);},enableDisplayMode:function(display){this.setVisibilityMode(El.DISPLAY);if(!Ext.isEmpty(display)){data(this.dom,ORIGINALDISPLAY,display);}
return this;},scrollIntoView:function(container,hscroll){var d=this.getDocument(),c=Ext.getDom(container,null,d)||Ext.getBody(d).dom,el=this.dom,o=this.getOffsetsTo(c),l=o[0]+c.scrollLeft,t=o[1]+c.scrollTop,b=t+el.offsetHeight,r=l+el.offsetWidth,ch=c.clientHeight,ct=parseInt(c.scrollTop,10),cl=parseInt(c.scrollLeft,10),cb=ct+ch,cr=cl+c.clientWidth;if(el.offsetHeight&gt;ch||t&lt;ct){c.scrollTop=t;}else if(b&gt;cb){c.scrollTop=b-ch;}
c.scrollTop=c.scrollTop;if(hscroll!==false){if(el.offsetWidth&gt;c.clientWidth||l&lt;cl){c.scrollLeft=l;}else if(r&gt;cr){c.scrollLeft=r-c.clientWidth;}
c.scrollLeft=c.scrollLeft;}
return this;},contains:function(el){try{return!el?false:ELD.isAncestor(this.dom,el.dom?el.dom:el);}catch(e){return false;}},getScroll:function(){var d=this.dom,doc=this.getDocument(),body=doc.body,docElement=doc.documentElement,l,t,ret;if(Ext.isDocument(d)||d==body){if(Ext.isIE&amp;&amp;ELD.docIsStrict(doc)){l=docElement.scrollLeft;t=docElement.scrollTop;}else{l=window.pageXOffset;t=window.pageYOffset;}
ret={left:l||(body?body.scrollLeft:0),top:t||(body?body.scrollTop:0)};}else{ret={left:d.scrollLeft,top:d.scrollTop};}
return ret;},getStyle:function(){var getStyle=view&amp;&amp;view.getComputedStyle?function GS(prop){var el=!this._isDoc?this.dom:null,v,cs,out,display,wk=Ext.isWebKit,display;if(!el||!el.style)return null;prop=chkCache(prop);out=(v=el.style[prop])?v:(cs=view.getComputedStyle(el,''))?cs[prop]:null;if(wk){if((marginRightRe.test(prop))&amp;&amp;out!='0px'){display=this.getStyle('display');el.style.display='inline-block';out=view.getComputedStyle(el,'');el.style.display=display;}
if(out=='rgba(0, 0, 0, 0)'){out='transparent';}}
return out;}:function GS(prop){var el=!this._isDoc?this.dom:null,m,cs;if(!el||!el.style)return null;if(prop==OPACITY){if(el.style.filter.match){if(m=el.style.filter.match(opacityRe)){var fv=parseFloat(m[1]);if(!isNaN(fv)){return fv?fv/100:0;}}}
return 1;}
prop=chkCache(prop);return el.style[prop]||((cs=el.currentStyle)?cs[prop]:null);};var GS=null;return getStyle;}(),setStyle:function(prop,value){if(this._isDoc||Ext.isDocument(this.dom))return this;var tmp,style;if(typeof prop!='object'){tmp={};tmp[prop]=value;prop=tmp;}
for(style in prop){value=prop[style];if(style==OPACITY){this.setOpacity(value)}
else{try{this.dom.style[chkCache(style)]=value;}
catch(err){null;}}}
return this;},center:function(centerIn){return this.alignTo(centerIn||this.getDocument(),'c-c');},mask:function(msg,msgCls){var me=this,dom=me.dom,dh=Ext.DomHelper,EXTELMASKMSG=&quot;ext-el-mask-msg&quot;,el,mask;if(me.getStyle(&quot;position&quot;)==&quot;static&quot;){me.addClass(XMASKEDRELATIVE);}
if((el=data(dom,'maskMsg'))){el.remove();}
if((el=data(dom,'mask'))){el.remove();}
mask=dh.append(dom,{cls:&quot;ext-el-mask&quot;},true);data(dom,'mask',mask);me.addClass(XMASKED);mask.setDisplayed(true);if(typeof msg=='string'){var mm=dh.append(dom,{cls:EXTELMASKMSG,cn:{tag:'div'}},true);data(dom,'maskMsg',mm);mm.dom.className=msgCls?EXTELMASKMSG+&quot; &quot;+msgCls:EXTELMASKMSG;mm.dom.firstChild.innerHTML=msg;mm.setDisplayed(true);mm.center(me);}
if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;me.getStyle('height')=='auto'){mask.setSize(undefined,me.getHeight());}
return mask;},unmask:function(){var me=this,dom=me.dom,mask=data(dom,'mask'),maskMsg=data(dom,'maskMsg');if(mask){if(maskMsg){maskMsg.remove();data(dom,'maskMsg',undefined);}
mask.remove();data(dom,'mask',undefined);}
me.removeClass([XMASKED,XMASKEDRELATIVE]);},isMasked:function(){var m=data(this.dom,'mask');return m&amp;&amp;m.isVisible();},getCenterXY:function(){return this.getAlignToXY(this.getDocument(),'c-c');},getAnchorXY:function(anchor,local,s){anchor=(anchor||&quot;tl&quot;).toLowerCase();s=s||{};var me=this,doc=this.getDocument(),vp=me.dom==doc.body||me.dom==doc,w=s.width||vp?ELD.getViewWidth(false,doc):me.getWidth(),h=s.height||vp?ELD.getViewHeight(false,doc):me.getHeight(),xy,r=Math.round,o=me.getXY(),scroll=me.getScroll(),extraX=vp?scroll.left:!local?o[0]:0,extraY=vp?scroll.top:!local?o[1]:0,hash={c:[r(w*.5),r(h*.5)],t:[r(w*.5),0],l:[0,r(h*.5)],r:[w,r(h*.5)],b:[r(w*.5),h],tl:[0,0],bl:[0,h],br:[w,h],tr:[w,0]};xy=hash[anchor];return[xy[0]+extraX,xy[1]+extraY];},anchorTo:function(el,alignment,offsets,animate,monitorScroll,callback){var me=this,dom=me.dom;function action(){fly(dom).alignTo(el,alignment,offsets,animate);Ext.callback(callback,fly(dom));};Ext.EventManager.onWindowResize(action,me);if(!Ext.isEmpty(monitorScroll)){Ext.EventManager.on(window,'scroll',action,me,{buffer:!isNaN(monitorScroll)?monitorScroll:50});}
action.call(me);return me;},getScroll:function(){var d=this.dom,doc=this.getDocument(),body=doc.body,docElement=doc.documentElement,l,t,ret;if(d==doc||d==body){if(Ext.isIE&amp;&amp;ELD.docIsStrict(doc)){l=docElement.scrollLeft;t=docElement.scrollTop;}else{l=window.pageXOffset;t=window.pageYOffset;}
ret={left:l||(body?body.scrollLeft:0),top:t||(body?body.scrollTop:0)};}else{ret={left:d.scrollLeft,top:d.scrollTop};}
return ret;},getAlignToXY:function(el,p,o){var doc;el=Ext.get(el,doc=this.getDocument());if(!el||!el.dom){throw&quot;Element.getAlignToXY with an element that doesn't exist&quot;;}
o=o||[0,0];p=(p==&quot;?&quot;?&quot;tl-bl?&quot;:(!/-/.test(p)&amp;&amp;p!=&quot;&quot;?&quot;tl-&quot;+p:p||&quot;tl-bl&quot;)).toLowerCase();var me=this,d=me.dom,a1,a2,x,y,w,h,r,dw=ELD.getViewWidth(false,doc)-10,dh=ELD.getViewHeight(false,doc)-10,p1y,p1x,p2y,p2x,swapY,swapX,docElement=doc.documentElement,docBody=doc.body,scrollX=(docElement.scrollLeft||docBody.scrollLeft||0)+5,scrollY=(docElement.scrollTop||docBody.scrollTop||0)+5,c=false,p1=&quot;&quot;,p2=&quot;&quot;,m=p.match(/^([a-z]+)-([a-z]+)(\?)?$/);if(!m){throw&quot;Element.getAlignToXY with an invalid alignment &quot;+p;}
p1=m[1];p2=m[2];c=!!m[3];a1=me.getAnchorXY(p1,true);a2=el.getAnchorXY(p2,false);x=a2[0]-a1[0]+o[0];y=a2[1]-a1[1]+o[1];if(c){w=me.getWidth();h=me.getHeight();r=el.getRegion();p1y=p1.charAt(0);p1x=p1.charAt(p1.length-1);p2y=p2.charAt(0);p2x=p2.charAt(p2.length-1);swapY=((p1y==&quot;t&quot;&amp;&amp;p2y==&quot;b&quot;)||(p1y==&quot;b&quot;&amp;&amp;p2y==&quot;t&quot;));swapX=((p1x==&quot;r&quot;&amp;&amp;p2x==&quot;l&quot;)||(p1x==&quot;l&quot;&amp;&amp;p2x==&quot;r&quot;));if(x+w&gt;dw+scrollX){x=swapX?r.left-w:dw+scrollX-w;}
if(x&lt;scrollX){x=swapX?r.right:scrollX;}
if(y+h&gt;dh+scrollY){y=swapY?r.top-h:dh+scrollY-h;}
if(y&lt;scrollY){y=swapY?r.bottom:scrollY;}}
return[x,y];},adjustForConstraints:function(xy,parent,offsets){return this.getConstrainToXY(parent||this.getDocument(),false,offsets,xy)||xy;},getConstrainToXY:function(el,local,offsets,proposedXY){var os={top:0,left:0,bottom:0,right:0};return function(el,local,offsets,proposedXY){var doc=this.getDocument();el=Ext.get(el,doc);offsets=offsets?Ext.applyIf(offsets,os):os;var vw,vh,vx=0,vy=0;if(el.dom==doc.body||el.dom==doc){vw=ELD.getViewWidth(false,doc);vh=ELD.getViewHeight(false,doc);}else{vw=el.dom.clientWidth;vh=el.dom.clientHeight;if(!local){var vxy=el.getXY();vx=vxy[0];vy=vxy[1];}}
var s=el.getScroll();vx+=offsets.left+s.left;vy+=offsets.top+s.top;vw-=offsets.right;vh-=offsets.bottom;var vr=vx+vw,vb=vy+vh,xy=proposedXY||(!local?this.getXY():[this.getLeft(true),this.getTop(true)]);x=xy[0],y=xy[1],offset=this.getConstrainOffset(),w=this.dom.offsetWidth+offset,h=this.dom.offsetHeight+offset;var moved=false;if((x+w)&gt;vr){x=vr-w;moved=true;}
if((y+h)&gt;vb){y=vb-h;moved=true;}
if(x&lt;vx){x=vx;moved=true;}
if(y&lt;vy){y=vy;moved=true;}
return moved?[x,y]:false;};}(),getConstrainOffset:function(){return 0;},getCenterXY:function(){return this.getAlignToXY(Ext.getBody(this.getDocument()),'c-c');},center:function(centerIn){return this.alignTo(centerIn||Ext.getBody(this.getDocument()),'c-c');},findParent:function(simpleSelector,maxDepth,returnEl){var p=this.dom,D=this.getDocument(),b=D.body,depth=0,stopEl;if(Ext.isGecko&amp;&amp;OPString.call(p)=='[object XULElement]'){return null;}
maxDepth=maxDepth||50;if(isNaN(maxDepth)){stopEl=Ext.getDom(maxDepth,null,D);maxDepth=Number.MAX_VALUE;}
while(p&amp;&amp;p.nodeType==1&amp;&amp;depth&lt;maxDepth&amp;&amp;p!=b&amp;&amp;p!=stopEl){if(Ext.DomQuery.is(p,simpleSelector)){return returnEl?Ext.get(p,D):p;}
depth++;p=p.parentNode;}
return null;},clip:function(){var me=this,dom=me.dom;if(!data(dom,ISCLIPPED)){data(dom,ISCLIPPED,true);data(dom,ORIGINALCLIP,{o:me.getStyle(OVERFLOW),x:me.getStyle(OVERFLOWX),y:me.getStyle(OVERFLOWY)});me.setStyle(OVERFLOW,HIDDEN);me.setStyle(OVERFLOWX,HIDDEN);me.setStyle(OVERFLOWY,HIDDEN);}
return me;},unclip:function(){var me=this,dom=me.dom;if(data(dom,ISCLIPPED)){data(dom,ISCLIPPED,false);var o=data(dom,ORIGINALCLIP);if(o.o){me.setStyle(OVERFLOW,o.o);}
if(o.x){me.setStyle(OVERFLOWX,o.x);}
if(o.y){me.setStyle(OVERFLOWY,o.y);}}
return me;},getViewSize:function(){var doc=this.getDocument(),d=this.dom,isDoc=(d==doc||d==doc.body);if(isDoc){var extdom=Ext.lib.Dom;return{width:extdom.getViewWidth(),height:extdom.getViewHeight()};}else{return{width:d.clientWidth,height:d.clientHeight};}},getStyleSize:function(){var me=this,w,h,doc=this.getDocument(),d=this.dom,isDoc=(d==doc||d==doc.body),s=d.style;if(isDoc){var extdom=Ext.lib.Dom;return{width:extdom.getViewWidth(),height:extdom.getViewHeight()};}
if(s.width&amp;&amp;s.width!='auto'){w=parseFloat(s.width);if(me.isBorderBox()){w-=me.getFrameWidth('lr');}}
if(s.height&amp;&amp;s.height!='auto'){h=parseFloat(s.height);if(me.isBorderBox()){h-=me.getFrameWidth('tb');}}
return{width:w||me.getWidth(true),height:h||me.getHeight(true)};}});Ext.isDefined(El.collectorThreadId)&amp;&amp;clearInterval(El.collectorThreadId);function garbageCollect(){if(!Ext.enableGarbageCollector){clearInterval(El.collectorThreadId);}else{var eid,el,d,o,EC=Ext.elCache;for(eid in EC){o=EC[eid];if(o.skipGC){continue;}
el=o.el;d=el.dom;if(!d||!d.parentNode||(!d.offsetParent&amp;&amp;!DOC.getElementById(eid))){if(Ext.enableListenerCollection){Ext.EventManager.removeAll(d);}
delete EC[eid];}}
if(Ext.isIE){var t={};for(eid in EC){t[eid]=EC[eid];}
Ext.elCache=Ext._documents[Ext.id(document)]=t;t=null;}}}
if(Ext.enableGarbageCollector){El.collectorThreadId=setInterval(garbageCollect,30000);}
Ext.apply(ELD,{getDocument:function(el,accessTest){var dom=null;try{dom=Ext.getDom(el,null,null);}catch(ex){}
var isDoc=Ext.isDocument(dom);if(isDoc){if(accessTest){return Ext.isDocument(dom,accessTest)?dom:null;}
return dom;}
return dom?dom.ownerDocument||dom.document:null;},docIsStrict:function(doc){return(Ext.isDocument(doc)?doc:this.getDocument(doc)).compatMode==&quot;CSS1Compat&quot;;},getViewWidth:Ext.overload([ELD.getViewWidth||function(full){},function(){return this.getViewWidth(false);},function(full,doc){return full?this.getDocumentWidth(doc):this.getViewportWidth(doc);}]),getViewHeight:Ext.overload([ELD.getViewHeight||function(full){},function(){return this.getViewHeight(false);},function(full,doc){return full?this.getDocumentHeight(doc):this.getViewportHeight(doc);}]),getDocumentHeight:Ext.overload([ELD.getDocumentHeight||emptyFn,function(doc){if(doc=this.getDocument(doc)){return Math.max(!this.docIsStrict(doc)?doc.body.scrollHeight:doc.documentElement.scrollHeight,this.getViewportHeight(doc));}
return undefined;}]),getDocumentWidth:Ext.overload([ELD.getDocumentWidth||emptyFn,function(doc){if(doc=this.getDocument(doc)){return Math.max(!this.docIsStrict(doc)?doc.body.scrollWidth:doc.documentElement.scrollWidth,this.getViewportWidth(doc));}
return undefined;}]),getViewportHeight:Ext.overload([ELD.getViewportHeight||emptyFn,function(doc){if(doc=this.getDocument(doc)){if(Ext.isIE){return this.docIsStrict(doc)?doc.documentElement.clientHeight:doc.body.clientHeight;}else{return doc.defaultView.innerHeight;}}
return undefined;}]),getViewportWidth:Ext.overload([ELD.getViewportWidth||emptyFn,function(doc){if(doc=this.getDocument(doc)){return!this.docIsStrict(doc)&amp;&amp;!Ext.isOpera?doc.body.clientWidth:Ext.isIE?doc.documentElement.clientWidth:doc.defaultView.innerWidth;}
return undefined;}]),getXY:Ext.overload([ELD.getXY||emptyFn,function(el,doc){el=Ext.getDom(el,null,doc);var D=this.getDocument(el),bd=D?(D.body||D.documentElement):null;if(!el||!bd||el==bd){return[0,0];}
return this.getXY(el);}])});var GETDOC=ELD.getDocument,flies=El._flyweights;Ext.fly=El.fly=function(el,named,doc){var ret=null;named=named||'_global';if(el=Ext.getDom(el,null,doc)){(ret=flies[named]=(flies[named]||new El.Flyweight())).dom=el;Ext.isDocument(el)&amp;&amp;(ret._isDoc=true);}
return ret;};var flyFn=function(){};flyFn.prototype=El.prototype;El.Flyweight=function(dom){this.dom=dom;};El.Flyweight.prototype=new flyFn();El.Flyweight.prototype.isFlyweight=true;function addListener(el,ename,fn,task,wrap,scope){el=Ext.getDom(el);if(!el){return;}
var id=Ext.id(el),cache=resolveCache(el);cache[id]||El.addToCache(el,id,cache);var es=cache[id].events||{},wfn;wfn=E.on(el,ename,wrap);es[ename]=es[ename]||[];es[ename].push([fn,wrap,scope,wfn,task]);if(el.addEventListener&amp;&amp;ename==&quot;mousewheel&quot;){var args=[&quot;DOMMouseScroll&quot;,wrap,false];el.addEventListener.apply(el,args);Ext.EventManager.addListener(window,'beforeunload',function(){el.removeEventListener.apply(el,args);});}
if(ename==&quot;mousedown&quot;&amp;&amp;DOC==el){Ext.EventManager.stoppedMouseDownEvent.addListener(wrap);}};function createTargeted(h,o){return function(){var args=Ext.toArray(arguments);if(o.target==Ext.EventObject.setEvent(args[0]).target){h.apply(this,args);}};};function createBuffered(h,o,task){return function(e){task.delay(o.buffer,h,null,[new Ext.EventObjectImpl(e)]);};};function createSingle(h,el,ename,fn,scope){return function(e){Ext.EventManager.removeListener(el,ename,fn,scope);h(e);};};function createDelayed(h,o,fn){return function(e){var task=new Ext.util.DelayedTask(h);(fn.tasks||(fn.tasks=[])).push(task);task.delay(o.delay||10,h,null,[new Ext.EventObjectImpl(e)]);};};function listen(element,ename,opt,fn,scope){var o=!Ext.isObject(opt)?{}:opt,el=Ext.getDom(element),task;fn=fn||o.fn;scope=scope||o.scope;if(!el){throw&quot;Error listening for \&quot;&quot;+ename+'\&quot;. Element &quot;'+element+'&quot; doesn\'t exist.';}
function h(e){if(!window.Ext){return;}
e=Ext.EventObject.setEvent(e);var t;if(o.delegate){if(!(t=e.getTarget(o.delegate,el))){return;}}else{t=e.target;}
if(o.stopEvent){e.stopEvent();}
if(o.preventDefault){e.preventDefault();}
if(o.stopPropagation){e.stopPropagation();}
if(o.normalized){e=e.browserEvent;}
fn.call(scope||el,e,t,o);};if(o.target){h=createTargeted(h,o);}
if(o.delay){h=createDelayed(h,o,fn);}
if(o.single){h=createSingle(h,el,ename,fn,scope);}
if(o.buffer){task=new Ext.util.DelayedTask(h);h=createBuffered(h,o,task);}
addListener(el,ename,fn,task,h,scope);return h;};Ext.apply(Evm,{addListener:Evm.on=function(element,eventName,fn,scope,options){if(typeof eventName=='object'){var o=eventName,e,val;for(e in o){val=o[e];if(!propRe.test(e)){if(Ext.isFunction(val)){listen(element,e,o,val,o.scope);}else{listen(element,e,val);}}}}else{listen(element,eventName,options,fn,scope);}},removeListener:Evm.un=function(element,eventName,fn,scope){var el=Ext.getDom(element);el&amp;&amp;Ext.get(el);var elCache=el?resolveCache(el):{},f=el&amp;&amp;((elCache[el.id]||{events:{}}).events)[eventName]||[],wrap,i,l,k,len,fnc;for(i=0,len=f.length;i&lt;len;i++){if(Ext.isArray(fnc=f[i])&amp;&amp;fnc[0]==fn&amp;&amp;(!scope||fnc[2]==scope)){fnc[4]&amp;&amp;fnc[4].cancel();k=fn.tasks&amp;&amp;fn.tasks.length;if(k){while(k--){fn.tasks[k].cancel();}
delete fn.tasks;}
wrap=fnc[1];E.un(el,eventName,E.extAdapter?fnc[3]:wrap);if(wrap&amp;&amp;eventName==&quot;mousewheel&quot;&amp;&amp;el.addEventListener){el.removeEventListener(&quot;DOMMouseScroll&quot;,wrap,false);}
if(wrap&amp;&amp;eventName==&quot;mousedown&quot;&amp;&amp;DOC==el){Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap);}
f.splice(i,1);if(f.length===0){delete elCache[el.id].events[eventName];}
for(k in elCache[el.id].events){return false;}
elCache[el.id].events={};return false;}}},removeAll:function(el){if(!(el=Ext.getDom(el))){return;}
var id=el.id,elCache=resolveCache(el)||{},es=elCache[id]||{},ev=es.events||{},f,i,len,ename,fn,k,wrap;for(ename in ev){if(ev.hasOwnProperty(ename)){f=ev[ename];for(i=0,len=f.length;i&lt;len;i++){fn=f[i];fn[4]&amp;&amp;fn[4].cancel();if(fn[0].tasks&amp;&amp;(k=fn[0].tasks.length)){while(k--){fn[0].tasks[k].cancel();}
delete fn.tasks;}
wrap=fn[1];E.un(el,ename,E.extAdapter?fn[3]:wrap);if(wrap&amp;&amp;el.addEventListener&amp;&amp;ename==&quot;mousewheel&quot;){el.removeEventListener(&quot;DOMMouseScroll&quot;,wrap,false);}
if(wrap&amp;&amp;DOC==el&amp;&amp;ename==&quot;mousedown&quot;){Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap);}}}}
elCache[id]&amp;&amp;(elCache[id].events={});},getListeners:function(el,eventName){el=Ext.getDom(el);if(!el){return;}
var id=(Ext.get(el)||{}).id,elCache=resolveCache(el),es=(elCache[id]||{}).events||{};return es[eventName]||null;},purgeElement:function(el,recurse,eventName){el=Ext.getDom(el);var id=Ext.id(el),elCache=resolveCache(el),es=(elCache[id]||{}).events||{},i,f,len;if(eventName){if(es.hasOwnProperty(eventName)){f=es[eventName];for(i=0,len=f.length;i&lt;len;i++){Evm.removeListener(el,eventName,f[i][0]);}}}else{Evm.removeAll(el);}
if(recurse&amp;&amp;el&amp;&amp;el.childNodes){for(i=0,len=el.childNodes.length;i&lt;len;i++){Evm.purgeElement(el.childNodes[i],recurse,eventName);}}}});E.getListeners=function(el,eventName){return Ext.EventManager.getListeners(el,eventName);};Ext.provide&amp;&amp;Ext.provide('multidom');})();(function(){var El=Ext.Element,ElFrame,ELD=Ext.lib.Dom,EMPTYFN=function(){},OP=Object.prototype,addListener=function(){var handler;if(window.addEventListener){handler=function F(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture);};}else if(window.attachEvent){handler=function F(el,eventName,fn,capture){el.attachEvent(&quot;on&quot;+eventName,fn);};}else{handler=function F(){};}
var F=null;return handler;}(),removeListener=function(){var handler;if(window.removeEventListener){handler=function F(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture));};}else if(window.detachEvent){handler=function F(el,eventName,fn){el.detachEvent(&quot;on&quot;+eventName,fn);};}else{handler=function F(){};}
var F=null;return handler;}();if(typeof ELD.getDocument!='function'){alert(&quot;MIF 2.1 requires multidom support&quot;);}
if(!Ext.elCache||parseInt(Ext.version.replace(/\./g,''),10)&lt;311){alert('Ext Release '+Ext.version+' is not supported');}
Ext.ns('Ext.ux.ManagedIFrame','Ext.ux.plugin');var MIM,MIF=Ext.ux.ManagedIFrame,MIFC;var frameEvents=['documentloaded','domready','focus','blur','resize','scroll','unload','scroll','exception','message','reset'];var reSynthEvents=new RegExp('^('+frameEvents.join('|')+')','i');Ext.ux.ManagedIFrame.Element=Ext.extend(Ext.Element,{constructor:function(element,forceNew,doc){var d=doc||document,elCache=ELD.resolveDocumentCache(d),dom=Ext.getDom(element,false,d);if(!dom||!(/^(iframe|frame)/i).test(dom.tagName)){return null;}
var id=Ext.id(dom);this.dom=dom;this.id=id;(elCache[id]||(elCache[id]={el:this,events:{},data:{}})).el=this;this.dom.name||(this.dom.name=this.id);if(Ext.isIE){document.frames&amp;&amp;(document.frames[this.dom.name]||(document.frames[this.dom.name]=this.dom));}
this.dom.ownerCt=this;MIM.register(this);if(!this._observable){(this._observable=new Ext.util.Observable()).addEvents('documentloaded','domready','exception','resize','message','blur','focus','unload','scroll','reset');this._observable.addEvents('_docready','_docload');}
var H=Ext.isIE?'onreadystatechange':'onload';this.dom[H]=this.loadHandler.createDelegate(this);this.dom['onerror']=this.loadHandler.createDelegate(this);},destructor:function(){this.dom[Ext.isIE?'onreadystatechange':'onload']=this.dom['onerror']=EMPTYFN;MIM.deRegister(this);this.removeAllListeners();Ext.destroy(this.frameShim,this.DDM);this.hideMask(true);delete this.loadMask;this.reset();this.manager=null;this.dom.ownerCt=null;},cleanse:function(forceReclean,deep){if(this.isCleansed&amp;&amp;forceReclean!==true){return this;}
var d=this.dom,n=d.firstChild,nx;while(d&amp;&amp;n){nx=n.nextSibling;deep&amp;&amp;Ext.fly(n).cleanse(forceReclean,deep);Ext.removeNode(n);n=nx;}
this.isCleansed=true;return this;},src:null,CSS:null,manager:null,disableMessaging:true,domReadyRetries:7500,focusOnLoad:Ext.isIE,eventsFollowFrameLinks:true,remove:function(){this.destructor.apply(this,arguments);ElFrame.superclass.remove.apply(this,arguments);},getDocument:function(){return this.dom?this.dom.ownerDocument:document;},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=this.getDocument(),form=Ext.getDom(opt.form?opt.form.form||opt.form:null,false,D)||Ext.DomHelper.append(D.body,{tag:'form',cls:'x-hidden x-mif-form',encoding:'multipart/form-data'}),formFly=Ext.fly(form,'_dynaForm'),formState={target:form.target||'',method:form.method||'',encoding:form.encoding||'',enctype:form.enctype||'',action:form.action||''},encoding=opt.encoding||form.encoding,method=opt.method||form.method||'POST';formFly.set({target:this.dom.name,method:method,encoding:encoding,action:opt.url||opt.action||form.action});if(method=='POST'||!!opt.enctype){formFly.set({enctype:opt.enctype||form.enctype||encoding});}
var hiddens,hd,ps;if(opt.params&amp;&amp;(ps=Ext.isFunction(opt.params)?opt.params():opt.params)){hiddens=[];Ext.iterate(ps=typeof ps=='string'?Ext.urlDecode(ps,false):ps,function(n,v){Ext.fly(hd=D.createElement('input')).set({type:'hidden',name:n,value:v});form.appendChild(hd);hiddens.push(hd);});}
opt.callback&amp;&amp;this._observable.addListener('_docready',opt.callback,opt.scope,{single:true});this._frameAction=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&amp;&amp;Ext.each(hiddens,Ext.removeNode,Ext);if(formFly.hasClass('x-mif-form')){formFly.remove();}else{formFly.set(formState);}
delete El._flyweights['_dynaForm'];formFly=null;this.hideMask(true);}).defer(100,this);return this;},resetUrl:(function(){return Ext.isIE&amp;&amp;Ext.isSecure?Ext.SSL_SECURE_URL:'about:blank';})(),setSrc:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener('_docload',callback,scope||this,{single:true});this.showMask();(discardUrl!==true)&amp;&amp;(this.src=src);var s=this._targetURI=(Ext.isFunction(src)?src()||'':src);try{this._frameAction=true;this.dom.src=s;this.checkDOM();}catch(ex){O.fireEvent.call(O,'exception',this,ex);}
return this;},setLocation:function(url,discardUrl,callback,scope){var src=url||this.src||this.resetUrl;var O=this._observable;this._unHook();Ext.isFunction(callback)&amp;&amp;O.addListener('_docload',callback,scope||this,{single:true});this.showMask();var s=this._targetURI=(Ext.isFunction(src)?src()||'':src);if(discardUrl!==true){this.src=src;}
try{this._frameAction=true;this.getWindow().location.replace(s);this.checkDOM();}catch(ex){O.fireEvent.call(O,'exception',this,ex);}
return this;},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false,s=src,win=this.getWindow(),O=this._observable;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false;}
this.hideMask(true);if(win){this.isReset=true;var cb=callback;O.addListener('_docload',function(frame){if(this.loadMask){this.loadMask.disabled=loadMaskOff;};Ext.isFunction(cb)&amp;&amp;(cb=cb.apply(scope||this,arguments));O.fireEvent(&quot;reset&quot;,this);},this,{single:true});Ext.isFunction(s)&amp;&amp;(s=src());s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;win.location?(win.location.href=s):O.fireEvent('_docload',this);}
return this;},scriptRE:/(?:&lt;script.*?&gt;)((\n|\r|.)*?)(?:&lt;\/script&gt;)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdater().loadScripts||false;content=Ext.DomHelper.markup(content||'');content=loadScripts===true?content:content.replace(this.scriptRE,&quot;&quot;);var doc;if((doc=this.getFrameDocument())&amp;&amp;!!content.length){this._unHook();this.src=null;this.showMask();Ext.isFunction(callback)&amp;&amp;this._observable.addListener('_docload',callback,scope||this,{single:true});this._targetURI=location.href;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM();}else{this.hideMask(true);Ext.isFunction(callback)&amp;&amp;callback.call(scope,this);}
return this;},execCommand:function(command,userInterface,value,validate){var doc,assert;if((doc=this.getFrameDocument())&amp;&amp;!!command){try{Ext.isIE&amp;&amp;this.getWindow().focus();assert=validate&amp;&amp;Ext.isFunction(doc.queryCommandEnabled)?doc.queryCommandEnabled(command):true;return assert&amp;&amp;doc.execCommand(command,!!userInterface,value);}catch(eex){return false;}}
return false;},setDesignMode:function(active){var doc;(doc=this.getFrameDocument())&amp;&amp;(doc.designMode=(/on|true/i).test(String(active))?'on':'off');},getUpdater:function(){return this.updateManager||(this.updateManager=new MIF.Updater(this));},getHistory:function(){var h=null;try{h=this.getWindow().history;}catch(eh){}
return h;},get:function(el){var doc=this.getFrameDocument();return doc?Ext.get(el,doc):doc=null;},fly:function(el,named){var doc=this.getFrameDocument();return doc?Ext.fly(el,named,doc):null;},getDom:function(el){var d;if(!el||!(d=this.getFrameDocument())){return(d=null);}
return Ext.getDom(el,d);},select:function(selector,unique){var d;return(d=this.getFrameDocument())?Ext.Element.select(selector,unique,d):d=null;},query:function(selector){var d;return(d=this.getFrameDocument())?Ext.DomQuery.select(selector,d):null;},removeNode:Ext.removeNode,_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.document.getElementById(&quot;'
+this.id
+'&quot;).ownerCt)._windowContext='
+(Ext.isIE?'window':'{eval:function(s){return new Function(&quot;return (&quot;+s+&quot;)&quot;)();}}')
+';})()')){var w,p=this._frameProxy,D=this.getFrameDocument();if(w=this.getWindow()){p||(p=this._frameProxy=this._eventProxy.createDelegate(this));addListener(w,'focus',p);addListener(w,'blur',p);addListener(w,'resize',p);addListener(w,'unload',p);D&amp;&amp;addListener(Ext.isIE?w:D,'scroll',p);}
D&amp;&amp;(this.CSS=new Ext.ux.ManagedIFrame.CSS(D));}}catch(ex){}
return this.domWritable();},_unHook:function(){if(this._hooked){this._windowContext&amp;&amp;(this._windowContext.hostMIF=null);this._windowContext=null;var w,p=this._frameProxy;if(p&amp;&amp;this.domWritable()&amp;&amp;(w=this.getWindow())){removeListener(w,'focus',p);removeListener(w,'blur',p);removeListener(w,'resize',p);removeListener(w,'unload',p);removeListener(Ext.isIE?w:this.getFrameDocument(),'scroll',p);}}
ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);this.CSS=this.CSS?this.CSS.destroy():null;this.domFired=this._frameAction=this.domReady=this._hooked=false;},_windowContext:null,getFrameDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&amp;&amp;win?win.document:null)||this.dom.contentDocument||window.frames[this.dom.name].document||null;}catch(gdEx){ELD.clearDocumentCache&amp;&amp;ELD.clearDocumentCache(this.id);return false;}
doc=(doc&amp;&amp;Ext.isFunction(ELD.getDocument))?ELD.getDocument(doc,true):doc;return doc;},getDoc:function(){var D=this.getFrameDocument();return Ext.get(D,D);},getBody:function(){var d;return(d=this.getFrameDocument())?this.get(d.body||d.documentElement):null;},getDocumentURI:function(){var URI,d;try{URI=this.src&amp;&amp;(d=this.getFrameDocument())?d.location.href:null;}catch(ex){}
return URI||(Ext.isFunction(this.src)?this.src():this.src);},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null;}catch(ex){}
return URI||(Ext.isFunction(this.src)?this.src():this.src);},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null;}catch(gwEx){}
return win;},scrollChildIntoView:function(child,container,hscroll){this.fly(child,'_scrollChildIntoView').scrollIntoView(this.getDom(container)||this.getBody().dom,hscroll);return this;},print:function(){try{var win;if(win=this.getWindow()){Ext.isIE&amp;&amp;win.focus();win.print();}}catch(ex){throw new MIF.Error('printexception',ex.description||ex.message||ex);}
return this;},domWritable:function(){return!!Ext.isDocument(this.getFrameDocument(),true)&amp;&amp;!!this._windowContext;},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block);}else{return this._windowContext.eval(block);}}else{throw new MIF.Error('execscript-secure-context');}}catch(ex){this._observable.fireEvent.call(this._observable,'exception',this,ex);return false;}
return true;},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:&quot;text/javascript&quot;,text:block});try{var head,script,doc=this.getFrameDocument();if(doc&amp;&amp;typeof doc.getElementsByTagName!='undefined'){if(!(head=doc.getElementsByTagName(&quot;head&quot;)[0])){head=doc.createElement(&quot;head&quot;);doc.getElementsByTagName(&quot;html&quot;)[0].appendChild(head);}
if(head&amp;&amp;(script=doc.createElement(&quot;script&quot;))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&amp;&amp;attrib in script){script[attrib]=attributes[attrib];}}
return!!head.appendChild(script);}}}catch(ex){this._observable.fireEvent.call(this._observable,'exception',this,ex);}finally{script=head=null;}
return false;},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fnSrc=fn.fn||window[fn];name&amp;&amp;fnSrc&amp;&amp;this.execScript(name+'='+fnSrc,useDOM);invokeIt&amp;&amp;this.execScript(name+'()');},loadHandler:function(e,target){var rstatus=(this.dom||{}).readyState||(e||{}).type;if(this.eventsFollowFrameLinks||this._frameAction||this.isReset){switch(rstatus){case'domready':case'DOMFrameContentLoaded':case'domfail':this._onDocReady(rstatus);break;case'load':case'complete':this._onDocLoaded(rstatus);break;case'error':this._observable.fireEvent.apply(this._observable,['exception',this].concat(arguments));break;default:}
this.frameState=rstatus;}},_onDocReady:function(eventName){var w,obv=this._observable,D;if(!this.isReset&amp;&amp;this.focusOnLoad&amp;&amp;(w=this.getWindow())){w.focus();}
obv.fireEvent(&quot;_docready&quot;,this);(D=this.getDoc())&amp;&amp;(D.isReady=true);if(!this.domFired&amp;&amp;(this._hooked=this._renderHook())){this.domFired=true;this.isReset||obv.fireEvent.call(obv,'domready',this);}
this.domReady=true;this.hideMask();},_onDocLoaded:function(eventName){var obv=this._observable,w;this.domReady||this._onDocReady('domready');obv.fireEvent(&quot;_docload&quot;,this);this.isReset||obv.fireEvent(&quot;documentloaded&quot;,this);this.hideMask(true);this._frameAction=this.isReset=false;},checkDOM:function(win){if(Ext.isGecko){return;}
var n=0,frame=this,domReady=false,b,l,d,max=this.domReadyRetries||2500,polling=false,startLocation=(this.getFrameDocument()||{location:{}}).location.href;(function(){d=frame.getFrameDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===frame._targetURI);if(frame.domReady){return;}
domReady=polling&amp;&amp;((b=frame.getBody())&amp;&amp;!!(b.dom.innerHTML||'').length)||false;if(d.location.href&amp;&amp;!domReady&amp;&amp;(++n&lt;max)){setTimeout(arguments.callee,2);return;}
frame.loadHandler({type:domReady?'domready':'domfail'});})();},filterEventOptionsRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,addListener:function(eventName,fn,scope,options){if(typeof eventName==&quot;object&quot;){var o=eventName;for(var e in o){if(this.filterEventOptionsRe.test(e)){continue;}
if(typeof o[e]==&quot;function&quot;){this.addListener(e,o[e],o.scope,o);}else{this.addListener(e,o[e].fn,o[e].scope,o[e]);}}
return;}
if(reSynthEvents.test(eventName)){var O=this._observable;if(O){O.events[eventName]||(O.addEvents(eventName));O.addListener.call(O,eventName,fn,scope||this,options);}}else{ElFrame.superclass.addListener.call(this,eventName,fn,scope||this,options);}
return this;},removeListener:function(eventName,fn,scope){var O=this._observable;if(reSynthEvents.test(eventName)){O&amp;&amp;O.removeListener.call(O,eventName,fn,scope||this,options);}else{ElFrame.superclass.removeListener.call(this,eventName,fn,scope||this);}
return this;},removeAllListeners:function(){Ext.EventManager.removeAll(this.dom);var O=this._observable;O&amp;&amp;O.purgeListeners.call(this._observable);return this;},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&amp;&amp;!lmask.disabled){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls,lmask.maskEl);}},hideMask:function(forced){var tlm=this.loadMask||{};if(forced||(tlm.hideOnReady&amp;&amp;this.domReady)){this.unmask();}},mask:function(msg,msgCls,maskCls,maskEl){this._mask&amp;&amp;this.unmask();var p=Ext.get(maskEl)||this.parent('.ux-mif-mask-target')||this.parent();if(p.getStyle(&quot;position&quot;)==&quot;static&quot;&amp;&amp;!p.select('iframe,frame,object,embed').elements.length){p.addClass(&quot;x-masked-relative&quot;);}
p.addClass(&quot;x-masked&quot;);this._mask=Ext.DomHelper.append(p,{cls:maskCls||&quot;ux-mif-el-mask&quot;},true);this._mask.setDisplayed(true);this._mask._agent=p;if(typeof msg=='string'){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||&quot;ux-mif-el-mask-msg&quot;,style:{visibility:'hidden'},cn:{tag:'div',html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY).center(p).setVisible(true);}
if(Ext.isIE&amp;&amp;!(Ext.isIE7&amp;&amp;Ext.isStrict)&amp;&amp;this.getStyle('height')=='auto'){this._mask.setSize(undefined,this._mask.getHeight());}
return this._mask;},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&amp;&amp;a.removeClass([&quot;x-masked-relative&quot;,&quot;x-masked&quot;]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg;}
this._mask.remove();delete this._mask;}},createFrameShim:function(imgUrl,shimCls){this.shimCls=shimCls||this.shimCls||'ux-mif-shim';this.frameShim||(this.frameShim=this.next('.'+this.shimCls)||Ext.DomHelper.append(this.dom.parentNode,{tag:'img',src:imgUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:&quot;no&quot;},true));this.frameShim&amp;&amp;(this.frameShim.autoBoxAdjust=false);return this.frameShim;},toggleShim:function(show){var shim=this.frameShim||this.createFrameShim();var cls=this.shimCls+'-on';!show&amp;&amp;shim.removeClass(cls);show&amp;&amp;!shim.hasClass(cls)&amp;&amp;shim.addClass(cls);},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&amp;&amp;loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer;}
um.update.apply(um,arguments);}
return this;},_eventProxy:function(e){if(!e)return;e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e,er,args=[e.type,this];if(!be['eventPhase']||(be['eventPhase']==(be['AT_TARGET']||2))){if(e.type=='resize'){var doc=this.getFrameDocument();doc&amp;&amp;(args.push({height:ELD.getDocumentHeight(doc),width:ELD.getDocumentWidth(doc)},{height:ELD.getViewportHeight(doc),width:ELD.getViewportWidth(doc)},{height:ELD.getViewHeight(false,doc),width:ELD.getViewWidth(false,doc)}));}
er=this._observable?this._observable.fireEvent.apply(this._observable,args.concat(Array.prototype.slice.call(arguments,0))):null;(e.type=='unload')&amp;&amp;this._unHook();}
return er;},sendMessage:function(message,tag,origin){},postMessage:function(message,origin){}});ElFrame=Ext.Element.IFRAME=Ext.Element.FRAME=Ext.ux.ManagedIFrame.Element;var fp=ElFrame.prototype;Ext.override(ElFrame,{on:fp.addListener,un:fp.removeListener,getUpdateManager:fp.getUpdater});Ext.ux.ManagedIFrame.ComponentAdapter=function(){};Ext.ux.ManagedIFrame.ComponentAdapter.prototype={version:2.12,defaultSrc:null,unsupportedText:'Inline frames are NOT enabled\/supported by your browser.',hideMode:!Ext.isIE&amp;&amp;!!Ext.ux.plugin.VisibilityMode?'nosize':'display',animCollapse:Ext.isIE,animFloat:Ext.isIE,disableMessaging:true,eventsFollowFrameLinks:true,frameConfig:null,focusOnLoad:Ext.isIE,frameEl:null,useShim:false,autoScroll:true,autoLoad:null,getId:function(){return this.id||(this.id=&quot;mif-comp-&quot;+(++Ext.Component.AUTO_ID));},stateEvents:['documentloaded'],stateful:false,setAutoScroll:function(auto){var scroll=Ext.value(auto,this.autoScroll===true);this.rendered&amp;&amp;this.getFrame()&amp;&amp;this.frameEl.setOverflow((this.autoScroll=scroll)?'auto':'hidden');return this;},getContentTarget:function(){return this.getFrame();},getFrame:function(){if(this.rendered){if(this.frameEl){return this.frameEl;}
var f=this.items&amp;&amp;this.items.first?this.items.first():null;f&amp;&amp;(this.frameEl=f.frameEl);return this.frameEl;}
return null;},getFrameWindow:function(){return this.getFrame()?this.frameEl.getWindow():null;},getFrameDocument:function(){return this.getFrame()?this.frameEl.getFrameDocument():null;},getFrameDoc:function(){return this.getFrame()?this.frameEl.getDoc():null;},getFrameBody:function(){return this.getFrame()?this.frameEl.getBody():null;},resetFrame:function(){this.getFrame()&amp;&amp;this.frameEl.reset.apply(this.frameEl,arguments);return this;},submitAsTarget:function(submitCfg){this.getFrame()&amp;&amp;this.frameEl.submitAsTarget.apply(this.frameEl,arguments);return this;},load:function(loadCfg){if(loadCfg&amp;&amp;this.getFrame()){var args=arguments;this.resetFrame(null,function(){loadCfg.submitAsTarget?this.submitAsTarget.apply(this,args):this.frameEl.load.apply(this.frameEl,args);},this);}
this.autoLoad=loadCfg;return this;},doAutoLoad:function(){this.autoLoad&amp;&amp;this.load(typeof this.autoLoad=='object'?this.autoLoad:{url:this.autoLoad});},getUpdater:function(){return this.getFrame()?this.frameEl.getUpdater():null;},setSrc:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setSrc.apply(this.frameEl,arguments);return this;},setLocation:function(url,discardUrl,callback,scope){this.getFrame()&amp;&amp;this.frameEl.setLocation.apply(this.frameEl,arguments);return this;},getState:function(){var URI=this.getFrame()?this.frameEl.getDocumentURI()||null:null;var state=this.supr().getState.call(this);state=Ext.apply(state||{},{defaultSrc:Ext.isFunction(URI)?URI():URI,autoLoad:this.autoLoad});return state;},setMIFEvents:function(){this.addEvents('documentloaded','domready','exception','message','blur','focus','scroll','resize','unload','reset');},sendMessage:function(message,tag,origin){},onAdd:function(C){C.relayTarget&amp;&amp;this.suspendEvents(true);},initRef:function(){if(this.ref){var t=this,levels=this.ref.split('/'),l=levels.length,i;for(i=0;i&lt;l;i++){if(t.ownerCt){t=t.ownerCt;}}
this.refName=levels[--i];t[this.refName]||(t[this.refName]=this);this.refOwner=t;}}};Ext.ux.ManagedIFrame.Component=Ext.extend(Ext.BoxComponent,{ctype:&quot;Ext.ux.ManagedIFrame.Component&quot;,initComponent:function(){var C={monitorResize:this.monitorResize||(this.monitorResize=!!this.fitToParent),plugins:(this.plugins||[]).concat(this.hideMode==='nosize'&amp;&amp;Ext.ux.plugin.VisibilityMode?[new Ext.ux.plugin.VisibilityMode({hideMode:'nosize',elements:['bwrap']})]:[])};MIF.Component.superclass.initComponent.call(Ext.apply(this,Ext.apply(this.initialConfig,C)));this.setMIFEvents();},onRender:function(ct,position){var frCfg=this.frameCfg||this.frameConfig||(this.relayTarget?{name:this.relayTarget.id}:{})||{};var frDOM=frCfg.autoCreate||frCfg;frDOM=Ext.apply({tag:'iframe',id:Ext.id()},frDOM);var el=Ext.getDom(this.el);(el&amp;&amp;el.tagName=='iframe')||(this.autoEl=Ext.apply({name:frDOM.id,frameborder:0},frDOM));MIF.Component.superclass.onRender.apply(this,arguments);if(this.unsupportedText){ct.child('noframes')||ct.createChild({tag:'noframes',html:this.unsupportedText||null});}
var frame=this.el;var F;if(F=this.frameEl=(this.el?new MIF.Element(this.el.dom,true):null)){Ext.apply(F,{ownerCt:this.relayTarget||this,disableMessaging:Ext.value(this.disableMessaging,true),focusOnLoad:Ext.value(this.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(this.eventsFollowFrameLinks,true)});F.ownerCt.frameEl=F;F.addClass('ux-mif');if(this.loadMask){var mEl=this.loadMask.maskEl;F.loadMask=Ext.apply({disabled:false,hideOnReady:false,msgCls:'ext-el-mask-msg x-mask-loading',maskCls:'ext-el-mask'},{maskEl:F.ownerCt[String(mEl)]||F.parent('.'+String(mEl))||F.parent('.ux-mif-mask-target')||mEl},Ext.isString(this.loadMask)?{msg:this.loadMask}:this.loadMask);Ext.get(F.loadMask.maskEl)&amp;&amp;Ext.get(F.loadMask.maskEl).addClass('ux-mif-mask-target');}
F._observable&amp;&amp;(this.relayTarget||this).relayEvents(F._observable,frameEvents.concat(this._msgTagHandlers||[]));delete this.contentEl;}},afterRender:function(container){MIF.Component.superclass.afterRender.apply(this,arguments);if(this.fitToParent&amp;&amp;!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1]);}
this.getEl().setOverflow('hidden');this.setAutoScroll();var F;if(F=this.frameEl){var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on('afterlayout',function(container,layout){Ext.each(['north','south','east','west'],function(region){var reg;if((reg=layout[region])&amp;&amp;reg.split&amp;&amp;reg.split.dd&amp;&amp;!reg._splitTrapped){reg.split.dd.endDrag=reg.split.dd.endDrag.createSequence(MIM.hideShims,MIM);reg.split.on('beforeresize',MIM.showShims,MIM);reg._splitTrapped=MIM._splitTrapped=true;}},this);},this,{single:true});ownerCt=ownerCt.ownerCt;}
if(!!this.ownerCt||this.useShim){this.frameShim=F.createFrameShim();}
this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var resumeEvents=this.relayTarget&amp;&amp;this.ownerCt?this.ownerCt.resumeEvents.createDelegate(this.ownerCt):null;if(this.autoload){this.doAutoLoad();}else if(this.frameMarkup||this.html){F.update(this.frameMarkup||this.html,true,resumeEvents);delete this.html;delete this.frameMarkup;return;}else{if(this.defaultSrc){F.setSrc(this.defaultSrc,false);}else{F.reset(null,resumeEvents);return;}}
resumeEvents&amp;&amp;resumeEvents();}},beforeDestroy:function(){var F;if(F=this.getFrame()){F.remove();this.frameEl=this.frameShim=null;}
this.relayTarget&amp;&amp;(this.relayTarget.frameEl=null);MIF.Component.superclass.beforeDestroy.call(this);}});Ext.override(MIF.Component,MIF.ComponentAdapter.prototype);Ext.reg('mif',MIF.Component);function embed_MIF(config){config||(config={});config.layout='fit';config.items={xtype:'mif',ref:'mifChild',useShim:true,autoScroll:Ext.value(config.autoScroll,this.autoScroll),defaultSrc:Ext.value(config.defaultSrc,this.defaultSrc),frameMarkup:Ext.value(config.html,this.html),loadMask:Ext.value(config.loadMask,this.loadMask),disableMessaging:Ext.value(config.disableMessaging,this.disableMessaging),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,this.eventsFollowFrameLinks),focusOnLoad:Ext.value(config.focusOnLoad,this.focusOnLoad),frameConfig:Ext.value(config.frameConfig||config.frameCfg,this.frameConfig),relayTarget:this};delete config.html;this.setMIFEvents();return config;};Ext.ux.ManagedIFrame.Panel=Ext.extend(Ext.Panel,{ctype:'Ext.ux.ManagedIFrame.Panel',bodyCssClass:'ux-mif-mask-target',constructor:function(config){MIF.Panel.superclass.constructor.call(this,embed_MIF.call(this,config));}});Ext.override(MIF.Panel,MIF.ComponentAdapter.prototype);Ext.reg('iframepanel',MIF.Panel);Ext.ux.ManagedIFrame.Portlet=Ext.extend(Ext.ux.ManagedIFrame.Panel,{ctype:&quot;Ext.ux.ManagedIFrame.Portlet&quot;,anchor:'100%',frame:true,collapseEl:'bwrap',collapsible:true,draggable:true,cls:'x-portlet'});Ext.reg('iframeportlet',MIF.Portlet);Ext.ux.ManagedIFrame.Window=Ext.extend(Ext.Window,{ctype:&quot;Ext.ux.ManagedIFrame.Window&quot;,bodyCssClass:'ux-mif-mask-target',constructor:function(config){MIF.Window.superclass.constructor.call(this,embed_MIF.call(this,config));}});Ext.override(MIF.Window,MIF.ComponentAdapter.prototype);Ext.reg('iframewindow',MIF.Window);Ext.ux.ManagedIFrame.Updater=Ext.extend(Ext.Updater,{showLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.mask(this.indicatorText);},hideLoading:function(){this.showLoadIndicator&amp;&amp;this.el&amp;&amp;this.el.unmask();},updateComplete:function(response){MIF.Updater.superclass.updateComplete.apply(this,arguments);this.hideLoading();},processFailure:function(response){MIF.Updater.superclass.processFailure.apply(this,arguments);this.hideLoading();}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase();};Ext.ux.ManagedIFrame.CSS=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null;},createStyleSheet:function(cssText,id){var ss;if(!doc)return;var head=doc.getElementsByTagName(&quot;head&quot;)[0];var rules=doc.createElement(&quot;style&quot;);rules.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;rules.setAttribute(&quot;id&quot;,id);if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText;}else{try{rules.appendChild(doc.createTextNode(cssText));}catch(e){rules.cssText=cssText;}
head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1]);}
this.cacheStyleSheet(ss);return ss;},removeStyleSheet:function(id){if(!doc||!id)return;var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing);}},swapStyleSheet:function(id,url){if(!doc)return;this.removeStyleSheet(id);var ss=doc.createElement(&quot;link&quot;);ss.setAttribute(&quot;rel&quot;,&quot;stylesheet&quot;);ss.setAttribute(&quot;type&quot;,&quot;text/css&quot;);Ext.isString(id)&amp;&amp;ss.setAttribute(&quot;id&quot;,id);ss.setAttribute(&quot;href&quot;,url);doc.getElementsByTagName(&quot;head&quot;)[0].appendChild(ss);},refreshCache:function(){return this.getRules(true);},cacheStyleSheet:function(ss,media){this.rules||(this.rules={});try{Ext.each(ss.cssRules||ss.rules||[],function(rule){this.hashRule(rule,ss,media);},this);Ext.each(ss.imports||[],function(sheet){sheet&amp;&amp;this.cacheStyleSheet(sheet,this.resolveMedia([sheet,sheet.parentStyleSheet]));},this);}catch(e){}},hashRule:function(rule,sheet,mediaOverride){var mediaSelector=mediaOverride||this.resolveMedia(rule);if(rule.cssRules||rule.rules){this.cacheStyleSheet(rule,this.resolveMedia([rule,rule.parentRule]));}
if(rule.styleSheet){this.cacheStyleSheet(rule.styleSheet,this.resolveMedia([rule,rule.ownerRule,rule.parentStyleSheet]));}
rule.selectorText&amp;&amp;Ext.each((mediaSelector||'').split(','),function(media){this.rules[((media?media.trim()+':':'')+rule.selectorText).toLowerCase()]=rule;},this);},resolveMedia:function(rule){var media;Ext.each([].concat(rule),function(r){if(r&amp;&amp;r.media&amp;&amp;r.media.length){media=r.media;return false;}});return media?(Ext.isIE?String(media):media.mediaText):'';},getRules:function(refreshCache){if(!this.rules||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i&lt;len;i++){try{this.cacheStyleSheet(ds[i]);}catch(e){}}}}
return this.rules;},getRule:function(selector,refreshCache,mediaSelector){var rs=this.getRules(refreshCache);if(Ext.type(mediaSelector)=='string'){mediaSelector=mediaSelector.trim()+':';}else{mediaSelector='';}
if(!Ext.isArray(selector)){return rs[(mediaSelector+selector).toLowerCase()];}
var select;for(var i=0;i&lt;selector.length;i++){select=(mediaSelector+selector[i]).toLowerCase();if(rs[select]){return rs[select];}}
return null;},updateRule:function(selector,property,value,mediaSelector){Ext.each((mediaSelector||'').split(','),function(mediaSelect){if(!Ext.isArray(selector)){var rule=this.getRule(selector,false,mediaSelect);if(rule){rule.style[property.replace(camelRe,camelFn)]=value;return true;}}else{for(var i=0;i&lt;selector.length;i++){if(this.updateRule(selector[i],property,value,mediaSelect)){return true;}}}
return false;},this);}};}};Ext.ux.ManagedIFrame.Manager=function(){var frames={};var implementation={_DOMFrameReadyHandler:function(e){try{var $frame;if($frame=e.target.ownerCt){$frame.loadHandler.call($frame,e);}}catch(rhEx){}},shimCls:'ux-mif-shim',register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.name]={ref:frame};return frame;},deRegister:function(frame){delete frames[frame.id];delete frames[frame.name];},hideShims:function(){var mm=MIF.Manager;mm.shimsApplied&amp;&amp;Ext.select('.'+mm.shimCls,true).removeClass(mm.shimCls+'-on');mm.shimsApplied=false;},showShims:function(){var mm=MIF.Manager;!mm.shimsApplied&amp;&amp;Ext.select('.'+mm.shimCls,true).addClass(mm.shimCls+'-on');mm.shimsApplied=true;},getFrameById:function(id){return typeof id=='string'?(frames[id]?frames[id].ref||null:null):null;},getFrameByName:function(name){return this.getFrameById(name);},getFrameHash:function(frame){return frames[frame.id]||frames[frame.id]||null;},destroy:function(){if(document.addEventListener&amp;&amp;!Ext.isOpera){window.removeEventListener(&quot;DOMFrameContentLoaded&quot;,this._DOMFrameReadyHandler,false);}}};document.addEventListener&amp;&amp;!Ext.isOpera&amp;&amp;window.addEventListener(&quot;DOMFrameContentLoaded&quot;,implementation._DOMFrameReadyHandler,false);Ext.EventManager.on(window,'beforeunload',implementation.destroy,implementation);return implementation;}();MIM=MIF.Manager;MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;var winDD=Ext.Window.DD;Ext.override(winDD,{startDrag:winDD.prototype.startDrag.createInterceptor(MIM.showShims),endDrag:winDD.prototype.endDrag.createInterceptor(MIM.hideShims)});Ext.ux.ManagedIFramePanel=MIF.Panel;Ext.ux.ManagedIFramePortlet=MIF.Portlet;Ext.ux.ManagedIframe=function(el,opt){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&amp;&amp;el.dom&amp;&amp;el.dom.tagName=='IFRAME'){config=args[1]||{};}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:'iframe',frameborder:0,cls:'x-mif',src:(Ext.isIE&amp;&amp;Ext.isSecure)?Ext.SSL_SECURE_URL:'about:blank'},config.autoCreate))):null;if(el&amp;&amp;config.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:'noframes',html:config.unsupportedText});}}
var mif=new MIF.Element(el,true);if(mif){Ext.apply(mif,{disableMessaging:Ext.value(config.disableMessaging,true),focusOnLoad:Ext.value(config.focusOnLoad,Ext.isIE),eventsFollowFrameLinks:Ext.value(config.eventsFollowFrameLinks,true),loadMask:!!config.loadMask?Ext.apply({msg:'Loading..',msgCls:'x-mask-loading',maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null});config.listeners&amp;&amp;mif.on(config.listeners);if(!!config.html){mif.update(config.html);}else{!!config.src&amp;&amp;mif.setSrc(config.src);}}
return mif;};Ext.ux.ManagedIFrame.Error=Ext.extend(Ext.Error,{constructor:function(message,arg){this.arg=arg;Ext.Error.call(this,message);},name:'Ext.ux.ManagedIFrame'});Ext.apply(Ext.ux.ManagedIFrame.Error.prototype,{lang:{'documentcontext-remove':'An attempt was made to remove an Element from the wrong document context.','execscript-secure-context':'An attempt was made at script execution within a document context with limited access permissions.','printexception':'An Error was encountered attempting the print the frame contents (document access is likely restricted).'}});Ext.onReady(function(){var CSS=new Ext.ux.ManagedIFrame.CSS(document),rules=[];CSS.getRule('.ux-mif-fill')||(rules.push('.ux-mif-fill{height:100%;width:100%;}'));CSS.getRule('.ux-mif-mask-target')||(rules.push('.ux-mif-mask-target{position:relative;zoom:1;}'));CSS.getRule('.ux-mif-el-mask')||(rules.push('.ux-mif-el-mask {z-index: 100;position: absolute;top:0;left:0;-moz-opacity: 0.5;opacity: .50;*filter: alpha(opacity=50);width: 100%;height: 100%;zoom: 1;} ','.ux-mif-el-mask-msg {z-index: 1;position: absolute;top: 0;left: 0;border:1px solid;background:repeat-x 0 -16px;padding:2px;} ','.ux-mif-el-mask-msg div {padding:5px 10px 5px 10px;border:1px solid;cursor:wait;} '));if(!CSS.getRule('.ux-mif-shim')){rules.push('.ux-mif-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}');rules.push('.ux-mif-shim-on{width:100%;height:100%;display:block;zoom:1;}');rules.push('.ext-ie6 .ux-mif-shim{margin-left:5px;margin-top:3px;}');}
if(!CSS.getRule('.x-hide-nosize')){rules.push('.x-hide-nosize{height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}.x-hide-nosize * {height:0px!important;width:0px!important;visibility:hidden!important;border:none!important;zoom:1;}');}!!rules.length&amp;&amp;CSS.createStyleSheet(rules.join(' '),'mifCSS');});Ext.provide&amp;&amp;Ext.provide('mif');})();function utils_logout(){Ext.util.Cookies.set('userLogin','');Ext.util.Cookies.set('hashCode','');Ext.Ajax.defaultHeaders.Authorization='';window.location.reload();}
Ext.namespace('sitools.widget');sitools.widget.FeedGridFlux=function(config){this.datasetName=config.datasetName;function clickOnRow(self,rowIndex,e){e.stopEvent();var rec=self.store.getAt(rowIndex);if(Ext.isEmpty(rec)){return;}
if(Ext.isEmpty(window)||Ext.isEmpty(window.SitoolsDesk)){var component=new sitools.widget.feedItemDetails({record:rec});var win=new Ext.Window({stateful:false,title:i18n.get('label.viewFeedDetail'),width:400,height:600,shim:false,animCollapse:false,constrainHeader:true,layout:'fit',modal:true});win.add(component);win.show();}else{var componentCfg={record:rec};var jsObj=sitools.widget.feedItemDetails;var windowConfig={id:&quot;viewFeedDetail&quot;,title:i18n.get('label.viewFeedDetail'),saveToolbar:false};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,jsObj,true);}}
Ext.apply(this);this.layout=&quot;fit&quot;;var gridPanel;if(config.feedSource!==undefined&amp;&amp;config.feedSource===&quot;OPENSEARCH&quot;){gridPanel=new sitools.user.component.openSearchResultFeed(config);}else{config.listeners={rowdblclick:clickOnRow};if(config.feedType!==undefined&amp;&amp;config.feedType===&quot;atom_1.0&quot;){gridPanel=new sitools.widget.atom1FeedReader(config);}else{gridPanel=new sitools.widget.rss2FeedReader(config);}}
this.items=[gridPanel];sitools.widget.FeedGridFlux.superclass.constructor.call(this);};Ext.extend(sitools.widget.FeedGridFlux,Ext.Panel,{componentType:&quot;feeds&quot;,_getSettings:function(){return{objectName:&quot;feedsReader&quot;};},border:false});Ext.reg('appfeedgridflux',sitools.widget.FeedGridFlux);Ext.namespace('sitools.widget');sitools.widget.rss2FeedReader=function(config){Ext.apply(this);this.layout=&quot;fit&quot;;this.storeFeedsRecords=new Ext.data.Store({autoLoad:true,sortInfo:{field:'pubDate',direction:&quot;DESC&quot;},proxy:new Ext.data.HttpProxy({url:config.urlFeed,restful:true,listeners:{scope:this,exception:onRequestFeedException}}),reader:new Ext.data.XmlReader({record:'item'},['title','author',{name:'pubDate',type:'date'},'link','description','content','guid',{name:'imageUrl',mapping:&quot;enclosure@url&quot;},{name:'imageType',mapping:&quot;enclosure@type&quot;}])});var columns=[{id:'image',header:&quot;Image&quot;,dataIndex:'imageUrl',sortable:false,width:120,renderer:this.imageRenderer},{id:'title',header:&quot;Title&quot;,dataIndex:'title',sortable:true,width:460,scope:this,renderer:this.formatTitle},{header:&quot;Author&quot;,dataIndex:'author',width:100,hidden:true,sortable:true},{id:'last',header:&quot;Date&quot;,dataIndex:'pubDate',width:150,renderer:this.formatDate,sortable:true,hidden:true}];sitools.widget.rss2FeedReader.superclass.constructor.call(this,{columns:columns,store:this.storeFeedsRecords,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:'title',hideHeaders:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},listeners:config.listeners});};Ext.extend(sitools.widget.rss2FeedReader,Ext.grid.GridPanel,{loadData:function(){this.loadFeed('http://feeds.feedburner.com/extblog');this.doLayout();},loadFeed:function(url){this.store.baseParams={feed:url};this.store.load();},togglePreview:function(show){this.view.showPreview=show;this.view.refresh();},applyRowClass:function(record,rowIndex,p,ds){if(this.showPreview){var xf=Ext.util.Format;p.body='&lt;p class=sous-titre-flux&gt;'+xf.ellipsis(xf.stripTags(record.data.description),200)+'&lt;/p&gt;';return'x-grid3-row-expanded';}
return'x-grid3-row-collapsed';},formatDate:function(date){if(!date){return'';}
var now=new Date();var d=now.clearTime(true);if(date instanceof Date){var notime=date.clearTime(true).getTime();if(notime==d.getTime()){return'Today '+date.dateFormat('g:i a');}
d=d.add('d',-6);if(d.getTime()&lt;=notime){return date.dateFormat('D g:i a');}
return date.dateFormat('n/j g:i a');}
else{return date;}},formatTitle:function(value,p,record){var link=record.data.link;var xf=Ext.util.Format;var author=(Ext.isEmpty(record.data.author))?&quot;&quot;:record.data.author;var dateFormat=this.formatDate(record.data.pubDate);var res=&quot;&quot;;if(link!==undefined&amp;&amp;link!==&quot;&quot;){res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0}&quot; title=&quot;{1}&quot; target=&quot;_blank&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{2}&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{3}&lt;/span&gt;&lt;/div&gt;',link,value,xf.ellipsis(xf.stripTags(value),30),author);}else{res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{1}&lt;/span&gt;&lt;/div&gt;',xf.ellipsis(xf.stripTags(value),30),author);}
if(dateFormat!=&quot;&quot;&amp;&amp;dateFormat!=null){res+=String.format('&lt;p id=&quot;feeds-date&quot;&gt;{0}&lt;/p&gt;',dateFormat);}
return res;},imageRenderer:function(value,p,record){if(Ext.isEmpty(value)||Ext.isEmpty(record.data.imageType)){return&quot;&quot;;}
if(record.data.imageType.substr(0,5)!=&quot;image&quot;){return&quot;&quot;;}
return String.format('&lt;img src=&quot;{0}&quot; width=&quot;50px&quot;&gt;',value);},sortByDate:function(direction){this.storeFeedsRecords.sort('pubDate',direction);}});Ext.namespace('sitools.widget');sitools.widget.atom1FeedReader=function(config){Ext.apply(this);this.layout=&quot;fit&quot;;this.storeFeedsRecords=new Ext.data.Store({autoLoad:true,sortInfo:{field:'pubDate',direction:&quot;DESC&quot;},proxy:new Ext.data.HttpProxy({url:config.urlFeed,restful:true,listeners:{scope:this,exception:onRequestFeedException}}),reader:new Ext.data.XmlReader({record:'entry'},['title',{name:'author',mapping:&quot;author.name&quot;},{name:'pubDate',mapping:'updated',type:'date'},{name:'link',mapping:&quot;link@href&quot;},{name:'description',mapping:'content'},'content',{name:'imageUrl',createAccessor:function(data,field){var q=Ext.DomQuery;var node=q.selectNode(&quot;link[type^=image]&quot;,data);var result={};if(Ext.isEmpty(node)){return result;}
Ext.each(node.attributes,function(attribute){result[attribute.name]=attribute.value;});return result;}}])});var columns=[{id:'image',header:&quot;Image&quot;,dataIndex:'imageUrl',sortable:false,width:120,renderer:this.imageRenderer},{id:'title',header:&quot;Title&quot;,dataIndex:'title',sortable:true,width:460,scope:this,renderer:this.formatTitle},{header:&quot;Author&quot;,dataIndex:'author',width:100,hidden:true,sortable:true},{id:'last',header:&quot;Date&quot;,dataIndex:'pubDate',width:150,renderer:this.formatDate,sortable:true,hidden:true}];sitools.widget.atom1FeedReader.superclass.constructor.call(this,{columns:columns,store:this.storeFeedsRecords,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:'title',hideHeaders:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},listeners:config.listeners});};Ext.extend(sitools.widget.atom1FeedReader,Ext.grid.GridPanel,{loadFeed:function(url){this.store.baseParams={feed:url};this.store.load();},togglePreview:function(show){this.view.showPreview=show;this.view.refresh();},applyRowClass:function(record,rowIndex,p,ds){if(this.showPreview){var xf=Ext.util.Format;if(record.data.summary!=&quot;&quot;&amp;&amp;record.data.summary!=undefined){p.body='&lt;p class=sous-titre-flux&gt;'+xf.ellipsis(xf.stripTags(record.data.summary),200)+'&lt;/p&gt;';return'x-grid3-row-expanded';}}
return'x-grid3-row-collapsed';},formatDate:function(date){if(!date){return'';}
var now=new Date();var d=now.clearTime(true);if(date instanceof Date){var notime=date.clearTime(true).getTime();if(notime==d.getTime()){return'Today '+date.dateFormat('g:i a');}
d=d.add('d',-6);if(d.getTime()&lt;=notime){return date.dateFormat('D g:i a');}
return date.dateFormat('n/j g:i a');}
else{return date;}},formatTitle:function(value,p,record){var author=(record.data.author.name!==undefined)?record.data.author.name:&quot;&quot;;var link=record.data.link;var xf=Ext.util.Format;var dateFormat=this.formatDate(record.data.updated);var author=(record.data.author.name!==undefined)?record.data.author.name:&quot;&quot;;var authorEmail=(record.data.author.email!==undefined)?record.data.author.email:&quot;&quot;;var res=&quot;&quot;;if(link!==undefined&amp;&amp;link!==&quot;&quot;){res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0}&quot; title=&quot;{1}&quot; target=&quot;_blank&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{2}&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{3}&lt;/span&gt;&lt;/div&gt;',link,value,xf.ellipsis(xf.stripTags(value),30),author);}else{res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;author&quot;&gt;{1}&lt;/span&gt;&lt;/div&gt;',xf.ellipsis(xf.stripTags(value),30),author);}
if(dateFormat!=&quot;&quot;&amp;&amp;dateFormat!=undefined){res+=String.format('&lt;p id=&quot;feeds-date&quot;&gt;{0}&lt;/p&gt;',dateFormat);}
return res;},imageRenderer:function(value,p,record){if(Ext.isEmpty(value)||Ext.isEmpty(value.href)){return&quot;&quot;;}
if(value.type.substr(0,5)!=&quot;image&quot;){return&quot;&quot;;}
return String.format('&lt;img src=&quot;{0}&quot; width=&quot;50px&quot;&gt;',value.href);},sortByDate:function(direction){this.storeFeedsRecords.sort('pubDate',direction);}});Ext.namespace('sitools.widget');sitools.widget.feedItemDetails=Ext.extend(Ext.Panel,{initComponent:function(){this.layout=&quot;fit&quot;;var record=this.record;if(!Ext.isEmpty(record)){this.store=new Ext.data.JsonStore({idProperty:'title',fields:[{name:'title'},{name:'pubDate',type:'date',dateFormat:'timestamp'},{name:'published',type:'date',dateFormat:'timestamp'},{name:'author'},{name:'link'},{name:'description'},{name:'imageUrl'},{name:'image'}],listeners:{scope:this,add:function(store,records,ind){if(record.data.imageUrl==undefined&amp;&amp;record.data.image!=undefined){record.data.image=record.data.imageUrl;}
if(records[0].data.pubDate!=&quot;&quot;){records[0].data.pubDate=this.formatDate(records[0].data.pubDate);}}}});this.store.add(record);this.tpl=new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;','&lt;div class=&quot;feed-article&quot;&gt;','&lt;tpl if=&quot;this.isDisplayable(imageUrl)&quot;&gt;','&lt;div class=&quot;feed-img&quot;&gt;','&lt;img src=&quot;{imageUrl}&quot; title=&quot;{title}&quot; width=&quot;70&quot; height=&quot;70&quot;/&gt;','&lt;/div&gt;','&lt;/tpl&gt;','&lt;p class=&quot;feed-title&quot;&gt; {title} &lt;/p&gt;','&lt;tpl if=&quot;this.isDisplayable(pubDate)&quot;&gt;','&lt;div class=&quot;feed-date-detail&quot;&gt;','&lt;b&gt; Date : &lt;/b&gt; {pubDate} ','&lt;/div&gt;','&lt;/tpl&gt;','&lt;tpl if=&quot;this.isDisplayable(author)&quot;&gt;','&lt;div class=&quot;feed-author&quot;&gt;','&lt;b&gt; Author : &lt;/b&gt; {author} ','&lt;/div&gt;','&lt;/tpl&gt;','&lt;div class=&quot;feed-description&quot;&gt;','{description}','&lt;/div&gt;','&lt;div class=&quot;feed-complementary&quot;&gt;','&lt;p style=&quot;padding-bottom: 3px;&quot;&gt; &lt;b&gt; Link : &lt;/b&gt; &lt;a href=&quot;{link}&quot; target=&quot;_blank&quot; title=&quot;{title}&quot;&gt;{link}&lt;/a&gt; &lt;/p&gt;','&lt;tpl if=&quot;this.isDisplayable(imageUrl)&quot;&gt;','&lt;p&gt; &lt;b&gt; Image Url : &lt;/b&gt; &lt;a href=&quot;{imageUrl}&quot; target=&quot;_blank&quot;&gt;{imageUrl}&lt;/a&gt; &lt;/p&gt;','&lt;/tpl&gt;','&lt;/div&gt;','&lt;/div&gt;','&lt;/tpl&gt;',{compiled:true,isDisplayable:function(item){if(item!=&quot;&quot;&amp;&amp;item!=undefined){return true;}
else{return false;}}});this.feedsDataview=new Ext.DataView({id:'detailFeed-view',autoScroll:true,layout:'fit',store:this.store,tpl:this.tpl,cls:'detailFeed-view',emptyText:i18n.get('label.nothingToDisplay')});this.componentType='feedDetails';this.items=[this.feedsDataview];}
sitools.widget.feedItemDetails.superclass.initComponent.call(this);},formatDate:function(date){if(!date){return'';}
var now=new Date();var d=now.clearTime(true);if(date instanceof Date){var notime=date.clearTime(true).getTime();if(notime==d.getTime()){return'Today '+date.dateFormat('g:i a');}
d=d.add('d',-6);if(d.getTime()&lt;=notime){return date.dateFormat('D g:i a');}
return date.dateFormat('n/j g:i a');}
else{return date;}},showMeInFixedNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);},showMeInDesktopNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);}});Ext.namespace(&quot;Ext.ux&quot;);Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||'x-icon-information',cls:'x-notification',width:200,autoHeight:true,plain:false,draggable:false,shadow:false,bodyStyle:'text-align:center'});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.hide,this);}else{this.closable=true;}
Ext.ux.Notification.superclass.initComponent.apply(this);},setMessage:function(msg){this.body.update(msg);},setTitle:function(title,iconCls){Ext.ux.Notification.superclass.setTitle.call(this,title,iconCls||this.iconCls);},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this);},cancelHiding:function(){this.addClass('fixed');if(this.autoDestroy){this.task.cancel();}},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);Ext.fly(this.body.dom).on('click',this.cancelHiding,this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000);}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)&gt;-1)
this.pos++;Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(document,&quot;br-br&quot;,[-20,-140-((this.getSize().height+10)*this.pos)]);this.el.slideIn('b',{duration:1,callback:this.afterShow,scope:this});},animHide:function(){this.el.ghost(&quot;b&quot;,{duration:1,remove:false,callback:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.destroy();}.createDelegate(this)});},focus:Ext.emptyFn});Ext.namespace('Ext.ux');Ext.namespace('Ext.ux.Plugin');Ext.ux.Plugin.LiteRemoteComponent=function(config){var defaultType=config.xtype||'panel';var callback=function(res){this.container.add(Ext.ComponentMgr.create(Ext.decode(res.responseText),defaultType)).show();this.container.doLayout();};return{init:function(container){this.container=container;Ext.Ajax.request(Ext.apply(config,{success:callback,scope:this}));}}};Ext.ux.Plugin.RemoteComponent=function(config){var defaultType=config.xtype||'panel';Ext.applyIf(config,{purgeSubscribers:true});this.initialConfig=config;Ext.apply(this,config);this.addEvents({'beforeload':true,'beforecreate':true,'beforeadd':true,'beforecomponshow':true,'beforecontainshow':true,'success':true});Ext.ux.Plugin.RemoteComponent.superclass.constructor.call(this,config);if(config.breakOn){this.on(config.breakOn,function(){return false;});}
var renderComponent=function(JSON){if(this.fireEvent('beforeadd',JSON,this)){var component=this.container.add(JSON);component.fireEvent('bodyResize',this);if(this.fireEvent('beforecomponshow',component,this)){return component;}}}.createDelegate(this);var callback=function(res){var JSON=Ext.decode(res.responseText);if(this.fireEvent('beforecreate',JSON,this)){var component=null;if(JSON instanceof Array){Ext.each(JSON,function(j,i){component=renderComponent(j).show();;});}else{component=renderComponent(JSON).show();}
if(this.fireEvent('beforecontainshow',component,this)){this.container.ownerCt.doLayout();this.fireEvent('success',component,this);}}
if(this.purgeSubscribers){this.purgeListeners();}}.createDelegate(this);this.load=function(){if(this.fireEvent('beforeload',config,this)){if(config.mask){var mask=new Ext.LoadMask(Ext.getDom(config.mask),Ext.apply({msg:'loading components...'},config.maskConfig||{}));mask.show();this.on('success',mask.hide,mask);}
Ext.Ajax.request(Ext.apply(config,{success:callback,scope:this}));}};this.init=function(container){container.on('beforedestroy',function(){this.purgeListeners();},this);this.container=container;if(config.loadOn){if(config.loadOn instanceof Array){Ext.each(config.loadOn,function(l,i,a){var evt=l.event||l.loadOn;var defer=function(){this.load();Ext.each(a,function(lo){(lo.scope||container).un(evt,defer,this);}.createDelegate(this));}.createDelegate(this);(l.scope||container).on(evt,defer,this);}.createDelegate(this));}else{(config.loadOn.scope||container).on((config.loadOn.event||config.loadOn),this.load,this,{single:true});}}else{this.load();}};};Ext.extend(Ext.ux.Plugin.RemoteComponent,Ext.util.Observable);Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:'column',autoScroll:true,cls:'x-portal',defaultType:'portalcolumn',resizable:true,initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true});},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig);},beforeDestroy:function(){if(this.dd){this.dd.unreg();}
Ext.ux.Portal.superclass.beforeDestroy.call(this);}});Ext.reg('portal',Ext.ux.Portal);Ext.ux.Portal.DropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig;},ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed};},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid();}
var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw;}else if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid();}
var col=0,xs=this.grid.columnX,cmatch=false,len;for(len=xs.length;col&lt;len;col++){if(xy[0]&lt;(xs[col].x+xs[col].w)){cmatch=true;break;}}
if(!cmatch){col--;}
var p,match=false,pos=0,c=portal.items.itemAt(col),items=c.items.items,overSelf=false;for(len=items.length;pos&lt;len;pos++){p=items[pos];var h=p.el.getHeight();if(h===0){overSelf=true;}else if((p.el.getY()+(h/2))&gt;xy[1]){match=true;break;}}
pos=(match&amp;&amp;p?pos:c.items.getCount())+(overSelf?-1:0);var overEvent=this.createEvent(dd,e,data,col,c,pos);if(portal.fireEvent('validatedrop',overEvent)!==false&amp;&amp;portal.fireEvent('beforedragover',overEvent)!==false){px.getProxy().setWidth('auto');if(p){px.moveProxy(p.el.dom.parentNode,match?p.el.dom:null);}else{px.moveProxy(c.el.dom,null);}
this.lastPos={c:c,col:col,p:overSelf||(match&amp;&amp;p)?pos:false};this.scrollPos=portal.body.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status;}else{return overEvent.status;}},notifyOut:function(){delete this.grid;},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return;}
var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p,panel=dd.panel,dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&amp;&amp;this.portal.fireEvent('beforedrop',dropEvent)!==false){dd.proxy.getProxy().remove();panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(pos!==false){c.insert(pos,panel);}else{c.add(panel);}
c.doLayout();this.portal.fireEvent('drop',dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st;},10);}}
delete this.lastPos;},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth()});});return box;},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);Ext.ux.Portal.DropZone.superclass.unreg.call(this);}});Ext.ux.PortalColumn=Ext.extend(Ext.Container,{defaultType:'portlet',cls:'x-portal-column'});Ext.reg('portalcolumn',Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:'100%',frame:true,collapsible:true,draggable:true,cls:'x-portlet',heightIncrement:16,pinned:false,duration:0.6,easing:'backIn',transparent:false,minHeight:10,onRender:function(ct,position){Ext.ux.Portlet.superclass.onRender.call(this,ct,position);var createProxyProtoType=Ext.Element.prototype.createProxy;Ext.Element.prototype.createProxy=function(config){return Ext.DomHelper.append(this.dom,config,true);};this.resizer=new Ext.Resizable(this.el,{animate:true,duration:this.duration,easing:this.easing,handles:'s',transparent:this.transparent,heightIncrement:this.heightIncrement,minHeight:this.minHeight||100,pinned:this.pinned});this.resizer.on('resize',this.onResizer,this);Ext.Element.prototype.createProxy=createProxyProtoType;},onResizer:function(oResizable,iWidth,iHeight,e){this.setHeight(iHeight);},onCollapse:function(doAnim,animArg){this.el.setHeight('');Ext.ux.Portlet.superclass.onCollapse.call(this,doAnim,animArg);}});Ext.reg('portlet',Ext.ux.Portlet);Ext.namespace('sitools.siteMap');var loadUrl={map:[],load:function(url,callback,scope){var siteMapRef=this;siteMapRef.transformsPropertiesToMap(url,callback,scope);},transformsPropertiesToMap:function(url,callback,scope){var store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:url,restful:true}),reader:new Ext.data.XmlReader({record:'url'},[{name:'name',mapping:'name'},{name:'loc',mapping:'loc'}])});var localMap=this.map;store.load({scope:scope,callback:function(r,options,success){var i=0;while(i!=undefined){var rec=r[i];if(rec!=undefined){var url=rec.data.loc;var name=rec.data.name;localMap[name]=url;i++;}else{i=undefined;}}
callback.call(this);}});},get:function(entry){return!Ext.isEmpty(this.map[entry])?this.map[entry]:entry;}};var componentManager={loadedComponents:[],load:function(name){}};var data={ret:null,get:function(url,cbk){Ext.Ajax.request({method:'GET',url:url,success:function(response,opts){cbk(Ext.decode(response.responseText));},failure:function(response,opts){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+url);}});return this.ret;}};Ext.applyIf(Array.prototype,{clone:function(){return[].concat(this);}});Ext.namespace('sitools.env');var userPreferences=null;var userLogin=null;var sql2ext={map:[],load:function(url){var i18nRef=this;Ext.Ajax.request({method:'GET',url:url,success:function(response,opts){ann(response.responseText,&quot;no response is sent&quot;);i18nRef.map=i18nRef.transformsPropertiesToMap(response.responseText);},failure:function(response,opts){alert(&quot;Error! Can't read i18n file with url :&quot;+url);}});},transformsPropertiesToMap:function(text){var array=text.split('\n');var localMap=[];var i;for(i=0;i&lt;array.length;i++){var string=array[i];var indexOfEqualsSign=string.indexOf('=');if(indexOfEqualsSign&gt;=1){var key=string.substring(0,indexOfEqualsSign).replace('\r','');var value=string.substring(indexOfEqualsSign+1).replace('\r','');localMap[key]=value;}}
return localMap;},get:function(entry){return!Ext.isEmpty(this.map[entry])?this.map[entry]:'auto';}};var i18n={map:[],load:function(url,callback,loopOnFailure){var i18nRef=this;Ext.Ajax.request({method:'GET',url:url,loopOnFailure:(Ext.isEmpty(loopOnFailure))?true:loopOnFailure,success:function(response,opts){ann(response.responseText,&quot;no response is sent&quot;);i18nRef.map=i18nRef.transformsPropertiesToMap(response.responseText);if(Ext.isFunction(callback)){callback();}},failure:function(response,opts){if(!opts.loopOnFailure){Ext.Msg.alert(&quot;Error! Can't read i18n file with url :&quot;+url);}else{locale.restoreDefault();url='/sitools/res/i18n/'+locale.getLocale()+'/gui.properties';i18n.load(url,callback,false);}}});},transformsPropertiesToMap:function(text){var array=text.split('\n');var localMap=[];var i;for(i=0;i&lt;array.length;i++){var string=array[i];var indexOfEqualsSign=string.indexOf('=');if(indexOfEqualsSign&gt;=1){var key=string.substring(0,indexOfEqualsSign).replace('\r','');var value=string.substring(indexOfEqualsSign+1).replace('\r','');localMap[key]=value;}}
return localMap;},get:function(entry){return!Ext.isEmpty(this.map[entry])?this.map[entry]:entry;}};var componentManager={loadedComponents:[],load:function(name){}};var data={ret:null,get:function(url,cbk){Ext.Ajax.request({method:'GET',url:url,success:function(response,opts){cbk(Ext.decode(response.responseText));},failure:function(response,opts){Ext.Msg.alert(&quot;Warning&quot;,&quot;Error! Can't get data with url :&quot;+url);}});return this.ret;}};userLogin=Ext.util.Cookies.get('userLogin');var userStorage={set:function(filename,filepath,content,callback){Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get('APP_USERSTORAGE_USER_URL').replace('{identifier}',userLogin)+&quot;/files&quot;,method:'POST',scope:this,params:{filepath:filepath,filename:filename},jsonData:content,success:function(ret){var Json=Ext.decode(ret.responseText);if(!Json.success){Ext.Msg.alert(i18n.get('label.warning'),Json.message);return;}else{var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:Json.message,autoDestroy:true,hideDelay:1000});notify.show(document);}},failure:function(){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('label.warning.savepreference.error'));return;},callback:function(){if(!Ext.isEmpty(callback)){callback.call();}}});},get:function(fileName,filePath,scope,success,failure,callback){Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get('APP_USERSTORAGE_USER_URL').replace('{identifier}',userLogin)+&quot;/files&quot;+filePath+&quot;/&quot;+fileName,method:'GET',scope:scope,success:success,failure:failure,callback:callback});}};var projectGlobal={projectId:null,projectName:null,preferences:null,userRoles:null,isAdmin:false,sitoolsAttachementForUsers:null,modules:null,links:null,callback:Ext.emptyFn,initProject:function(callback){this.callback=callback;this.projectName=this.getProjectName();this.getProjectInfo();},getDataViewsDependencies:function(){Ext.Ajax.request({url:this.sitoolsAttachementForUsers+&quot;/datasetViews&quot;,method:&quot;GET&quot;,scope:this,success:function(ret){var json=Ext.decode(ret.responseText);if(!json.success){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProjectName'));return false;}else{var data=json.data;Ext.each(data,function(datasetViewComponent){if(!Ext.isEmpty(datasetViewComponent.dependencies)&amp;&amp;!Ext.isEmpty(datasetViewComponent.dependencies.js)){Ext.each(datasetViewComponent.dependencies.js,function(dependencies){includeJs(dependencies.url);},this);}
if(!Ext.isEmpty(datasetViewComponent.dependencies)&amp;&amp;!Ext.isEmpty(datasetViewComponent.dependencies.css)){Ext.each(datasetViewComponent.dependencies.css,function(dependencies){includeCss(dependencies.url);},this);}});}},callback:function(){this.getFormDependencies();}});},getFormDependencies:function(){Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get('APP_FORMCOMPONENTS_URL'),method:&quot;GET&quot;,scope:this,success:function(ret){var json=Ext.decode(ret.responseText);if(!json.success){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProjectName'));return false;}else{var data=json.data;Ext.each(data,function(formComponent){includeJs(formComponent.fileUrlUser);});}},callback:function(){this.initLanguages();}});},initLanguages:function(){Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:loadUrl.get('APP_URL')+'/client-user/tmp/langues.json',success:function(response){var json=Ext.decode(response.responseText);this.languages=json.data;},failure:function(response){Ext.Msg.alert('Status',i18n.get('warning.serverError'));},callback:function(){this.getPreferences(this.callback);}});},getUserRoles:function(cb){if(Ext.isEmpty(userLogin)){cb.call();}
else{Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get(&quot;APP_USER_ROLE_URL&quot;),method:&quot;GET&quot;,scope:this,success:function(ret){var json=Ext.decode(ret.responseText);if(!json.success){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProjectName'));return false;}else{this.user=json.user;if(Ext.isEmpty(this.user.roles)){return;}
for(var index=0;index&lt;this.user.roles.length;index++){var role=this.user.roles[index];if(role.name===&quot;Administrator&quot;){this.isAdmin=true;}}}},callback:cb});}},getProjectName:function(){if(this.projectName===null){var url=document.location.pathname;var tabUrl=url.split(&quot;/&quot;);var i=0,index;var found=false;while(i&lt;tabUrl.length&amp;&amp;!found){if(tabUrl[i]===&quot;project-index.html&quot;){found=true;index=i;}
i++;}
this.projectName=tabUrl[index-1];if(this.projectName===undefined||this.projectName===&quot;&quot;){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProject'));}}
return this.projectName;},getProjectInfo:function(){Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get('APP_PORTAL_URL')+'/projects/'+this.projectName,method:&quot;GET&quot;,scope:this,success:function(ret){var data=Ext.decode(ret.responseText);if(!data.success){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProjectName'));return false;}else{this.sitoolsAttachementForUsers=data.project.sitoolsAttachementForUsers;this.projectId=data.project.id;this.projectName=data.project.name;this.htmlHeader=data.project.htmlHeader;this.links=data.project.links;this.navigationMode=data.project.navigationMode;}},callback:function(){this.getDataViewsDependencies();},failure:function(){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noProject'));}});},getPreferences:function(callback){if(!Ext.isEmpty(userLogin)){var filePath=&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+projectGlobal.projectName;var fileName=&quot;desktop&quot;;var success=function(ret){try{this.preferences=Ext.decode(ret.responseText);callback.call();}catch(err){callback.call();}};var failure=function(ret){this.getPublicPreferences(callback);};userStorage.get(fileName,filePath,this,success,failure);}else{this.getPublicPreferences(callback);}},getPublicPreferences:function(callback){var AppPublicStorage=loadUrl.get('APP_PUBLIC_STORAGE_URL')+&quot;/files&quot;;Ext.Ajax.request({url:loadUrl.get('APP_URL')+AppPublicStorage+&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+&quot;/&quot;+this.projectName+&quot;/desktop?media=json&quot;,method:'GET',scope:this,success:function(ret){try{this.preferences=Ext.decode(ret.responseText);}catch(err){this.preferences=null;}},callback:callback});}};var publicStorage={set:function(filename,filepath,content,callback){this.url=loadUrl.get('APP_URL')+loadUrl.get('APP_PUBLIC_STORAGE_URL')+&quot;/files&quot;;Ext.Ajax.request({url:this.url,method:'POST',scope:this,params:{filepath:filepath,filename:filename},jsonData:content,success:function(ret){var Json=Ext.decode(ret.responseText);if(!Json.success){Ext.Msg.alert(i18n.get('label.warning'),Json.message);return;}else{var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:Json.message,autoDestroy:true,hideDelay:1000});notify.show(document);}},failure:function(){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('label.warning.savepreference.error'));return;},callback:function(){if(!Ext.isEmpty(callback)){callback.call();}}});},get:function(fileName,filePath,scope,success,failure){Ext.Ajax.request({url:loadUrl.get('APP_URL')+loadUrl.get('APP_PUBLIC_STORAGE_URL')+&quot;/files&quot;+filePath+&quot;/&quot;+fileName,method:'GET',scope:scope,success:success,failure:failure});},remove:function(){this.url=loadUrl.get('APP_URL')+loadUrl.get('APP_PUBLIC_STORAGE_URL')+&quot;/files&quot;+&quot;?recursive=true&quot;;Ext.Ajax.request({url:this.url,method:'DELETE',scope:this,success:function(ret){var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get(&quot;label.publicUserPrefDeleted&quot;),autoDestroy:true,hideDelay:1000});notify.show(document);},failure:function(ret){if(ret.status===404){var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get(&quot;label.publicUserPrefDeleted&quot;),autoDestroy:true,hideDelay:1000});notify.show(document);}
else{var notifye=new Ext.ux.Notification({iconCls:'x-icon-error',title:i18n.get('label.error'),html:ret.responseText,autoDestroy:true,hideDelay:1000});notifye.show(document);}}});}};function showResponse(ret,notification){try{var Json=Ext.decode(ret.responseText);if(!Json.success){Ext.Msg.alert(i18n.get('label.warning'),Json.message);return false;}
if(notification){var notify=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:Json.message,autoDestroy:true,hideDelay:1000});notify.show(document);}
return true;}catch(err){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.javascriptError')+&quot; : &quot;+err);return false;}};var DEFAULT_NATIVEJSON=false;var DEFAULT_TIMEOUT=30000;var DEFAULT_TIMEBUF=10;var DEFAULT_NBRETRY=0;var SERVER_OK=200;var DEFAULT_WIN_HEIGHT=400;var DEFAULT_WIN_WIDTH=600;var DEFAULT_WINORDER_WIDTH=400;var DEFAULT_ORDER_FOLDER=&quot;dataSelection&quot;;var DEFAULT_PREFERENCES_FOLDER=&quot;preferences&quot;;var DEFAULT_LIVEGRID_BUFFER_SIZE=300;var WARNING_NB_RECORDS_PLOT=10000;var URL_CGU=&quot;/sitools/res/licences/cgu.html&quot;;var COOKIE_DURATION=20;var MULTIDS_TIME_DELAY=2000;var SITOOLS_DEFAULT_PROJECT_IMAGE_URL=&quot;/sitools/res/images/sitools2_logo.png&quot;;var DEFAULT_NEAR_LIMIT_SIZE=100;Ext.BLANK_IMAGE_URL='/sitools/cots/extjs/resources/images/default/s.gif';Ext.USE_NATIVE_JSON=DEFAULT_NATIVEJSON;Ext.Ajax.timeout=DEFAULT_TIMEOUT;var onBeforeRequest=function(conn,options){var date=new Date();if(!Ext.isEmpty(Ext.util.Cookies.get('scheme'))){if(Ext.util.Cookies.get('scheme')==&quot;HTTP_Digest&quot;){var tmp=null;var method=&quot;GET&quot;;if(!Ext.isEmpty(options.method)){method=options.method;}
var url=options.url;if(Ext.isEmpty(options.url)&amp;&amp;!Ext.isEmpty(options.scope)){if(!Ext.isEmpty(options.scope.url)){url=options.scope.url;}}
var A1=Ext.util.Cookies.get(&quot;A1&quot;);var auth=new Digest({usr:Ext.util.Cookies.get(&quot;userLogin&quot;),algorithm:Ext.util.Cookies.get(&quot;algorithm&quot;),realm:Ext.util.Cookies.get(&quot;realm&quot;),url:url,nonce:Ext.util.Cookies.get('nonce'),method:method,mode:&quot;digest&quot;,A1:A1});Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:auth.getDigestAuth()});}
else{if(!Ext.isEmpty(Ext.util.Cookies.get('hashCode'))){Ext.util.Cookies.set('hashCode',Ext.util.Cookies.get('hashCode'),date.add(Date.MINUTE,COOKIE_DURATION));Ext.apply(Ext.Ajax.defaultHeaders,{Authorization:Ext.util.Cookies.get('hashCode')});}}}
if(!Ext.isEmpty(Ext.util.Cookies.get('userLogin'))){Ext.util.Cookies.set('userLogin',Ext.util.Cookies.get('userLogin'),date.add(Date.MINUTE,20));}};Ext.Ajax.on('beforerequest',onBeforeRequest,this);var DEFAULT_LOCALE=&quot;en&quot;;var SITOOLS_DATE_FORMAT='Y-m-d\\TH:i:s.u';var SITOOLS_DEFAULT_IHM_DATE_FORMAT='Y-m-d H:i:s.u';var locale={locale:DEFAULT_LOCALE,isInit:false,getLocale:function(){if(!this.isInit){if(Ext.isEmpty(Ext.util.Cookies.get('language'))){var navigator=window.navigator;this.locale=navigator.language||navigator.browserLanguage||navigator.userLanguage;}
else{this.locale=Ext.util.Cookies.get('language');}
this.isInit=true;}
return this.locale;},setLocale:function(locale){this.locale=locale;},restoreDefault:function(){this.setLocale(DEFAULT_LOCALE);}};var onRequestFeedException=function(proxy,type,action,options,response,args){if((response.status==403)&amp;&amp;!Ext.isEmpty(Ext.util.Cookies.get('hashCode'))){Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get('label.session.expired'),response.responseText);}else{Ext.MessageBox.minWidth=360;Ext.MessageBox.alert(i18n.get('label.error'),response.responseText);}
return false;};var desktop;var projectGlobal;var projectId;function alertFailure(response,opts){var txt;if(response.status==SERVER_OK){var ret=Ext.decode(response.responseText).message;txt=i18n.get('msg.error')+': '+ret;}else{txt=i18n.get('warning.serverError')+': '+response.statusText;}
Ext.Msg.alert(i18n.get('label.warning'),txt);}
function extColModelToJsonColModel(ExtColModel){var colModel=[];var columns;if(!Ext.isEmpty(ExtColModel.columns)){columns=ExtColModel.columns;}
else{columns=ExtColModel;}
Ext.each(columns,function(column){colModel.push({columnAlias:column.columnAlias,dataIndex:column.dataIndexSitools,dataIndexSitools:column.dataIndexSitools,header:column.header,filter:column.filter,hidden:column.hidden,id:column.id,previewColumn:column.previewColumn,primaryKey:column.primaryKey,schema:column.schema,sortable:column.sortable,sqlColumnType:column.sqlColumnType,tableAlias:column.tableAlias,tableName:column.tableName,toolTip:column.tooltip,urlColumn:column.urlColumn,width:column.width,columnRenderer:column.columnRenderer,specificColumnType:column.specificColumnType,javaSqlColumnType:column.javaSqlColumnType,format:column.format});});return colModel;}
function extColModelToSrv(ExtColModel){var colModel=[];var columns;if(!Ext.isEmpty(ExtColModel.columns)){columns=ExtColModel.columns;}
else{columns=ExtColModel;}
Ext.each(columns,function(column){if(!column.hidden){colModel.push(column.columnAlias);}});return colModel.join(&quot;, &quot;);}
function extColModelToStorage(ExtColModel){var colModel=[];var columns;if(!Ext.isEmpty(ExtColModel.columns)){columns=ExtColModel.columns;}
else{columns=ExtColModel;}
Ext.each(columns,function(column){if(!column.hidden){colModel.push({columnAlias:column.columnAlias,dataIndex:column.dataIndex,dataIndexSitools:column.dataIndexSitools,editor:column.editor,filter:column.filter,header:column.header,hidden:column.hidden,id:column.id,isColumn:column.isColumn,previewColumn:column.previewColumn,primaryKey:column.primaryKey,schema:column.schema,sortable:column.sortable,sqlColumnType:column.sqlColumnType,tableAlias:column.tableAlias,tableName:column.tableName,toolTip:column.tooltip,urlColumn:column.urlColumn,width:column.width,columnRenderer:column.columnRenderer,specificColumnType:column.specificColumnType,javaSqlColumnType:column.javaSqlColumnType,unit:column.unit,format:column.format});}});return colModel;}
function getDesktop(){if(Ext.isEmpty(this.SitoolsDesk)){return null;}
else{return this.SitoolsDesk.app.desktop;}}
function getApp(){if(Ext.isEmpty(SitoolsDesk)){return null;}
else{return SitoolsDesk.app;}}
Ext.override(Ext.Window,{initEvents:function(){Ext.Window.superclass.initEvents.call(this);if(this.animateTarget){this.setAnimateTarget(this.animateTarget);}
if(this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||'all',pinned:true,resizeElement:this.resizerAction,handleCls:'x-window-handle'});this.resizer.window=this;this.mon(this.resizer,'beforeresize',this.beforeResize,this);}
if(this.draggable){this.header.addClass('x-window-draggable');}
this.mon(this.el,'mousedown',this.toFront,this);var tmp=getDesktop();if(Ext.isEmpty(tmp)){this.manager=Ext.WindowMgr;}
else{this.manager=getDesktop().getManager()||Ext.WindowMgr;}
this.manager.register(this);if(this.maximized){this.maximized=false;this.maximize();}
if(this.closable){var km=this.getKeyMap();km.on(27,this.onEsc,this);km.disable();}}});Ext.override(Ext.grid.GridPanel,{stripeRows:true});Ext.data.Types.DATEASSTRING={convert:function(v,data){return v;},sortType:function(v){return v;},type:&quot;dateAsString&quot;};function includeJs(url){if(Ext.isEmpty(url)){return;}
var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.setAttribute('src',url);script.setAttribute('type','text/javascript');head.appendChild(script);}
function includeCss(url){var headID=document.getElementsByTagName(&quot;head&quot;)[0];var newCss=document.createElement('link');newCss.type='text/css';newCss.rel='stylesheet';newCss.href=url;newCss.media='screen';headID.appendChild(newCss);}
Ext.override(Ext.PagingToolbar,{initComponent:function(){var T=Ext.Toolbar;var pagingItems=[this.first=new T.Button({tooltip:this.firstText,overflowText:this.firstText,iconCls:'x-tbar-page-first',disabled:true,handler:this.moveFirst,scope:this}),this.prev=new T.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:'x-tbar-page-prev',disabled:true,handler:this.movePrevious,scope:this}),'-',this.beforePageText,this.inputItem=new Ext.form.NumberField({cls:'x-tbar-page-number',allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.afterTextItem=new T.TextItem({text:String.format(this.afterPageText,1)}),'-',this.next=new T.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:'x-tbar-page-next',disabled:true,handler:this.moveNext,scope:this}),this.last=new T.Button({tooltip:this.lastText,overflowText:this.lastText,iconCls:'x-tbar-page-last',disabled:true,handler:this.moveLast,scope:this}),'-'];var userItems=this.items||this.buttons||[];if(this.prependButtons){this.items=userItems.concat(pagingItems);}else{this.items=pagingItems.concat(userItems);}
delete this.buttons;if(this.displayInfo){this.items.push('-&gt;');this.items.push(this.displayItem=new T.TextItem({}));}
Ext.PagingToolbar.superclass.initComponent.call(this);this.addEvents('change','beforechange');this.on('afterlayout',this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true);},onFirstLayout:function(){this.refresh=new Ext.Toolbar.Button({tooltip:i18n.get('label.refreshText'),overflowText:i18n.get('label.refreshText'),iconCls:'x-tbar-loading',handler:this.doRefresh,scope:this});this.insert(10,this.refresh);if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded);}}});function getColumnModel(listeColonnes,dictionnaryMappings,dataviewConfig){var columns=[];if(!Ext.isEmpty(listeColonnes)){Ext.each(listeColonnes,function(item,index,totalItems){var tooltip=&quot;&quot;;if(item.toolTip){tooltip=item.toolTip;}
else{if(Ext.isArray(dictionnaryMappings)&amp;&amp;!Ext.isEmpty(dictionnaryMappings)){var dico=dictionnaryMappings[0];var dicoMapping=dico.mapping||[];dicoMapping.each(function(mapping){if(item.columnAlias==mapping.columnAlias){var concept=mapping.concept||{};if(!Ext.isEmpty(concept.description)){tooltip+=concept.description.replace('&quot;',&quot;''&quot;)+&quot;&lt;br&gt;&quot;;}}});}}
var renderer=sitools.user.component.dataviews.dataviewUtils.getRendererLiveGrid(item,dataviewConfig);var hidden;if(Ext.isEmpty(item.visible)){hidden=item.hidden;}else{hidden=!item.visible;}
if(Ext.isEmpty(item.columnRenderer)||ColumnRendererEnum.NO_CLIENT_ACCESS!=item.columnRenderer.behavior){columns.push(new Ext.grid.Column({columnAlias:item.columnAlias,dataIndexSitools:item.dataIndex,dataIndex:item.columnAlias,header:item.header,width:item.width,sortable:item.sortable,hidden:hidden,tooltip:tooltip,renderer:renderer,schema:item.schema,tableName:item.tableName,tableAlias:item.tableAlias,id:item.id,primaryKey:item.primaryKey,previewColumn:item.previewColumn,filter:item.filter,sqlColumnType:item.sqlColumnType,columnRenderer:item.columnRenderer,specificColumnType:item.specificColumnType,format:item.format}));}},this);}
var cm=new Ext.grid.ColumnModel({columns:columns});return cm;}
Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on('beforeshow',this.onBeforeShow,this);if(this.strict==(Ext.isIE7&amp;&amp;Ext.isStrict)){this.on('show',this.onShow,this,{single:true,delay:20});}
Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.SitoolsDatePicker(Ext.applyIf({internalRender:this.strict||!Ext.isIE,ctCls:'x-menu-date-item',id:this.pickerId},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,['select']);this.on('show',this.picker.focus,this.picker);this.on('select',this.menuHide,this);if(this.handler){this.on('select',this.handler,this.scope||this);}}});Ext.override(Ext.form.DateField,{showTime:false,onTriggerClick:function(){if(this.disabled){return;}
if(Ext.isEmpty(this.menu)){this.menu=new Ext.menu.DateMenu({hideOnClick:false,showTime:this.showTime,focusOnSelect:false});}
this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,&quot;tl-bl?&quot;);this.menuEvents('on');}});function viewFileContent(url,title){Ext.Ajax.request({url:url,method:'HEAD',scope:this,success:function(ret){try{var headerFile=ret.getResponseHeader(&quot;Content-Type&quot;).split(&quot;;&quot;)[0].split(&quot;/&quot;)[0];if(headerFile==&quot;text&quot;||ret.getResponseHeader(&quot;Content-Type&quot;).indexOf(&quot;application/json&quot;)&gt;=0){Ext.Ajax.request({url:url,method:'GET',scope:this,success:function(ret){var windowConfig={id:&quot;winPreferenceDetailId&quot;,title:title,iconCls:&quot;version&quot;};var jsObj=sitools.user.component.entete.userProfile.viewTextPanel;var componentCfg={text:ret.responseText,formatJson:(ret.getResponseHeader(&quot;Content-Type&quot;).indexOf(&quot;application/json&quot;)&gt;=0)};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,jsObj);}});}
else if(headerFile==&quot;image&quot;){sitools.user.component.dataviews.dataviewUtils.showPreview(url,title);}
else{sitools.user.component.dataviews.dataviewUtils.downloadFile(url);}}catch(err){Ext.Msg.alert(i18n.get('label.error'),err);}},failure:function(ret){return null;}});}
Ext.override(Ext.data.XmlReader,{buildExtractors:function(){if(this.ef){return;}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;if(s.totalProperty){this.getTotal=this.createAccessor(s.totalProperty);}
if(s.successProperty){this.getSuccess=this.createAccessor(s.successProperty);}
if(s.messageProperty){this.getMessage=this.createAccessor(s.messageProperty);}
this.getRoot=function(res){return(!Ext.isEmpty(res[this.meta.record]))?res[this.meta.record]:res[this.meta.root];};if(s.idPath||s.idProperty){var g=this.createAccessor(s.idPath||s.idProperty);this.getId=function(rec){var id=g(rec)||rec.id;return(id===undefined||id==='')?null:id;};}else{this.getId=function(){return null;};}
var ef=[];for(var i=0;i&lt;fl;i++){f=fi[i];var map=(f.mapping!==undefined&amp;&amp;f.mapping!==null)?f.mapping:f.name;if(f.createAccessor!==undefined&amp;&amp;f.createAccessor!==null){ef.push(f.createAccessor);}
else{ef.push(this.createAccessor(map));}}
this.ef=ef;}});Ext.override(Ext.layout.BorderLayout.Region,{getCollapsedEl:function(){if(!this.collapsedEl){if(!this.toolTemplate){var tt=new Ext.Template('&lt;span class=&quot;x-panel-collapsed-text&quot;&gt;{title}&lt;/span&gt;','&lt;div class=&quot;x-tool x-tool-{id}&quot;&gt;&amp;#160;&lt;/div&gt;');tt.disableFormats=true;tt.compile();Ext.layout.BorderLayout.Region.prototype.toolTemplate=tt;}
this.collapsedEl=this.targetEl.createChild({cls:&quot;x-layout-collapsed x-layout-collapsed-&quot;+this.position,id:this.panel.id+'-xcollapsed'});this.collapsedEl.enableDisplayMode('block');if(this.collapseMode=='mini'){this.collapsedEl.addClass('x-layout-cmini-'+this.position);this.miniCollapsedEl=this.collapsedEl.createChild({cls:&quot;x-layout-mini x-layout-mini-&quot;+this.position,html:&quot;&amp;#160;&quot;});this.miniCollapsedEl.addClassOnOver('x-layout-mini-over');this.collapsedEl.addClassOnOver(&quot;x-layout-collapsed-over&quot;);this.collapsedEl.on('click',this.onExpandClick,this,{stopEvent:true});}
else{if(this.collapsible!==false&amp;&amp;!this.hideCollapseTool){var t=this.expandToolEl=this.toolTemplate.append(this.collapsedEl.dom,{id:'expand-'+this.position,title:this.panel.collapsedTitle},true);t.addClassOnOver('x-tool-expand-'+this.position+'-over');t.on('click',this.onExpandClick,this,{stopEvent:true});}
if(this.floatable!==false||this.titleCollapse){this.collapsedEl.addClassOnOver(&quot;x-layout-collapsed-over&quot;);this.collapsedEl.on(&quot;click&quot;,this[this.floatable?'collapseClick':'onExpandClick'],this);}}}
return this.collapsedEl;}});Ext.ns(&quot;sitools.user&quot;);sitools.user.clickDatasetIcone=function(url,type,extraCmpConfig){Ext.Ajax.request({method:&quot;GET&quot;,url:url,success:function(ret){var Json=Ext.decode(ret.responseText);if(showResponse(ret)){var dataset=Json.dataset;var componentCfg,javascriptObject;var windowConfig={datasetName:dataset.name,type:type,saveToolbar:true,toolbarItems:[]};switch(type){case&quot;desc&quot;:Ext.apply(windowConfig,{title:i18n.get('label.description')+&quot; : &quot;+dataset.name,id:&quot;desc&quot;+dataset.id,saveToolbar:false,iconCls:&quot;version&quot;});componentCfg={autoScroll:true,html:dataset.descriptionHTML};Ext.applyIf(componentCfg,extraCmpConfig);javascriptObject=Ext.Panel;SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;data&quot;:javascriptObject=eval(SitoolsDesk.navProfile.getDatasetOpenMode(dataset));Ext.apply(windowConfig,{winWidth:900,winHeight:400,title:i18n.get('label.dataTitle')+&quot; : &quot;+dataset.name,id:type+dataset.id,iconCls:&quot;dataviews&quot;});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,datasetId:dataset.Id,datasetCm:dataset.columnModel,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings,datasetViewConfig:dataset.datasetViewConfig,preferencesPath:&quot;/&quot;+dataset.datasetName,preferencesFileName:&quot;datasetOverview&quot;,sitoolsAttachementForUsers:dataset.sitoolsAttachementForUsers};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;forms&quot;:var menuForms=new Ext.menu.Menu();Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/forms&quot;,success:function(ret){try{var Json=Ext.decode(ret.responseText);if(!Json.success){throw Json.message;}
if(Json.total===0){throw i18n.get('label.noForms');}
javascriptObject=sitools.user.component.forms.mainContainer;if(Json.total==1){var form=Json.data[0];Ext.apply(windowConfig,{title:i18n.get('label.forms')+&quot; : &quot;+dataset.name+&quot;.&quot;+form.name,iconCls:&quot;forms&quot;});Ext.apply(windowConfig,{id:type+dataset.id+form.id});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,dataset:dataset,formId:form.id,formName:form.name,formParameters:form.parameters,formWidth:form.width,formHeight:form.height,formCss:form.css,preferencesPath:&quot;/&quot;+dataset.name+&quot;/forms&quot;,preferencesFileName:form.name};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);}
else{var handler=null;Ext.each(Json.data,function(form){handler=function(form,dataset){Ext.apply(windowConfig,{title:i18n.get('label.forms')+&quot; : &quot;+dataset.name+&quot;.&quot;+form.name,iconCls:&quot;forms&quot;});Ext.apply(windowConfig,{id:type+dataset.id+form.id});componentCfg={dataUrl:dataset.sitoolsAttachementForUsers,formId:form.id,formName:form.name,formParameters:form.parameters,formWidth:form.width,formHeight:form.height,formCss:form.css,dataset:dataset};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);};menuForms.addItem({text:form.name,handler:function(){handler(form,dataset);},icon:loadUrl.get('APP_URL')+&quot;/common/res/images/icons/tree_forms.png&quot;});},this);menuForms.showAt(Ext.EventObject.xy);}}
catch(err){var tmp=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get(err),autoDestroy:true,hideDelay:1000}).show(document);}}});break;case&quot;feeds&quot;:var menuFeeds=new Ext.menu.Menu();Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/feeds&quot;,success:function(ret){try{var Json=Ext.decode(ret.responseText);if(!Json.success){throw Json.message;}
if(Json.total===0){throw i18n.get('label.noFeeds');}
javascriptObject=sitools.widget.FeedGridFlux;if(Json.total==1){var feed=Json.data[0];Ext.apply(windowConfig,{title:i18n.get('label.feeds')+&quot; : &quot;+dataset.name+&quot;.&quot;+feed.title,id:type+dataset.id+feed.id,iconCls:&quot;feedsModule&quot;});componentCfg={datasetId:dataset.id,urlFeed:dataset.sitoolsAttachementForUsers+&quot;/clientFeeds/&quot;+feed.name,feedType:feed.feedType,datasetName:dataset.name,feedSource:feed.feedSource,autoLoad:true};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);}
else{var handler=null;Ext.each(Json.data,function(feed){handler=function(feed,dataset){Ext.apply(windowConfig,{title:i18n.get('label.feeds')+&quot; : &quot;+dataset.name+&quot;.&quot;+feed.title,id:type+dataset.id+feed.id,iconCls:&quot;feedsModule&quot;});componentCfg={datasetId:dataset.id,urlFeed:dataset.sitoolsAttachementForUsers+&quot;/clientFeeds/&quot;+feed.name,feedType:feed.feedType,datasetName:dataset.name,feedSource:feed.feedSource,autoLoad:true};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);};menuFeeds.addItem({text:feed.name,handler:function(){handler(feed,dataset);},icon:loadUrl.get('APP_URL')+&quot;/common/res/images/icons/rss.png&quot;});},this);menuFeeds.showAt(Ext.EventObject.xy);}}
catch(err){var tmp=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get(err),autoDestroy:true,hideDelay:1000}).show(document);}}});break;case&quot;defi&quot;:Ext.apply(windowConfig,{title:i18n.get('label.definitionTitle')+&quot; : &quot;+dataset.name,id:type+dataset.id,iconCls:&quot;semantic&quot;});javascriptObject=sitools.user.component.columnsDefinition;componentCfg={datasetId:dataset.id,datasetCm:dataset.columnModel,datasetName:dataset.name,dictionaryMappings:dataset.dictionaryMappings,preferencesPath:&quot;/&quot;+dataset.name,preferencesFileName:&quot;semantic&quot;};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);break;case&quot;openSearch&quot;:Ext.Ajax.request({method:&quot;GET&quot;,url:dataset.sitoolsAttachementForUsers+&quot;/opensearch.xml&quot;,success:function(ret){var xml=ret.responseXML;var dq=Ext.DomQuery;var success=dq.selectNode('OpenSearchDescription ',xml);if(!success){var tmp=new Ext.ux.Notification({iconCls:'x-icon-information',title:i18n.get('label.information'),html:i18n.get(&quot;label.noOpenSearch&quot;),autoDestroy:true,hideDelay:1000}).show(document);return;}
Ext.apply(windowConfig,{title:i18n.get('label.opensearch')+&quot; : &quot;+dataset.name,id:type+dataset.id,iconCls:&quot;openSearch&quot;});javascriptObject=sitools.user.component.datasetOpensearch;componentCfg={datasetId:dataset.id,dataUrl:dataset.sitoolsAttachementForUsers,datasetName:dataset.name,preferencesPath:&quot;/&quot;+dataset.name,preferencesFileName:&quot;openSearch&quot;};Ext.applyIf(componentCfg,extraCmpConfig);SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,javascriptObject);}});break;}}},failure:alertFailure});};Ext.override(Ext.form.Field,{tooltip:null,listeners:{render:function(){Ext.form.Field.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var ttConfig={};if(Ext.isString(this.tooltip)){ttConfig={html:this.tooltip,width:200,dismissDelay:5000};}
else if(Ext.isObject(this.tooltip)){ttConfig=this.tooltip;}else{return;}
Ext.apply(ttConfig,{target:this.el});this.tTip=new Ext.ToolTip(ttConfig);}}}});Ext.override(Ext.BoxComponent,{tooltip:null,listeners:{render:function(){Ext.BoxComponent.superclass.render.apply(this,arguments);if(!Ext.isEmpty(this.tooltip)){var ttConfig={};if(Ext.isString(this.tooltip)){ttConfig={html:this.tooltip,width:200,dismissDelay:5000};}
else if(Ext.isObject(this.tooltip)){ttConfig=this.tooltip;}else{return;}
Ext.apply(ttConfig,{target:this.el});this.tTip=new Ext.ToolTip(ttConfig);}}}});Ext.override(Ext.Button,{setTooltip:function(){return;}});function initAppliDesktop(){return;}
var portal;var portalApp={projects:null,languages:null,preferences:null,autoChainAjaxRequest:true,initProjects:function(callback){Ext.Ajax.request({scope:this,url:loadUrl.get('APP_URL')+loadUrl.get('APP_PORTAL_URL')+'/projects?media=json',method:'GET',success:function(response){try{this.projects=Ext.decode(response.responseText).data;if(this.autoChainAjaxRequest){this.initLanguages();}}catch(err){Ext.Msg.alert(i18n.get('label.error'),err);}},failure:function(response){Ext.Msg.alert('Status',i18n.get('warning.serverError'));}});},initLanguages:function(){Ext.Ajax.request({scope:this,method:&quot;GET&quot;,url:loadUrl.get('APP_URL')+'/client-user/tmp/langues.json',success:function(response){this.languages=Ext.decode(response.responseText).data;if(this.autoChainAjaxRequest){this.initPreferences();}},failure:function(response){Ext.Msg.alert('Status',i18n.get('warning.serverError'));}});},initPreferences:function(cb){if(Ext.isEmpty(userLogin)){var projects=this.projects;var languages=this.languages;var preferences=this.preferences;var callback;if(this.autoChainAjaxRequest){callback=function(){portal=new sitools.Portal(projects,languages,preferences);};}
else{callback=cb;}
i18n.load(loadUrl.get('APP_URL')+'/res/i18n/'+locale.getLocale()+'/gui.properties',callback);return;}
var filePath=&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+'/portal';var success=function(response){this.preferences=Ext.decode(response.responseText);if(!Ext.isEmpty(this.preferences.language)){locale.setLocale(this.preferences.language);}};var failure=function(){return;};var callback=function(){var projects=this.projects;var languages=this.languages;var preferences=this.preferences;i18n.load(loadUrl.get('APP_URL')+'/res/i18n/'+locale.getLocale()+'/gui.properties',function(){portal=new sitools.Portal(projects,languages,preferences);});};userStorage.get(&quot;portal&quot;,filePath,this,success,failure,callback);},initAppliPortal:function(opts,callback){if(!Ext.isEmpty(Ext.util.Cookies.get('userLogin'))){var auth=Ext.util.Cookies.get('hashCode');Ext.Ajax.defaultHeaders={&quot;Authorization&quot;:auth,&quot;Accept&quot;:&quot;application/json&quot;,&quot;X-User-Agent&quot;:&quot;Sitools&quot;};}else{Ext.Ajax.defaultHeaders={&quot;Accept&quot;:&quot;application/json&quot;,&quot;X-User-Agent&quot;:&quot;Sitools&quot;};}
Ext.QuickTips.init();this.callSiteMapResource(opts.siteMapRes,callback);},callSiteMapResource:function(res,cb){var callback;if(this.autoChainAjaxRequest){callback=this.initProjects;}else{callback=cb;}
loadUrl.load(res+'/siteMap',callback,this);}};var ID={PANEL:{MENU:'menuPanelId',TREE:'treePanelId',MAIN:'mainPanelId',HELP:'helpPanelId'},CMP:{TOOLBAR:'toolbarId',MENU:'menuId'},WIN:{LOGIN:'loginWinId',ORDER:'orderWinId'},BOX:{REG:'regBoxId',USER:'userBoxId',GROUP:'groupBoxId',FIREWALL:'firewallBoxId'},PORTLET:{PROJET:'portletProjectId',RECHERCHE:'portletRecherceID',FEEDS:'portletFeedsId'},PORTALTREENAV:{PROJET:'navProjectId',RECHERCHE:'navRechercheId',FEEDS:'navFeedsId'}};sitools.Portal=function(projectsList,languages,preferences){var user;var menuLoginLogout;if(Ext.isEmpty(Ext.util.Cookies.get('userLogin'))){user=i18n.get('label.guest');menuLoginLogout={xtype:'tbbutton',text:i18n.get('label.connection'),itemId:'menu_login',icon:loadUrl.get('APP_URL')+'/common/res/images/icons/login.png',handler:this.connect};}else{user=Ext.util.Cookies.get('userLogin');menuLoginLogout={xtype:'tbbutton',text:i18n.get('label.logout'),itemId:'menu_logout',icon:loadUrl.get('APP_URL')+'/common/res/images/icons/logout.png',handler:function(){utils_logout();}};}
var versionButton={xtype:'tbbutton',text:i18n.get('label.version'),itemId:'menu_version',icon:loadUrl.get('APP_URL')+'/common/res/images/icons/version.png',handler:function(){showVersion();}};var menuLangues=new Ext.menu.Menu({plain:true});Ext.each(languages,function(language){menuLangues.add({text:language.displayName,scope:this,handler:function(){var callback=function(){Ext.util.Cookies.set('language',language.localName);window.location.reload();};var date=new Date();Ext.util.Cookies.set('language',language.localName,date.add(Date.MINUTE,20));userPreferences={};userPreferences.language=language.localName;if(!Ext.isEmpty(userLogin)){userStorage.set(loadUrl.get('APP_PORTAL_URL'),&quot;/&quot;+DEFAULT_PREFERENCES_FOLDER+loadUrl.get('APP_PORTAL_URL'),userPreferences,callback);}else{window.location.reload();}},icon:language.image});},this);var editProfileButton;if(!Ext.isEmpty(Ext.util.Cookies.get('userLogin'))){editProfileButton={xtype:'tbbutton',text:i18n.get('label.editProfile'),itemId:'menu_editProfile',icon:loadUrl.get('APP_URL')+'/common/res/images/icons/tree_userman.png',identifier:user,edit:loadUrl.get('APP_URL')+'/editProfile/'+user,handler:function(){var win=new Ext.Window({items:[],modal:true,width:400,height:405,resizable:false});win.show();var edit=new sitools.userProfile.editProfile({closable:true,identifier:user,url:this.edit,handler:this.onRender,height:win.body.getHeight()});win.add(edit);win.doLayout();}};}else{editProfileButton={xtype:'tbbutton',hidden:true};}
var toolbar={xtype:'toolbar',id:'toolbar',items:[{xtype:'label',html:'&lt;img src='+loadUrl.get('APP_URL')+'/common/res/images/cnes.png width=92 height=28&gt;'},{xtype:'label',html:'&lt;img src='+loadUrl.get('APP_URL')+'/common/res/images/logo_01_petiteTaille.png width=92 height=28&gt;'},'-&gt;',{xtype:'label',margins:{top:0,right:10,bottom:0,left:10},text:i18n.get('label.welcome')+' '+user},'-',versionButton,'-',{text:i18n.get('label.langues'),menu:menuLangues},'-',editProfileButton,'-',menuLoginLogout]};var menuPanel=new Ext.Panel({id:'north',region:'north',layout:'fit',height:28,items:[toolbar]});var treePanel=new Ext.Panel({id:'tree',region:'west',title:i18n.get('label.components'),split:true,collapsible:true,autoScroll:true,width:200,layout:'fit',defaults:{padding:10},collapsed:true});var data=[];var store=new Ext.data.JsonStore({fields:['id','name','description','image','authorized','maintenance','maintenanceText'],sortInfo:{field:'name',direction:'ASC'}});Ext.each(projectsList,function(project){var record=new Ext.data.Record({id:project.id,name:project.name,description:project.description,image:project.image.url||SITOOLS_DEFAULT_PROJECT_IMAGE_URL,authorized:project.authorized,maintenance:project.maintenance,maintenanceText:project.maintenanceText});store.add(record);});var myDataView=new Ext.DataView({store:store,tpl:new Ext.XTemplate('&lt;ul&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;li id=&quot;{id}&quot; ','&lt;tpl if=&quot;authorized == true&quot;&gt;','class=&quot;project','&lt;tpl if=&quot;maintenance&quot;&gt;',' sitools-maintenance-portal','&lt;/tpl&gt;','&quot;','&lt;/tpl&gt;','&lt;tpl if=&quot;authorized == false&quot;&gt;','class=&quot;project projectUnauthorized&quot;','&lt;/tpl&gt;','&gt;','&lt;img width=&quot;80&quot; height=&quot;80&quot; src=&quot;{image}&quot; /&gt;','&lt;strong&gt;{name}&lt;/strong&gt;','&lt;span&gt;{description} &lt;/span&gt;','&lt;/li&gt;','&lt;/tpl&gt;','&lt;/ul&gt;',{compiled:true,disableFormats:true,isAuthorized:function(authorized){return authorized===true;}}),id:'projectDataView',itemSelector:'li.project',overClass:'project-hover',singleSelect:true,multiSelect:false,autoScroll:true,listeners:{scope:this,click:function(dataView,index,node,e){var data=dataView.getRecord(node).data;var projectName=data.name;var authorized=data.authorized;var maintenance=data.maintenance;var maintenanceText=data.maintenanceText;if(authorized){if(!maintenance){window.open(projectName+&quot;/project-index.html&quot;);}
else{var alertWindow=new Ext.Window({title:i18n.get('label.maintenance'),width:600,height:400,autoScroll:true,items:[{xtype:'panel',layout:'fit',autoScroll:true,html:maintenanceText,padding:&quot;5&quot;}],modal:true});alertWindow.show();}}else{this.connect();}}}});var portletProjet=new Ext.ux.Portlet({id:ID.PORTLET.PROJET,title:i18n.get('label.portletProjetTitle'),height:560,items:[myDataView],autoScroll:true});var panelFluxPortal={xtype:'sitools.component.users.portal.feedsReaderPortal'};var portletFluxPortal=new Ext.ux.Portlet({layout:'fit',id:ID.PORTLET.FEEDS,title:i18n.get('title.portlelFeedsPortal'),height:400,items:[panelFluxPortal]});var osPanel=new sitools.component.users.portal.portalOpensearch({dataUrl:loadUrl.get('APP_URL')+loadUrl.get('APP_PORTAL_URL'),suggest:false,pagging:false});var portletRecherche=new Ext.ux.Portlet({collapsed:true,bodyCssClass:'portletRecherche',id:ID.PORTLET.RECHERCHE,title:i18n.get('label.portletRechercheTitle'),items:[osPanel],layout:&quot;fit&quot;,height:400});var helpPanel=new Ext.ux.ManagedIFrame.Panel({id:'helpPanelId',title:i18n.get('label.helpTitle'),autoScroll:true,defaults:{padding:10},defaultSrc:&quot;res/html/&quot;+locale.getLocale()+&quot;/help.html&quot;});var linkPanel=new Ext.ux.ManagedIFrame.Panel({id:'link',title:i18n.get('label.linkTitle'),autoScroll:true,defaults:{padding:10},defaultSrc:&quot;res/html/&quot;+locale.getLocale()+&quot;/link.html&quot;});var contactPanel=new Ext.ux.ManagedIFrame.Panel({id:'help',title:i18n.get('label.contactTitle'),autoScroll:true,defaults:{padding:10},defaultSrc:&quot;res/html/&quot;+locale.getLocale()+&quot;/contact.html&quot;});var mainPanel=new Ext.TabPanel({baseCls:'portalMainPanel',region:'center',activeTab:0,items:[{xtype:'panel',baseCls:'portalMainPanel',autoScroll:true,title:i18n.get('label.portalTitle'),items:[{region:'north',xtype:'iframepanel',title:i18n.get('label.freeText'),autoScroll:true,defaults:{padding:10},defaultSrc:&quot;res/html/&quot;+locale.getLocale()+&quot;/freeText.html&quot;,height:200},{region:'center',baseCls:'portalMainPanel',xtype:'portal',id:'portalId',margins:'35 5 5 0',defaults:{style:'padding:10px 0 10px 10px'},items:[{columnWidth:0.50,style:'padding:10px 0 10px 10px',items:[portletProjet]},{columnWidth:0.50,style:'padding:10px',items:[portletFluxPortal,portletRecherche]}]}]},contactPanel,linkPanel,helpPanel]});sitools.Portal.superclass.constructor.call(this,Ext.apply({layout:'border',items:[menuPanel,treePanel,mainPanel]}));var treeNav=new Ext.tree.TreePanel({id:'panelNav',useArrows:true,autoScroll:true,animate:true,enableDD:false,containerScroll:true,rootVisible:false,width:200,root:new Ext.tree.AsyncTreeNode({expanded:true,children:[{id:ID.PORTALTREENAV.PROJET,panelId:ID.PORTLET.PROJET,icon:'res/images/icons/portlet.png',text:i18n.get('label.portletProjetTitle'),leaf:true,checked:true,listeners:{checkchange:function(node){if(!node.attributes.checked){Ext.get(node.attributes.panelId).hide();Ext.get(node.attributes.panelId).addClass('x-hide-display');}else{Ext.get(node.attributes.panelId).show();Ext.get(node.attributes.panelId).removeClass('x-hide-display');}}}},{id:ID.PORTALTREENAV.RECHERCHE,icon:'res/images/icons/portlet.png',panelId:ID.PORTLET.RECHERCHE,text:i18n.get('label.portletRechercheTitle'),leaf:true,checked:true,listeners:{checkchange:function(node){if(!node.attributes.checked){Ext.get(node.attributes.panelId).hide();Ext.get(node.attributes.panelId).addClass('x-hide-display');}else{Ext.get(node.attributes.panelId).show();Ext.get(node.attributes.panelId).removeClass('x-hide-display');}}}},{id:ID.PORTALTREENAV.FEEDS,icon:'res/images/icons/portlet.png',panelId:ID.PORTLET.FEEDS,text:i18n.get('label.portletFeedsTitle'),leaf:true,checked:true,listeners:{checkchange:function(node){if(!node.attributes.checked){Ext.get(node.attributes.panelId).hide();Ext.get(node.attributes.panelId).addClass('x-hide-display');}else{Ext.get(node.attributes.panelId).show();Ext.get(node.attributes.panelId).removeClass('x-hide-display');}}}}]}),listeners:{'checkchange':function(node,checked){if(checked){node.getUI().addClass('complete');}else{node.getUI().removeClass('complete');}}}});treePanel.add(treeNav);treePanel.doLayout();};Ext.extend(sitools.Portal,Ext.Viewport,{onRender:function(){sitools.Portal.superclass.onRender.apply(this,arguments);},connect:function(){var tmp=new sitools.userProfile.Login({closable:true,url:loadUrl.get('APP_URL')+'/login',register:loadUrl.get('APP_URL')+'/inscriptions/user',reset:loadUrl.get('APP_URL')+'/resetPassword',handler:function(){portal.initAppliPortal({siteMapRes:loadUrl.get('APP_URL')+loadUrl.get('APP_CLIENT_USER_URL')});}}).show();}});Ext.reg('sitools.Portal',sitools.Portal);Ext.namespace('sitools.component.users.portal');sitools.component.users.portal.feedsReaderPortal=Ext.extend(Ext.Panel,{portalId:&quot;idPortal&quot;,layout:&quot;fit&quot;,initComponent:function(){var storeFeeds=new Ext.data.JsonStore({fields:['id','name','feedType','title','feedSource',{name:'visible',type:'boolean'}],url:loadUrl.get('APP_URL')+loadUrl.get('APP_PORTAL_URL')+'/'+this.portalId+'/listFeeds',root:&quot;data&quot;,autoLoad:true,listeners:{scope:this,load:function(store,records,options){if(store.getCount()!==0){this.comboFeeds.setValue(storeFeeds.getAt(0).data.id);this.selectFeeds(this.comboFeeds,storeFeeds.getAt(0));}}}});this.comboFeeds=new Ext.form.ComboBox({store:storeFeeds,displayField:'name',valueField:'id',typeAhead:true,mode:'local',forceSelection:true,triggerAction:'all',emptyText:i18n.get('label.selectAFeed'),selectOnFocus:true,scope:this,listeners:{scope:this,select:this.selectFeeds}});this.buttonDate=this.createSorterButton({text:i18n.get(&quot;label.feedDate&quot;),sortData:{direction:'ASC'}});this.tbar={xtype:'toolbar',defaults:{scope:this},items:[this.comboFeeds,this.buttonDate]};sitools.component.users.portal.feedsReaderPortal.superclass.initComponent.call(this);},selectFeeds:function(combo,rec,index){this.remove(this.feedsReader);var url=loadUrl.get('APP_URL')+loadUrl.get('APP_PORTAL_URL')+&quot;/&quot;+this.portalId+&quot;/clientFeeds/&quot;+rec.data.name;this.feedsReader=new sitools.widget.FeedGridFlux({urlFeed:url,feedType:rec.data.feedType,feedSource:rec.data.feedSource,autoLoad:true});this.add(this.feedsReader);this.doSort();this.doLayout();},doSort:function(){this.feedsReader.items.items[0].sortByDate(this.buttonDate.sortData.direction);},createSorterButton:function(config){config=config||{};Ext.applyIf(config,{listeners:{scope:this,click:function(button,e){this.changeSortDirection(button,true);}},iconCls:'sort-'+config.sortData.direction.toLowerCase(),reorderable:true});return new Ext.Button(config);},changeSortDirection:function(button,changeDirection){var sortData=button.sortData,iconCls=button.iconCls;if(sortData!=undefined){if(changeDirection!==false){button.sortData.direction=button.sortData.direction.toggle(&quot;ASC&quot;,&quot;DESC&quot;);button.setIconClass(iconCls.toggle(&quot;sort-asc&quot;,&quot;sort-desc&quot;));}
this.doSort();}},getSorters:function(){var sorters=[];Ext.each(this.getTopToolbar().findByType('button'),function(button){if(!Ext.isEmpty(button.sortData)){sorters.push(button.sortData);}},this);return sorters;}});Ext.reg('sitools.component.users.portal.feedsReaderPortal',sitools.component.users.portal.feedsReaderPortal);Ext.namespace('sitools.component.users.portal');sitools.component.users.portal.portalOpensearch=function(config){var uri=config.dataUrl+&quot;/opensearch/search&quot;;var uriSuggest=config.dataUrl+&quot;/opensearch/suggest&quot;;var suggest=true;if(!Ext.isEmpty(config.suggest)){suggest=config.suggest;}
var pagging=true;if(!Ext.isEmpty(config.pagging)){pagging=config.pagging;}
function _clickOnSearch(){var searchQuery=formPanel.getForm().getValues().searchQuery;var nbResults=formPanel.getForm().getValues().nbResults;result.updateStore(uri+&quot;?q=&quot;+searchQuery+&quot;&amp;nbResults=&quot;+nbResults);}
var ds=new Ext.data.JsonStore({url:uriSuggest,restful:true,root:'data',fields:[{name:'field',type:'string'},{name:'name',type:'string'},{name:'nb',type:'string'}]});var resultTpl=new Ext.XTemplate('&lt;tpl for=&quot;.&quot;&gt;&lt;div class=&quot;search-item&quot;&gt;','&lt;h3&gt;{name}&lt;span&gt; ({field} / {nb} results ) &lt;/span&gt;&lt;/h3&gt;','&lt;/div&gt;&lt;/tpl&gt;');var search=new Ext.form.ComboBox({store:ds,displayField:'name',typeAhead:false,loadingText:i18n.get(&quot;label.searching&quot;),hideTrigger:true,fieldLabel:i18n.get(&quot;label.search&quot;),name:'searchQuery',anchor:&quot;100%&quot;,tpl:resultTpl,itemSelector:'div.search-item',minChars:2,queryParam:'q',enableKeyEvents:true,scope:this,listeners:{scope:this,beforequery:function(queryEvent){if(queryEvent.query.indexOf(&quot; &quot;)==-1){return true;}else{return false;}},specialkey:function(field,e){if(e.getKey()==e.ENTER){_clickOnSearch();}},beforeselect:function(self,record,index){record.data.name=record.data.field+&quot;:&quot;+record.data.name;return true;}}});this.storeCb=new Ext.data.ArrayStore({id:0,fields:['nbResults'],data:[[10],[20],[30],[40],[50]]});var combo=new Ext.form.ComboBox({name:&quot;nbResults&quot;,typeAhead:true,triggerAction:'all',lazyRender:true,mode:'local',store:this.storeCb,valueField:'nbResults',displayField:'nbResults',fieldLabel:i18n.get(&quot;label.nbResults&quot;),value:this.storeCb.getAt(0).get(&quot;nbResults&quot;)});var items=[search,combo];var buttonForm=[{text:i18n.get(&quot;label.search&quot;),scope:this,handler:_clickOnSearch}];var formPanel=new Ext.FormPanel({labelWidth:75,height:90,frame:true,defaultType:'textfield',items:items,buttons:buttonForm});function clickOnRow(self,rowIndex,e){var rec=self.store.getAt(rowIndex);var guid=rec.get(&quot;guid&quot;);if(Ext.isEmpty(guid)){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noGuidFieldDefined')+&quot;&lt;br/&gt;&quot;+i18n.get('warning.noPrimaryKeyDefinedOSNotice'));return;}
var component=new sitools.user.component.simpleViewDataDetail({urlDataDetail:guid});var win=new Ext.Window({stateful:false,title:i18n.get('label.viewDataDetail'),width:400,height:600,shim:false,animCollapse:false,constrainHeader:true,layout:'fit'});win.add(component);win.show();}
var result=new sitools.user.component.openSearchResultFeed({input:search,dataUrl:config.dataUrl,pagging:false,listeners:{rowdblclick:clickOnRow}});sitools.component.users.portal.portalOpensearch.superclass.constructor.call(this,Ext.apply({items:[formPanel,result],layout:'vbox',layoutConfig:{align:'stretch',pack:'start'}},config));};Ext.extend(sitools.component.users.portal.portalOpensearch,Ext.Panel,{});Ext.reg('sitools.component.users.portal.portalOpensearch',sitools.component.users.portal.portalOpensearch);Ext.namespace('sitools.user.component');sitools.user.component.openSearchResultFeed=function(config){this.pageSize=10;var urlParam=config.urlFeed;this.input=config.input;this.uriRecords=config.dataUrl+&quot;/records&quot;;var pagging=config.pagging;var url=(urlParam===undefined)?&quot;/tmp&quot;:urlParam;var exceptionHttpHandler=(Ext.isEmpty(config.exceptionHttpHandler))?onRequestFeedException:config.exceptionHttpHandler;this.httpProxy=new Ext.data.HttpProxy({url:url,restful:true,listeners:{scope:this,exception:exceptionHttpHandler}});this.xmlReader=new sitools.component.users.datasets.XmlReader({record:'item',totalProperty:'opensearch:totalResults'},['title','link','guid','pubDate','description']);this.store=new Ext.data.Store({proxy:this.httpProxy,reader:this.xmlReader,autoLoad:config.autoLoad,paramNames:{start:'start',limit:'rows'},listeners:{scope:this,load:function(self,records,index){if(!pagging&amp;&amp;!Ext.isEmpty(this.displayNbResults)){this.displayNbResults.setText('Total number of results : '+this.store.getTotalCount());}
return true;},exception:function(proxy,type,action,options,response,arg){var data=Ext.decode(response.responseText);if(!data.success){this.input.markInvalid(i18n.get(data.message));this.store.removeAll();}
return true;}}});this.store.setDefaultSort('pubDate',&quot;DESC&quot;);var columns=[{id:'title',header:&quot;Title&quot;,dataIndex:'title',sortable:true,renderer:this.formatTitle},{id:'last',header:&quot;Date&quot;,dataIndex:'pubDate',renderer:this.formatDate,sortable:true}];if(pagging){this.bbar={xtype:'paging',pageSize:this.pageSize,store:this.store,displayInfo:true,displayMsg:i18n.get('paging.display'),emptyMsg:i18n.get('paging.empty'),totalProperty:'totalCount'};}else{this.displayNbResults=new Ext.form.Label({text:'Total number of results : '});this.bbar={items:['-&gt;',this.displayNbResults]};}
function clickOnRow(self,rowIndex,e){e.stopEvent();var rec=self.store.getAt(rowIndex);var guid=rec.get(&quot;guid&quot;);if(Ext.isEmpty(guid)){Ext.Msg.alert(i18n.get('label.warning'),i18n.get('warning.noGuidFieldDefined')+&quot;&lt;br/&gt;&quot;+i18n.get('warning.noPrimaryKeyDefinedOSNotice'));return;}
if(Ext.isEmpty(window)||Ext.isEmpty(window.SitoolsDesk)){var component=new sitools.user.component.simpleViewDataDetail({fromWhere:&quot;openSearch&quot;,urlDataDetail:guid});var win=new Ext.Window({stateful:false,title:i18n.get('label.viewDataDetail'),width:400,height:600,shim:false,animCollapse:false,constrainHeader:true,layout:'fit'});win.add(component);win.show();}else{var componentCfg={grid:this,fromWhere:&quot;openSearch&quot;,datasetId:config.datasetId,datasetUrl:config.dataUrl,datasetName:config.datasetName,preferencesPath:&quot;/&quot;+config.datasetName,preferencesFileName:&quot;dataDetails&quot;};var jsObj=sitools.user.component.viewDataDetail;var windowConfig={id:&quot;dataDetail&quot;+config.datasetId,title:i18n.get('label.viewDataDetail')+&quot; : &quot;+config.datasetName,datasetName:config.datasetName,iconCls:&quot;openSearch&quot;,saveToolbar:true,type:&quot;dataDetail&quot;,toolbarItems:[{icon:loadUrl.get('APP_URL')+&quot;/common/res/images/icons/simple-arrow-left.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goPrevious();}},{icon:loadUrl.get('APP_URL')+&quot;/common/res/images/icons/simple-arrow-right.png&quot;,handler:function(){this.ownerCt.ownerCt.items.items[0].goNext();}}]};SitoolsDesk.addDesktopWindow(windowConfig,componentCfg,jsObj,true);}}
sitools.user.component.openSearchResultFeed.superclass.constructor.call(this,{columns:columns,layout:'fit',flex:1,store:this.store,loadMask:{msg:i18n.get(&quot;label.loadingFeed&quot;)},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),autoExpandColumn:'title',viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:this.applyRowClass},listeners:{rowdblclick:clickOnRow}});this.updateStore=function(url){this.httpProxy.setUrl(url,true);this.store.load();};};Ext.extend(sitools.user.component.openSearchResultFeed,Ext.grid.GridPanel,{componentType:&quot;feeds&quot;,applyRowClass:function(record,rowIndex,p,ds){if(this.showPreview){var xf=Ext.util.Format;p.body='&lt;p class=sous-titre-flux&gt;'+xf.ellipsis(xf.stripTags(record.data.description),200)+'&lt;/p&gt;';return'x-grid3-row-expanded';}
return'x-grid3-row-collapsed';},formatDate:function(date){if(!date){return'';}
var now=new Date();var d=now.clearTime(true);if(date instanceof Date){var notime=date.clearTime(true).getTime();if(notime==d.getTime()){return'Today '+date.dateFormat('g:i a');}
d=d.add('d',-6);if(d.getTime()&lt;=notime){return date.dateFormat('D g:i a');}
return date.dateFormat('n/j g:i a');}
else{return date;}},formatTitle:function(value,p,record){var link=record.data.link;var xf=Ext.util.Format;var res=&quot;&quot;;if(link!==undefined&amp;&amp;link!==&quot;&quot;){res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;a href=&quot;{0}&quot; title=&quot;{1}&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{2}&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;',link,value,xf.ellipsis(xf.stripTags(value),30));}else{res=String.format('&lt;div class=&quot;topic&quot;&gt;&lt;span class=&quot;rss_feed_title&quot;&gt;{0}&lt;/span&gt;&lt;/div&gt;',xf.ellipsis(xf.stripTags(value),30));}
return res;}});Ext.reg('sitools.user.component.openSearchResultFeed',sitools.user.component.openSearchResultFeed);Ext.namespace(&quot;sitools.component.users.datasets&quot;);sitools.component.users.datasets.DomQuery=function(){var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/&gt;+~]\s?|\s|$)/,tagTokenRe=/^(#)?((?:opensearch:)?[\w-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;eval(&quot;var batch = 30803;&quot;);function child(parent,index){var i=0,n=parent.firstChild;while(n){if(n.nodeType==1){if(++i==index){return n;}}
n=n.nextSibling;}
return null;}
function next(n){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1);return n;}
function prev(n){while((n=n.previousSibling)&amp;&amp;n.nodeType!=1);return n;}
function children(parent){var n=parent.firstChild,nodeIndex=-1,nextNode;while(n){nextNode=n.nextSibling;if(n.nodeType==3&amp;&amp;!nonSpace.test(n.nodeValue)){parent.removeChild(n);}else{n.nodeIndex=++nodeIndex;}
n=nextNode;}
return this;}
function byClassName(nodeSet,cls){if(!cls){return nodeSet;}
var result=[],ri=-1;for(var i=0,ci;ci=nodeSet[i];i++){if((' '+ci.className+' ').indexOf(cls)!=-1){result[++ri]=ci;}}
return result;};function attrValue(n,attr){if(!n.tagName&amp;&amp;typeof n.length!=&quot;undefined&quot;){n=n[0];}
if(!n){return null;}
if(attr==&quot;for&quot;){return n.htmlFor;}
if(attr==&quot;class&quot;||attr==&quot;className&quot;){return n.className;}
return n.getAttribute(attr)||n[attr];};function getNodes(ns,mode,tagName){var result=[],ri=-1,cs;if(!ns){return result;}
tagName=tagName||&quot;*&quot;;if(typeof ns.getElementsByTagName!=&quot;undefined&quot;){ns=[ns];}
if(!mode){for(var i=0,ni;ni=ns[i];i++){cs=ni.getElementsByTagName(tagName);for(var j=0,ci;ci=cs[j];j++){result[++ri]=ci;}}}else if(mode==&quot;/&quot;||mode==&quot;&gt;&quot;){var utag=tagName.toUpperCase();for(var i=0,ni,cn;ni=ns[i];i++){cn=ni.childNodes;for(var j=0,cj;cj=cn[j];j++){if(cj.nodeName==utag||cj.nodeName==tagName||tagName=='*'){result[++ri]=cj;}}}}else if(mode==&quot;+&quot;){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1);if(n&amp;&amp;(n.nodeName==utag||n.nodeName==tagName||tagName=='*')){result[++ri]=n;}}}else if(mode==&quot;~&quot;){var utag=tagName.toUpperCase();for(var i=0,n;n=ns[i];i++){while((n=n.nextSibling)){if(n.nodeName==utag||n.nodeName==tagName||tagName=='*'){result[++ri]=n;}}}}
return result;}
function concat(a,b){if(b.slice){return a.concat(b);}
for(var i=0,l=b.length;i&lt;l;i++){a[a.length]=b[i];}
return a;}
function byTag(cs,tagName){if(cs.tagName||cs==document){cs=[cs];}
if(!tagName){return cs;}
var result=[],ri=-1;tagName=tagName.toLowerCase();for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType==1&amp;&amp;ci.tagName.toLowerCase()==tagName){result[++ri]=ci;}}
return result;}
function byId(cs,id){if(cs.tagName||cs==document){cs=[cs];}
if(!id){return cs;}
var result=[],ri=-1;for(var i=0,ci;ci=cs[i];i++){if(ci&amp;&amp;ci.id==id){result[++ri]=ci;return result;}}
return result;}
function byAttribute(cs,attr,value,op,custom){var result=[],ri=-1,useGetStyle=custom==&quot;{&quot;,fn=sitools.component.users.datasets.DomQuery.operators[op],a,xml,hasXml;for(var i=0,ci;ci=cs[i];i++){if(ci.nodeType!=1){continue;}
if(!hasXml){xml=sitools.component.users.datasets.DomQuery.isXml(ci);hasXml=true;}
if(!xml){if(useGetStyle){a=sitools.component.users.datasets.DomQuery.getStyle(ci,attr);}else if(attr==&quot;class&quot;||attr==&quot;className&quot;){a=ci.className;}else if(attr==&quot;for&quot;){a=ci.htmlFor;}else if(attr==&quot;href&quot;){a=ci.getAttribute(&quot;href&quot;,2);}else{a=ci.getAttribute(attr);}}else{a=ci.getAttribute(attr);}
if((fn&amp;&amp;fn(a,value))||(!fn&amp;&amp;a)){result[++ri]=ci;}}
return result;}
function byPseudo(cs,name,value){return sitools.component.users.datasets.DomQuery.pseudos[name](cs,value);}
function nodupIEXml(cs){var d=++key,r;cs[0].setAttribute(&quot;_nodup&quot;,d);r=[cs[0]];for(var i=1,len=cs.length;i&lt;len;i++){var c=cs[i];if(!c.getAttribute(&quot;_nodup&quot;)!=d){c.setAttribute(&quot;_nodup&quot;,d);r[r.length]=c;}}
for(var i=0,len=cs.length;i&lt;len;i++){cs[i].removeAttribute(&quot;_nodup&quot;);}
return r;}
function nodup(cs){if(!cs){return[];}
var len=cs.length,c,i,r=cs,cj,ri=-1;if(!len||typeof cs.nodeType!=&quot;undefined&quot;||len==1){return cs;}
if(isIE&amp;&amp;typeof cs[0].selectSingleNode!=&quot;undefined&quot;){return nodupIEXml(cs);}
var d=++key;cs[0]._nodup=d;for(i=1;c=cs[i];i++){if(c._nodup!=d){c._nodup=d;}else{r=[];for(var j=0;j&lt;i;j++){r[++ri]=cs[j];}
for(j=i+1;cj=cs[j];j++){if(cj._nodup!=d){cj._nodup=d;r[++ri]=cj;}}
return r;}}
return r;}
function quickDiffIEXml(c1,c2){var d=++key,r=[];for(var i=0,len=c1.length;i&lt;len;i++){c1[i].setAttribute(&quot;_qdiff&quot;,d);}
for(var i=0,len=c2.length;i&lt;len;i++){if(c2[i].getAttribute(&quot;_qdiff&quot;)!=d){r[r.length]=c2[i];}}
for(var i=0,len=c1.length;i&lt;len;i++){c1[i].removeAttribute(&quot;_qdiff&quot;);}
return r;}
function quickDiff(c1,c2){var len1=c1.length,d=++key,r=[];if(!len1){return c2;}
if(isIE&amp;&amp;typeof c1[0].selectSingleNode!=&quot;undefined&quot;){return quickDiffIEXml(c1,c2);}
for(var i=0;i&lt;len1;i++){c1[i]._qdiff=d;}
for(var i=0,len=c2.length;i&lt;len;i++){if(c2[i]._qdiff!=d){r[r.length]=c2[i];}}
return r;}
function quickId(ns,mode,root,id){if(ns==root){var d=root.ownerDocument||root;return d.getElementById(id);}
ns=getNodes(ns,mode,&quot;*&quot;);return byId(ns,id);}
return{getStyle:function(el,name){return Ext.fly(el).getStyle(name);},compile:function(path,type){type=type||&quot;select&quot;;var fn=[&quot;var f = function(root){\n var mode; ++batch; var n = root || document;\n&quot;],mode,lastPath,matchers=sitools.component.users.datasets.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);if(lmode&amp;&amp;lmode[1]){fn[fn.length]='mode=&quot;'+lmode[1].replace(trimRe,&quot;&quot;)+'&quot;;';path=path.replace(lmode[1],&quot;&quot;);}
while(path.substr(0,1)==&quot;/&quot;){path=path.substr(1);}
while(path&amp;&amp;lastPath!=path){lastPath=path;var tokenMatch=path.match(tagTokenRe);if(type==&quot;select&quot;){if(tokenMatch){if(tokenMatch[1]==&quot;#&quot;){fn[fn.length]='n = quickId(n, mode, root, &quot;'+tokenMatch[2]+'&quot;);';}else{fn[fn.length]='n = getNodes(n, mode, &quot;'+tokenMatch[2]+'&quot;);';}
path=path.replace(tokenMatch[0],&quot;&quot;);}else if(path.substr(0,1)!='@'){fn[fn.length]='n = getNodes(n, mode, &quot;*&quot;);';}}else{if(tokenMatch){if(tokenMatch[1]==&quot;#&quot;){fn[fn.length]='n = byId(n, &quot;'+tokenMatch[2]+'&quot;);';}else{fn[fn.length]='n = byTag(n, &quot;'+tokenMatch[2]+'&quot;);';}
path=path.replace(tokenMatch[0],&quot;&quot;);}}
while(!(modeMatch=path.match(modeRe))){var matched=false;for(var j=0;j&lt;matchersLn;j++){var t=matchers[j];var m=path.match(t.re);if(m){fn[fn.length]=t.select.replace(tplRe,function(x,i){return m[i];});path=path.replace(m[0],&quot;&quot;);matched=true;break;}}
if(!matched){throw'Error parsing selector, parsing failed at &quot;'+path+'&quot;';}}
if(modeMatch[1]){fn[fn.length]='mode=&quot;'+modeMatch[1].replace(trimRe,&quot;&quot;)+'&quot;;';path=path.replace(modeMatch[1],&quot;&quot;);}}
fn[fn.length]=&quot;return nodup(n);\n}&quot;;eval(fn.join(&quot;&quot;));return f;},jsSelect:function(path,root,type){path=path||&quot;&quot;;root=root||document;if(typeof root==&quot;string&quot;){root=document.getElementById(root);}
var paths=path.split(&quot;,&quot;),results=[];for(var i=0,len=paths.length;i&lt;len;i++){var subPath=paths[i].replace(trimRe,&quot;&quot;);if(!cache[subPath]){cache[subPath]=sitools.component.users.datasets.DomQuery.compile(subPath);if(!cache[subPath]){throw subPath+&quot; is not a valid selector&quot;;}}
var result=cache[subPath](root);if(result&amp;&amp;result!=document){results=results.concat(result);}}
if(paths.length&gt;1){return nodup(results);}
return results;},isXml:function(el){var docEl=(el?el.ownerDocument||el:0).documentElement;return docEl?docEl.nodeName!==&quot;HTML&quot;:false;},select:document.querySelectorAll?function(path,root,type){root=root||document;if(!sitools.component.users.datasets.DomQuery.isXml(root)){try{var cs=root.querySelectorAll(path);return Ext.toArray(cs);}catch(ex){}}
return sitools.component.users.datasets.DomQuery.jsSelect.call(this,path,root,type);}:function(path,root,type){return sitools.component.users.datasets.DomQuery.jsSelect.call(this,path,root,type);},selectNode:function(path,root){return sitools.component.users.datasets.DomQuery.select(path,root)[0];},selectValue:function(path,root,defaultValue){path=path.replace(trimRe,&quot;&quot;);if(!valueCache[path]){valueCache[path]=sitools.component.users.datasets.DomQuery.compile(path,&quot;select&quot;);}
var n=valueCache[path](root),v;n=n[0]?n[0]:n;if(typeof n.normalize=='function')
n.normalize();v=(n&amp;&amp;n.firstChild?n.firstChild.nodeValue:null);return((v===null||v===undefined||v==='')?defaultValue:v);},selectNumber:function(path,root,defaultValue){var v=sitools.component.users.datasets.DomQuery.selectValue(path,root,defaultValue||0);return parseFloat(v);},is:function(el,ss){if(typeof el==&quot;string&quot;){el=document.getElementById(el);}
var isArray=Ext.isArray(el),result=sitools.component.users.datasets.DomQuery.filter(isArray?el:[el],ss);return isArray?(result.length==el.length):(result.length&gt;0);},filter:function(els,ss,nonMatches){ss=ss.replace(trimRe,&quot;&quot;);if(!simpleCache[ss]){simpleCache[ss]=sitools.component.users.datasets.DomQuery.compile(ss,&quot;simple&quot;);}
var result=simpleCache[ss](els);return nonMatches?quickDiff(result,els):result;},matchers:[{re:/^\.([\w-]+)/,select:'n = byClassName(n, &quot; {1} &quot;);'},{re:/^\:([\w-]+)(?:\(((?:[^\s&gt;\/]*|.*?))\))?/,select:'n = byPseudo(n, &quot;{1}&quot;, &quot;{2}&quot;);'},{re:/^(?:([\[\{])(?:@)?([\w-]+)\s?(?:(=|.=)\s?['&quot;]?(.*?)[&quot;']?)?[\]\}])/,select:'n = byAttribute(n, &quot;{2}&quot;, &quot;{4}&quot;, &quot;{3}&quot;, &quot;{1}&quot;);'},{re:/^#([\w-]+)/,select:'n = byId(n, &quot;{1}&quot;);'},{re:/^@([\w-]+)/,select:'return {firstChild:{nodeValue:attrValue(n, &quot;{1}&quot;)}};'}],operators:{&quot;=&quot;:function(a,v){return a==v;},&quot;!=&quot;:function(a,v){return a!=v;},&quot;^=&quot;:function(a,v){return a&amp;&amp;a.substr(0,v.length)==v;},&quot;$=&quot;:function(a,v){return a&amp;&amp;a.substr(a.length-v.length)==v;},&quot;*=&quot;:function(a,v){return a&amp;&amp;a.indexOf(v)!==-1;},&quot;%=&quot;:function(a,v){return(a%v)==0;},&quot;|=&quot;:function(a,v){return a&amp;&amp;(a==v||a.substr(0,v.length+1)==v+'-');},&quot;~=&quot;:function(a,v){return a&amp;&amp;(' '+a+' ').indexOf(' '+v+' ')!=-1;}},pseudos:{&quot;first-child&quot;:function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.previousSibling)&amp;&amp;n.nodeType!=1);if(!n){r[++ri]=ci;}}
return r;},&quot;last-child&quot;:function(c){var r=[],ri=-1,n;for(var i=0,ci;ci=n=c[i];i++){while((n=n.nextSibling)&amp;&amp;n.nodeType!=1);if(!n){r[++ri]=ci;}}
return r;},&quot;nth-child&quot;:function(c,a){var r=[],ri=-1,m=nthRe.exec(a==&quot;even&quot;&amp;&amp;&quot;2n&quot;||a==&quot;odd&quot;&amp;&amp;&quot;2n+1&quot;||!nthRe2.test(a)&amp;&amp;&quot;n+&quot;+a||a),f=(m[1]||1)-0,l=m[2]-0;for(var i=0,n;n=c[i];i++){var pn=n.parentNode;if(batch!=pn._batch){var j=0;for(var cn=pn.firstChild;cn;cn=cn.nextSibling){if(cn.nodeType==1){cn.nodeIndex=++j;}}
pn._batch=batch;}
if(f==1){if(l==0||n.nodeIndex==l){r[++ri]=n;}}else if((n.nodeIndex+l)%f==0){r[++ri]=n;}}
return r;},&quot;only-child&quot;:function(c){var r=[],ri=-1;;for(var i=0,ci;ci=c[i];i++){if(!prev(ci)&amp;&amp;!next(ci)){r[++ri]=ci;}}
return r;},&quot;empty&quot;:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var cns=ci.childNodes,j=0,cn,empty=true;while(cn=cns[j]){++j;if(cn.nodeType==1||cn.nodeType==3){empty=false;break;}}
if(empty){r[++ri]=ci;}}
return r;},&quot;contains&quot;:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if((ci.textContent||ci.innerText||'').indexOf(v)!=-1){r[++ri]=ci;}}
return r;},&quot;nodeValue&quot;:function(c,v){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.firstChild&amp;&amp;ci.firstChild.nodeValue==v){r[++ri]=ci;}}
return r;},&quot;checked&quot;:function(c){var r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(ci.checked==true){r[++ri]=ci;}}
return r;},&quot;not&quot;:function(c,ss){return sitools.component.users.datasets.DomQuery.filter(c,ss,true);},&quot;any&quot;:function(c,selectors){var ss=selectors.split('|'),r=[],ri=-1,s;for(var i=0,ci;ci=c[i];i++){for(var j=0;s=ss[j];j++){if(sitools.component.users.datasets.DomQuery.is(ci,s)){r[++ri]=ci;break;}}}
return r;},&quot;odd&quot;:function(c){return this[&quot;nth-child&quot;](c,&quot;odd&quot;);},&quot;even&quot;:function(c){return this[&quot;nth-child&quot;](c,&quot;even&quot;);},&quot;nth&quot;:function(c,a){return c[a-1]||[];},&quot;first&quot;:function(c){return c[0]||[];},&quot;last&quot;:function(c){return c[c.length-1]||[];},&quot;has&quot;:function(c,ss){var s=sitools.component.users.datasets.DomQuery.select,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){if(s(ss,ci).length&gt;0){r[++ri]=ci;}}
return r;},&quot;next&quot;:function(c,ss){var is=sitools.component.users.datasets.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=next(ci);if(n&amp;&amp;is(n,ss)){r[++ri]=ci;}}
return r;},&quot;prev&quot;:function(c,ss){var is=sitools.component.users.datasets.DomQuery.is,r=[],ri=-1;for(var i=0,ci;ci=c[i];i++){var n=prev(ci);if(n&amp;&amp;is(n,ss)){r[++ri]=ci;}}
return r;}}};}();Ext.query=sitools.component.users.datasets.DomQuery.select;Ext.namespace('sitools.component.users.datasets');sitools.component.users.datasets.XmlReader=function(meta,recordType){meta=meta||{};Ext.applyIf(meta,{idProperty:meta.idProperty||meta.idPath||meta.id,successProperty:meta.successProperty||meta.success});sitools.component.users.datasets.XmlReader.superclass.constructor.call(this,meta,recordType||meta.fields);};Ext.extend(sitools.component.users.datasets.XmlReader,Ext.data.XmlReader,{createAccessor:function(){var q=sitools.component.users.datasets.DomQuery;return function(key){if(Ext.isFunction(key)){return key;}
switch(key){case this.meta.totalProperty:return function(root,def){return q.selectNumber(key,root,def);};break;case this.meta.successProperty:return function(root,def){var sv=q.selectValue(key,root,true);var success=sv!==false&amp;&amp;sv!=='false';return success;};break;default:return function(root,def){return q.selectValue(key,root,def);};break;}};}()});Ext.namespace('sitools.user.component');sitools.user.component.viewDataDetail=Ext.extend(Ext.Panel,{datasetColumnModel:null,initComponent:function(){var rec;switch(this.fromWhere){case&quot;openSearch&quot;:this.grid=this.grid;this.recSelected=this.grid.getSelectionModel().getSelected();this.url=this.recSelected.data.guid;break;case&quot;dataView&quot;:break;case&quot;plot&quot;:break;default:this.recSelected=this.selections[0];if(Ext.isEmpty(this.recSelected)){Ext.Msg.alert(i18n.get('label.error'),i18n.get('label.noSelection'));return;}
var primaryKeyValue=&quot;&quot;,primaryKeyName=&quot;&quot;;Ext.each(this.recSelected.fields.items,function(field){if(field.primaryKey){this.primaryKeyName=field.name;}},this);this.primaryKeyValue=this.recSelected.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break;}
this.layout=&quot;border&quot;;this.linkStore=new Ext.data.Store({fields:['name','value','image','behavior','columnRenderer']});var linkDataview=new Ext.DataView({store:this.linkStore,tpl:new Ext.XTemplate('&lt;ul&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;li id=&quot;{name}&quot; class=&quot;img-link&quot;','&lt;tpl if=&quot;this.hasToolTip(toolTip)&quot;&gt;','ext:qtip=&quot;{toolTip}&quot;&gt;','&lt;/tpl&gt;','&lt;tpl if=&quot;this.hasToolTip(toolTip) == false&quot;&gt;','ext:qtip=&quot;{name}&quot;&gt;','&lt;/tpl&gt;','&lt;img src=&quot;{image}&quot; /&gt;','&lt;/li&gt;','&lt;/tpl&gt;','&lt;/ul&gt;',{compiled:true,disableFormats:true,hasToolTip:function(toolTip){return!Ext.isEmpty(toolTip);}}),cls:'linkImageDataView',itemSelector:'li.img-link',overClass:'nodes-hover',selectedClass:'',singleSelect:true,multiSelect:false,autoScroll:true,listeners:{scope:this,click:this.handleClickOnLink}});this.formPanel=new Ext.FormPanel({labelAlign:&quot;top&quot;,anchor:&quot;100%&quot;,defaults:{labelStyle:'font-weight:bold;'},padding:10});this.linkPanel=new Ext.Panel({title:i18n.get(&quot;label.complementaryInformation&quot;),items:[linkDataview],anchor:&quot;100%&quot;});this.formPanelImg=new Ext.FormPanel({frame:true,autoScroll:true,region:&quot;east&quot;,hideLabels:true,split:(this.fromWhere!='dataView'),collapsible:(this.fromWhere!='dataView'),collapsed:(this.fromWhere!='dataView'),flex:1,title:(this.fromWhere=='dataView')?i18n.get(&quot;label.formImagePanelTitle&quot;):null});var centerPanelItems;if(this.fromWhere=='dataView'){centerPanelItems=[this.formPanel,this.formPanelImg,this.linkPanel];}
else{centerPanelItems=[this.formPanel,this.linkPanel];}
this.centerPanel=new Ext.Panel({autoScroll:true,frame:true,region:&quot;center&quot;,split:true,layout:{type:'anchor'},items:centerPanelItems});this.getCmDefAndbuildForm();this.componentType='dataDetail';if(this.fromWhere=='dataView'){this.items=[this.centerPanel];}
else{this.items=[this.centerPanel,this.formPanelImg];}
this.listeners={scope:this,afterrender:function(panel){panel.getEl().on(&quot;contextmenu&quot;,function(e,t,o){e.stopPropagation();},this);}};sitools.user.component.viewDataDetail.superclass.initComponent.call(this);},afterRender:function(){this._loadMaskAnchor=Ext.get(this.body.dom);sitools.user.component.viewDataDetail.superclass.afterRender.apply(this,arguments);},_getSettings:function(){return{objectName:&quot;viewDataDetail&quot;,preferencesPath:this.preferencesPath,preferencesFileName:this.preferencesFileName};},goNext:function(){if(Ext.isEmpty(this.grid)){return;}
var rec,rowSelect;switch(this.fromWhere){case&quot;openSearch&quot;:rowSelect=this.grid.getSelectionModel();if(!rowSelect.selectNext()){return;}
rec=rowSelect.getSelected();this.url=rec.data.guid;break;case&quot;sitools.user.component.dataviews.tplView.TplView&quot;:var index=this.grid.getStore().indexOf(this.recSelected);var nextRec=this.grid.getStore().getAt(index+1);if(Ext.isEmpty(nextRec)){return;}
this.primaryKeyValue=nextRec.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;this.recSelected=nextRec;this.grid.select(nextRec);break;default:rowSelect=this.grid.getSelectionModel();if(!rowSelect.selectNext()){return;}
rec=rowSelect.getSelected();this.primaryKeyValue=rec.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break;}
this.getCmDefAndbuildForm();},goPrevious:function(){if(Ext.isEmpty(this.grid)){return;}
var rec,rowSelect;switch(this.fromWhere){case&quot;openSearch&quot;:rowSelect=this.grid.getSelectionModel();if(!rowSelect.selectPrevious()){return;}
rec=rowSelect.getSelected();this.url=rec.data.guid;break;case&quot;sitools.user.component.dataviews.tplView.TplView&quot;:var index=this.grid.getStore().indexOf(this.recSelected);var nextRec=this.grid.getStore().getAt(index-1);if(Ext.isEmpty(nextRec)){return;}
this.primaryKeyValue=nextRec.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;this.recSelected=nextRec;this.grid.select(nextRec);break;default:rowSelect=this.grid.getSelectionModel();if(!rowSelect.selectPrevious()){return;}
rec=rowSelect.getSelected();this.primaryKeyValue=rec.get(this.primaryKeyName);this.primaryKeyValue=encodeURIComponent(this.primaryKeyValue);this.url=this.baseUrl+this.primaryKeyValue;break;}
this.getCmDefAndbuildForm();},getCmDefAndbuildForm:function(){if(Ext.isEmpty(this.datasetColumnModel)){Ext.Ajax.request({url:this.datasetUrl,method:'GET',scope:this,success:function(ret){try{var Json=Ext.decode(ret.responseText);if(!Json.success){throw Json.message;}
this.datasetColumnModel=Json.dataset.columnModel;this.buildForm();}
catch(err){Ext.Msg.alert(i18n.get('label.error'),err);}},failure:alertFailure});}
else{this.buildForm();}},buildForm:function(){if(!Ext.isEmpty(this._loadMaskAnchor)){this._loadMaskAnchor.mask(i18n.get('label.waitMessage'),&quot;x-mask-loading&quot;);}
if(!Ext.isEmpty(this.url)){this.linkStore.removeAll();Ext.Ajax.request({url:this.url,method:'GET',scope:this,success:function(ret){var data=Ext.decode(ret.responseText);var itemsForm=[];var itemsFormImg=[];if(!data.success){Ext.Msg.alert(i18n.get('label.information'),&quot;Server error&quot;);return false;}
var record=data.record;var id=record.id;var attributes=record.attributeValues;if(attributes!==undefined){var i;for(i=0;i&lt;attributes.length;i++){var name=attributes[i].name;var column=this.findColumn(name);var value=attributes[i].value;var valueFormat=value;if(sql2ext.get(column.sqlColumnType)=='dateAsString'){valueFormat=sitools.user.component.dataviews.dataviewUtils.formatDate(value,column);}
if(sql2ext.get(column.sqlColumnType)=='boolean'){valueFormat=value?i18n.get('label.true'):i18n.get('label.false');}
var item=new Ext.BoxComponent({fieldLabel:column.header,labelSeparator:&quot;&quot;,html:(Ext.isEmpty(valueFormat)||!Ext.isFunction(valueFormat.toString))?valueFormat:valueFormat.toString()});if(Ext.isEmpty(column)||Ext.isEmpty(column.columnRenderer)){itemsForm.push(item);}
else{var columnRenderer=column.columnRenderer;var behavior=&quot;&quot;;if(!Ext.isEmpty(column.columnRenderer)){behavior=column.columnRenderer.behavior;var html=sitools.user.component.dataviews.dataviewUtils.getRendererHTML(column,{});switch(behavior){case ColumnRendererEnum.URL_LOCAL:case ColumnRendererEnum.URL_EXT_NEW_TAB:case ColumnRendererEnum.URL_EXT_DESKTOP:case ColumnRendererEnum.DATASET_ICON_LINK:if(!Ext.isEmpty(value)){if(!Ext.isEmpty(columnRenderer.linkText)){item=new Ext.BoxComponent({fieldLabel:column.header,labelSeparator:&quot;&quot;,html:String.format(html,value)});itemsForm.push(item);}else if(!Ext.isEmpty(columnRenderer.image)){var rec={name:name,value:value,image:columnRenderer.image.url,behavior:behavior,columnRenderer:columnRenderer,toolTip:columnRenderer.toolTip};rec=new Ext.data.Record(rec);this.linkStore.add(rec);}}
break;case ColumnRendererEnum.IMAGE_FROM_SQL:case ColumnRendererEnum.IMAGE_THUMB_FROM_IMAGE:if(!Ext.isEmpty(value)){var tooltip=&quot;&quot;;var imageUrl=&quot;&quot;;if(Ext.isEmpty(columnRenderer.toolTip)){tooltip=columnRenderer.toolTip;}
else{tooltip=col.header;}
if(!Ext.isEmpty(columnRenderer.url)){imageUrl=columnRenderer.url;}else if(!Ext.isEmpty(columnRenderer.columnAlias)){imageUrl=this.findRecordValue(record,columnRenderer.columnAlias);}
item=new Ext.BoxComponent({html:String.format(html,value,imageUrl),tooltip:tooltip,cls:&quot;x-form-item&quot;});}
itemsFormImg.push(item);break;case ColumnRendererEnum.NO_CLIENT_ACCESS:break;default:item=new Ext.BoxComponent({fieldLabel:column.header,labelSeparator:&quot;&quot;,html:String.format(html,value)});itemsForm.push(item);break;}}}}
this.formPanel.removeAll();this.formPanelImg.removeAll();this.formPanel.add(itemsForm);this.formPanel.doLayout();if(this.linkStore.getCount()===0){this.linkPanel.setVisible(false);}else{this.linkPanel.setVisible(true);this.linkPanel.doLayout();}
if(itemsFormImg.length===0){this.formPanelImg.setVisible(false);}else{this.formPanelImg.add(itemsFormImg);this.formPanelImg.setVisible(true);this.linkPanel.doLayout();}
this.doLayout();if(this._loadMaskAnchor&amp;&amp;this._loadMaskAnchor.isMasked()){this._loadMaskAnchor.unmask();}}},failure:function(){alertFailure();if(this._loadMaskAnchor&amp;&amp;this._loadMaskAnchor.isMasked()){this._loadMaskAnchor.unmask();}}});}},findColumn:function(columnAlias){var result=null;Ext.each(this.datasetColumnModel,function(column){if(column.columnAlias==columnAlias){result=column;return;}},this);return result;},findRecordValue:function(record,columnAlias){var result=null;Ext.each(record.attributeValues,function(attr){if(attr.name==columnAlias){result=attr.value;return;}},this);return result;},handleClickOnLink:function(dataView,index,node,e){var data=dataView.getRecord(node).data;var behavior=data.behavior;switch(behavior){case ColumnRendererEnum.URL_LOCAL:sitools.user.component.dataviews.dataviewUtils.downloadData(data.value);break;case ColumnRendererEnum.URL_EXT_NEW_TAB:window.open(data.value);break;case ColumnRendererEnum.URL_EXT_DESKTOP:sitools.user.component.dataviews.dataviewUtils.showDisplayableUrl(data.value,data.columnRenderer.displayable);break;case ColumnRendererEnum.DATASET_ICON_LINK:sitools.user.component.dataviews.dataviewUtils.showDetailsData(data.value,data.columnRenderer.columnAlias,data.columnRenderer.datasetLinkUrl);break;default:break;}},showMeInFixedNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);},showMeInDesktopNav:function(me,config){Ext.apply(config.windowSettings,{width:config.windowSettings.winWidth||DEFAULT_WIN_WIDTH,height:config.windowSettings.winHeight||DEFAULT_WIN_HEIGHT});SitoolsDesk.openModalWindow(me,config);}});Ext.namespace('sitools.user.component');sitools.user.component.simpleViewDataDetail=Ext.extend(Ext.Panel,{initComponent:function(){this.url=this.urlDataDetail;var urlSplited=this.url.split('/');this.url=&quot;&quot;;for(var i=0;i&lt;urlSplited.length;i++){if(i&lt;urlSplited.length-1){this.url+=urlSplited[i]+&quot;/&quot;;}else{this.url+=encodeURIComponent(urlSplited[i]);}}
this.layout=&quot;fit&quot;;this.autoScroll=true;this.formPanel=new Ext.FormPanel({frame:true,autoScroll:true,labelWidth:150,labelAlign:&quot;top&quot;});var itemsForm=[];Ext.Ajax.request({url:this.url,method:'GET',scope:this,success:function(ret){var data=Ext.decode(ret.responseText);if(!data.success){Ext.Msg.alert(i18n.get('label.information'),&quot;Server error&quot;);return false;}
var record=data.record;var id=record.id;var attributes=record.attributeValues;if(attributes!==undefined){var i;for(i=0;i&lt;attributes.length;i++){var name=attributes[i].name;var value=attributes[i].value;var item;if(value!==null&amp;&amp;value.length&gt;100){item=new Ext.form.TextArea({fieldLabel:name,value:value,anchor:&quot;90%&quot;,readOnly:true});}else{item=new Ext.form.TextField({fieldLabel:name,value:value,anchor:&quot;90%&quot;,readOnly:true});}
itemsForm.push(item);}
this.formPanel.add(itemsForm);this.formPanel.doLayout();}},failure:alertFailure});this.componentType='detail';this.items=[this.formPanel];sitools.user.component.simpleViewDataDetail.superclass.initComponent.call(this);},_getSettings:function(){return{};}});Ext.namespace('sitools.component.version');sitools.component.version.sitoolsVersion=Ext.extend(Ext.Panel,{layout:'fit',version:null,initComponent:function(){this.versionUrl=loadUrl.get('APP_URL')+'/version';var title=new Ext.form.Label({html:'&lt;h2&gt;SITools2&lt;/h2'});var logo=new Ext.form.Label({html:'&lt;img src='+loadUrl.get('APP_URL')+'/res/images/logo_02_tailleMoyenne.png&gt;'});var credits=new Ext.form.Label({html:'&lt;p&gt;Copyright 2010, 2011, 2012 CNES&lt;/p&gt;'});var website=new Ext.form.Label({html:'&lt;a href=&quot;http://www.sitools2.sourceforge.net&quot;&gt;sitools2.sourceforge.net&lt;/&gt;'});this.versionLabel=new Ext.form.Label({});var panelVersion=new Ext.Panel({title:i18n.get(&quot;label.version&quot;),layout:'fit',padding:10});var panelLicence=new Ext.ux.ManagedIFrame.Panel({title:i18n.get(&quot;label.licence&quot;),layout:'fit',defaultSrc:loadUrl.get('APP_URL')+&quot;/res/licences/gpl-3.0.txt&quot;});panelVersion.add([logo,title,this.versionLabel,credits,website]);this.tabs=new Ext.TabPanel({activeTab:0,items:[panelVersion,panelLicence]});this.items=[this.tabs];this.listeners={scope:this,resize:function(window){var size=window.body.getSize();this.tabs.setSize(size);}};sitools.component.version.sitoolsVersion.superclass.initComponent.call(this);},afterRender:function(){sitools.component.version.sitoolsVersion.superclass.afterRender.apply(this,arguments);Ext.Ajax.request({url:this.versionUrl,method:'GET',scope:this,success:function(ret){var json=Ext.decode(ret.responseText);if(!json.success){Ext.Msg.alert(i18n.get('label.warning'),json.message);return false;}
this.version=json.version;this.versionLabel.setText(&quot;&lt;h3&gt;Version : &quot;+this.version+&quot;&lt;/h3&gt;&quot;,false);},failure:alertFailure});var size=this.ownerCt.body.getSize();this.tabs.setSize(size);}});function showVersion(){var versionHelp=Ext.getCmp('winVersionId');if(!versionHelp){var panelHelp=new sitools.component.version.sitoolsVersion();versionHelp=new Ext.Window({title:i18n.get('label.version'),id:'winVersionId',items:[panelHelp],modal:false,width:700,height:480,resizable:false,modal:true,buttons:[{text:i18n.get('label.close'),handler:function(){this.ownerCt.ownerCt.close();}}]});versionHelp.show();}else{versionHelp.show();}}</pre>
</body>
</html>
